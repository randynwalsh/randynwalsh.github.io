anonymousFunc = function () {
    window.cachedFileNames["jsb_mdl"] = "jsb_mdl"
    if (!window.cached_jsb_mdl) window.cached_jsb_mdl = {}
    window.cached_jsb_mdl["addclassnames"] = "sub addClassNames(dbGroups)\xFE    * %options aspxC-\xFE    \xFE    for each tagName in dbGroups\xFE         v = dbGroups[tagName]\xFE         \xFE         if isJson(v) then\xFE            v.class = \"group\"\xFE            call addClassNames(v)\xFE            \xFE        elseif isArray(v) then\xFE            \xFE            call addClassNames(v)\xFE            \xFE        else\xFE            v.class = \"database\"\xFE        end if\xFE    next\xFEend sub            ";
    var z = "Subroutine addColumn(ProjectName, PageName, ViewName, ColumnID)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE";
    z += "    ColumnIdx = @findViewColumn(dataSet, ColumnID)\xFE";
    z += "\xFE";
    z += "    NewColumnID = Trim(InputBox(\"Add Column\", \"New column name\"))\xFE";
    z += "    If Len(NewColumnID) = 0 Or NewColumnID = Chr(27) Then Return\xFE";
    z += "    \xFE";
    z += "    NewColumnIdx = @findViewColumn(dataSet, NewColumnID)\xFE";
    z += "    If NewColumnIdx Then\xFE";
    z += "        viewRow = dataSet.columns[NewColumnIdx]\xFE";
    z += "        \xFE";
    z += "    Else\xFE";
    z += "        NewColumnIdx = UBound(dataSet.columns) + 1\xFE";
    z += "        viewRow = Clone(dataSet.columns[ColumnIdx]) ;* Clone Previous Column\xFE";
    z += "        viewRow.name = NewColumnID\xFE";
    z += "        viewRow.label = NewColumnID\xFE";
    z += "        viewRow.transferurl = \"\"\xFE";
    z += "        dataSet.columns[-1] = viewRow\xFE";
    z += "\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    viewRow.display = \"visible\"\xFE";
    z += "    viewRow.index = 0\xFE";
    z += "    viewRow.index = @highestViewIndex(dataSet)\xFE";
    z += "\xFE";
    z += "    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edc-\":System(28):\": \":@Errors\xFE";
    z += "    \xFE";
    z += "    If viewRow.control = \"button\" Then\xFE";
    z += "        Call setButtonURL(ProjectName, PageName, ViewName, NewColumnID)\xFE";
    z += "    Else\xFE";
    z += "        Call @jsb_mdl.ReGenPageModel(ProjectName, PageName, False)\xFE";
    z += "    End If\xFE";
    z += "End Subroutine"
    window.cached_jsb_mdl["addcolumn"] = z;
    var z = "Subroutine addExtraColumns2ViewModel(Model, templateName)\xFE";
    z += "   // for aspxc    \xFE";
    z += "End Sub\xFE";
    z += "\xFE";
    z += "Subroutine addExtraColumns2ViewModel(Model, templateName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    Read Template From @fHandle(\"JSB_viewTemplates\"), templateName Else\xFE";
    z += "        If templateName <> \"\" Then @Alert(\"JSB_viewTemplates Template \":templateName:\" not found\")\xFE";
    z += "        Return\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Columns = Field(Template, \"******************************************************************************\", 1)\xFE";
    z += "    Columns = Replace(Columns, Chr(254), \" \")\xFE";
    z += "    If Trim(Columns) = \"\" Then Return\xFE";
    z += "    Columns = JSon(\"[\" : Columns : \"]\")\xFE";
    z += "    If Typeof(Columns) = \"String\" Then\xFE";
    z += "        @Alert(\"Your JSB_viewTemplates \":templateName:\" does not have valid JSON extra columns\")\xFE";
    z += "        Return\xFE";
    z += "    End If\xFE";
    z += "    For Each XRow In Columns\xFE";
    z += "        Model.columns[-1] = XRow\xFE";
    z += "    Next\xFE";
    z += "End function"
    window.cached_jsb_mdl["addextracolumns2viewmodel"] = z;
    var z = "function addFromAnotherView(ProjectName, ViewName, dataSet)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    fDict = @fHandle(\"DICT\", ProjectName)\xFE";
    z += "    Select fDict To Sl Where \"ItemId Like '%.view'\" Else Return False\xFE";
    z += "    Values = GetList(Sl)\xFE";
    z += "    tPrefix = \"Table: \"\xFE";
    z += "\xFE";
    z += "    List = @fileList()\xFE";
    z += "    For Each FileName In List\xFE";
    z += "        Values<-1> = tPrefix:FileName\xFE";
    z += "    Next\xFE";
    z += "    Values = @Sort(Values)\xFE";
    z += "\xFE";
    z += "    Ans = @InputDropDownBox(\"Choose View\", \"Pick a view to choose from\", Values)\xFE";
    z += "    If Ans = \"\" Or Ans = Chr(27) Then Return False\xFE";
    z += "\xFE";
    z += "    If Left(Ans, Len(tPrefix)) = tPrefix Then\xFE";
    z += "        Ans = Mid(Ans, Len(tPrefix) + 1)\xFE";
    z += "        possibleColumns = @getTableColumnDefs(Ans, True, True)\xFE";
    z += "    Else\xFE";
    z += "        ReadJSon anotherView From fDict, Ans Else Return False\xFE";
    z += "        possibleColumns = anotherView.columns\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Return @ChooseColumns_ss(ProjectName, ViewName, dataSet, possibleColumns)\xFE";
    z += "End function"
    window.cached_jsb_mdl["addfromanotherview"] = z;
    window.cached_jsb_mdl["addnestedviews"] = "Function addNestedViews(ProjectName, Views)\xFE    * %options aspxC-\xFE    \xFE    For Each ViewName In Views\xFE        ReadJson Vs From @fHandle(\"DICT\", ProjectName), ViewName Then\xFE            For Each Column In Vs.columns\xFE                CtlName = LCase(Column.control)\xFE                If CtlName = \"json_inline\" Or CtlName = \"json_inline\" Then\xFE                    newViewName = Column.useview\xFE                    Locate newViewName In Views Else\xFE                        Views[-1] = newViewName\xFE                        addNestedViews(ProjectName, Views)\xFE                    End If\xFE                End If\xFE            Next\xFE        End If\xFE    Next\xFE\xFE    Return Views\xFEEnd Function";
    var z = "Function addPageToMenu(ProjectName, pageName, WhichMenuPage)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    If ProjectName = \"\" Then @Errors = \"Missing URL Parameters\"; Return False\xFE";
    z += "    \xFE";
    z += "    pageName = @DropIfRight(pageName, \".page\", True)\xFE";
    z += "    WhichMenuPage = @DropIfRight(WhichMenuPage, \".page\", True)\xFE";
    z += "    \xFE";
    z += "    ReadJson pageDataSet From @fHandle(\"dict\", ProjectName), WhichMenuPage:\".page\" Else\xFE";
    z += "        objectModel = @modelForPage(projectName)\xFE";
    z += "        pageType = \"simplePage\"\xFE";
    z += "        Call getExtraPageColumns(objectModel.columns, pageType)\xFE";
    z += "        pageDataSet = @newRow(\"Menu\", objectModel.columns)\xFE";
    z += "        pageDataSet.templateName = pageType\xFE";
    z += "        pageDataSet.menuitem = \"Admin\"\xFE";
    z += "        pageDataSet.centerview = WhichMenuPage:\".view\"\xFE";
    z += "        WriteJson pageDataSet On @fHandle(\"dict\", ProjectName), WhichMenuPage:\".page\" Else Stop @(-1):\"Edp-\":System(28):\": \":@Errors\xFE";
    z += "    End If\xFE";
    z += "        \xFE";
    z += "    ViewName = pageDataSet.centerview\xFE";
    z += "    ReadJson viewDataSet From @fHandle(\"DICT\", ProjectName), ViewName Else\xFE";
    z += "        viewDataSet = @createNewView(ViewName)\xFE";
    z += "        viewDataSet.templateName = \"NoCrud_Form\"\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    AlreadyThere = False\xFE";
    z += "    For Each C In viewDataSet.columns\xFE";
    z += "        If C.name = pageName Then AlreadyThere = True\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    If !AlreadyThere Then\xFE";
    z += "        viewDataSet.columns[-1] = { \"name\": pageName, \"label\": pageName, \"control\": \"button\", \"display\": \"visible\", \"datatype\": \"string\", \"suppresslabel\": true, \"width\": 12, \"transferurl\": pageName:\".page\", \"transferto\": \"10\", \"transferaddfrompage\": false, \"fullline\": true, \"ctlstyle\": \"width: 99%; height: 50px; display: block; margin: auto; max-width: 300px;\" }\xFE";
    z += "        WriteJson viewDataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"Edp-\":System(28):\": \":@Errors\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Call ReGenPageModel(ProjectName, WhichMenuPage, False)\xFE";
    z += "     \xFE";
    z += "    ' Put a back button on the page\xFE";
    z += "    ReadJson viewDataSet From @fHandle(\"dict\", ProjectName), pageName:\".view\" Then\xFE";
    z += "        hasSave = False\xFE";
    z += "        hasCancel = False\xFE";
    z += "        \xFE";
    z += "        For Each Btn In viewDataSet.custombtns\xFE";
    z += "            If Btn.buttontxt = \"Save\" Then\xFE";
    z += "                hasSave = True\xFE";
    z += "                If Btn.url = \"\" Then Btn.url = WhichMenuPage:\".page\"\xFE";
    z += "            End If\xFE";
    z += "            \xFE";
    z += "            If Btn.buttontxt = \"Cancel\" Then\xFE";
    z += "                hasCancel = True\xFE";
    z += "                If Btn.url = \"\" Then Btn.url = WhichMenuPage:\".page\"\xFE";
    z += "            End If\xFE";
    z += "            \xFE";
    z += "            If Btn.buttontxt = \"Back\" Then\xFE";
    z += "                hasCancel = True\xFE";
    z += "                If Btn.url = \"\" Then Btn.url = WhichMenuPage:\".page\"\xFE";
    z += "            End If\xFE";
    z += "        Next\xFE";
    z += "        \xFE";
    z += "        WriteJson viewDataSet On @fHandle(\"dict\", ProjectName), pageName:\".view\" Else Alert(@Errors)\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Return True\xFE";
    z += "End Function\xFE";
    z += "Program addPageToMenu\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    if !isManager() Then Stop \"You must be at least a data manager to run program\"\xFE";
    z += "\xFE";
    z += "    ProjectName = @ParamVar('ProjectName')\xFE";
    z += "    pageName = @ParamVar('pageName')\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "    closeWindow = @ParamVar('closeWindow')\xFE";
    z += "\xFE";
    z += "    If !addPageToMenu(ProjectName, pageName, \"Menu\") Then Alert(@Errors)\xFE";
    z += "    \xFE";
    z += "    If fromPage Then @Response.Redirect(fromPage)\xFE";
    z += "    If closeWindow Or !@hasParentProcess Then @Server.End\xFE";
    z += "    \xFE";
    z += "    @Response.Redirect(@jsbRootExecute(pageName))\xFE";
    z += "End Program"
    window.cached_jsb_mdl["addpagetomenu"] = z;
    window.cached_jsb_mdl["addpagetoreferencemenu"] = "Program addPageToReferenceMenu\xFE    * %options aspxC-\xFE    \xFE    if !isManager() Then Stop \"You must be at least a data manager to run program\"\xFE\xFE    ProjectName = @ParamVar('ProjectName')\xFE    pageName = @ParamVar('pageName')\xFE    fromPage = @ParamVar('fromPage')\xFE    closeWindow = @ParamVar('closeWindow')\xFE\xFE    If !addPageToMenu(ProjectName, pageName, \"ReferenceMenu\") Then Alert(@Errors)\xFE    \xFE    If fromPage Then @Response.Redirect(fromPage)\xFE    If closeWindow Or !@hasParentProcess Then @Server.End\xFE    \xFE    @Response.Redirect(@jsbRootExecute(pageName))\xFEEnd Program";
    var z = "function addViewBtn(ProjectName, pageName, ViewName, Optional byVal modelAfterBtn)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    defaultRow = getJsonDefDefaults('customBtns')\xFE";
    z += "    ReadJSon ObjectModel From @fHandle(\"DICT\", ProjectName), ViewName Else Debug @Alert('Unable to find view ':ViewName); Return False\xFE";
    z += "    \xFE";
    z += "    If modelAfterBtn Then\xFE";
    z += "        BtnI = @findBtnI(ObjectModel, modelAfterBtn)\xFE";
    z += "        If BtnI Then\xFE";
    z += "            Btn = ObjectModel.custombtns[BtnI]\xFE";
    z += "            For Each Property In Btn\xFE";
    z += "                If Btn[Property] Then defaultRow[Property] = Btn[Property]\xFE";
    z += "            Next\xFE";
    z += "            \xFE";
    z += "            defaultRow.url = \"\"\xFE";
    z += "            defaultRow.buttontxt = \"\"\xFE";
    z += "            defaultRow.customcall = \"\"\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Ans = @Popup_jsondef(ProjectName, \"jsb_jsondefs\", \"customBtns\", \"\", \"\", defaultRow, \"80%\", \"80%\", \"Buttons for view \":ViewName)\xFE";
    z += "    If !Ans Then Return False\xFE";
    z += "    \xFE";
    z += "    If !ObjectModel.custombtns Then ObjectModel.custombtns = []\xFE";
    z += "    For Each Btn In JSon(Ans)\xFE";
    z += "        ObjectModel.custombtns[-1] = Btn\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    WriteJSon ObjectModel On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "    Call @Jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFE";
    z += "    Return True\xFE";
    z += "End function"
    window.cached_jsb_mdl["addviewbtn"] = z;
    var z = "* Returns SqlFilter and SqlColumns as variable in HTML\xFE";
    z += "\xFE";
    z += "function buildSqlSelect(viewModel, optional byval hasLocalFormVars, optional byval orderAllColumns)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    Dim restoreDB As String = \"\"\xFE";
    z += "    \xFE";
    z += "    Inputs = viewModel.inputs\xFE";
    z += "    BuildSelect = [] // [\"      Dim sqlFilter As String = ''\"]\xFE";
    z += "\xFE";
    z += "    \xFE";
    z += "    if Inputs Then\xFE";
    z += "        if viewModel.attachdb then\xFE";
    z += "            restoreDB = @attachedDB\xFE";
    z += "            attachdb viewModel.attachdb else debug ;* No db??\xFE";
    z += "        end if\xFE";
    z += "\xFE";
    z += "        Inputs = JSon(inputs)\xFE";
    z += "        LoadVars = []\xFE";
    z += "        checkRequired = []\xFE";
    z += "        lpcnt = 0\xFE";
    z += "        \xFE";
    z += "        if viewModel.customsql Then\xFE";
    z += "            FlatFile = False\xFE";
    z += "            TableColumns = getColumnDefinitions(viewModel.customsql, columnNames) // Sorted by Ordinal\xFE";
    z += "        Else\xFE";
    z += "            FlatFile = True\xFE";
    z += "            TableColumns = getColumnDefinitions(viewModel.tableName, columnNames)\xFE";
    z += "            Open viewModel.tableName to tFile Then\xFE";
    z += "                if left(tFile, 4) = \"ado:\" Then FlatFile = False\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        \xFE";
    z += "        dbColumns = {} // reorder into json\xFE";
    z += "        for each dbColumn in tableColumns\xFE";
    z += "            dbColumns[dbColumn.name] = dbColumn\xFE";
    z += "        next\xFE";
    z += "        \xFE";
    z += "        * Fetch each Input into a local variable and check for required\xFE";
    z += "        for each Row in inputs\xFE";
    z += "            If row.name = \"\" Then row.name = row.field\xFE";
    z += "            varName = nicename(row.name) \xFE";
    z += "            if !varName then debug\xFE";
    z += "            \xFE";
    z += "            Op = row.operator\xFE";
    z += "            doCompareAs = row.datatype\xFE";
    z += "            if Len(op) > 2 And doCompareAs <> \"integer\" And op <> \"Dynamic\" Then doCompareAs = \"string\"  // Like and InList operators must be done as strings\xFE";
    z += "            \xFE";
    z += "            dbColumn = dbColumns[row.field]\xFE";
    z += "            if !dbColumn Then dbColumn = { datatype: row.datatype }\xFE";
    z += "            \xFE";
    z += "            sqlDataType = dbColumn.datatype // guid;autointeger;integer;double;boolean;string;date;time;datetime;currency;blob;png;jpg;url;memo;password;json;jsonarray\xFE";
    z += "            if !sqlDataType then \xFE";
    z += "                debug ; // Missing sqlDataType!\xFE";
    z += "            end if\xFE";
    z += "            \xFE";
    z += "            if doCompareAs = \"string\" then\xFE";
    z += "                missingParam = `IsNothing(`:varName:`)` // Allow paramvar={blank} to suffice as a valid empty string\xFE";
    z += "                hasParam = `!IsNothing(`:varName:`)` // Allow paramvar={blank} to suffice as a valid empty string\xFE";
    z += "            Else\xFE";
    z += "                missingParam = `!Len(`:varName:`)`  // integers, dates, boolean will fail on paramvar={blank} - must have a length\xFE";
    z += "                hasParam = `Len(`:varName:`)`  // integers, dates, boolean will fail on paramvar={blank} - must have a length\xFE";
    z += "            End if\xFE";
    z += "            \xFE";
    z += "            Select Case row.scope\xFE";
    z += "                case \"SessionVar\"\xFE";
    z += "                    LoadVars[-1] = `      Dim `:varName:` As String = @SessionVar(\"`:row.name:`\")`\xFE";
    z += "                    If Row.required Then checkRequired[-1] = `      `:`If `:missingParam:` Then @Errors = \"`:varName:` is a required session parameter\";`\xFE";
    z += "\xFE";
    z += "                case \"ApplicationVar\"\xFE";
    z += "                    LoadVars[-1] = `      Dim `:varName:` As String = @Application(\"`:row.name:`\")`\xFE";
    z += "                    If Row.required Then checkRequired[-1] = `   If `:missingParam:` Then @Errors = \"`:varName:` is a required application parameter\";`\xFE";
    z += "\xFE";
    z += "                case \"ProfileVar\"\xFE";
    z += "                    LoadVars[-1] = `   ReadJSon Profile From @fHandle(\"JSB_USERS\"), @username Else Profile = {}`\xFE";
    z += "                    LoadVars[-1] = `   Dim `:varName:` As String = Profile[\"`:row.name:`\"]`\xFE";
    z += "                    If Row.required Then checkRequired[-1] = `   If `:missingParam:` Then @Errors = \"`:varName:` is a required profile parameter\";`\xFE";
    z += "\xFE";
    z += "                case \"FormVar\"\xFE";
    z += "                    If hasLocalFormVars Then\xFE";
    z += "                        LoadVars[-1] = `   Dim `:varName:` As String = FormVars[\"`:row.name:`\"]`\xFE";
    z += "                    Else\xFE";
    z += "                        LoadVars[-1] = `   Dim `:varName:` As String = @FormVar(\"`:row.name:`\")`\xFE";
    z += "                    End If\xFE";
    z += "                    If Row.required Then checkRequired[-1] = `   If `:missingParam:` Then @Errors = \"`:varName:` is a required form variable parameter\";`\xFE";
    z += "\xFE";
    z += "                case \"memoryVar\"\xFE";
    z += "                    If hasLocalFormVars Then\xFE";
    z += "                        LoadVars[-1] = `   Dim `:varName:` As String = FormVars[\"memoryVar_`:row.name:`\"]`\xFE";
    z += "                    Else\xFE";
    z += "                        LoadVars[-1] = `   Dim `:varName:` As String = @FormVar(\"memoryVar_`:row.name:`\")`\xFE";
    z += "                    End If\xFE";
    z += "                    If Row.required Then checkRequired[-1] = `   If `:missingParam:` Then @Errors = \"`:varName:` is a required memory variable parameter\";`\xFE";
    z += "\xFE";
    z += "                case \"AppCode\"\xFE";
    z += "                    LoadVars[-1] = `   Dim `:varName:` As String = `:row.defaultvalue\xFE";
    z += "\xFE";
    z += "                case else\xFE";
    z += "                    LoadVars[-1] = `   Dim `:varName:` As String = @ParamVar(\"`:row.name:`\")`\xFE";
    z += "                    If Row.required Then checkRequired[-1] = `   If `:missingParam:` Then @Errors = \"`:varName:` is a required url/post parameter\";`\xFE";
    z += "            End Select\xFE";
    z += "\xFE";
    z += "            If Len(row.defaultvalue) And row.scope <> \"AppCode\" Then\xFE";
    z += "                DftVal = row.defaultvalue\xFE";
    z += "                \xFE";
    z += "                If IsNumeric(DftVal) Then\xFE";
    z += "                    LoadVars[-1] = `   If IsEmpty(`:varName:`) Then `:varName:` = `:DftVal\xFE";
    z += "                ElseIf Left(DftVal, 1) = \"{\" Then\xFE";
    z += "                    LoadVars[-1] = `   If `:missingParam:` Then `:varName:` = getDefaultValue(Nothing, \"`:DftVal:`\", \"`:row.name:`\", \"`:viewModel.name:`\")`\xFE";
    z += "                Else\xFE";
    z += "                    LoadVars[-1] = `   If `:missingParam:` Then `:varName:` = \"`:DftVal:`\"`\xFE";
    z += "                End If\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "            // Now we need to set the varName and the Cast\xFE";
    z += "            \xFE";
    z += "            // There are futher checks on IsNothing - so can't force a value yet\xFE";
    z += "            // If doCompareAs = \"boolean\" Then LoadVars[-1] = `   If !IsEmpty(`:varName:`) Then If `:varName:` Then `:varName:` = -1 Else `:varName:` = 0 `\xFE";
    z += "            // If doCompareAs = \"number\" Then LoadVars[-1] = `   If !IsEmpty(`:varName:`) And !`:varName:` Then `:varName:` = 0`\xFE";
    z += "            \xFE";
    z += "            \xFE";
    z += "            // (and) (lparen) (field) Pname) (scope) (datatype) (operator) (required) (rparen)\xFE";
    z += "            \xFE";
    z += "            If row.and Then \xFE";
    z += "                if row.lparen then\xFE";
    z += "                    lpCnt += 1\xFE";
    z += "                    cj = `iif(sqlFilter, ' And (', '(')`\xFE";
    z += "                else\xFE";
    z += "                    cj = `iif(sqlFilter, ' And ', '')`\xFE";
    z += "                end if\xFE";
    z += "            else\xFE";
    z += "                if row.lparen then\xFE";
    z += "                    lpCnt += 1\xFE";
    z += "                    cj = `iif(sqlFilter, ' Or (', '(')`\xFE";
    z += "                else\xFE";
    z += "                    cj = `iif(sqlFilter, ' Or ', '')`\xFE";
    z += "                end if\xFE";
    z += "            end if\xFE";
    z += "            \xFE";
    z += "            if !lpcnt Then BuildSelect[-1] = `          If `:hasParam:` Then`\xFE";
    z += "            BuildSelect[-1] = `              sqlFilter := `:cj:`:whereDynamicOperator(\"`:LCase(doCompareAs):`\", \"`:LCase(sqlDataType):`\", \"`:row.field:`\" , `:varName:`, \"`:row.operator:`\")`:iif(row.rparen And lpCnt, `)`, ``)\xFE";
    z += "            if !lpcnt Then BuildSelect[-1] = `           End If`\xFE";
    z += "            If row.rparen And lpCnt Then lpCnt -= 1 \xFE";
    z += "        next\xFE";
    z += "        \xFE";
    z += "        html = LoadVars\xFE";
    z += "        \xFE";
    z += "        possibleErrors = UBound(LoadVars) > 1\xFE";
    z += "        if checkRequired then\xFE";
    z += "            html[-1] = \"   @Errors = ''\"\xFE";
    z += "            html[-1] =     Join(checkRequired, crlf())\xFE";
    z += "            html[-1] = \"   If @Errors Then\"\xFE";
    z += "            html[-1] = \"      rtnErrors = @Errors\"\xFE";
    z += "            html[-1] = \"      sqlFilter = '1=0'\"\xFE";
    z += "            html[-1] = \"   Else\"\xFE";
    z += "            html[-1] =        Join(BuildSelect, crlf())\xFE";
    z += "            html[-1] = \"   End If\"\xFE";
    z += "        else\xFE";
    z += "            html[-1] = Join(BuildSelect, crlf())\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        if viewModel.orderby Then html[-1] = \"    sqlFilter := ` \":viewModel.orderby:\"`\"\xFE";
    z += "    Else\xFE";
    z += "        html = BuildSelect\xFE";
    z += "        if viewModel.orderby Then html[-1] = [\"    sqlFilter = `\":viewModel.orderby:\"`\"]\xFE";
    z += "    end if\xFE";
    z += "\xFE";
    z += "    * Build list of columns to fetch\xFE";
    z += "    Columns = @getSelectionColumns(viewModel, CNames, orderAllColumns)\xFE";
    z += "\xFE";
    z += "    html[-1] = \"   SqlColumns = `\":Join(CNames, \",\"):\"`\"\xFE";
    z += "\xFE";
    z += "    if restoreDB then attachdb restoreDB Else debug ;* Unable to restore DB\xFE";
    z += "    Return Join(Html, CRLF())\xFE";
    z += "End Function"
    window.cached_jsb_mdl["buildsqlselect"] = z;
    window.cached_jsb_mdl["buildtreeviewsublevel"] = "";
    window.cached_jsb_mdl["choosecolumns"] = "Subroutine ChooseColumns(ProjectName, pageName, ViewName)\xFE    * %options aspxC-\xFE    \xFE    fDict = @fHandle(\"DICT\", ProjectName)\xFE    ReadJSon dataSet From fDict, ViewName Else dataSet = @createNewView(ViewName)\xFE    possibleColumns = @getTableColumnDefs(dataSet.tableName, True, True)\xFE    \xFE    If @ChooseColumns_ss(ProjectName, ViewName, dataSet, possibleColumns) Then\xFE        WriteJSon dataSet On fDict, ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE        Call @Jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFE    End If\xFEEnd Sub";
    var z = "function ChooseColumns_ss(ByVal ProjectName As String, ByVal ViewName As String, ByVal dataSet As JSon, ByVal possibleColumns As Array, optional byval Question As String)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    Dim allColumns As String = []\xFE";
    z += "    if !Question then Question = \"Select your columns\"\xFE";
    z += "    \xFE";
    z += "    Dim needSort As Boolean = True\xFE";
    z += "    If Len(possibleColumns) Then\xFE";
    z += "        If HasTag(possibleColumns[LBound(possibleColumns)], \"Oridinal\") Then\xFE";
    z += "            possibleColumns = @Sort(possibleColumns, \"Oridinal\")\xFE";
    z += "            needSort = False\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    DIm Column As Json\xFE";
    z += "    For Each Column In possibleColumns\xFE";
    z += "        DIm CName As String = Trim(Column.name)\xFE";
    z += "        If CName Then allColumns[-1] = CName\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    Dim SelColumns As Array = []\xFE";
    z += "    For Each Column In dataSet.columns\xFE";
    z += "        CName = Column.name\xFE";
    z += "        \xFE";
    z += "        If CName Then\xFE";
    z += "            SelColumns[-1] = CName\xFE";
    z += "            Locate CName In allColumns Else allColumns[-1] = CName\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "    If Len(SelColumns) = 0 Then SelColumns = Clone(allColumns)\xFE";
    z += "    \xFE";
    z += "    If needSort Then allColumns = @Sort(allColumns)\xFE";
    z += "*\xFE";
    z += "* Basically a copy of @jsb_bf.InputMultiSelect\xFE";
    z += "*\xFE";
    z += "    Dim innerHtmlDialog As String = @Jsb_html.MultiSelectListBox(\"ddbox\", allColumns, SelColumns, []):@Br:@Br\xFE";
    z += "    innerHtmlDialog := @Jsb_bf.HtmlEncode(\"Add detached columns (comma seperated):\"):@Br:@Br\xFE";
    z += "    innerHtmlDialog := @Jsb_html.TextBox(\"addcols\")\xFE";
    z += "\xFE";
    z += "    innerHtmlDialog := Chr(28):`<input type=\"button\" value='or Select another table/view' class='Button'`\xFE";
    z += "    innerHtmlDialog := `   onclick=\"$('#msgboxResult').val(Chr(27)+'SA'); $('#dialog').dialog('close'); \"`\xFE";
    z += "    innerHtmlDialog := `/>&nbsp;<br /><br />`\xFE";
    z += "\xFE";
    z += "    innerHtmlDialog := `<input type=\"submit\" value='OK' class='Button'`\xFE";
    z += "    innerHtmlDialog := `onclick=\"\xFE";
    z += "      var v1 = formVar('ddbox');\xFE";
    z += "      var v2 = LTrim(formVar('addcols'));\xFE";
    z += "\xFE";
    z += "    v1 = Change(v1, ',', Chr(254));\xFE";
    z += "    v2 = Change(v2, ',', Chr(254));\xFE";
    z += "\xFE";
    z += "    if (v1 && v2) v1 += Chr(254) + v2; else v1 += v2; \xFE";
    z += "\xFE";
    z += "    $('#msgboxResult').val(v1); \xFE";
    z += "    $('#dialog').dialog('close'); \"`\xFE";
    z += "\xFE";
    z += "    innerHtmlDialog := `/>&nbsp;`\xFE";
    z += "    innerHtmlDialog := `<input type=\"button\" value='All' class='Button'`\xFE";
    z += "    innerHtmlDialog := `   onclick=\"multiSelectAll($('#ddbox'));\"`\xFE";
    z += "    innerHtmlDialog := `/>&nbsp;`\xFE";
    z += "\xFE";
    z += "    innerHtmlDialog := `<input type=\"button\" value='None' class='Button'`\xFE";
    z += "    innerHtmlDialog := `   onclick=\"multiSelectNone($('#ddbox'));\"`\xFE";
    z += "    innerHtmlDialog := `/>&nbsp;`\xFE";
    z += "\xFE";
    z += "    innerHtmlDialog := `<input type=\"submit\" value='Cancel' class='Button'`\xFE";
    z += "    innerHtmlDialog := `   onclick=\"$('#msgboxResult').val(Chr(27)); $('#dialog').dialog('close'); \"`\xFE";
    z += "    innerHtmlDialog := `/>&nbsp;`:Chr(29)\xFE";
    z += "\xFE";
    z += "    Dim Ans As Variant = @Jsb_bf.Dialog(Question, innerHtmlDialog, True, \"80%\", \"90%\")\xFE";
    z += "\xFE";
    z += "    If Ans = Chr(27) Then Return False\xFE";
    z += "    If Ans = Chr(27):'SA' Then Return @addFromAnotherView(ProjectName, ViewName, dataSet)\xFE";
    z += "    \xFE";
    z += "    Dim SelectedCols As Array = Split(Ans, AM())\xFE";
    z += "    \xFE";
    z += "    * check for New ones\xFE";
    z += "    Dim oldColumn As Json\xFE";
    z += "    Dim newColumn As Json\xFE";
    z += "    Dim PreviousDef As Boolean\xFE";
    z += "    \xFE";
    z += "    For Each selectedName As String In SelectedCols\xFE";
    z += "        PreviousDef = False\xFE";
    z += "        selectedName = Trim(selectedName)\xFE";
    z += "        \xFE";
    z += "        For Each oldColumn In dataSet.columns\xFE";
    z += "            If oldColumn.name = selectedName Then\xFE";
    z += "                PreviousDef = True\xFE";
    z += "                If oldColumn.datatype = \"\" Then oldColumn.datatype = \"string\"\xFE";
    z += "                If oldColumn.control = \"\" Then oldColumn.control = \"textbox\"\xFE";
    z += "                If isNothing(oldColumn.display) Then oldColumn.display = \"visible\"\xFE";
    z += "                If isNothing(oldColumn.sortable) Then oldColumn.sortable = \"1\"\xFE";
    z += "                If isNothing(oldColumn.width) Then oldColumn.width = 12\xFE";
    z += "                If isNothing(oldColumn.canedit) Then oldColumn.canedit = True\xFE";
    z += "                If isNothing(oldColumn.label) Then oldColumn.label = oldColumn.name\xFE";
    z += "                Exit For\xFE";
    z += "            End If\xFE";
    z += "        Next\xFE";
    z += "\xFE";
    z += "        * Add New ones\xFE";
    z += "        If !PreviousDef  Then\xFE";
    z += "            * New definition\xFE";
    z += "            For Each newColumn In possibleColumns\xFE";
    z += "                If newColumn.name = selectedName Then\xFE";
    z += "                    Call setColumnDefaults(newColumn.datatype, newColumn)\xFE";
    z += "                    dataSet.columns[-1] = newColumn\xFE";
    z += "                    PreviousDef = True\xFE";
    z += "                    Exit For\xFE";
    z += "                End If\xFE";
    z += "            Next\xFE";
    z += "            \xFE";
    z += "            If !PreviousDef Then\xFE";
    z += "                Model = @modelForAllColumns\xFE";
    z += "                newColumn = @Jsb_mdl.NewRow(ViewName, Model.columns)\xFE";
    z += "                newColumn.name = selectedName\xFE";
    z += "                newColumn.label = selectedName\xFE";
    z += "                newColumn.datatype = \"string\"\xFE";
    z += "                Call setColumnDefaults(\"string\", newColumn)\xFE";
    z += "                dataSet.columns[-1] = newColumn\xFE";
    z += "\xFE";
    z += "                If dataSet.tableName Then Write newColumn On @fHandle('dict', dataSet.tableName), \"!\":selectedName\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    For I = 1 To UBound(dataSet.columns) While I <= UBound(dataSet.columns)\xFE";
    z += "        oldColumn = dataSet.columns[I]\xFE";
    z += "        PreviousDef = False\xFE";
    z += "\xFE";
    z += "        For Each selectedName In SelectedCols\xFE";
    z += "            If oldColumn.name = selectedName Then\xFE";
    z += "                PreviousDef = True\xFE";
    z += "                Exit For\xFE";
    z += "            End If\xFE";
    z += "        Next\xFE";
    z += "\xFE";
    z += "        If !PreviousDef Then\xFE";
    z += "            * Delete this one\xFE";
    z += "            dataSet.columns.Delete(I)\xFE";
    z += "            I = I - 1\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    Return True\xFE";
    z += "End Sub"
    window.cached_jsb_mdl["choosecolumns_ss"] = z;
    var z = "Function clonePageModel(byval ProjectName, byval oldPageName, optional byval clonePageName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    oldPageName = @DropIfRight(oldPageName, \".page\", True)\xFE";
    z += "\xFE";
    z += "    if !clonePageName Then\xFE";
    z += "        clonePageName = Trim(@InputBox(\"Save a copy As\", \"Enter a clone pageName or '(' projectname clonePageName\", \"\", \"80%\", \"\"))\xFE";
    z += "        clonePageName = @DropIfRight(clonePageName, \".page\", True)\xFE";
    z += "        If clonePageName = Chr(27) Or clonePageName = \"\" Then Return \"\"\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    If Instr(clonePageName, \"(\") Then\xFE";
    z += "        CProjectName = Field(clonePageName, \"(\", 1)\xFE";
    z += "        clonePageName = DropLeft(clonePageName, \"(\")\xFE";
    z += "    Else\xFE";
    z += "        CProjectName = ProjectName\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    ReadJson Xxxx From @fHandle(\"DICT\", CProjectName), clonePageName:\".page\" Then\xFE";
    z += "        If @Msgbox(\"Confirm\", \"Page \":clonePageName:\" already exists, overwrite?\", \"Yes,*No\") = \"Yes\" Then Return \"\"\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    ReadJson pageDataSet From @fHandle(\"dict\", ProjectName), oldPageName:\".page\" Else @Errors = \"Unable to find page \":oldPageName; Return \"\"\xFE";
    z += "\xFE";
    z += "    If pageDataSet.centerview Then pageDataSet.centerview = @CloneViewTo(ProjectName, CProjectName, pageDataSet.centerview, makeCloneName(CProjectName, oldPageName, pageDataSet.centerview, clonePageName))\xFE";
    z += "    If pageDataSet.northview Then pageDataSet.northview = @CloneViewTo(ProjectName, CProjectName, pageDataSet.northview, makeCloneName(CProjectName, oldPageName, pageDataSet.northview, clonePageName))\xFE";
    z += "    If pageDataSet.southview Then pageDataSet.southview = @CloneViewTo(ProjectName, CProjectName, pageDataSet.southview, makeCloneName(CProjectName, oldPageName, pageDataSet.southview, clonePageName))\xFE";
    z += "    If pageDataSet.westview Then pageDataSet.westview = @CloneViewTo(ProjectName, CProjectName, pageDataSet.westview, makeCloneName(CProjectName, oldPageName, pageDataSet.westview, clonePageName))\xFE";
    z += "    If pageDataSet.eastview Then pageDataSet.eastview = @CloneViewTo(ProjectName, CProjectName, pageDataSet.eastview, makeCloneName(CProjectName, oldPageName, pageDataSet.eastview, clonePageName))\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "    If pageDataSet.parentview Then pageDataSet.parentview = @CloneViewTo(ProjectName, CProjectName, pageDataSet.parentview, makeCloneName(CProjectName, oldPageName, pageDataSet.parentview, clonePageName))\xFE";
    z += "    If pageDataSet.childview Then pageDataSet.childview = @CloneViewTo(ProjectName, CProjectName, pageDataSet.childview, makeCloneName(CProjectName, oldPageName, pageDataSet.childview, clonePageName))\xFE";
    z += "\xFE";
    z += "    pageDataSet.menuitem = ReplaceI(pageDataSet.menuitem, oldPageName, clonePageName)\xFE";
    z += "    pageDataSet.header = ReplaceI(pageDataSet.header, oldPageName, clonePageName)\xFE";
    z += "    \xFE";
    z += "    WriteJSon pageDataSet On @fHandle(\"DICT\", CProjectName), clonePageName:\".page\" Else Return \"\"\xFE";
    z += "    \xFE";
    z += "    Call updateMenu(ProjectName, True)\xFE";
    z += "    \xFE";
    z += "    Read Src From fHandle(CProjectName), oldPageName then   \xFE";
    z += "         Write Replace(Src, oldPageName, clonePageName) on fHandle(CProjectName), clonePageName else stop @Errors                                             \xFE";
    z += "     End If \xFE";
    z += "\xFE";
    z += "    Call ReGenPageModel(ProjectName, clonePageName, False)\xFE";
    z += "\xFE";
    z += "    Return clonePageName\xFE";
    z += "End Function\xFE";
    z += "Program clonePageModel\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    if !isManager() Then Stop \"You must be at least a data manager to run program\"\xFE";
    z += "\xFE";
    z += "    ProjectName = @ParamVar('ProjectName')\xFE";
    z += "    pageName = @ParamVar('pageName')\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "\xFE";
    z += "    If ProjectName = \"\" And InStr(@Sentence, '=') = 0 Then\xFE";
    z += "        Sentence = Field(@Sentence, \"(\", 1)\xFE";
    z += "        ProjectName = Field(Sentence, \" \", 2)\xFE";
    z += "        pageName = Field(Sentence, \" \", 3)\xFE";
    z += "        If LCase(ProjectName) = \"dict\" Then\xFE";
    z += "            ProjectName = Field(Sentence, \" \", 3)\xFE";
    z += "            pageName = Field(Sentence, \" \", 4)\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "    pageName = @DropIfRight(pageName, \".page\", True)\xFE";
    z += "\xFE";
    z += "    clonePageName = clonePageModel(ProjectName, pageName) \xFE";
    z += "    If clonePageName = Chr(27) Or clonePageName = \"\" Then\xFE";
    z += "        If fromPage Then ResponseRedirect(fromPage)\xFE";
    z += "        If @hasParentProcess Then Stop\xFE";
    z += "        ResponseRedirect(@jsbRootExecute(pageName))\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    If fromPage Then\xFE";
    z += "        If MsgBox(\"Where to?\", \"Go to new page?\", \"*Yes,No\") <> \"Yes\" Then ResponseRedirect(fromPage)\xFE";
    z += "    Else\xFE";
    z += "        If @hasParentProcess Then Stop\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    ResponseRedirect(@jsbRootExecute(clonePageName))\xFE";
    z += "End Program"
    window.cached_jsb_mdl["clonepagemodel"] = z;
    var z = "// returns ToViewName\xFE";
    z += "\xFE";
    z += "function CloneViewTo(ByVal FromProjectName As String, ByVal ToProjectName As String, ByVal fromViewName As String, ByVal optToViewName As String) As String\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    fToDict = @fHandle(\"DICT\", ToProjectName)\xFE";
    z += "    \xFE";
    z += "    If !optToViewName Then\xFE";
    z += "        optToViewName = Trim(@InputBox(\"Save a copy As\", \"Enter a clone name (may space-prefix with another project)\", \"\", \"80%\", \"\"))\xFE";
    z += "        If optToViewName = Chr(27) Or optToViewName = \"\" Then Return False\xFE";
    z += "\xFE";
    z += "        If Instr(optToViewName, \" \") Then\xFE";
    z += "            ToProjectName = Field(optToViewName, \" \", 1)\xFE";
    z += "            optToViewName = Field(optToViewName, \" \", 2)\xFE";
    z += "        End If\xFE";
    z += "\xFE";
    z += "        If LCase(Left(optToViewName, 5)) = \"view_\" Then optToViewName = Mid(optToViewName, 6)\xFE";
    z += "        optToViewName = @DropIfRight(optToViewName, \".view\", True)\xFE";
    z += "\xFE";
    z += "        Read Tmp From fToDict, optToViewName:\".view\" Then\xFE";
    z += "            If @MsgBox(\"Confirm\", optToViewName:\" already exists, overwrite?\", \"Yes,*No\") <> \"Yes\" Then Return False\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "    optToViewName = @DropIfRight(optToViewName, \".view\", True)\xFE";
    z += "    \xFE";
    z += "    // copy the view, and update any nested views (json_inline)\xFE";
    z += "    Dim dataSet As JSON\xFE";
    z += "    ReadJSon dataSet From fToDict, fromViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "    \xFE";
    z += "    For Each Column As JSON In dataSet.columns\xFE";
    z += "        Dim CtlName As String = LCase(Column.control)\xFE";
    z += "        If CtlName = \"json_inline\" Or CtlName = \"json_popup\" Then\xFE";
    z += "            newViewName =  makeCloneName(ToProjectName, @DropIfRight(fromViewName, \".view\", True), Column.useview, @DropIfRight(optToViewName, \".view\", True))\xFE";
    z += "            Column.useview = CloneViewTo(FromProjectName, ToProjectName, Column.useview, newViewName)\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    Read htm As String From fToDict, fromViewName:\".htm\" Then\xFE";
    z += "        write htm on fToDict, optToViewName:\".htm\" else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    WriteJSon dataSet On fToDict, optToViewName:\".view\" Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "    Return optToViewName:\".view\"\xFE";
    z += "End function"
    window.cached_jsb_mdl["cloneviewto"] = z;
    var z = "Program cloneWebSite\xFE";
    z += "* %options aspxC-\xFE";
    z += "    If !IsManager() Then Stop \"You must be at least a manager to run this command\"\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "    \xFE";
    z += "    Attachdb \"\" Else Null\xFE";
    z += "    ProjectName = @jsbAccount\xFE";
    z += "    \xFE";
    z += "    Title = \"New Project\"\xFE";
    z += "    fMD = fHandle('MD')\xFE";
    z += "    \xFE";
    z += "    Read Dft From fMD, ProjectName Else Dft = \"\"\xFE";
    z += "    \xFE";
    z += "    Loop\xFE";
    z += "        newActName = @InputBox(\"Clone \":ProjectName, \"New Web Site Name\", \"\", \"80%\", \"\")\xFE";
    z += "        If newActName = Chr(27) Or newActName = \"\" Then If fromPage Then @Response.Redirect(fromPage) Else Return\xFE";
    z += "        \xFE";
    z += "        If Dft Then\xFE";
    z += "            Read Hold From fMD, newActName Else Hold = \"\"\xFE";
    z += "            Write Dft On fMD, newActName Else MsgBox(@Errors)\xFE";
    z += "            didClone = cloneAccount(newActName)\xFE";
    z += "            If Hold Then\xFE";
    z += "                Write Hold On fMD, newActName Else MsgBox(@Errors)\xFE";
    z += "            Else\xFE";
    z += "                Delete fMD, newActName Else MsgBox(@Errors)\xFE";
    z += "            End If\xFE";
    z += "        Else\xFE";
    z += "            didClone = cloneAccount(newActName)\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "    Until didClone Do\xFE";
    z += "        MsgBox(@Errors)\xFE";
    z += "    Repeat\xFE";
    z += "\xFE";
    z += "    @Response.Redirect(@HtmlRoot:newActName)\xFE";
    z += "End Program"
    window.cached_jsb_mdl["clonewebsite"] = z;
    window.cached_jsb_mdl["copyviewfrom"] = "function CopyViewFrom(ProjectName, ViewName)\xFE    * %options aspxC-\xFE    \xFE    fDict = @fHandle(\"DICT\", ProjectName)\xFE    Select fDict To Sl Where \"ItemId Like '%.view'\" Else Debug @Alert(@Errors)\xFE    fromViewName = @InputDropDownBox(\"Choose a view\", \"Pick a view to choose from\", @Sort(GetList(Sl)))\xFE    If fromViewName = Chr(27) Or fromViewName = \"\" Then Return False\xFE    fromViewName = @DropIfRight(fromViewName, \".view\", True):\".view\"\xFE    ReadJSon Tmp From fDict, fromViewName Else Return False\xFE\xFE    dataSet = Tmp\xFE    WriteJSon dataSet On fDict, ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE\xFE    Return True\xFEEnd function";
    window.cached_jsb_mdl["createnewview"] = "function createNewView(ViewName)\xFE    ObjectModel = @modelForView()\xFE    Dataset = @Jsb_mdl.NewRow(ViewName, ObjectModel.columns)\xFE    Call addExtraColumns2ViewModel(ObjectModel, dataSet.templateName)\xFE\xFE    dataSet = @Jsb_mdl.NewRow(@DropIfRight(ViewName, \".view\", True), ObjectModel.columns)\xFE    dataSet.attachdb = @attacheddb\xFE    dataSet.columns = []\xFE    Return dataSet\xFEEnd function";
    window.cached_jsb_mdl["crlfcolumn"] = "Subroutine crlfColumn(ProjectName, PageName, ViewName, ColumnID)\xFE    * %options aspxC-\xFE    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE    ColumnIdx = @findViewColumn(dataSet, ColumnID)\xFE    If ColumnIdx = 0 Then Return\xFE    dataSet.columns[ColumnIdx].newlineprefix = !dataSet.columns[ColumnIdx].newlineprefix\xFE    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edc-\":System(28):\": \":@Errors\xFE    Call @jsb_mdl.ReGenPageModel(ProjectName, PageName, False)\xFEEnd Subroutine";
    var z = "* Takes insert> and delete> statements from PriorGeneratedCode and replicates them into newGeneratedCode\xFE";
    z += "function customMerge(byval newGeneratedCode, byval PriorGeneratedCode)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    newGeneratedCode = Replace(newGeneratedCode, CRLF(), AM())\xFE";
    z += "    PriorGeneratedCode = Replace(PriorGeneratedCode, CRLF(), AM())\xFE";
    z += "    \xFE";
    z += "    LPriorGeneratedCode = LCase(PriorGeneratedCode)\xFE";
    z += "    If !InStr(LPriorGeneratedCode, \"* <insert>\") and !InStr(LPriorGeneratedCode, \"*<insert>\") and !InStr(LPriorGeneratedCode, \"* <delete>\") and !InStr(LPriorGeneratedCode, \"*<delete>\") Then Return newGeneratedCode\xFE";
    z += "    \xFE";
    z += "    if !IsArray(newGeneratedCode) Then newGeneratedCode = Split(newGeneratedCode, AM())\xFE";
    z += "    if !IsArray(PriorGeneratedCode) Then PriorGeneratedCode = Split(PriorGeneratedCode, AM())\xFE";
    z += "\xFE";
    z += "    nci = LBound(newGeneratedCode) ;* pointer into newGeneratedCode\xFE";
    z += "    pci = LBound(PriorGeneratedCode) ;* pointer into PriorGeneratedCode\xFE";
    z += "\xFE";
    z += "    mergedCode = []\xFE";
    z += "\xFE";
    z += "    loop\xFE";
    z += "        pline = PriorGeneratedCode[pci]\xFE";
    z += "        nLine = newGeneratedCode[nci]\xFE";
    z += "\xFE";
    z += "        if IsNothing(pline) Then\xFE";
    z += "            for nci2 = nci to UBound(newGeneratedCode)\xFE";
    z += "                mergedCode[-1] = newGeneratedCode[nci2]\xFE";
    z += "            next\xFE";
    z += "            break\xFE";
    z += "        endif\xFE";
    z += "\xFE";
    z += "        ptline = lcase(trim(pline))\xFE";
    z += "        ntline = lcase(trim(nline))\xFE";
    z += "\xFE";
    z += "        If Left(ptline, 10) = \"* <insert>\" or Left(ptline, 9) = \"*<insert>\" Then\xFE";
    z += "            pline = ltrim(dropleft(pline, \">\"))\xFE";
    z += "            if pline then\xFE";
    z += "                mergedCode[-1] = \"* <insert>\"\xFE";
    z += "                mergedCode[-1] = pline\xFE";
    z += "                mergedCode[-1] = \"* </insert>\"\xFE";
    z += "                pci += 1\xFE";
    z += "            else\xFE";
    z += "                pline = \"* <insert>\"\xFE";
    z += "                loop\xFE";
    z += "                    mergedCode[-1] = pline\xFE";
    z += "                    Done = Left(ptline, 11) = \"* </insert>\" or Left(ptline, 10) = \"*</insert>\" or IsNull(pline)\xFE";
    z += "                    pci += 1\xFE";
    z += "                    pline = PriorGeneratedCode[pci]\xFE";
    z += "                    ptline = lcase(trim(pline))\xFE";
    z += "                until Done Do Repeat\xFE";
    z += "            end if\xFE";
    z += "\xFE";
    z += "        ElseIf Left(ptline, 10) = \"* <delete>\" or Left(ptline, 9) = \"*<delete>\" Then\xFE";
    z += "            ptline = DropLeft(ptline, \">\")\xFE";
    z += "            ptline = trim(pline)\xFE";
    z += "            if ptline = ntline then pci += 1\xFE";
    z += "            mergedCode[-1] = pline\xFE";
    z += "            pci += 1\xFE";
    z += "\xFE";
    z += "        ElseIf ptline = ntline Then\xFE";
    z += "            mergedCode[-1] = nline\xFE";
    z += "            nci += 1\xFE";
    z += "            pci += 1\xFE";
    z += "\xFE";
    z += "        ElseIf ptline = \"\" Or Left(ptline, 1) = \"*\" or Left(ptline, 2) = \"//\" Then\xFE";
    z += "            If ptline = \"\" then mergedCode[-1] = pline\xFE";
    z += "            pci += 1\xFE";
    z += "            \xFE";
    z += "        Else\xFE";
    z += "            newTemp = []\xFE";
    z += "            FoundMatch = False\xFE";
    z += "            \xFE";
    z += "            for nci2 = nci to UBound(newGeneratedCode)\xFE";
    z += "                nLine2 = newGeneratedCode[nci2]\xFE";
    z += "                ntline2 = lcase(trim(nline2))\xFE";
    z += "\xFE";
    z += "                If ptline = ntline2 And Len(ptLine) > 3 Then\xFE";
    z += "                    for Each xLine in newTemp\xFE";
    z += "                        mergedCode[-1] = xline\xFE";
    z += "                    next\xFE";
    z += "                    FoundMatch = True\xFE";
    z += "                    nci = nci2\xFE";
    z += "                    break\xFE";
    z += "                end if\xFE";
    z += "                \xFE";
    z += "                newTemp[-1] = nLine2\xFE";
    z += "            next\xFE";
    z += "\xFE";
    z += "            if !FoundMatch Then \xFE";
    z += "                * Couldn't match any pline with anything generated, go to next pline\xFE";
    z += "                pci += 1\xFE";
    z += "            end if\xFE";
    z += "        end if\xFE";
    z += "    Until z > 19999 Do \xFE";
    z += "        z += 1 ;* Fail safe for infinite loop\xFE";
    z += "    Repeat\xFE";
    z += "    if z > 19999 then alert('mdl updatecode fail safe fallout')\xFE";
    z += "    \xFE";
    z += "    cd = Join(mergedCode, AM())\xFE";
    z += "    Return formatCD(cd)\xFE";
    z += "end function"
    window.cached_jsb_mdl["custommerge"] = z;
    var z = "* %options aspxC-\xFE";
    z += "Program Db\xFE";
    z += "*\xFE";
    z += "* %options aspxC-\xFE";
    z += "*\xFE";
    z += "* db database \xFE";
    z += "*    tables        -> showTop1000(id only)\xFE";
    z += "*    views         -> showTop1000(id only)\xFE";
    z += "*    Sql Selects   -> sqlQueryBuilder  (id or *NEW*)\xFE";
    z += "*    reports       -> edp dbBuilderReports (id or blank for new)\xFE";
    z += "*      --- all new windows get passed in tabID\xFE";
    z += "* \xFE";
    z += "    roleMsg = Iff(@IsAuthenticated, \"\", \"You must be logged in to view this page. \":@Anchor(@LoginUrl, \"Click here to login\"))\xFE";
    z += "    If !@IsEmployee Then Stop Iff(roleMsg, roleMsg, \"You must be at least an employee to view this page.\")\xFE";
    z += "\xFE";
    z += "    Call ?CheckIn()\xFE";
    z += "\xFE";
    z += "    Attachdb \"\" Else Stop \"Unable to detach\"\xFE";
    z += "    \xFE";
    z += "    Theme('lumen')\xFE";
    z += "    tabID = \"myTabs\"\xFE";
    z += "    treeID = \"myTree\"\xFE";
    z += "    \xFE";
    z += "    CenterHtml = @Jsb_html.TABS(tabID, \"\", \"\", \"\", \"\", \"\", \"\")\xFE";
    z += "    WestOptions = \"startsize: 270px\"\xFE";
    z += "    Theme = @jsbConfig(\"default_jsb_Themes\", \"theme_none\")\xFE";
    z += "    if Theme Then Theme = \"jsb_themes.\":Theme\xFE";
    z += "    \xFE";
    z += "    NorthHtml = \"\"; NorthOptions = \"\"; SouthOptions = \"\"; EastOptions = \"\"\xFE";
    z += "    fromRoot = @queryVar('root')\xFE";
    z += "    \xFE";
    z += "    Call @@db_removeVacantDatabases();\xFE";
    z += "    Call @@db_addNewDatabases()\xFE";
    z += "    \xFE";
    z += "    Loop\xFE";
    z += "        Tree = @db_buildJson4TreeView(tabID, fromRoot)\xFE";
    z += "        WestHtml = @Div('', jsonTree(treeID, Tree), { style: 'height: 98%; width: 100%; padding-top: 5px' })\xFE";
    z += "        \xFE";
    z += "        Html = @Html(`\xFE";
    z += "            <style>\xFE";
    z += "                .database>label, .database>li>label {\xFE";
    z += "                    background: url(\"../jsb/pics/database.png\") no-repeat;\xFE";
    z += "                    background-position-x: 18px;\xFE";
    z += "                    background-size: 18px;\xFE";
    z += "                    background-position-y: -2px;\xFE";
    z += "                }\xFE";
    z += "                \xFE";
    z += "                .treeFolder_Tables label {\xFE";
    z += "                    background: url(\"../jsb/pics/tables.png\") no-repeat;\xFE";
    z += "                    background-position-x: 18px;\xFE";
    z += "                    background-size: 18px;\xFE";
    z += "                    background-position-y: -2px;\xFE";
    z += "                }\xFE";
    z += "                \xFE";
    z += "                .treeFolder_SqlSelects label {\xFE";
    z += "                    background: url(\"../jsb/pics/sql.png\") no-repeat;\xFE";
    z += "                    background-position-x: 18px;\xFE";
    z += "                    background-size: 18px;\xFE";
    z += "                    background-position-y: -2px;\xFE";
    z += "                }\xFE";
    z += "                \xFE";
    z += "                .treeFolder_Reports label {\xFE";
    z += "                    background: url(\"../jsb/pics/reports.png\") no-repeat;\xFE";
    z += "                    background-position-x: 18px;\xFE";
    z += "                    background-size: 18px;\xFE";
    z += "                    background-position-y: -2px;\xFE";
    z += "                }\xFE";
    z += "                \xFE";
    z += "                .treeFolder_Views label {\xFE";
    z += "                    background: url(\"../jsb/pics/views.png\") no-repeat;\xFE";
    z += "                    background-position-x: 18px;\xFE";
    z += "                    background-size: 18px;\xFE";
    z += "                    background-position-y: -2px;\xFE";
    z += "                }\xFE";
    z += "                \xFE";
    z += "            </style>`)\xFE";
    z += "            \xFE";
    z += "        Html := @Jsb_html.LAYOUT(CenterHtml, NorthHtml, NorthOptions, \"South\", SouthOptions, \"East\", EastOptions, WestHtml, WestOptions)\xFE";
    z += "        \xFE";
    z += "        Html := @Script(`function treeShow() { $(\"#mylayout\").layout().open(\"west\");}`)\xFE";
    z += "        Html := @Script(`function treeToggle() {$(\"#mylayout\").layout().toggle(\"west\");}`)\xFE";
    z += "        Html := @Script(`function treeHide() { if (innerWidth < 1024) $(\"#mylayout\").layout().close(\"west\");}`)\xFE";
    z += "        \xFE";
    z += "        \xFE";
    z += "        // Add javascript to allow tree to be loaded via API\xFE";
    z += "        Html := @db_loadDBTreeGroups(tabID, treeID)\xFE";
    z += "        \xFE";
    z += "        // Add jQuery drag & drop to allow .databases to be dropped on .databaseLists\xFE";
    z += "        if @IsManager then \xFE";
    z += "            Html := db_setupDragAndDrop(fromRoot)\xFE";
    z += "            Html := db_setupContextMenus(fromRoot)\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        // Theme it\xFE";
    z += "        if Theme Then Html = @((Theme))(System(27),System(28), Html)\xFE";
    z += "        \xFE";
    z += "        // Display it\xFE";
    z += "        Print @(-1):Html:\xFE";
    z += "        \xFE";
    z += "        if !@hasTclParent Then Break\xFE";
    z += "        \xFE";
    z += "        @Server.Pause\xFE";
    z += "        \xFE";
    z += "        Cmd =  @formVar(\"SelectedMenu\")\xFE";
    z += "        ItemID =  @formVar(\"itemID\")\xFE";
    z += "        menucmd = @Formvar(\"contextmenucmd\")\xFE";
    z += "        menutext = @Formvar(\"contextmenutext\")\xFE";
    z += "        menuval = @Formvar(\"contextmenuval\") \xFE";
    z += "        targetID = @Formvar(\"contextmenuctlid\")\xFE";
    z += "        targetText = @Formvar(\"contextmenuctltext\")\xFE";
    z += "        \xFE";
    z += "        Print @(-1):\xFE";
    z += "        MsgBox(\"You chose context menucmd: \":menucmd:\"; text: \":menutext:\"; val: \":menuval:crlf(): \"on target '\":targetID: \"'; with text '\":targetText:\"'\")\xFE";
    z += "    \xFE";
    z += "    Until Cmd = 'Quit' Do Repeat\xFE";
    z += "\xFE";
    z += "    // If @HasParentProcess Then Stop @(-1) Else @Server.End\xFE";
    z += "End Program\xFE";
    z += "\xFE";
    z += "function db_setupDragAndDrop(fromRoot)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    return @Script(`\xFE";
    z += "        `:`function disableDragAndDrop() {\xFE";
    z += "            $(\".css-treeview,.databaseList,.group\").droppable(\"destroy\");\xFE";
    z += "            $(\".database\" ).draggable(\"destroy\");\xFE";
    z += "        }\xFE";
    z += "        \xFE";
    z += "        `:`function setupDragAndDrop() {\xFE";
    z += "            var droppables = $(\".css-treeview,.databaseList,.group\").reverse();\xFE";
    z += "            window.acceptDrop = false;\xFE";
    z += "          \xFE";
    z += "            $(droppables).droppable(\xFE";
    z += "            { \xFE";
    z += "                classes: [ \".css-treeview\" , \"database\", \"group\" ],\xFE";
    z += "                drop: function (event, ui) { \xFE";
    z += "                    // I had better have moved at least the line height\xFE";
    z += "                    if (window.acceptDrop && Math.abs(ui.position.top) >= ui.helper.height()) {\xFE";
    z += "                        var srcDBName = ui.draggable.children().first().attr('id'); // id is on first input child\xFE";
    z += "                        var prmGrp = $(event.target).children().first().attr('id');\xFE";
    z += "                        if (!prmGrp) prmGrp = \"\";\xFE";
    z += "                        if ($(event.target).hasClass(\"group\")) {\xFE";
    z += "                            var droppedOnFolder = $(event.target).children().first(\"input\");\xFE";
    z += "                            if (droppedOnFolder && !$(droppedOnFolder).prop(\"checked\")) $(droppedOnFolder).prop(\"checked\", true);\xFE";
    z += "                        }\xFE";
    z += "                        \xFE";
    z += "                        ignoreNextFolderClick = true;\xFE";
    z += "                        ajaxReloadTree(\"db_MoveDataBaseAPI\", srcDBName, prmGrp);\xFE";
    z += "                    } else {\xFE";
    z += "                        if (window.acceptDrop) ui.draggable.draggable('option', 'revert', true);\xFE";
    z += "                    }\xFE";
    z += "                    window.acceptDrop = false;\xFE";
    z += "                }\xFE";
    z += "            });\xFE";
    z += "          \xFE";
    z += "            $(\".database\" ).draggable( \xFE";
    z += "            { \xFE";
    z += "                start: function(event, ui) {\xFE";
    z += "                    window.acceptDrop = true;\xFE";
    z += "                },\xFE";
    z += "                scroll: false, \xFE";
    z += "                containment: \".css-treeview\" \xFE";
    z += "            }); \xFE";
    z += "       }\xFE";
    z += "       \xFE";
    z += "       setupDragAndDrop();\xFE";
    z += "    `)\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "function db_setupContextMenus(fromRoot)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    // Add javascript to allow a context menu on .databaseList \xFE";
    z += "    javaScriptShareCode = `\xFE";
    z += "        var root = queryVar('root');\xFE";
    z += "        if (root) root += \"|\"; else root = \"\";\xFE";
    z += "       \xFE";
    z += "        if ($(contextMenuTarget).parent().hasClass('treeLeaf')) {\xFE";
    z += "          // share report URL: \xFE";
    z += "          var data = string2json($(contextMenuTarget).attr('data'));\xFE";
    z += "          var url = data.url;\xFE";
    z += "        } else {\xFE";
    z += "\xFE";
    z += "          var pathway = root + $(contextMenuTarget).parentsUntil('.css-treeview').filter('.treeFolder:visible:not(.ui-draggable)').reverse().map(function () { return $(this).attr(\"for\") }).get().join(\"|\");\xFE";
    z += "          var url = Field(myLocation(), \"?\", 1) + \"?root=\" + pathway;\xFE";
    z += "        }\xFE";
    z += "        windowOpen(url, '_blank');\xFE";
    z += "    `\xFE";
    z += "      \xFE";
    z += "    javaScriptRenameCode = `\xFE";
    z += "        var pathway = $(contextMenuTarget).parentsUntil('.css-treeview').filter('.treeFolder:visible:not(.ui-draggable)').reverse().map(function () { return $(this).attr(\"for\") }).get().join(\"|\");\xFE";
    z += "        var groupName = $(contextMenuTarget).attr('id');\xFE";
    z += "        debugger\xFE";
    z += "        var newName = prompt(\"Please enter a new name for '\" + groupName + \"'\");\xFE";
    z += "        if (newName) ajaxReloadTree(\"db_renameGroupAPI\", pathway, newName);\xFE";
    z += "    `\xFE";
    z += "    \xFE";
    z += "    javaScriptDeleteCode = `\xFE";
    z += "        var pathway = $(contextMenuTarget).parentsUntil('.css-treeview').filter('.treeFolder:visible:not(.ui-draggable)').reverse().map(function () { return $(this).attr(\"for\") }).get().join(\"|\");\xFE";
    z += "        var groupName = $(contextMenuTarget).attr('id');\xFE";
    z += "        debugger\xFE";
    z += "        if (confirm(\"Are you sure you want to delete the group '\" + groupName + \"'\")) ajaxReloadTree(\"db_deleteGroupAPI\", pathway);\xFE";
    z += "    `\xFE";
    z += "    \xFE";
    z += "    javaScriptNewSubGrpCode = `\xFE";
    z += "        var pathway = $(contextMenuTarget).parentsUntil('.css-treeview').filter('.treeFolder:visible:not(.ui-draggable)').reverse().map(function () { return $(this).attr(\"for\") }).get().join(\"|\");\xFE";
    z += "        var groupName = $(contextMenuTarget).attr('id');\xFE";
    z += "        debugger\xFE";
    z += "        var newName = prompt(\"Please enter a new subgroup name under '\" + pathway + \"'\");\xFE";
    z += "        if (newName) ajaxReloadTree(\"db_newSubGroupAPI\", pathway, newName);\xFE";
    z += "    `\xFE";
    z += "    \xFE";
    z += "    // Groups\xFE";
    z += "    S = []\xFE";
    z += "    cmGroupMenu = 'grpContextMenu'\xFE";
    z += "    Html := @Contextmenu('#doNothingYet', { \xFE";
    z += "            \"Share URL\":      { onclick: javaScriptShareCode },\xFE";
    z += "            \"Rename Group\":   { onclick: javaScriptRenameCode },\xFE";
    z += "            \"Delete Group\":   { onclick: javaScriptDeleteCode },\xFE";
    z += "            \"New Sub-Group\":  { onclick: javaScriptNewSubGrpCode }\xFE";
    z += "        }, false, cmGroupMenu)\xFE";
    z += "        \xFE";
    z += "    S[-1] = `$(document).on(\"contextmenu\", \".databaseList>label\", function (e) { return `:cmGroupMenu:`(e, this) });`\xFE";
    z += "    S[-1] = `$(document).on(\"contextmenu\", \".group>label\", function (e) { return `:cmGroupMenu:`(e, this) });`\xFE";
    z += "    \xFE";
    z += "\xFE";
    z += "    // Databases\xFE";
    z += "    cmDatabaseMenu = 'grpContextDBLeafMenu'\xFE";
    z += "    Html := @Contextmenu('#doNothingYet', { \xFE";
    z += "            \"Delete Database\": { onclick: \"alert('not yet implemented');\" },\xFE";
    z += "            \"Rename Database\": { onclick: \"alert('not yet implemented');\" }\xFE";
    z += "        }, false, cmDatabaseMenu)\xFE";
    z += "        \xFE";
    z += "    S[-1] = `$(document).on(\"contextmenu\", \".database>label\", function (e) { return `:cmDatabaseMenu:`(e, this) });`\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "    // Leafs (reports)\xFE";
    z += "    S[-1] = `\xFE";
    z += "        window.editRPT = function(contextMenuTarget, e) {\xFE";
    z += "            var data = string2json($(contextMenuTarget).attr(\"data\"));\xFE";
    z += "            var Url = jsbRootAct() + \"makenewreport?databaseName=\" + urlEncode(data.databaseName) + \"&reportName=\" + urlEncode(data.reportID); // tabID=\" + urlEncode(data.tabID) + \xFE";
    z += "            // openInTab(data.tabID, \"Edit_\" + data.reportID, \"Edit \" + data.reportID, Url); \xFE";
    z += "            windowOpen(Url, '_blank'); \xFE";
    z += "            treeHide();\xFE";
    z += "        }\xFE";
    z += "        \xFE";
    z += "        window.shareRPT = function(contextMenuTarget, e) {\xFE";
    z += "            var data = string2json($(contextMenuTarget).attr(\"data\"));\xFE";
    z += "            var Url = jsbRootAct() + urlEncode(data.reportID);\xFE";
    z += "            windowOpen(Url, '_blank'); \xFE";
    z += "            // treeHide();\xFE";
    z += "        }\xFE";
    z += "        \xFE";
    z += "        window.deleteRPT = function(contextMenuTarget, e) {\xFE";
    z += "            var pathway = $(contextMenuTarget).parentsUntil('.css-treeview').filter('.treeFolder:visible:not(.ui-draggable)').reverse().map(function () { return $(this).attr(\"for\") }).get().join(\"|\");\xFE";
    z += "            var data = string2json($(contextMenuTarget).attr(\"data\"));\xFE";
    z += "            var url = jsbRootAct() + \"deleteRptAPI?tabID=\" + urlEncode(data.tabID) + \"&databaseName=\" + urlEncode(data.databaseName) + \"&reportName=\" + urlEncode(data.reportID) + \"&path=\" + urlEncode(pathway) ;\xFE";
    z += "            url += '&cacheBuster=' + newGUID();\xFE";
    z += "            var myDBTree = $(\"#\" + string2json( $(contextMenuTarget).attr(\"data\") ).databaseName)\xFE";
    z += "            \xFE";
    z += "            MsgBox(\"Confirm report deletion\", \"Are you sure you wish to delete the report: \" + data.databaseName + \"?\", \"Yes,No\", 0, 0, \xFE";
    z += "                function (ans) { \xFE";
    z += "                    if (ans == \"Yes\") {\xFE";
    z += "                        disableDragAndDrop();\xFE";
    z += "                        \xFE";
    z += "                        // call deleteRptAPI\xFE";
    z += "                        ajaxCall(\"GET\", url, null, function(success) {    \xFE";
    z += "                            if (window.setupDragAndDrop) setupDragAndDrop();\xFE";
    z += "                            if (success.AtErrors) alert(success.AtErrors); else {\xFE";
    z += "                                debugger;\xFE";
    z += "                                $(myDBTree).onclick = $(myDBTree).attr(\"prior_onclick\")\xFE";
    z += "                                $(myDBTree)[0].click();\xFE";
    z += "                            }\xFE";
    z += "                        });\xFE";
    z += "                    }\xFE";
    z += "                }\xFE";
    z += "            )\xFE";
    z += "        }\xFE";
    z += "        \xFE";
    z += "    `\xFE";
    z += "\xFE";
    z += "    cmReportMenu = 'grpContextRPTLeafMenu'\xFE";
    z += "    Html := @Contextmenu('#doNothingYet', { \xFE";
    z += "            \"Share URL\": { onclick: \"shareRPT(contextMenuTarget, this);\" },\xFE";
    z += "            \"Edit Report\": { onclick: \"editRPT(contextMenuTarget, this);\" },\xFE";
    z += "            \"Delete Report\": { onclick: \"deleteRPT(contextMenuTarget, this);\" }\xFE";
    z += "        }, false, cmReportMenu)\xFE";
    z += "\xFE";
    z += "    S[-1] = `$(document).on(\"contextmenu\", \".usrReport\", function (e) { return `:cmReportMenu:`(e, this) });`\xFE";
    z += "    \xFE";
    z += "    \xFE";
    z += "    cmRootMenu = 'contextMenuRoot'\xFE";
    z += "    Html := @Contextmenu('#doNothingYet', { \"New Sub-Group\": { onclick: javaScriptNewSubGrpCode } }, false, cmRootMenu)\xFE";
    z += "    S[-1] = `$(document).on(\"contextmenu\", \".css-treeblankspace\", function (e) { return `:cmRootMenu:`(e, this) });`\xFE";
    z += "    \xFE";
    z += "    Html := @Script(`\xFE";
    z += "        `:`function setupContextMenus() {\xFE";
    z += "             `:Join(S, crlf()):`\xFE";
    z += "        }\xFE";
    z += "       \xFE";
    z += "        setupContextMenus();\xFE";
    z += "    `)\xFE";
    z += "    \xFE";
    z += "    return HTML\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "// Build top level of tree\xFE";
    z += "function db_buildJson4TreeView(ByVal tabID As String, ByVal root As String)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    dbGroups = @@db_getGroupsFromRoot(root)\xFE";
    z += "    if IsNothing(dbGroups) Then dbGroups = {}\xFE";
    z += "    \xFE";
    z += "    NoPermissions = @@db_getDatabaseNamesWithoutPermissons()\xFE";
    z += "    onlineDBs = Split(Lcase(@@db_getDatabaseNames()), am())\xFE";
    z += "    \xFE";
    z += "    Cnt = db_buildTreeViewSubLevel(tabID, NoPermissions, onlineDBs, dbGroups, Tree)\xFE";
    z += "    Return Tree\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function db_buildTreeViewSubLevel(ByVal tabID, ByVal NoPermissions, ByVal onlineDBs, ByVal dbSubGroup, ByRef Tree)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    Tree = {}\xFE";
    z += "    dbCnt = 0\xFE";
    z += "    For Each Tag In dbSubGroup\xFE";
    z += "        V = dbSubGroup[Tag]\xFE";
    z += "\xFE";
    z += "        If Isjson(V) Then \xFE";
    z += "            // a High level group\xFE";
    z += "            if Len(V) Then\xFE";
    z += "                subCnt = db_buildTreeViewSubLevel(tabID, NoPermissions, onlineDBs, V, subTree)\xFE";
    z += "                Tree[Tag] = subTree\xFE";
    z += "                \xFE";
    z += "                if subCnt Then\xFE";
    z += "                    dbCnt += subCnt\xFE";
    z += "                Else\xFE";
    z += "                    ' subTree.disabled =  true\xFE";
    z += "                    subTree.caption = @disabledLook(Tag:\" (not online)\") \xFE";
    z += "                End If\xFE";
    z += "            Else\xFE";
    z += "                // empty group\xFE";
    z += "                Tree[Tag] = { url: \"\" }\xFE";
    z += "            end if\xFE";
    z += "            \xFE";
    z += "            Tree[Tag].class = \"group\"\xFE";
    z += "            Tree[Tag].id = Tag\xFE";
    z += "            \xFE";
    z += "        Else // *** a single database\xFE";
    z += "            Tree[Tag] = { \xFE";
    z += "                    url: @jsbRestCall('db_getSubTree'):`?tabID=`:@urlEncode(tabID):`&databaseName=`:@urlEncode(V):`&noCache=`:timer(), \xFE";
    z += "                    data: V, \xFE";
    z += "                    class: \"database\",\xFE";
    z += "                    id: Tag\xFE";
    z += "                }\xFE";
    z += "                \xFE";
    z += "            Locate LCase(V) in onlineDBs Then\xFE";
    z += "                Locate LCase(V) in NoPermissions Then \xFE";
    z += "                    Tree[Tag].caption = @disabledLook(Tag:\" (no permissions)\") \xFE";
    z += "                    Tree[Tag].url = \"\"\xFE";
    z += "                End If\xFE";
    z += "                dbCnt += 1\xFE";
    z += "            Else\xFE";
    z += "                Tree[Tag].caption = @disabledLook(Tag:\" (not online)\") \xFE";
    z += "                Tree[Tag].url = \"\"\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "    Return dbCnt\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function disabledLook(txt)\xFE";
    z += "    return CHR(28):\"<span style='opacity: .5; font-style: italic;'>\":Chr(29):txt:Chr(28):\"</span>\":Chr(29)\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "// operations: db_MoveDataBaseAPI, db_renameGroupAPI, db_newSubGroupAPI, db_deleteGroupAPI\xFE";
    z += "function db_loadDBTreeGroups(tabID, treeID)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    Return @Script(`\xFE";
    z += "        `:`function reloadDbTree(Root) {\xFE";
    z += "            asyncRpcRequest('DB_GETGROUPSFROMROOT', Root).then(Dbgroups => {\xFE";
    z += "                if (isNothing(Dbgroups)) { Dbgroups = {} }\xFE";
    z += "                asyncRpcRequest('DB_GETDATABASENAMESWITHOUTPERMISSONS').then(Nopermissions => {\xFE";
    z += "                    asyncRpcRequest('DB_GETDATABASENAMES').then(Onlinedbs => {\xFE";
    z += "                        Onlinedbs = Split(LCase(Onlinedbs),am); \xFE";
    z += "                        var newTree;\xFE";
    z += "                        if (!window.tabID) tabID = '';\xFE";
    z += "                        JSB_MDL_DB_BUILDTREEVIEWSUBLEVEL(tabID, Nopermissions, Onlinedbs, Dbgroups, null, function (_Tree) { newTree = _Tree }).then(function () {\xFE";
    z += "                            var treeID = $(\".css-treeview\").parent().attr('id');\xFE";
    z += "                            var html = JSB_HTML_JSONTREE(treeID, newTree);\xFE";
    z += "                            debugger;\xFE";
    z += "                            var openedFolders = getTreeOpenedFolders()\xFE";
    z += "                            $(\".css-treeview\").html(html);\xFE";
    z += "                            reopenTreeFolders(openedFolders);\xFE";
    z += "                            if (window.setupDragAndDrop) setupDragAndDrop();\xFE";
    z += "                        });\xFE";
    z += "                    });\xFE";
    z += "                });\xFE";
    z += "            });\xFE";
    z += "        }\xFE";
    z += "        \xFE";
    z += "        `:`function ajaxReloadTree(operation, prmDB, prmGrp) {\xFE";
    z += "            if (!window.tabID) tabID = '';\xFE";
    z += "            var url = myRpcUrl + operation + '?tabID=`:tabID:`';  // operation(tabID, root, prmDB, prmGrm\xFE";
    z += "            var root = queryVar('root');\xFE";
    z += "            var openedFolders = getTreeOpenedFolders();\xFE";
    z += "            \xFE";
    z += "            if (!root) root = '';\xFE";
    z += "            url += '&root=' + urlEncode(root);\xFE";
    z += "            if (prmDB != null)  url += '&prmDB=' + urlEncode(prmDB)\xFE";
    z += "            if (prmGrp != null) url += '&prmGrp=' + urlEncode(prmGrp);\xFE";
    z += "            \xFE";
    z += "            url += '&cacheBuster=' + newGUID();\xFE";
    z += "            \xFE";
    z += "            disableDragAndDrop();\xFE";
    z += "            \xFE";
    z += "            ajaxCall(\"GET\", url, null, function(result) {  \xFE";
    z += "                if (result.startsWith('0x')) {\xFE";
    z += "                    result = string2json(XTS(result));\xFE";
    z += "                    reloadDbTree(root);\xFE";
    z += "                } else {\xFE";
    z += "                    debugger;\xFE";
    z += "                    if (result != '') alert(result);\xFE";
    z += "                }\xFE";
    z += "            })\xFE";
    z += "        }\xFE";
    z += "    `)\xFE";
    z += "End function\xFE";
    z += ""
    window.cached_jsb_mdl["db"] = z;
    window.cached_jsb_mdl["dbcleanjson"] = "function dbCleanJson(dbSubGroup)\xFE    * %options aspxC-\xFE    \xFE    For Each Tag In dbSubGroup\xFE        V = dbSubGroup[Tag]\xFE        \xFE        if isArray(V) then\xFE            ary = V\xFE            V = {}\xFE            for each db in ary\xFE                V[db] = db\xFE            next\xFE            dbSubGroup[Tag] = V\xFE        end if\xFE            \xFE        If Isjson(V) Then dbCleanJson(V)\xFE    Next\xFEend function";
    var z = "Program dbUploadDatabase\xFE";
    z += "    *$options internal Pg\xFE";
    z += "    * %options aspxC-\xFE";
    z += " \xFE";
    z += "    Attachdb \"\" Else Null\xFE";
    z += " \xFE";
    z += "    attachedDB = @AttachedDB\xFE";
    z += "    \xFE";
    z += "    If !isManager() Then\xFE";
    z += "        Msgbox( \"You must be a data Manager to run this command\")\xFE";
    z += "        If tabID Then @Server.End Else Stop\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    // Insure we have the proper setup\xFE";
    z += "    Attachdb \"\" Else Null\xFE";
    z += "\xFE";
    z += "    dbPrefix = \"z\":replace(field(@email, \"@\", 1), \"_\", \".\")\xFE";
    z += "    if instr(dbPrefix, \".\") Then\xFE";
    z += "        dbPrefix = Split(dbPrefix, \".\")\xFE";
    z += "        dbPrefix = UCase(Left(dbPrefix[1], 1)):UCase(Left(dbPrefix[2], 1)):LCase(Mid(dbPrefix[2], 2))\xFE";
    z += "    end if\xFE";
    z += "    dbPrefix := \"-\"\xFE";
    z += "    \xFE";
    z += "    fTmp = @FHandle('tmp')\xFE";
    z += "    fSystem = FHandle('system')\xFE";
    z += "    fTmpPath = @filePath(fTmp)\xFE";
    z += "    If !fTmpPath Then Goto errOut\xFE";
    z += "    \xFE";
    z += "    Theme('lumen')\xFE";
    z += "    tabID = @ParamVar('tabID')\xFE";
    z += "    ctlID = \"uploadBoxID\"\xFE";
    z += "    style = @Style(`#jsb { word-wrap: break-all; white-space: normal }`)\xFE";
    z += "    niceBackground = @Image(\"bk\", \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARMAAAC3CAMAAAAGjUrGAAAAaVBMVEX///9CpfX4+/8uoPU1ofUrnvQ8o/VTrfa32PowoPTU6P37/f/x+P9Rqvbd7f3K4/zi8P3q9P5vt/dFp/WTx/mo0fpstvd+vvidzPl4u/ix1vu83PtfsPbO5fzB3/va6/2PxvmayvmEwfg9U86wAAAFZUlEQVR4nO2d23qqMBCFlRwoAooinqvo+z/kBq1tdYsFnZWJfvNfeGVLskwmk5lM6PUEQRAEQRAEQRAEQRAEQRAEQRAEQRAEQRAEQRCEXpxku8/RaDQYjgPutnhAtp7OUmuUirTWShmVbg7FZ8LdLDay1aSSwdr+BdbqSKXTUczdPPeMi43RV3L8Fkbp5Za7jW7Zzu4IctYlstMxd0OdUeTqL0FOaLUccjfWCSutWwlyGixmlnE3GM4ojdorclRFHd7b3CZL027WXKiiP7jbDWR9vfC2RM3e1pebq4cUqYeKHXE3HkKSdrCt/w+Vgrv9AAYt199GUebcPSBn+/C8OaM33H0g5sM8K0llVNK3WpS3BJJUooTc/SCERpJKlPeZPjsiSSqbsuTuCxHJcwvOBdGeuzc0bAg16Zu3cN7KZ1y1G6K8QWByQGZMTtgZd4+6EwfZsCJLTs5EnFPOnBq1Yu5hJ4br/SSsg/A1xxD8ajilnTlHUV5lkzyug/DaXgQDrNVPbnJuYl9i5xPcDcKTo/wP0mYH5VCQ/gu4s8MZYn7cx3gdtx7PHwiwPo312cVfcChSobx13LLw6UDRg+gFd98b+HBvSL7JuTt/mwPXIKnxcjmOZ/QOagd8nDxByjdvajx0UQLynV1XvNv0xMyjpCLyLbZEGjl7DN8MypzVvJ7wzJVdcS7C33jloQy9kKRvuHX4Db99PaI8Ov9X+DFMfPJkE08k6UcDbim+WfoxcypNPrmlOJMRZ2sexx+nzZth4o8mY1+sCa8mcZB8E0y9GSZ9tWMQY7xeTMI8Mr/xRxIG/2RYpqpO63H3vBl7cOqgJEXq04howJq0cBW+T0rlwb63FVqVTkJLRZdSEna0xp+vzsKOpSTsRBtworRgTNk8isUe0nm8cKJN22H/GXkUf4O0JHqJU0XDzrhBI89R2ctwCRBQfUIMlcSU1SMS3EjB5MAmyIljTitmgotbIk6dL5BrsDk7EUEIE0WRJ3w+kbEi87NYBjg7bogDbzGqocfGXlw8AJyjtCVPB6Axua4aWKKcIF1SSpIBfTX1X3z9gDJditLLx0VZrb4RDitBPwFlDnkIM7BW3/zp9qAHGrowE2yY2LwhQFhgRKE7iQ9L7dmwMQ5GUVt7A7JzswVo0dGbO4sjVSnp1SOpIkwg31JP7j51gKhboNr2JJhhHP01tzOEKIYmPruGmBNV/v1jAGIHak2iSYmYOq12ZIBtsp2SaIIwJ6ZliJR8R0hjUGKEJK1HMPmO0FJsBAHeSZda8Tnx5ofEQ6E/xnhri9PMgXackhxzG1HvUjsWihOPU5JjKc9f6nNNvht8cec4xPkrgxWtRfFUk370xb3Vp6++vkRsZBXFbaLkc+eHe/fvoSL4JOPk3TShiFTvcHFHDk1I1h3gUUYWTSiOuSH82C84NLEEkiBT5wyaEAVQIPviIxyalCSarGH5LgZNSNyTXi+AZTIYNKG6lQuW63evCdmlXKi4PYMmmuq4Hyy/w6AJ2cFqVB7QuSaECWNUvti5JpT3LE1AWS/Hmtj7WbZugKr8XGtCev6kB7iBsO9cE017tyxmI+hYE5rt3w8DxHrsVhNDXiAIKbnPw0bIn4V4UcISYVJsI9RPwtzePXu90p0fQJUZMe7cNxwdol6RAK3fQYKr3wHXeeFQB5wkvd7qBeqKr7FkAYIGXrBuNMRfsNvpVXXsaPQgORHsI7fXSz+M1dHC1RWH8UvcV6BNunL6kqLdNPf3Xov63nyV7xkumRpv95Mwt8rULzYwdz/VrU/Un+k8nOy3nLezxYF3MKohCIIgCIIgCIIgCIIgCIIgCIIgCIIgCIIgCILQin/qP2m6tagoOQAAAABJRU5ErkJggg==\", { style: \"margin-top: 15%\" })\xFE";
    z += "    niceBackground = @Div(\"backgroundPic\", niceBackground, {style:'position:fixed; top: 0; width:100%; height:100%; background-color:white', class: \"watermark\" })\xFE";
    z += "\xFE";
    z += "    Header = [niceBackground:style]\xFE";
    z += "    \xFE";
    z += "    ctlHtml = @Jsb_html.UploadBox(ctlID, \"\" /* default */, 0 /* autopostback */, False /* allowMultipleFiles */, '' /* acceptableMimeTypes */, [`title=\"Database\"`,`placeholder=\"Database\"`] /* lblAdditionalAttributes */, [``])\xFE";
    z += "    ctlHtml = @lblCtlSet(\"Database\", ctlHtml, ctlID, True, 0, \"\")\xFE";
    z += "    \xFE";
    z += "     @Submitbtn(\"Btn\", \"OK\", \"OK Display\", {}, \"danger\", \"lg\", \"alert('you clicked it')\")\xFE";
    z += "     \xFE";
    z += "    Btns = @Div('', @SaveBtn('cmd', \"Upload\", 'Upload', {}, \"\", \"\", \"if ($('#uploadBoxID').val()) startSpinner('Uploading')\" ):@SaveBtn('cmd', \"Cancel\", 'Cancel'), { class: \"col-xs-12 col-sm-10 col-md-10 col-lg-11\", style:\"xmargin-top:5px\" })\xFE";
    z += "    \xFE";
    z += "    Print @(-1):Join(Header, Crlf()):ctlHtml:Btns\xFE";
    z += "    \xFE";
    z += "    @Server.Pause\xFE";
    z += "    \xFE";
    z += "    Cmd = @Formvar('cmd')\xFE";
    z += "    \xFE";
    z += "    If Cmd <> \"Upload\" Then Goto doExit\xFE";
    z += "    \xFE";
    z += "    uploaddDBName = @Request.FileName(ctlID)\xFE";
    z += "    If !uploaddDBName Then Goto errOut\xFE";
    z += "    \xFE";
    z += "    Ext = LCase(FieldIfRight(uploaddDBName, \".\")) // \"xlsx\"\xFE";
    z += "    \xFE";
    z += "\xFE";
    z += "    uploaddDBName = DropIfRight(uploaddDBName, \".\")\xFE";
    z += "    \xFE";
    z += "    Locate Ext In [\"accdb\", \"mdb\", \"db3\", \"sl3\", \"xls\", \"xlsx\", \"xlsm\", \"xlsb\"] Else\xFE";
    z += "        Msgbox('Files must have an extension of: .accdb, .mdb, .sl3, .xlsx, .xls or .db3')\xFE";
    z += "        Goto doExit\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    // Get the database\xFE";
    z += "    uploadedFileContents = @RequestFile(ctlID)\xFE";
    z += "    L = Len(uploadedFileContents)\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "    Locate Ext In [\"xls\", \"xlsx\", \"xlsm\", \"xlsb\"] Then\xFE";
    z += "        srcDB = uploaddDBName:\".\":Ext\xFE";
    z += "        Write uploadedFileContents On fTmp, srcDB Else Goto errOut\xFE";
    z += "        if !showExcelForm(Null, fTmp.filePath(), srcDB, \"scp_history\") Then MsgBox(@Errors)\xFE";
    z += "        Stop\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    srcDB = dbPrefix:Replace(Timer(), \".\", \"\"):\".\":Ext\xFE";
    z += "    Write uploadedFileContents On fTmp, srcDB Else Goto errOut\xFE";
    z += "    \xFE";
    z += "    AppendRecords = False\xFE";
    z += "    dstDB = dbPrefix:uploaddDBName\xFE";
    z += "    \xFE";
    z += "    // Incase we msgbox\xFE";
    z += "    Print @(-1):Join(Header, Crlf()):\xFE";
    z += "    \xFE";
    z += "    Loop While dbDatabaseExists(dstDB) Do\xFE";
    z += "        Ans = Msgbox(\"The SQL Server database \":uploaddDBName:\" already exists.  What do you want to do?\", \"Delete Existing SQL DB,Choose a New Name,Rename the existing SQL DB,Append New Records,Cancel\")\xFE";
    z += "        If Ans = \"\" Or Ans = Chr(27) Or Ans = \"Cancel\" Then Goto errOut\xFE";
    z += "        \xFE";
    z += "        Select Case Ans\xFE";
    z += "            Case \"Delete Existing SQL DB\":\xFE";
    z += "                If Msgbox(\"Are you sure you want to DELETE the existing SQL database: \":dstDB, \"DELETE IT!,Cancel\") <> \"DELETE IT!\" Then Cycle\xFE";
    z += "                \xFE";
    z += "                If !dbDropSqlDatabase(dstDB) Then Msgbox(@Errors)\xFE";
    z += "                \xFE";
    z += "            Case \"Choose a New Name\", \"Rename the existing SQL DB\":\xFE";
    z += "                Msg = Ans\xFE";
    z += "                Loop\xFE";
    z += "                    For I = 1 To 50\xFE";
    z += "                        If I > 1 Then newName = dbPrefix:uploaddDBName:\"_\":I\xFE";
    z += "                        If !dbDatabaseExists(newName) Then Break\xFE";
    z += "                    Next\xFE";
    z += "                    If I>=50 Then newName = \"\"\xFE";
    z += "                    \xFE";
    z += "                    newName = @InputBox(\"New Name\", Msg, newName)\xFE";
    z += "                    If newName = \"\" Or newName = Chr(27) Then Goto doExit\xFE";
    z += "                    \xFE";
    z += "                While dbDatabaseExists(dbPrefix:newName) Do\xFE";
    z += "                    Msg = newName:\" is already used. Try again:\"\xFE";
    z += "                Repeat\xFE";
    z += "                \xFE";
    z += "                if Ans = \"Choose a New Name\" Then \xFE";
    z += "                    dstDB = dbPrefix:newName\xFE";
    z += "                Else\xFE";
    z += "                    If !dbRenameSqlDatabase(dstDB,dbPrefix:newName) Then Msgbox(@Errors)\xFE";
    z += "                End If\xFE";
    z += "                \xFE";
    z += "            Case \"Append New Records\"\xFE";
    z += "                AppendRecords = True\xFE";
    z += "                break\xFE";
    z += "                \xFE";
    z += "            Case Else\xFE";
    z += "                Goto doExit\xFE";
    z += "        End Select\xFE";
    z += "    Repeat\xFE";
    z += "\xFE";
    z += "    If Ext = \"accdb\" Then\xFE";
    z += "        Ds = 'Provider=Microsoft.ACE.OLEDB.12.0;Data Source=\"':fTmpPath:srcDB:'\";Persist Security Info=False'\xFE";
    z += "    ElseIf Ext = \"xlsx\" Then\xFE";
    z += "        Ds = 'Provider=Microsoft.ACE.OLEDB.12.0;Data Source=\"':fTmpPath:srcDB:'\";Extended Properties=\"Excel 12.0 Xml;HDR=YES\"'\xFE";
    z += "    ElseIf Ext = \"mdb\" Then\xFE";
    z += "        Ds = 'Provider=Microsoft.Jet.OLEDB.4.0;Data Source=\"':fTmpPath:srcDB:'\";Persist Security Info=False'\xFE";
    z += "    Else\xFE";
    z += "        Ds = 'Data Source=\"':fTmpPath:srcDB:'\";Version=3;New=False;Compress=False;Pooling=True;datetimeformat=CurrentCulture'\xFE";
    z += "    End If\xFE";
    z += "    Write 'D\\a':Ds On fSystem, srcDB Else Goto errOut\xFE";
    z += "\xFE";
    z += "    if dbCopyDatabase(srcDB, dstDB, AppendRecords) then goto doExit\xFE";
    z += "\xFE";
    z += "errOut: \xFE";
    z += "    if @Errors then Msgbox(@Errors)\xFE";
    z += "    \xFE";
    z += "doExit: \xFE";
    z += "    attachdb attachedDB Else Null\xFE";
    z += "    \xFE";
    z += "    Delete fSystem, srcDB Else Null\xFE";
    z += "    Delete fTmp, srcDB Else Null\xFE";
    z += "    \xFE";
    z += "    If !tabID Then Stop \"\"\xFE";
    z += "    \xFE";
    z += "    Print @(-1):@Script(`\xFE";
    z += "        if (window.parent.reloadDbTree) window.parent.reloadDbTree();\xFE";
    z += "    `):\xFE";
    z += "    \xFE";
    z += "    @Server.flush; Print @(-1):; @Server.flush\xFE";
    z += "    @Server.End\xFE";
    z += "End Program"
    window.cached_jsb_mdl["dbuploaddatabase"] = z;
    var z = "sub db_customMenu(jsonMenu)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    tabID = \"myTabs\"\xFE";
    z += "    \xFE";
    z += "    //     // ******************* Open / Close     // ******************* \xFE";
    z += "    onclick = 'treeToggle()'\xFE";
    z += "    JsonMenu.iconOpenClose = {\"id\":\"openclose\",\"glyphicon\":\"forward\", onclick: onclick } \xFE";
    z += "    \xFE";
    z += "    // ******************* upload     // ******************* \xFE";
    z += "    if @isManager() Then\xFE";
    z += "        Url = @jsbRestCall('dbUploadDatabase'):`?tabID=`:@urlEncode(tabID):`&noCache=`:timer()\xFE";
    z += "        onclick =  `openInTab(`:jsEscapeString(tabID):`, \"Upload_Database\", \"Upload database\", `:jsEscapeString(Url):`);`\xFE";
    z += "        JsonMenu.File = {} \xFE";
    z += "        JsonMenu.File.Upload = { id: \"upload\", caption:\"Upload MS Access Or Excel DB\", onclick: onclick }\xFE";
    z += "        JsonMenu.collaspable = true\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    if @hasTclParent Then \xFE";
    z += "        JsonMenu.btnQuit = \"Quit\" ;* put into @FormVar('SelectedMenu') will be \"Quit\"\xFE";
    z += "    End If\xFE";
    z += "end sub"
    window.cached_jsb_mdl["db_custommenu"] = z;
    var z = "function db_server\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "function moveDBtoList(ByVal dbSubGroup As Json, ByVal dbName As String, ByVal toGroup As String) As Boolean\xFE";
    z += "    if toGroup Then\xFE";
    z += "        For Each Tag As String In dbSubGroup\xFE";
    z += "            Dim V As Object = dbSubGroup[Tag]\xFE";
    z += "            Dim L As Integer = Len(V)\xFE";
    z += "            \xFE";
    z += "            If Isjson(V) And L Then \xFE";
    z += "                If Tag = toGroup Then\xFE";
    z += "                    V[dbName] = dbName\xFE";
    z += "                    return true\xFE";
    z += "                Else\xFE";
    z += "                    // a High level group\xFE";
    z += "                    if moveDBtoList(V, dbName, toGroup) then return true\xFE";
    z += "                End If\xFE";
    z += "                \xFE";
    z += "            ElseIf Tag = toGroup Then\xFE";
    z += "                // *** a single database\xFE";
    z += "                V = [dbName]\xFE";
    z += "                dbSubGroup[Tag] = V\xFE";
    z += "                return True\xFE";
    z += "            End If\xFE";
    z += "        Next\xFE";
    z += "    Else\xFE";
    z += "        dbSubGroup[dbName] = dbName\xFE";
    z += "        return True\xFE";
    z += "    End If\xFE";
    z += "      \xFE";
    z += "    return false\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "function hasGroupName(ByVal dbSubGroup As Json, ByVal groupname As String) As Boolean\xFE";
    z += "    For Each Tag As String In dbSubGroup\xFE";
    z += "        If Tag = groupname Then return true\xFE";
    z += "        Dim V As Object = dbSubGroup[Tag]\xFE";
    z += "        \xFE";
    z += "        If Isjson(V) Then \xFE";
    z += "           if hasGroupName(V, groupname) then return True\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "      \xFE";
    z += "    return false\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "function removeTreeViewDB(ByVal dbSubGroup As Json, ByVal dbName As String) As Boolean\xFE";
    z += "    Dim changed As Boolean = False\xFE";
    z += "    \xFE";
    z += "    For Each Tag As String In dbSubGroup\xFE";
    z += "        Dim V As Object = dbSubGroup[Tag]\xFE";
    z += "\xFE";
    z += "        If Isjson(V) Then \xFE";
    z += "            // a High level group\xFE";
    z += "            if removeTreeViewDB(V, dbName) then changed = True\xFE";
    z += "            \xFE";
    z += "        ElseIf Isarray(V) Then \xFE";
    z += "            // *** an array of databases\xFE";
    z += "            Locate dbName In V Setting Spot Then\xFE";
    z += "                 V.Delete(Spot)\xFE";
    z += "                 changed = True\xFE";
    z += "            End If\xFE";
    z += "            \xFE";
    z += "        ElseIf Tag = dbName Then\xFE";
    z += "            // *** a single database\xFE";
    z += "            Remove dbSubGroup, Tag\xFE";
    z += "            changed = True\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "      \xFE";
    z += "    return Changed\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "function dbfindAndRenameGroup(ByVal dbSubGroup As Json, ByVal path As String, ByVal newName As String) As Boolean\xFE";
    z += "   Dim groupname As String = fieldLeft(path, \"|\")\xFE";
    z += "   Dim subPath As String = dropLeft(path, \"|\")\xFE";
    z += "    \xFE";
    z += "    For Each Tag As String In dbSubGroup\xFE";
    z += "        If Tag = groupname Then\xFE";
    z += "            Dim V As Object = dbSubGroup[Tag]\xFE";
    z += "            if subPath Then\xFE";
    z += "               If Isjson(V) Then \xFE";
    z += "                   if dbfindAndRenameGroup(V, subPath, newName) then return True\xFE";
    z += "               End If\xFE";
    z += "            Else\xFE";
    z += "                Remove dbSubGroup, groupname\xFE";
    z += "                dbSubGroup[newName] = V\xFE";
    z += "                return true\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "      \xFE";
    z += "    return false\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "function dbfindAnddeleteGroup(ByVal dbSubGroup As Json, ByVal path As String) As Boolean\xFE";
    z += "   Dim groupname As String = fieldLeft(path, \"|\")\xFE";
    z += "   Dim subPath As String = dropLeft(path, \"|\")\xFE";
    z += "    \xFE";
    z += "    For Each Tag As String In dbSubGroup\xFE";
    z += "        If Tag = groupname Then\xFE";
    z += "            Dim V As Object = dbSubGroup[Tag]\xFE";
    z += "            if subPath Then\xFE";
    z += "               If Isjson(V) Then \xFE";
    z += "                   if dbfindAnddeleteGroup(V, subPath) then return True\xFE";
    z += "               End If\xFE";
    z += "            Else\xFE";
    z += "                Remove dbSubGroup, groupname\xFE";
    z += "                return true\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "      \xFE";
    z += "    return false\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "Restful function newSubGroupAPI(ByVal tabID As String, ByVal root As String, ByVal prmDB As String, ByVal prmGrp As String)\xFE";
    z += "    Call dbNewSubGroup(root, prmDB, prmGrp)\xFE";
    z += "    Return \"\"\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "Sub dbNewSubGroup(ByVal root As String, ByVal path As String, newSubGroupName)\xFE";
    z += "    dbGroups = getDbGroupsFromRoot(root)\xFE";
    z += "    if IsNothing(dbGroups) Then Return\xFE";
    z += "    \xFE";
    z += "    if dbfindAndAddSubGroup(dbGroups, path, newSubGroupName) Then updateGroupFromPath(root, dbGroups)\xFE";
    z += "end Sub\xFE";
    z += "\xFE";
    z += "Restful function deleteGroupAPI(tabID, ByVal root As String, ByVal path As String)\xFE";
    z += "    if !dbdeleteGroup(root, path) then return @Errors\xFE";
    z += "    Return \"\"\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function dbdeleteGroup(ByVal root As String, ByVal path As String)\xFE";
    z += "    Dim dbGroups As Json = getDbGroupsFromRoot(root)\xFE";
    z += "    if IsNothing(dbGroups) Then Return False\xFE";
    z += "    \xFE";
    z += "    if dbfindAnddeleteGroup(dbGroups, path) Then\xFE";
    z += "        updateGroupFromPath(root, dbGroups)\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    Return \"\"\xFE";
    z += "end Sub\xFE";
    z += "\xFE";
    z += "Restful function dbMoveDataBaseAPI(ByVal tabID As String, ByVal root As String, ByVal fromPath As String, ByVal toPath As String)\xFE";
    z += "    if !dbMoveDBtoGroup(root, fromPath, toPath) Then return @Errors\xFE";
    z += "    Return \"\"\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function dbMoveDBtoGroup(ByVal root As String, ByVal dbName As String, ByVal toGroup As String)\xFE";
    z += "    Dim dbGroups As Json = getDbGroupsFromRoot(root)\xFE";
    z += "    if IsNothing(dbGroups) Then Return False\xFE";
    z += "    \xFE";
    z += "    removeTreeViewDB(dbGroups, dbName)\xFE";
    z += "    if moveDBtoList(dbGroups, dbName, toGroup) Then updateGroupFromPath(root, dbGroups)\xFE";
    z += "\xFE";
    z += "    Return \"\"\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "Restful function renameGroupAPI(ByVal tabID As String, ByVal root As String, ByVal fromName As String, ByVal toName As String)\xFE";
    z += "    if !dbRenameGroup(root, fromName, toName) then return @Errors\xFE";
    z += "    Return \"\"\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function db_RenameGroup(ByVal root As String, ByVal path As String, ByVal newName As String)\xFE";
    z += "    dbGroups = getDbGroupsFromRoot(root)\xFE";
    z += "    if IsNothing(dbGroups) Then Return False\xFE";
    z += "    \xFE";
    z += "    if hasGroupName(dbGroups, newName) Then @Errors = \"'\":newName:\"' already exists\"; Return False\xFE";
    z += "    \xFE";
    z += "    if dbfindAndRenameGroup(dbGroups, path, newName) Then\xFE";
    z += "        updateGroupFromPath(root, dbGroups)\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    Return \"\"\xFE";
    z += "end Sub\xFE";
    z += "\xFE";
    z += "function runReportUrl(ByVal tabID As String, ByVal  reportID As String, ByVal  databaseName As String) As String\xFE";
    z += "    Return @jsbRootAccount():@urlEncode(reportID):`?tabID=`:@urlEncode(tabID):`&databaseName=`:@urlEncode(databaseName)\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function newReportUrl(ByVal  tabID As String, ByVal  databaseName As String) As String\xFE";
    z += "    Return @jsbRootAccount():`makenewreport?tabID=`:@urlEncode(tabID):`&databaseName=`:@urlEncode(databaseName)\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function db_showTop1000URL(ByVal tabID As String, ByVal tableOrViewName As String, ByVal databaseName As String) As String\xFE";
    z += "    Return @jsbRootAccount():`showTop1000?tabID=`:@urlEncode(tabID):`&tableID=`:@urlEncode(tableOrViewName):`&databaseName=`:@urlEncode(databaseName)\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "// 2nd level - Return { Tables:..., Views: ..., Reports: ..., SqlSelects: ... }\xFE";
    z += "// Each level under this will pop out a tab - we will use the database name as the tabID\xFE";
    z += "Restful function db_getSubTree(ByVal tabID As String, ByVal databaseName As String) As Json\xFE";
    z += "    return dbGetSubTree(tabID, databaseName)\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "function dbGetSubTree(ByVal tabID As String, ByVal databaseName As String) As Json\xFE";
    z += "    Dim preventTimeOut As Object = System(56)\xFE";
    z += "    Dim databaseName As String = Replace(Replace(databaseName, `[`, ``), `]`, ``)\xFE";
    z += "    \xFE";
    z += "    Dim Tables As Json = @db_getListOfTables(tabID, databaseName)\xFE";
    z += "    Dim Views As Json = @db_getListOfViews(tabID, databaseName)\xFE";
    z += "    Dim dbBuilderReports As Json = @db_getListOfReports(tabID, databaseName)\xFE";
    z += "    // Dim CustomSQLs As Json = @db_getListOfCustomSQL(tabID, databaseName)\xFE";
    z += "\xFE";
    z += "    Dim Tree As Json = {}\xFE";
    z += "    If Len(Tables) Then Tree.Tables = Tables\xFE";
    z += "    If Len(Views) Then Tree.Views = Views\xFE";
    z += "    If Len(dbBuilderReports) Then Tree.Reports = dbBuilderReports\xFE";
    z += "    // If Len(CustomSQLs) Then Tree.SqlSelects = CustomSQLs\xFE";
    z += "    \xFE";
    z += "    Return Tree\xFE";
    z += "End Sub\xFE";
    z += "\xFE";
    z += "function db_getListOfCustomSQL(ByVal tabID As String, ByVal databaseName As String) As Json\xFE";
    z += "    Dim CustomSQLs As Json = {}\xFE";
    z += "    \xFE";
    z += "    // Database must be SQL type\xFE";
    z += "    If @Jsb_odb.AttachDBextended(databaseName) Then \xFE";
    z += "        If UCase(typeOfConnection()) <> \"FILESYSTEM\" Then \xFE";
    z += "            Dim fSQL As tableHandle\xFE";
    z += "            Open \"jsbCustomSQL\" To fSQL Else\xFE";
    z += "                Attachdb \"\" Else Stop @Errors\xFE";
    z += "                fSql = @fHandle(\"\", \"jsbCustomSQL\", True)\xFE";
    z += "            End If\xFE";
    z += "            \xFE";
    z += "            Dim Prefix As String = NiceName(databaseName):`_`\xFE";
    z += "            Dim Sl As SelectList\xFE";
    z += "            Select fSQL To Sl Where `ItemID like '`:Prefix:`]' Order By ItemID` Else Return {}\xFE";
    z += "            Dim SqlList As Array = GetList(Sl)\xFE";
    z += "            Dim sqlID As String\xFE";
    z += "            Dim Url As String\xFE";
    z += "            Dim tabCaption As String\xFE";
    z += "            Dim onTableClick As String\xFE";
    z += "            \xFE";
    z += "            For Each sqlID In SqlList\xFE";
    z += "                If LCase(Right(sqlID, 4)) = \".sql\" Then\xFE";
    z += "                    sqlID = DropRight(sqlID, \".\") // drop extension\xFE";
    z += "                    Url = db_buildQryURL(tabID, sqlID, databaseName)\xFE";
    z += "                    tabCaption = \"sql: \":Replace(Mid(sqlID, Len(Prefix) + 1), \"_\", \" \")\xFE";
    z += "                    onTableClick = `openInTab(`:jsEscapeString(tabID):`, `:jsEscapeString(sqlID):`, `:jsEscapeString(tabCaption):`, `:jsEscapeString(Url):`); treeHide();`\xFE";
    z += "                    CustomSQLs[sqlID] = { id: sqlID, class: 'usrSQL', onclick: onTableClick, data: { url: Url, sqlID: sqlID, databaseName: databaseName, tabID: tabID } }\xFE";
    z += "                End If\xFE";
    z += "            Next\xFE";
    z += "            \xFE";
    z += "            sqlID = \"*NEW*\"\xFE";
    z += "            Url = db_buildQryURL(tabID, sqlID, databaseName)\xFE";
    z += "            tabCaption = \"SQL: *NEW*\"\xFE";
    z += "            onTableClick = `openInTab(`:jsEscapeString(tabID):`, `:jsEscapeString(databaseName:\"_\":sqlID):`, `:jsEscapeString(tabCaption):`, `:jsEscapeString(Url):`); treeHide();`\xFE";
    z += "            CustomSQLs[sqlID] = { id: sqlID, class: 'usrSQL', onclick: onTableClick, data: { url: Url, sqlID: sqlID, databaseName: databaseName, tabID: tabID } }\xFE";
    z += "        End if\xFE";
    z += "    End if\xFE";
    z += "    \xFE";
    z += "    Attachdb \"\" Else Null\xFE";
    z += "    Return CustomSQLs\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function db_fDict_DBBuilder\xFE";
    z += "    // Create file if necessary\xFE";
    z += "    Return Fhandle(\"dict\", \"dbBuilderReports\", true)\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function db_buildQryURL(tabID, sqlID, databaseName) As String\xFE";
    z += "    Return @jsbRootAccount():`sqlQueryBuilder?sqlID=`:@urlEncode(sqlID):`&tabID=`:@urlEncode(tabID):`&databaseName=`:@urlEncode(databaseName)\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function db_getListOfReports(ByVal tabID As String, ByVal databaseName As String) As Json\xFE";
    z += "    Dim fReports As TableHandle = @db_fDict_DBBuilder()\xFE";
    z += "    Dim rptPrefix As String = NiceName(databaseName):`_`\xFE";
    z += "    Dim prefixLen As Integer = Len(rptPrefix)\xFE";
    z += "    \xFE";
    z += "    Dim Sl As SelectList\xFE";
    z += "    Select fReports To Sl Where `ItemID like '`:rptPrefix:`]'` Else Return {}\xFE";
    z += "    Dim Pages As Array = GetList(Sl)\xFE";
    z += "    \xFE";
    z += "    // Build list of reports\xFE";
    z += "    Dim reportList As Array = []\xFE";
    z += "    For Each reportName As String In Pages\xFE";
    z += "        If LCase(Right(reportName, 5)) = \".page\" Then\xFE";
    z += "            reportName = Field(reportName, \".page\", 1)\xFE";
    z += "            Dim fRight As String = LCase(FieldRight(reportName, \"_\"))\xFE";
    z += "            Locate fRight In [\"grid\", \"pivotsetup\", \"pivot\", \"editrecord\"] Else reportList[-1] = reportName\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    reportList = @Sort(reportList)\xFE";
    z += "    Dim dbBuilderReports As Json = {}\xFE";
    z += "    For Each reportID As String In reportList\xFE";
    z += "        Dim Url As String, tabCaption As String\xFE";
    z += "        If reportID = \"*New Report*\" Then\xFE";
    z += "            Url = newReportUrl(tabID, databaseName)\xFE";
    z += "            tabCaption = reportID\xFE";
    z += "        Else\xFE";
    z += "            Url = runReportUrl(tabID, reportID, databaseName)\xFE";
    z += "            tabCaption = Replace(Mid(reportID, prefixLen+1), \"_\", \" \")\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        onTableClick = `openInTab(`:jsEscapeString(tabID):`, `:jsEscapeString(reportID):`, `:jsEscapeString(tabCaption):`, `:jsEscapeString(Url):`); treeHide();`\xFE";
    z += "        dbBuilderReports[reportID] = { id: reportID, class: 'usrReport', onclick: onTableClick, caption: tabCaption, data: { url: Url, reportID: reportID, databaseName: databaseName, tabID: tabID } }\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    Return dbBuilderReports\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function db_getListOfViews(ByVal tabID As String, ByVal databaseName As String) As Json\xFE";
    z += "    Dim Views As Json = {}\xFE";
    z += "    Try\xFE";
    z += "        dim systemDbTemplateName As String, connectionString As String, UserName As String, Password As String, InitialCatalog  As String\xFE";
    z += "        If @Jsb_odb.AttachDBextended(databaseName, systemDbTemplateName, connectionString, UserName, Password, InitialCatalog) Then\xFE";
    z += "            Dim Sql As String = `USE [`:InitialCatalog:`]; SELECT Name FROM sys.objects WHERE type = 'V' Order By Name`\xFE";
    z += "            Dim Sl As SelectList\xFE";
    z += "            Sqlselect Sql To Sl Else Return {}\xFE";
    z += "            \xFE";
    z += "            Dim Rows As Array = GetList(Sl)\xFE";
    z += "            \xFE";
    z += "            Dim viewList As Array = []\xFE";
    z += "            For Each Row As Json In Rows\xFE";
    z += "                viewName = Row.Name\xFE";
    z += "                Url = db_showTop1000URL(tabID, viewName, databaseName)\xFE";
    z += "                tabCaption = \"view: \":viewName\xFE";
    z += "                onTableClick = `openInTab(`:jsEscapeString(tabID):`, `:jsEscapeString(databaseName:\"_\":viewName):`, `:jsEscapeString(tabCaption):`, `:jsEscapeString(Url):`); treeHide();`\xFE";
    z += "                Views[viewName] = { id: viewName, class: 'usrView', onclick: onTableClick, data: { url: Url, viewName: viewName, databaseName: databaseName, tabID: tabID } }\xFE";
    z += "            Next\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "    Catch Err\xFE";
    z += "        \xFE";
    z += "    End Try\xFE";
    z += "    \xFE";
    z += "    Attachdb \"\" Else Null\xFE";
    z += "    Return Views\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function db_getListOfTables(ByVal tabID As String, ByVal databaseName As String) As Json\xFE";
    z += "    Dim Tables As Json = {}\xFE";
    z += "    \xFE";
    z += "    Attachdb \"databaseBuilder_ro\" Else return Tables\xFE";
    z += "\xFE";
    z += "    Dim Sql As String = `use [`:databaseName:`]; SELECT table_name FROM information_schema.tables WHERE table_type = 'base table'  Order By table_name`\xFE";
    z += "    Dim SL As SelectList\xFE";
    z += "    Sqlselect Sql To Sl Else \xFE";
    z += "        Attachdb \"\" Else Null\xFE";
    z += "        Return { Errors: @Errors }\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Dim Recs As Array = GetList(Sl)\xFE";
    z += "    For Each Rec As Json In Recs\xFE";
    z += "        Dim TableName As String = Rec.table_name\xFE";
    z += "        Locate TableName In ['master', 'tempdb', 'model', 'msdb', 'MSys', 'sysdiagrams'] Else\xFE";
    z += "            Dim Url As String = db_showTop1000URL(tabID, TableName, databaseName)\xFE";
    z += "            Dim tabCaption As String =  \"tbl: \":TableName\xFE";
    z += "            Dim onTableClick As String = `openInTab(`:jsEscapeString(tabID):`, `:jsEscapeString(databaseName:\"_\":TableName):`, `:jsEscapeString(tabCaption):`, `:jsEscapeString(Url):`); treeHide();`\xFE";
    z += "            Tables[TableName] = { id: tableName, class: 'usrTable', onclick: onTableClick, data: { url: Url, tableName: tableName, databaseName: databaseName, tabID: tabID } }\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    Attachdb \"\" Else Null\xFE";
    z += "    Return Tables\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function db_getDatabaseNamesWithoutPermissons() As Array\xFE";
    z += "    Dim DATABASENAMES As Array\xFE";
    z += "    Dim SS As SelectList\xFE";
    z += "    Dim Sql As String\xFE";
    z += "    Dim SL As SelectList\xFE";
    z += "    Dim RECS As String\xFE";
    z += "    Dim NoPermissions As Array = []\xFE";
    z += "\xFE";
    z += "    databaseNames = @@db_getDatabaseNames()\xFE";
    z += "\xFE";
    z += "    Attachdb \"databaseBuilder_ro\" Else Stop @Errors\xFE";
    z += "    For Each databaseName In databaseNames\xFE";
    z += "       // Make sure we can query the table names Or The viewNames\xFE";
    z += "       Sql = `use [`:databaseName:`]; SELECT top 3 table_name FROM information_schema.tables WHERE table_type = 'base table'  Order By table_name`\xFE";
    z += "       Sqlselect Sql To Sl Else NoPermissions[-1] = LCase(databaseName)\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    attachdb \"\" else null\xFE";
    z += "    Return NoPermissions\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "function db_cleanJson(ByVal dbSubGroup As Json) As Boolean\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    For Each Tag As String In dbSubGroup\xFE";
    z += "        Dim V As Object = dbSubGroup[Tag]\xFE";
    z += "        \xFE";
    z += "        if isArray(V) then\xFE";
    z += "            Dim ary As Array = V\xFE";
    z += "            V = {}\xFE";
    z += "            for each db As Object in ary\xFE";
    z += "                V[db] = db\xFE";
    z += "            next\xFE";
    z += "            dbSubGroup[Tag] = V\xFE";
    z += "        end if\xFE";
    z += "            \xFE";
    z += "        If Isjson(V) Then db_cleanJson(V)\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    return true\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "function db_getdefinedDBs(ByVal databaseNames As Array, ByVal dbGroups As Json, ByRef definedDBs As Array) As Array\xFE";
    z += "    \xFE";
    z += "    If !definedDBs Then definedDBs = []\xFE";
    z += "    For Each groupName As String, Grpi As Integer In dbGroups\xFE";
    z += "        Dim subGroups As Object = dbGroups[groupName]\xFE";
    z += "        If Isjson(subGroups) Then\xFE";
    z += "            db_getdefinedDBs(databaseNames, subGroups, definedDBs)\xFE";
    z += "            \xFE";
    z += "        Else If Isarray(subGroups) Then\xFE";
    z += "            For Each dbName As String, Dbi As Integer In subGroups\xFE";
    z += "                Locate dbName In databaseNames Then\xFE";
    z += "                    dbName = LCase(dbName)\xFE";
    z += "                    Locate dbName In definedDBs Else definedDBs[-1] = dbName\xFE";
    z += "                Else\xFE";
    z += "                    Return db_getdefinedDBs(databaseNames, dbGroups, definedDBs)\xFE";
    z += "                End If\xFE";
    z += "            Next\xFE";
    z += "        Else\xFE";
    z += "            dbName = LCase(subGroups)\xFE";
    z += "            Locate dbName In definedDBs Else definedDBs[-1] = dbName\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    Return definedDBs\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function db_getDatabaseNames() As Array\xFE";
    z += "    Attachdb \"databaseBuilder_ro\" Else Stop @Errors\xFE";
    z += "    Dim Cmd As String = `SELECT name FROM sys.databases Where Not name In ('master', 'tempdb', 'model', 'msdb', 'MSys', 'sysdiagrams') And state_desc!='OFFLINE' Order By name`\xFE";
    z += "    Sqlselect Cmd To Sl As SelectList Else Stop @Errors\xFE";
    z += "\xFE";
    z += "    Dim Recs As Array = Getlist(Sl)\xFE";
    z += "    Dim databaseNames As Array = []\xFE";
    z += "    For Each Rec As Json In Recs\xFE";
    z += "       databaseNames[-1] = Rec.name\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    Attachdb \"\" Else Null\xFE";
    z += "    Return databaseNames\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "// =====================================================================================================\xFE";
    z += "// DB program code to run on the server\xFE";
    z += "// =====================================================================================================\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "function @@db_addNewDatabases() as Boolean\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    Dim okToUpdate As Boolean = True\xFE";
    z += "    Dim Changed As Boolean = False\xFE";
    z += "    \xFE";
    z += "    Dim databaseNames As Array = db_getDatabaseNames()\xFE";
    z += "    Dim dbGroups As Json = db_getGroupsFromRoot(\"\")\xFE";
    z += "    Dim definedDBs As Array = db_getdefinedDBs(databaseNames, dbGroups, definedDBs)\xFE";
    z += "\xFE";
    z += "    // make sure each database is defined somewhere\xFE";
    z += "    Dim unassignedDBS As Array = []\xFE";
    z += "    Dim dbName As String\xFE";
    z += "    For Each dbName In databaseNames\xFE";
    z += "        Locate LCase(dbName) In definedDBs Else unassignedDBS[-1] = dbName\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    If Len(unassignedDBS) Then \xFE";
    z += "        // make sure misc group exists\xFE";
    z += "        Dim miscName As String = \"Miscellaneous\"\xFE";
    z += "        Dim Misc As Object = dbGroups[miscName]\xFE";
    z += "        If !Misc Then\xFE";
    z += "            dbGroups[miscName] = []\xFE";
    z += "            Misc = dbGroups[miscName]\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        // make sure ms access group exists\xFE";
    z += "        Dim accName As String = \"Private Databases\"\xFE";
    z += "        DIm Msacc As Object = dbGroups[accName]\xFE";
    z += "        If !Msacc Then\xFE";
    z += "            dbGroups[accName] = {}\xFE";
    z += "            Msacc = dbGroups[accName]\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        For Each dbName In unassignedDBS\xFE";
    z += "            If LCase(Left(dbName, 1)) = \"z\" And Instr(dbName, \"-\") Then\xFE";
    z += "                Dim Username As String = Mid(Field(dbName, \"-\", 1), 2)\xFE";
    z += "                \xFE";
    z += "                // insure users group exists\xFE";
    z += "                Dim Usersgrp As Object = Msacc[Username]\xFE";
    z += "                If !Usersgrp Then\xFE";
    z += "                    Msacc[Username] = []\xFE";
    z += "                    Usersgrp = Msacc[Username]\xFE";
    z += "                End If\xFE";
    z += "                \xFE";
    z += "                // Place dbName in Usersgrp\xFE";
    z += "                if isArray(Usersgrp) Then Usersgrp[-1] = dbName Else Usersgrp[dbName] = dbName\xFE";
    z += "            Else\xFE";
    z += "                if isArray(Misc) Then Misc[-1] = dbName Else Misc[dbName] = dbName\xFE";
    z += "            End If\xFE";
    z += "        Next\xFE";
    z += "        Changed = True\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    If Changed And okToUpdate Then db_updateGroupFromPath(\"\", dbGroups)\xFE";
    z += "\xFE";
    z += "    Return Changed\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function @@db_removeVacantDatabases() As Boolean\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    return true ;* skip this for now\xFE";
    z += "    \xFE";
    z += "    Dim dbGroups As Json = db_getGroupsFromRoot(\"\")\xFE";
    z += "    if IsNothing(dbGroups) Then dbGroups = {}\xFE";
    z += "    \xFE";
    z += "    Dim alldatabaseNames As Array = db_getDatabaseNames()\xFE";
    z += "    \xFE";
    z += "    Dim changed As Boolean = false\xFE";
    z += "    db_removeVacantDatabasesSubLevel(0, dbGroups, alldatabaseNames, changed)\xFE";
    z += "    If Changed Then db_updateGroupFromPath(\"\", dbGroups)\xFE";
    z += "    return changed\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function db_updateGroupFromPath(ByVal root As String, ByVal dbGroupReplacement As Object) As Boolean\xFE";
    z += "   Dim allGroups As Json\xFE";
    z += "   \xFE";
    z += "   if root then\xFE";
    z += "        allGroups = db_getGroupsFromRoot(\"\")\xFE";
    z += "        db_ReplaceGroup(root, allGroups, dbGroupReplacement)\xFE";
    z += "    Else\xFE";
    z += "        TrashIt(\"jsb_config\", \"dbBuilderDBGroups\")\xFE";
    z += "        allGroups = dbGroupReplacement\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    WriteJson allGroups On @fJsbConfig, \"dbBuilderDBGroups\" Else Null\xFE";
    z += "    return True\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function db_ReplaceGroup(ByVal path As String, ByVal dbGroups As Json, ByVal Replacement As Object) As Boolean\xFE";
    z += "    Dim groupName As String = LCase(fieldLeft(path, \"|\"))\xFE";
    z += "    Dim subPath As String = dropLeft(path, \"|\")\xFE";
    z += "    \xFE";
    z += "    if !subPath then \xFE";
    z += "        dbGroups[groupname] = Replacement\xFE";
    z += "        return True\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    For Each Tag As String In dbGroups\xFE";
    z += "        If LCase(Tag) = groupName Then\xFE";
    z += "            Dim V As Object = dbGroups[Tag]\xFE";
    z += "            If Isjson(V) Then return db_ReplaceGroup(subPath, V, Replacement)\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "      \xFE";
    z += "    return False\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "function db_removeVacantDatabasesSubLevel(ByVal Level As Integer, ByVal dbSubGroup As String, ByVal databaseNames As Array, ByRef changed As Boolean) As Integer\xFE";
    z += "    Dim trueCnt As Integer = 0\xFE";
    z += "    Dim SubCnt As Integer\xFE";
    z += "    \xFE";
    z += "    For Each Tag As String, TagI As Integer In dbSubGroup\xFE";
    z += "        Dim V As Object = dbSubGroup[Tag]\xFE";
    z += "\xFE";
    z += "        If Isjson(V) Then \xFE";
    z += "            // a High level group\xFE";
    z += "            if Len(V) Then\xFE";
    z += "                SubCnt = db_removeVacantDatabasesSubLevel(Level + 1, V, databaseNames, changed)\xFE";
    z += "            Else\xFE";
    z += "                // but empty\xFE";
    z += "                SubCnt = 0\xFE";
    z += "            end if\xFE";
    z += "            \xFE";
    z += "            trueCnt += SubCnt\xFE";
    z += "            \xFE";
    z += "            // Remove empty groups\xFE";
    z += "            //if SubCnt = 0 And Level <> 0 Then\xFE";
    z += "            //    remove dbSubGroup, Tag\xFE";
    z += "            //    Changed = True\xFE";
    z += "            //    TagI -= 1    \xFE";
    z += "            //End If\xFE";
    z += "\xFE";
    z += "        Else If V Then // *** a single database V\xFE";
    z += "            locate V in databaseNames Then\xFE";
    z += "                trueCnt += 1\xFE";
    z += "            Else\xFE";
    z += "                // remove dbSubGroup, Tag\xFE";
    z += "                // Changed = True\xFE";
    z += "                // TagI -= 1\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    Return trueCnt\xFE";
    z += "End function\xFE";
    z += "\xFE";
    z += "function db_getGroupsFromRoot(ByVal root As String) As Json\xFE";
    z += "    ReadJson dbGroups As Json From @fJsbConfig, \"dbBuilderDBGroups\" Else Return Nothing\xFE";
    z += "    If HasTag(dbGroups, \"ItemID\") Then @Errors = \"Corrupt jsb_config dbBuilderDBGroups\"; Return Nothing\xFE";
    z += "    \xFE";
    z += "    db_cleanJson(dbGroups)\xFE";
    z += "    \xFE";
    z += "    if root then dbGroups = db_findRoot(dbGroups, root) \xFE";
    z += "    \xFE";
    z += "    Return dbGroups\xFE";
    z += "end Sub\xFE";
    z += "\xFE";
    z += "function db_findRoot(ByVal dbGroups As JSON, ByVal path As String) As Json\xFE";
    z += "    Dim groupname As String = LCase(fieldLeft(path, \"|\"))\xFE";
    z += "    if !groupname then return dbGroups\xFE";
    z += "    Dim subPath As String = dropLeft(path, \"|\")\xFE";
    z += "    \xFE";
    z += "    For Each Tag As String In dbGroups\xFE";
    z += "        If LCase(Tag) = groupname Then\xFE";
    z += "            Dim V As Object = dbGroups[Tag]\xFE";
    z += "            if !subPath then return V\xFE";
    z += "            If Isjson(V) Then \xFE";
    z += "               return db_findRoot(V, subPath)\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "      \xFE";
    z += "    return {}\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "\xFE";
    z += ""
    window.cached_jsb_mdl["db_server"] = z;
    window.cached_jsb_mdl["defaultcolumn"] = "Subroutine defaultColumn(ProjectName, PageName, ViewName, ColumnID)\xFE    * %options aspxC-\xFE    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE    ColumnIdx = @findViewColumn(dataSet, ColumnID)\xFE    If ColumnIdx = 0 Then Return\xFE    newValue = Trim(@InputBox(\"Column Property \":ColumnID, \"Default Value\", dataSet.columns[ColumnIdx].defaultvalue, \"80%\", \"auto\"))\xFE    If newValue = Chr(27) Then Return\xFE    dataSet.columns[ColumnIdx].defaultvalue = newValue\xFE    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edc-\":System(28):\": \":@Errors\xFE    Call @jsb_mdl.ReGenPageModel(ProjectName, PageName, False)\xFEEnd Subroutine";
    window.cached_jsb_mdl["deletenonessentialfiles"] = "Sub DeleteNonEssentialFiles(ProjectName)\xFE* %options aspxC-\xFE    Open \"\", ProjectName To Scp Else Stop\xFE    Open \"dict\", ProjectName To Dscp Else Stop\xFE\xFE    Execute 'delete dict ':ProjectName:' = \"[.PCS\"' Capturing X\xFE    Execute 'delete dict ':ProjectName:' = \"[.PCF\"' Capturing X\xFE    Execute 'delete dict ':ProjectName:' = \"[.PCD\"' Capturing X\xFE    Select Scp To Sl Else Stop @Errors\xFE    Loop\xFE        Readnext Id From Sl Else Break\xFE    While True Do\xFE        If Instr(LCase(Id), \"_custom\") = 0 Then Delete Scp, Id Else Stop @Errors\xFE    Repeat\xFEEnd Sub";
    window.cached_jsb_mdl["deletepage"] = "// TCL version\xFEProgram deletePage\xFE    * %options aspxC-\xFE    if !isManager() Then Stop \"You must be at least a data manager to run program\"\xFE\xFE    If !@ParseSelect(@Sentence, \"\", Top, Columns, Dict, ProjectName, FilterBy, OrderBY, Options, AllItems, F) Then Stop\xFE    ItemList = GetList(0)\xFE    If Len(ItemList) = 0 Then Stop\xFE    \xFE    Ans = @MsgBox(\"Warning!\", \"Are you sure you wish to delete these page(s): \":Replace(ItemList, AM(), \", \"), \"Yes,*No\")\xFE    If Ans <> \"Yes\" Then Stop\xFE\xFE    For Each pageName In ItemList\xFE        @deletePageModel(ProjectName, pageName)\xFE    Next\xFEEnd Program";
    var z = "Function deletePageModel(ProjectName, ipageName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    pageName = @DropIfRight(ipageName, \".page\", True)\xFE";
    z += "\xFE";
    z += "    Views = ViewsInPage(ProjectName, pageName)\xFE";
    z += "    If Len(Views) = 0 Then Views[-1] = pageName:\".view\"\xFE";
    z += "    \xFE";
    z += "    For Each ViewName In Views\xFE";
    z += "        DeleteView(ProjectName, pageName, ViewName, False)\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    // really only need to TrashIt if there is custom code \xFE";
    z += "    TrashIt(ProjectName, pageName)\xFE";
    z += "    Delete @fHandle(\"\", ProjectName), pageName Else If @Errors Then Alert(@Errors)\xFE";
    z += "    \xFE";
    z += "    fDict = @fHandle(\"DICT\", ProjectName)\xFE";
    z += "    TrashIt(\"dict \":ProjectName, pageName:\".page\")\xFE";
    z += "    Delete fdict, pageName:\".page\" Else If @Errors Then Alert(@Errors)\xFE";
    z += "    Delete fdict, pageName:\".pcd\" Else If @Errors Then Alert(@Errors)\xFE";
    z += "    \xFE";
    z += "    Delete @fHandle(\"\", \"md\"), pageName Else If @Errors Then Alert(@Errors)\xFE";
    z += "\xFE";
    z += "    Call @jsb_mdl.UpdateMenu(ProjectName, True)\xFE";
    z += "    Return True\xFE";
    z += "End Function\xFE";
    z += "// URL version\xFE";
    z += "Program deletePageModel\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    if !isManager() Then Stop \"You must be at least a data manager to run program\"\xFE";
    z += "\xFE";
    z += "    ProjectName = @ParamVar('ProjectName')\xFE";
    z += "    pageName = @ParamVar('pageName')\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "\xFE";
    z += "    If ProjectName And Len(@ParamVars) Then\xFE";
    z += "        pageName = @DropIfRight(pageName, \".page\", True)\xFE";
    z += "        \xFE";
    z += "        Ans = @MsgBox(\"Warning!\", \"Are you sure you wish to delete this page: \":pageName:\".page\", \"Yes,*No\")\xFE";
    z += "        If Ans = \"Yes\" Then deletePageModel(ProjectName, pageName)\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    If !fromPage And !@hasParentProcess Then @Server.End\xFE";
    z += "    @Response.Redirect(@jsbRootExecute('menu'))\xFE";
    z += "End Program"
    window.cached_jsb_mdl["deletepagemodel"] = z;
    var z = "Restful function deleteRptAPI(tabID, databaseName, reportName, path)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "\xFE";
    z += "    if left(reportName, len(databasename) + 1) <> databaseName:\"_\" then return { AtErrors: \"bad report name prefix\" }\xFE";
    z += "    if LCase(Right(reportName, 7)) <> \"_report\" then return { AtErrors: \"bad report name suffix\" }\xFE";
    z += "    \xFE";
    z += "\xFE";
    z += "    success_editRecord = @deletePageModel(\"dbBuilderReports\", reportName:\"_editRecord\")\xFE";
    z += "    success_Grid = @deletePageModel(\"dbBuilderReports\", reportName:\"_Grid\")\xFE";
    z += "    success_Pivot = @deletePageModel(\"dbBuilderReports\", reportName:\"_Pivot\")\xFE";
    z += "    success_PivotSetup = @deletePageModel(\"dbBuilderReports\", reportName:\"_PivotSetup\")\xFE";
    z += "    \xFE";
    z += "    // Create file if necessary\xFE";
    z += "    fReports = @fDictDBbuilder\xFE";
    z += "    rptPrefix = NiceName(reportName)\xFE";
    z += "    \xFE";
    z += "    Select fReports To Sl Where `ItemID like '`:rptPrefix:`]'` Else Return { AtErrors: @Errors }\xFE";
    z += "    rptItems = GetList(Sl)\xFE";
    z += "    \xFE";
    z += "    For Each rptName In rptItems\xFE";
    z += "        delete fReports, rptName\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    return { success: true }\xFE";
    z += "End function"
    window.cached_jsb_mdl["deleterptapi"] = z;
    var z = "function DeleteView(ProjectName, pageName, ViewName, Confirm)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    ViewName = @DropIfRight(ViewName, \".view\", True)\xFE";
    z += "    If Confirm Then\xFE";
    z += "        If @MsgBox(\"Confirm\", \"Are you sure you wish to delete view '\":ViewName:\"'?\", \"Yes,*No\") <> \"Yes\" Then Return False\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    fDict = @fHandle(\"DICT\", ProjectName)\xFE";
    z += "    \xFE";
    z += "    TrashIt(\"dict \":ProjectName, ViewName:\".view\")\xFE";
    z += "    Delete From fDict, ViewName:\".view\" Else If @Errors Then Alert(@Errors)\xFE";
    z += "    \xFE";
    z += "    TrashIt(\"dict \":ProjectName, ViewName:\".htm\")\xFE";
    z += "    Delete From fDict, ViewName:\".htm\" Else If @Errors Then Alert(@Errors)\xFE";
    z += "    \xFE";
    z += "    Delete From fDict, ViewName:\".pcd\" Else If @Errors Then Alert(@Errors)\xFE";
    z += "    Delete From @fHandle(\"MD\"), ViewName Else If @Errors Then Alert(@Errors)\xFE";
    z += "\xFE";
    z += "    // cleaup .pcd, .pcs, .pcf files:  (Anything the starts, contains, or endswith viewname\xFE";
    z += "    For Each Id In fSelect('dict ':ProjectName, \"ItemID like '\":ViewName:\"_%' Or ItemID like '%_\":ViewName:\"_%' Or ItemID like '%_\":ViewName:\"'\")\xFE";
    z += "        ext = lcase(right(id, 4))\xFE";
    z += "        if ext = \".pcd\" or ext = \".pcs\" or ext = \".pcf\" then\xFE";
    z += "            Delete fDict, Id Else @Alert(@Errors)\xFE";
    z += "        end if\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    Return True\xFE";
    z += "End function"
    window.cached_jsb_mdl["deleteview"] = z;
    window.cached_jsb_mdl["deleteviewbtn"] = "function DeleteViewBtn(ProjectName, pageName, ViewName, btnText)\xFE    * %options aspxC-\xFE    \xFE    ReadJSon ObjectModel From @fHandle(\"DICT\", ProjectName), ViewName Else Debug @Alert('Unable to find view ':ViewName); Return False\xFE    BtnI = @findBtnI(ObjectModel, btnText)\xFE    If !BtnI Then Return False\xFE\xFE    If @MsgBox(\"Confirm\", \"Are you sure you wish to delete this button '\":btnText:\"'?\", \"Yes,*No\") = \"Yes\" Then\xFE        ObjectModel.custombtns.Delete(BtnI)\xFE        WriteJSon ObjectModel On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE        Call @Jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFE        Return True\xFE    End If\xFE\xFE    Return False\xFEEnd function";
    var z = "Subroutine DeleteViewColumn(ProjectName, PageName, ViewName, ColumnID, includeDB)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    If includeDB Then\xFE";
    z += "        Ans = @MsgBox(\"Warning!\", \"Are you sure you wish to DELETE the database column: '\":ColumnID:\"?\", \"Yes,No\")\xFE";
    z += "    Else\xFE";
    z += "        Ans = @MsgBox(\"Warning!\", \"Are you sure you wish to remove the column: '\":ColumnID:\"' from the view \":ViewName:\"?\", \"Yes,No\")\xFE";
    z += "    End If\xFE";
    z += "   \xFE";
    z += "    If Ans <> \"Yes\" Then Return\xFE";
    z += "\xFE";
    z += "    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE";
    z += "    ColumnIdx = @findViewColumn(dataSet, ColumnID)\xFE";
    z += "    If ColumnIdx = 0 Then Return\xFE";
    z += "    dataSet.columns.Delete(ColumnIdx)\xFE";
    z += "    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edc-\":System(28):\": \":@Errors\xFE";
    z += "    \xFE";
    z += "    If includeDB Then\xFE";
    z += "        TableName = dataSet.tableName\xFE";
    z += "        Delete Fhandle('dict', TableName), \"!\":ColumnID Else Null\xFE";
    z += "        open TableName to x then\xFE";
    z += "            select \"ItemID,*\" from x to sl then\xFE";
    z += "                Items = getlist(sl)\xFE";
    z += "                For Each Item In Items\xFE";
    z += "                    If HasTag(Item, ColumnID) Then\xFE";
    z += "                        ItemID = Item.ItemID\xFE";
    z += "                        Remove Item, ColumnID\xFE";
    z += "                        Remove Item, \"ItemID\"\xFE";
    z += "                        Writejson Item On X, ItemID else alert(@Errors)\xFE";
    z += "                    End If\xFE";
    z += "                Next\xFE";
    z += "            end if\xFE";
    z += "        end if\xFE";
    z += "    End If\xFE";
    z += "  \xFE";
    z += "    Call @jsb_mdl.ReGenPageModel(ProjectName, PageName, False)\xFE";
    z += "End Subroutine"
    window.cached_jsb_mdl["deleteviewcolumn"] = z;
    window.cached_jsb_mdl["deletewebsitemodel"] = "Program deleteWebSiteModel\xFE* %options aspxC-\xFE    If !IsManager() Then Stop \"You must be at least a manager to run this command\"\xFE    Attachdb \"\" Else Null\xFE    \xFE    Ans = @MsgBox(\"DELETE ACCOUNT\", \"Are you sure you want to completely DELETE the website: \":@jsbAccount, \"Yes,No\")\xFE    If Ans = \"Yes\" Then\xFE        If deleteAccount(@jsbAccount) Then @Response.Redirect(@logoutUrl) \xFE        MsgBox(@Errors)\xFE    End If\xFEEnd Program";
    var z = "Program devxPivotSetup\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    if !@islocalhost Then\xFE";
    z += "        roleMsg = Iff(@IsAuthenticated, \"\", \"You must be logged in to view this page. \":@Anchor(@LoginUrl, \"Click here to login\"))\xFE";
    z += "        If !@IsEmployee Then Stop Iff(roleMsg, roleMsg, \"I'm sorry, you must be an employee to view this page.\")\xFE";
    z += "        \xFE";
    z += "        Call ?CheckIn()\xFE";
    z += "    end if\xFE";
    z += "   \xFE";
    z += "    databaseName = @ParamVar('databaseName') // Table Name\xFE";
    z += "    tableID = @ParamVar('tableID') // Table Name\xFE";
    z += "    tabID = @ParamVar('tabID')\xFE";
    z += "    pivotLayout = @ParamVar(\"layout\")\xFE";
    z += "    \xFE";
    z += "    // Did we run from TCL? setup something for testing\xFE";
    z += "    If !tableID Then\xFE";
    z += "        S = RTrim(Field(@Sentence, \"(\", 1))\xFE";
    z += "        Cmd = Field(S, \" \", 1)\xFE";
    z += "        If LCase(Cmd) = \"run\" Then tableID = Field(S, \" \", 4) Else tableID = Field(S, \" \", 2)\xFE";
    z += "        'If !tableID Then Stop 'tableID (the Table Name) is a required parameter'\xFE";
    z += "        tableID = \"democustomers.json\"\xFE";
    z += "        databaseName = \"\"\xFE";
    z += "    Else\xFE";
    z += "        if isMissing(databaseName) then Stop \"databaseName is a required parameter\"\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    isSqlSelect = lcase(left(tableID, 7)) = \"select \"\xFE";
    z += "    if isSqlSelect then\xFE";
    z += "        reportName = databaseName:\"_SqlSelect\"\xFE";
    z += "    else\xFE";
    z += "        reportName = databaseName:\"_\":tableID\xFE";
    z += "    end if\xFE";
    z += "        \xFE";
    z += "    Readjson pivotLayout From fHandle('tmp'), reportName Else pivotLayout = {}\xFE";
    z += "    \xFE";
    z += "    Print @devxPivotSetup(tabID, databaseName, pivotLayout.AvailFlds, tableID, reportName, pivotLayout):\xFE";
    z += "    Print @submitBtn(\"btn\", \"Next\", { onclick: \"return saveRowsAndCols();\", style: \"display:block; width: 100%;\" }):\" \":\xFE";
    z += "    Print @submitBtn(\"btn\", \"Refresh\", { onclick: \"return saveRowsAndCols();\", style: \"display:block; width: 100%;\" }):\xFE";
    z += "        \xFE";
    z += "    @Server.Pause\xFE";
    z += "\xFE";
    z += "    Cmd = @formVar('btn')\xFE";
    z += "    Call devxUnloadPivot(pivotLayout)\xFE";
    z += "    \xFE";
    z += "    if Cmd = \"Refresh\" Then pivotLayout.AvailFlds = \"\"\xFE";
    z += "    WriteJson pivotLayout On fHandle('tmp'), reportName Else Stop @Errors\xFE";
    z += "\xFE";
    z += "    If @hasTclParent Or @hasParentProcess Then Stop Else @Server.End\xFE";
    z += "end program"
    window.cached_jsb_mdl["devxpivotsetup"] = z;
    var z = "function Display_excelupload(ByVal viewVars As Json) As String\xFE";
    z += "    Dim aryHTML As Array = [@Html('<div class=\"container\">')], Row As Json = viewVars.Row, ctlHtml As String = \"\"\xFE";
    z += "\xFE";
    z += "    aryHTML[-1] = @Html('<div class=\"form-group row\">')  // start of form-group row\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('DataMustHaveOneNumericRow', True, \"\", Val(Iff(Row[\"DataMustHaveOneNumericRow\"], Row[\"DataMustHaveOneNumericRow\"], 1)), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"Rows have some numeric data\", ctlHtml, \"DataMustHaveOneNumericRow\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('SideBySideTables', True, \"\", Val(Row[\"SideBySideTables\"]), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"Allow Side By Side Tables\", ctlHtml, \"SideBySideTables\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('ignoreTablesWithNoRows', True, \"\", Val(Iff(Row[\"ignoreTablesWithNoRows\"], Row[\"ignoreTablesWithNoRows\"], 1)), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"ignore Tables With No Rows\", ctlHtml, \"ignoreTablesWithNoRows\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.IntegerBox(\"ignoreTablesWithLessThanNColumns\", Row[\"ignoreTablesWithLessThanNColumns\"], False, [`onchange='parsleyReset(this)'`,`placeholder=\"ignore Tables With Less Than N-Columns\"`,`parsley-trigger=\"change focusout\"`,`min=\"0\"`,`max=\"10\"`,`data-parsley-type=\"integer\"`,`type='number;number'`], '0', '10')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"ignore Tables With Less Than N-Columns\", ctlHtml, \"ignoreTablesWithLessThanNColumns\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('OneTablePerSheet', True, \"\", Val(Iff(Row[\"OneTablePerSheet\"], Row[\"OneTablePerSheet\"], 1)), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"OneTablePerSheet\", ctlHtml, \"OneTablePerSheet\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('AllowBlankRows', True, \"\", Val(Iff(Row[\"AllowBlankRows\"], Row[\"AllowBlankRows\"], 1)), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"Allow Blank Rows\", ctlHtml, \"AllowBlankRows\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('DefaultEmptyValuesFromPreviousRow', True, \"\", Val(Row[\"DefaultEmptyValuesFromPreviousRow\"]), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"Default Empty Values From Previous Row\", ctlHtml, \"DefaultEmptyValuesFromPreviousRow\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('deleteAndRecreateTables', True, \"\", Val(Row[\"deleteAndRecreateTables\"]), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"delete And Recreate Sql Table\", ctlHtml, \"deleteAndRecreateTables\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('showTables', True, \"\", Val(Iff(Row[\"showTables\"], Row[\"showTables\"], 1)), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"show Table\", ctlHtml, \"showTables\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    aryHTML[-1] = @Html('</div>') // end of form-group row\xFE";
    z += "    aryHTML[-1] = @Html('<div class=\"form-group row\">')  // start of form-group row\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.TextBox(\"commonDatabaseName\", Row[\"commonDatabaseName\"], False, [`title=\"Leave blank to put each Excel file into it's own database\"`,`placeholder=\"Leave blank to put each Excel file into it's own database\"`], \"\")\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"Put tables into the Database\", ctlHtml, \"commonDatabaseName\", 1, 0, \"\")\xFE";
    z += "\xFE";
    z += "    aryHTML[-1] = @Html('</div>') // end of form-group row\xFE";
    z += "    aryHTML[-1] = @Html('</div>') // end of container\xFE";
    z += "\xFE";
    z += "    aryHTML[-1] = @Script('_isDirty = ':LCase(view_ExcelUpload_isDirty(viewVars))) ;* Some Of The Defaults May Have Made The Page Dirty\xFE";
    z += "\xFE";
    z += "    Return display_ExcelUpload_extras(viewVars, Join(aryHTML, \"\"))\xFE";
    z += "End function\xFE";
    z += "function Display_excelupload(ByVal viewVars As Json) As String\xFE";
    z += "    Dim aryHTML As Array = [@Html('<div class=\"container\">')], Row As Json = viewVars.Row, ctlHtml As String = \"\"\xFE";
    z += "\xFE";
    z += "    aryHTML[-1] = @Html('<div class=\"form-group row\">')  // start of form-group row\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('DataMustHaveOneNumericRow', True, \"\", Val(Iff(Row[\"DataMustHaveOneNumericRow\"], Row[\"DataMustHaveOneNumericRow\"], 1)), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"Rows have some numeric data\", ctlHtml, \"DataMustHaveOneNumericRow\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('SideBySideTables', True, \"\", Val(Row[\"SideBySideTables\"]), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"Allow Side By Side Tables\", ctlHtml, \"SideBySideTables\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('ignoreTablesWithNoRows', True, \"\", Val(Iff(Row[\"ignoreTablesWithNoRows\"], Row[\"ignoreTablesWithNoRows\"], 1)), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"ignore Tables With No Rows\", ctlHtml, \"ignoreTablesWithNoRows\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.IntegerBox(\"ignoreTablesWithLessThanNColumns\", Row[\"ignoreTablesWithLessThanNColumns\"], False, [`onchange='parsleyReset(this)'`,`placeholder=\"ignore Tables With Less Than N-Columns\"`,`parsley-trigger=\"change focusout\"`,`min=\"0\"`,`max=\"10\"`,`data-parsley-type=\"integer\"`,`type='number;number'`], '0', '10')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"ignore Tables With Less Than N-Columns\", ctlHtml, \"ignoreTablesWithLessThanNColumns\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('OneTablePerSheet', True, \"\", Val(Iff(Row[\"OneTablePerSheet\"], Row[\"OneTablePerSheet\"], 1)), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"OneTablePerSheet\", ctlHtml, \"OneTablePerSheet\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('AllowBlankRows', True, \"\", Val(Iff(Row[\"AllowBlankRows\"], Row[\"AllowBlankRows\"], 1)), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"Allow Blank Rows\", ctlHtml, \"AllowBlankRows\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('DefaultEmptyValuesFromPreviousRow', True, \"\", Val(Row[\"DefaultEmptyValuesFromPreviousRow\"]), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"Default Empty Values From Previous Row\", ctlHtml, \"DefaultEmptyValuesFromPreviousRow\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('deleteAndRecreateTables', True, \"\", Val(Row[\"deleteAndRecreateTables\"]), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"delete And Recreate Sql Table\", ctlHtml, \"deleteAndRecreateTables\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.CheckBox('showTables', True, \"\", Val(Iff(Row[\"showTables\"], Row[\"showTables\"], 1)), '')\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"show Table\", ctlHtml, \"showTables\", 0, 0, \"\")\xFE";
    z += "\xFE";
    z += "    aryHTML[-1] = @Html('</div>') // end of form-group row\xFE";
    z += "    aryHTML[-1] = @Html('<div class=\"form-group row\">')  // start of form-group row\xFE";
    z += "\xFE";
    z += "    ctlHtml = @Jsb_html.TextBox(\"commonDatabaseName\", Row[\"commonDatabaseName\"], False, [`title=\"Leave blank to put each Excel file into it's own database\"`,`placeholder=\"Leave blank to put each Excel file into it's own database\"`], \"\")\xFE";
    z += "    aryHTML[-1] = @lblCtlSet(\"Put tables into the Database\", ctlHtml, \"commonDatabaseName\", 1, 0, \"\")\xFE";
    z += "\xFE";
    z += "    aryHTML[-1] = @Html('</div>') // end of form-group row\xFE";
    z += "    aryHTML[-1] = @Html('</div>') // end of container\xFE";
    z += "\xFE";
    z += "    aryHTML[-1] = @Script('_isDirty = ':LCase(view_ExcelUpload_isDirty(viewVars))) ;* Some Of The Defaults May Have Made The Page Dirty\xFE";
    z += "\xFE";
    z += "    Return display_ExcelUpload_extras(viewVars, Join(aryHTML, \"\"))\xFE";
    z += "End function"
    window.cached_jsb_mdl["display_excelupload"] = z;
    var z = "function display_ExcelUpload_extras(ByVal viewVars As Json, ByVal Html As String) As String\xFE";
    z += "    Dim ToolBar As String = \"\"\xFE";
    z += "\xFE";
    z += "    ToolBar := @SaveBtn('formBtn_Save', \"Save\", \"Process Excel File\")\xFE";
    z += "    ToolBar := @SaveBtn('formBtn_Save', \"Cancel\", \"Cancel\")\xFE";
    z += "\xFE";
    z += "    ToolBar = @Html(\"<div class='BOBlock_ToolBar'>\"):ToolBar:@Html(\"</div>\")\xFE";
    z += "    Html = @Html('<div class=\"BOBlock FullHeight ExcelUpload\">':Crlf()):@Rows2(\"%\", Html, \"66px\", ToolBar, \"overflow-y:auto\", \"overflow:hidden\"):@Html(\"</div>\":Crlf())\xFE";
    z += "\xFE";
    z += "    Return Html\xFE";
    z += "end function\xFE";
    z += "function display_ExcelUpload_extras(ByVal viewVars As Json, ByVal Html As String) As String\xFE";
    z += "    Dim ToolBar As String = \"\", AdditionalAttributes As Json, btnHtml As String\xFE";
    z += "    Dim Confirm As String, UrlParams As String, jsCode As String, jsCall As String, contextMenus As String\xFE";
    z += "\xFE";
    z += "    If !viewVars.currentID Then ;* New Record\xFE";
    z += "        * Setup server-side button: Save\xFE";
    z += "        AdditionalAttributes = { style: \"\", name: \"formBtn_ExcelUpload\" }\xFE";
    z += "        btnHtml = @SaveBtn('formBtn_Save', \"Save\", \"Save\", AdditionalAttributes)\xFE";
    z += "        contextMenus := @Jsb_bf.adminButtonContextMenu(\"ExcelUpload\", \"formBtn_Save\")\xFE";
    z += "        ToolBar := btnHtml\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    If viewVars.currentID Then ;* Existing Record\xFE";
    z += "        * Setup server-side button: Update\xFE";
    z += "        AdditionalAttributes = { style: \"\", name: \"formBtn_ExcelUpload\" }\xFE";
    z += "        btnHtml = @SaveBtn('formBtn_Update', \"Update\", \"Update\", AdditionalAttributes)\xFE";
    z += "        contextMenus := @Jsb_bf.adminButtonContextMenu(\"ExcelUpload\", \"formBtn_Update\")\xFE";
    z += "        ToolBar := btnHtml\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Confirm = 'if (window._isDirty && !confirm(\"Your changes will be lost. Are you sure you want to Cancel this record?\")) return false; '\xFE";
    z += "    * Setup client-side button: Cancel\xFE";
    z += "    UrlParams = \"\"\xFE";
    z += "\xFE";
    z += "    jsCode = @genEventHandler(\"Cancel\", \"ExcelUpload\":UrlParams, 10 /* Current WIndow */, \"\", 0 /* add fromPage */, False /* passthruParams */)\xFE";
    z += "    jsCall = 'window.eventHandler_Cancel(jsbFormVars(), \"ItemID\" /* primary Key */);'\xFE";
    z += "    jsCall = '$(\"form\").parsley().destroy(); ':jsCall\xFE";
    z += "    btnHtml = @Button('formBtn_Cancel', \"Cancel\", { onclick: jsCall, style: \"\" } ):jsCode\xFE";
    z += "    contextMenus := @Jsb_bf.adminButtonContextMenu(\"ExcelUpload\", \"formBtn_Cancel\")\xFE";
    z += "    ToolBar := btnHtml\xFE";
    z += "\xFE";
    z += "    ToolBar := viewVars.extraToolBarHtml\xFE";
    z += "\xFE";
    z += "    Dim Header As String = @Html(\"<div id='header_ExcelUpload' class='HeaderStyle'>\"):\"ExcelUpload\":@Html(\"</div>\")\xFE";
    z += "    Html = @Rows2(\"46px\", Header, \"%\", Html, \"overflow: hidden\", \"overflow: auto\")\xFE";
    z += "\xFE";
    z += "    If @IsManager Then\xFE";
    z += "        contextMenus := @adminControlContextMenu(\"ExcelUpload\", \"DataMustHaveOneNumericRow\", \"ctl_checkbox\", 0, -1, 0, 0, 0 )\xFE";
    z += "        contextMenus := @adminControlContextMenu(\"ExcelUpload\", \"SideBySideTables\", \"ctl_checkbox\", 0, -1, 0, 0, 0 )\xFE";
    z += "        contextMenus := @adminControlContextMenu(\"ExcelUpload\", \"ignoreTablesWithNoRows\", \"ctl_checkbox\", 0, -1, 0, 0, 0 )\xFE";
    z += "        contextMenus := @adminControlContextMenu(\"ExcelUpload\", \"ignoreTablesWithLessThanNColumns\", \"textbox\", 0, -1, 0, 0, 0 )\xFE";
    z += "        contextMenus := @adminControlContextMenu(\"ExcelUpload\", \"OneTablePerSheet\", \"ctl_checkbox\", 0, -1, 0, 0, 0 )\xFE";
    z += "        contextMenus := @adminControlContextMenu(\"ExcelUpload\", \"AllowBlankRows\", \"ctl_checkbox\", 0, -1, 0, 0, 0 )\xFE";
    z += "        contextMenus := @adminControlContextMenu(\"ExcelUpload\", \"DefaultEmptyValuesFromPreviousRow\", \"ctl_checkbox\", 0, -1, 0, 0, 0 )\xFE";
    z += "        contextMenus := @adminControlContextMenu(\"ExcelUpload\", \"deleteAndRecreateTables\", \"ctl_checkbox\", 0, -1, 0, 0, 0 )\xFE";
    z += "        contextMenus := @adminControlContextMenu(\"ExcelUpload\", \"showTables\", \"ctl_checkbox\", 0, -1, 0, 0, 0 )\xFE";
    z += "        contextMenus := @adminControlContextMenu(\"ExcelUpload\", \"commonDatabaseName\", \"textbox\", 0, -1, 0, 1, 0 )\xFE";
    z += "        contextMenus := @adminViewContextMenu(\"ExcelUpload\", viewVars.showAddRmvViews + 0)\xFE";
    z += "        Html := @Hidden('contextMenuText'):@Hidden('contextMenuID')\xFE";
    z += "    End If\xFE";
    z += "    Html := @Script(contextMenus)\xFE";
    z += "\xFE";
    z += "    Call ?view_ExcelUpload_Display_cc(viewVars, Html, ToolBar)\xFE";
    z += "\xFE";
    z += "    If ToolBar Then\xFE";
    z += "        ToolBar = @Html(\"<div class='BOBlock_ToolBar'>\"):ToolBar:@Html(\"</div>\")\xFE";
    z += "        If viewVars.parentMultiView Then\xFE";
    z += "            Html = @Html('<div class=\"BOBlock ExcelUpload\">':Crlf()):Html:ToolBar:@Html(\"</div>\":Crlf())\xFE";
    z += "        Else\xFE";
    z += "            Html = @Html('<div class=\"BOBlock FullHeight ExcelUpload\">':Crlf()):@Rows2(\"%\", Html, \"66px\", ToolBar, \"overflow-y:auto\", \"overflow:hidden\"):@Html(\"</div>\":Crlf())\xFE";
    z += "        End If\xFE";
    z += "    Else\xFE";
    z += "        Html = @Html('<div class=\"BOBlock ExcelUpload\">':Crlf()):Html:@Html(\"</div>\":Crlf())\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    * Output Refresh if needed\xFE";
    z += "    If viewVars.masterview Then\xFE";
    z += "        * Output Code that will enable us to refresh() if needed by our childer\xFE";
    z += "        Html := @Script(\"function refreshData() { if (window.ExcelUpload_refresh) window.ExcelUpload_refresh() }\")\xFE";
    z += "\xFE";
    z += "    ElseIf viewVars.ParentRefresh Then\xFE";
    z += "        viewVars.ParentRefresh = False\xFE";
    z += "        Html := @Script(\"if (parent.refreshData) parent.refreshData();\")\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Return Html\xFE";
    z += "End function"
    window.cached_jsb_mdl["display_excelupload_extras"] = z;
    var z = "* toType is \"Reset Form\",\"Search Form\",\"ReadOnly Form\", or \"Menu Form\"\xFE";
    z += "Sub doWizard(ViewName, dataSet, toType)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    dictColumns = @getTableColumnDefs(dataSet.tableName, False, True) ;* Suppress Messages, doRefresh\xFE";
    z += "    modelForAllColumns = @modelForAllColumns\xFE";
    z += "\xFE";
    z += "    For Each Column In dataSet.columns\xFE";
    z += "        If Column.control <> \"htmlbox\" Then\xFE";
    z += "            Select Case toType\xFE";
    z += "                Case \"Reset Form\"\xFE";
    z += "                    @setDefaults(ViewName, modelForAllColumns.columns, Column) ;* Defaults From Model\xFE";
    z += "                    Call setColumnDefaults(\"string\", Column)\xFE";
    z += "                    For Each dictColumn In dictColumns\xFE";
    z += "                        If dictColumn.name = Column.name And dictColumn.datatype <> \"string\" Then\xFE";
    z += "                            Call setColumnDefaults(dictColumn.datatype, Column) ;* Sets Control, Display, Width, Canedit, Suppresslabel, Fullline\xFE";
    z += "                        End If\xFE";
    z += "                    Next\xFE";
    z += "                    \xFE";
    z += "                Case \"Search Form\"\xFE";
    z += "                    Column.control = \"textbox\"\xFE";
    z += "                    Column.fullline = False\xFE";
    z += "                    Column.width = 12\xFE";
    z += "                    Column.canedit = True\xFE";
    z += "                    Column.ctlstyle = \"\"\xFE";
    z += "                    Column.display = \"visible\"\xFE";
    z += "                    \xFE";
    z += "                    Select Case Column.datatype\xFE";
    z += "                        Case \"integer\", \"autointeger\"\xFE";
    z += "                            Column.control = \"textbox\"\xFE";
    z += "                            \xFE";
    z += "                        Case \"double\":\xFE";
    z += "                            Column.control = \"textbox\"\xFE";
    z += "                            \xFE";
    z += "                        Case \"boolean\":\xFE";
    z += "                            Column.control = \"dropdownbox\"\xFE";
    z += "                            \xFE";
    z += "                        Case \"date\":\xFE";
    z += "                            Column.control = \"datebox\"\xFE";
    z += "                            \xFE";
    z += "                        Case \"time\":\xFE";
    z += "                            Column.control = \"timebox\"\xFE";
    z += "                            \xFE";
    z += "                        Case \"datetime\":\xFE";
    z += "                            Column.control = \"datetimebox\"\xFE";
    z += "                            \xFE";
    z += "                        Case \"currency\":\xFE";
    z += "                            Column.control = \"textbox\"\xFE";
    z += "                            \xFE";
    z += "                        Case \"blob\", \"jpg\", \"png\":\xFE";
    z += "                            Column.control = \"display\"\xFE";
    z += "                            \xFE";
    z += "                        Case \"url\":\xFE";
    z += "                            Column.control = \"urlbox\"\xFE";
    z += "                            \xFE";
    z += "                    End Select\xFE";
    z += "                    \xFE";
    z += "                Case \"ReadOnly Form\"\xFE";
    z += "                    Lc = LCase(Column.control)\xFE";
    z += "                    If Lc <> \"checkbox\" And Instr(Lc, \"box\") Then Column.control = \"label\"\xFE";
    z += "                    Column.canedit = False\xFE";
    z += "                    Column.ctlstyle = \"\"\xFE";
    z += "                    \xFE";
    z += "                Case \"Menu Form\"\xFE";
    z += "                    Column.control = \"button\"\xFE";
    z += "                    Column.suppresslabel = True\xFE";
    z += "                    Column.ctlstyle = \"width: 99%; height: 50px; display: block; margin: auto; max-width: 300px;\"\xFE";
    z += "                    Column.fullline = True\xFE";
    z += "                    Column.canedit = False\xFE";
    z += "                    Column.addfrompage = False\xFE";
    z += "            End Select\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    Select Case toType\xFE";
    z += "        Case \"Search Form\"\xFE";
    z += "            dataSet.startempty = True\xFE";
    z += "            dataSet.updatebtn = False\xFE";
    z += "            dataSet.allowupdates = False\xFE";
    z += "            dataSet.deletebtn = False\xFE";
    z += "            dataSet.allowdeletes = False\xFE";
    z += "            dataSet.searchbtn = True\xFE";
    z += "            dataSet.template = \"Form\"\xFE";
    z += "\xFE";
    z += "        Case \"DisplayOnly Form\"\xFE";
    z += "            dataSet.startempty = False\xFE";
    z += "            dataSet.updatebtn = False\xFE";
    z += "            dataSet.allowupdates = False\xFE";
    z += "            dataSet.deletebtn = False\xFE";
    z += "            dataSet.allowdeletes = False\xFE";
    z += "            dataSet.template = \"Form\"\xFE";
    z += "\xFE";
    z += "        Case \"Menu Form\"\xFE";
    z += "            dataSet.startempty = True\xFE";
    z += "            dataSet.updatebtn = False\xFE";
    z += "            dataSet.allowupdates = False\xFE";
    z += "            dataSet.deletebtn = False\xFE";
    z += "            dataSet.allowdeletes = False\xFE";
    z += "            dataSet.template = \"Form\"\xFE";
    z += "    End Select\xFE";
    z += "End Sub"
    window.cached_jsb_mdl["dowizard"] = z;
    window.cached_jsb_mdl["dropgridcolumns"] = "Function DropGridColumns(Columns)\xFE    RColumns = []\xFE    COrder = []\xFE    For Each Column In Columns\xFE        If Column.name Then\xFE            If Column.display = \"gridhidden\" Then Column.display = \"visible\"\xFE            If IsNumeric(Column.width) And Len(Column.width) Then Column.width = Column.width:\"em\"\xFE            If Column.display <> \"hidden\" Then RColumns[-1] = Column\xFE        End If\xFE    Next\xFE\xFE    Return RColumns\xFEEnd Function";
    var z = "// for tableColumns() and viewColumns see bf gettablecolumndefs   ( https://jsbwinforms.azurewebsites.net/sysprog/?ed bf gettablecolumndefs )\xFE";
    z += "\xFE";
    z += "Program Edc\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    If !isManager() Then Stop \"You must be at least a data manager to run this command\"\xFE";
    z += "   \xFE";
    z += "    ProjectName = @ParamVar('ProjectName')\xFE";
    z += "    ViewName = @ParamVar('ViewName')\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "    inIFrame = @ParamVar(\"inIFrame\")\xFE";
    z += "    ColumnID = @ParamVar('id')\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "    closeWindow = @ParamVar('closeWindow')\xFE";
    z += "    PageName = @ParamVar('PageName')\xFE";
    z += "   \xFE";
    z += "    If ProjectName = \"\" And Len(@ParamVars) <= 1 Then\xFE";
    z += "        Sentence = Field(@Sentence, \"(!\", 1)\xFE";
    z += "        ProjectName = Field(Sentence, \" \", 2)\xFE";
    z += "        ViewName = Field(Sentence, \" \", 3)\xFE";
    z += "        ColumnID = Field(Sentence, \" \", 4)\xFE";
    z += "    End If\xFE";
    z += "   \xFE";
    z += "    If ViewName Then ViewName = @DropIfRight(ViewName, \".view\", True):\".view\"\xFE";
    z += "    If ProjectName = \"\" Or ViewName = \"\" Then Stop \"edc ProjectName ViewName ColumnName\"\xFE";
    z += "   \xFE";
    z += "    Open \"\", ProjectName Else Stop @(-1):\"File/Project \":ProjectName:\" not found\"\xFE";
    z += "\xFE";
    z += "    If ColumnID Then\xFE";
    z += "        Call editViewColumn(ProjectName, PageName, ViewName, ColumnID, inIFrame)\xFE";
    z += "    Else\xFE";
    z += "        Call editViewModelColumns(ProjectName, PageName, ViewName, False)\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    If fromPage Then @Response.Redirect(fromPage)\xFE";
    z += "    If inIFrame Then Stop\xFE";
    z += "    \xFE";
    z += "    If closeWindow Or !@hasParentProcess Then @Server.End\xFE";
    z += "End Program"
    window.cached_jsb_mdl["edc"] = z;
    var z = "Program editPageModel\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    pageName = @ParamVar('pagename')\xFE";
    z += "    ProjectName = @ParamVar('projectname')\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "\xFE";
    z += "    Call editPageModel(ProjectName, pageName, True, False)\xFE";
    z += "    If fromPage Then @Response.Redirect(fromPage)\xFE";
    z += "    if @hasTclParent then Stop \xFE";
    z += "    @Server.End\xFE";
    z += "End Program\xFE";
    z += "\xFE";
    z += "Subroutine editPageModel(ProjectName, pageName, optional byval showBackBtn, optional byval quickRtn)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    pageName = @DropIfRight(pageName, \".page\", True)\xFE";
    z += "    OriginalDB = @Account\xFE";
    z += "    \xFE";
    z += "    If pageName = \"\" Then\xFE";
    z += "        if !newPage(ProjectName, \"\", pageName, [], [], [], pageType, \"\") Then Return\xFE";
    z += "        IsNew = True\xFE";
    z += "    Else\xFE";
    z += "        ReadJson pageDataSet From @fHandle(\"dict\", ProjectName), pageName:\".page\" Then\xFE";
    z += "            IsNew = False\xFE";
    z += "        Else\xFE";
    z += "            Ans = @MsgBox(\"Warning\", \"The web page \":pageName:\" does not exist, do you want to create it?\", \"*Yes,No\")\xFE";
    z += "            If Ans <> \"Yes\" Then pageName = \"\"; Return\xFE";
    z += "            if !newPage(ProjectName, \"\", pageName, [], [], [], pageType, \"\") Then Return\xFE";
    z += "            if quickRtn then return\xFE";
    z += "            IsNew = True\xFE";
    z += "        end if\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    ReadJson pageDataSet From @fHandle(\"dict\", ProjectName), pageName:\".page\" Else pageName = \"\"; Return\xFE";
    z += "    viewName = pageName:\".view\"\xFE";
    z += "    \xFE";
    z += "    Loop\xFE";
    z += "        * Redisplay the record\xFE";
    z += "        objectModel = @modelForPage(projectName)\xFE";
    z += "        Call getExtraPageColumns(objectModel.columns, pageDataSet.templateName)\xFE";
    z += "\xFE";
    z += "        Html = @jsb_mdl.formViewNColumns(ProjectName, ObjectModel, False, pageDataSet, viewName)\xFE";
    z += "\xFE";
    z += "        If showBackBtn Then\xFE";
    z += "            ToolBar = @SubmitBtn('formBtn', \"B\", 'Back')\xFE";
    z += "            ToolBar = ToolBar: @SubmitBtn('formBtn', \"S\", 'Save'):@SubmitBtn('formBtn', \"CC\", 'Cancel'):@SubmitBtn('formBtn', \"D\", 'Delete')\xFE";
    z += "        Else\xFE";
    z += "            ToolBar = @SubmitBtn('formBtn', \"Q\", 'Quit')\xFE";
    z += "            ToolBar = ToolBar: @SaveBtn('formBtn', \"S\", 'Save'):@SubmitBtn('formBtn', \"D\", 'Delete'):@SaveBtn('formBtn', \"G\", 'Generate')\xFE";
    z += "        End If\xFE";
    z += "        ToolBar = ToolBar: @SaveBtn('formBtn', \"C\", 'Clone')\xFE";
    z += "\xFE";
    z += "        Print @ClearScreen:@Rows2(\"%\", Html, \"66px\", ToolBar):\xFE";
    z += "\xFE";
    z += "        If ParentRefresh Then\xFE";
    z += "            Print @Script(\"if (parent.refreshData) parent.refreshData();\"):\xFE";
    z += "            ParentRefresh = 0\xFE";
    z += "        End If\xFE";
    z += "\xFE";
    z += "        **** Pause ****\xFE";
    z += "        @Server.pause\xFE";
    z += "        @standardUnload(objectModel.columns, pageDataSet, true)\xFE";
    z += "        Cmd = @Formvar(\"formBtn\") ;* Only Exists If This Is A Post Back\xFE";
    z += "\xFE";
    z += "        * In case we MsgBox\xFE";
    z += "        * Html = @jsb_mdl.putRowDataIntoHtml(ProjectName, objectModel, pageDataSet, htmlBackDrop)\xFE";
    z += "        * Html = @jsb_mdl.formViewNColumns(ProjectName, ObjectModel, False, pageDataSet)\xFE";
    z += "        * Print @ClearScreen:@Rows2(\"%\", Html, \"66px\", ToolBar):\xFE";
    z += "\xFE";
    z += "        Select Case Cmd\xFE";
    z += "            Case \"Q\", \"B\"\xFE";
    z += "                AttachDB OriginalDB Else Null\xFE";
    z += "                pageName = Chr(27)\xFE";
    z += "                Return\xFE";
    z += "                \xFE";
    z += "            Case \"CC\"\xFE";
    z += "                // Cancel = delete what work we have done so far\xFE";
    z += "                If IsNew Then\xFE";
    z += "                    Delete @fHandle(\"DICT\", ProjectName), pageName Else If @Errors Then Alert(@Errors)\xFE";
    z += "                    Delete @fHandle(\"DICT\", ProjectName), pageName:\".view\" Else If @Errors Then Alert(@Errors)\xFE";
    z += "                    Delete @fHandle(\"DICT\", ProjectName), pageName:\"_west.view\" Else If @Errors Then Alert(@Errors)\xFE";
    z += "                    Delete @fHandle(\"dict\", ProjectName), pageName:\".page\" Else If @Errors Then Alert(@Errors)\xFE";
    z += "                End If\xFE";
    z += "                AttachDB OriginalDB Else Null\xFE";
    z += "                Return\xFE";
    z += "                \xFE";
    z += "            Case \"C\"\xFE";
    z += "                clonePageName = clonePageModel(ProjectName, pageName) \xFE";
    z += "                if clonePageName then ResponseRedirect(@jsbRootExecute(clonePageName))\xFE";
    z += "                \xFE";
    z += "            Case \"D\"\xFE";
    z += "                If @deletePageModel(ProjectName, pageName) Then \xFE";
    z += "                    pageName = Chr(27)\xFE";
    z += "                    Stop @ClearScreen\xFE";
    z += "                End If\xFE";
    z += "\xFE";
    z += "            Case \"S\", \"G\"\xFE";
    z += "                Print @ClearScreen:\xFE";
    z += "                WriteJSon pageDataSet On @fHandle(\"dict\", ProjectName), pageName:\".page\" Else Stop @(-1):\"Edp-\":System(28):\": \":@Errors\xFE";
    z += "                Call ReGenPageModel(ProjectName, pageName, True)\xFE";
    z += "                If Cmd = \"S\" Then\xFE";
    z += "                    If showBackBtn Then\xFE";
    z += "                        AttachDB OriginalDB Else Null\xFE";
    z += "                        Return\xFE";
    z += "                    End If\xFE";
    z += "                    \xFE";
    z += "                    @Response.Redirect(jsbRootExecute(pageName))\xFE";
    z += "                End If\xFE";
    z += "\xFE";
    z += "            Case \"R\";\xFE";
    z += "                oldPageName = @DropIfRight(pageName, \".page\", True)\xFE";
    z += "                \xFE";
    z += "                newPageName = Trim(@InputBox(\"Rename\", \"Enter a new name\", \"\", \"80%\", \"\"))\xFE";
    z += "                newPageName = @DropIfRight(newPageName, \".page\", True)\xFE";
    z += "                If newPageName <> Chr(27) And newPageName <> \"\" Then\xFE";
    z += "                    If clonePageModel(ProjectName, oldPageName, newPageName) Then\xFE";
    z += "                        @deletePageModel(ProjectName, oldPageName)\xFE";
    z += "                        pageName = newPageName\xFE";
    z += "                    End If\xFE";
    z += "                End If\xFE";
    z += "                \xFE";
    z += "                ParentRefresh = 1\xFE";
    z += "        End Select\xFE";
    z += "\xFE";
    z += "    While 1 Do Repeat\xFE";
    z += "End Function\xFE";
    z += ""
    window.cached_jsb_mdl["editpagemodel"] = z;
    window.cached_jsb_mdl["editreporturl"] = "function editReportUrl(tabID, reportID, databaseName)\xFE    * %options aspxC-\xFE    \xFE    Url = @jsbRootAccount():`?edp dbBuilderReports`\xFE    If reportID Then Url := ` `:reportID\xFE    Url := ` (`:`&tabID=`:@urlEncode(tabID):`&databaseName=`:@urlEncode(databaseName)\xFE    Return Url\xFEEnd function";
    var z = "subroutine editTable(tableName, showTableList)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    if !tableName or showTableList Then\xFE";
    z += "        tableName = pickAtable(tableName, \"\")\xFE";
    z += "        If !tableName Then Return\xFE";
    z += "    end if\xFE";
    z += "\xFE";
    z += "    fDict = fHandle('dict', tableName)\xFE";
    z += "\xFE";
    z += "    MetaData = @JSB_BF.tableColumns()\xFE";
    z += "    MetaData[1].display = ''\xFE";
    z += "    MetaData[1].canedit = true\xFE";
    z += "    MetaData[-1] = { name: \"original_name\", label: \"Original Name\", defaultvalue:\"\",  align:'left', datatype: 'string', display: 'hidden' }  \xFE";
    z += "    for each row in MetaData\xFE";
    z += "       row.width = \"100%\"\xFE";
    z += "    next\xFE";
    z += "    \xFE";
    z += "    Options = { HeadForeColor: 'blue', HeadBackColor: 'yellow', allowUpdates: true, allowDeletes: true, allowInserts: True, width100percent: true }  \xFE";
    z += "    \xFE";
    z += "startOver:\xFE";
    z += "    myData = @jsb_bf.getTableColumnDefs(tableName, false, true)\xFE";
    z += "\xFE";
    z += "    for each row in myData\xFE";
    z += "       row.original_name = row.name\xFE";
    z += "       row.required = !!row.required\xFE";
    z += "       row.sortable = !!row.sortable\xFE";
    z += "       row.notblank = !!row.notblank\xFE";
    z += "       row.primarykey = !!row.primarykey\xFE";
    z += "       row.encrypt = !!row.encrypt\xFE";
    z += "       if row.align = \"\" then row.align = \"left\"\xFE";
    z += "    next\xFE";
    z += "    \xFE";
    z += "    header = @Center(\"Editing Meta Data for table \":@Bold(tableName))\xFE";
    z += "    Header := crlf()\xFE";
    z += "    Header := @Center(@submitbtn('btn', 'Save'):\" \":@submitbtn('btn', 'Cancel'))\xFE";
    z += "    \xFE";
    z += "top:\xFE";
    z += "    jqGrid = @jqGrid(\"myGrid\", mydata, MetaData, Options) \xFE";
    z += "    \xFE";
    z += "    Print @(-1):@rows2(\"6em\", header, \"%\", jqGrid, \"overflow: hidden\", \"overflow: hidden\"):\xFE";
    z += "    \xFE";
    z += "    @Server.Pause\xFE";
    z += "    \xFE";
    z += "    if @FormVar('btn') = 'Cancel' Then Return\xFE";
    z += "    \xFE";
    z += "    newData = JSon(@formvar(\"myGrid\"))\xFE";
    z += "    Ops = JSon(@formvar(\"myGrid_ops\"))\xFE";
    z += "    pkName = \"name\"\xFE";
    z += "    \xFE";
    z += "    For Each Cmd in Ops\xFE";
    z += "        Row = Cmd.updatedrow\xFE";
    z += "        OriginalRow = Cmd.originalrow\xFE";
    z += "        if !OriginalRow Then OriginalRow = {}\xFE";
    z += "        \xFE";
    z += "        If Cmd.op = \"delete\" Then\xFE";
    z += "            If Left(Cmd.id, 1) <> \"-\" Then \xFE";
    z += "                delete fDict, \"!\":Cmd.row[pkName] else MsgBox(@Errors)\xFE";
    z += "            End If\xFE";
    z += "            \xFE";
    z += "        Else ;* Update or New\xFE";
    z += "            originalPKID = OriginalRow[PKName]\xFE";
    z += "            PKID = Row[PKName]\xFE";
    z += "            \xFE";
    z += "            for each pname in [\"required\", \"sortable\", \"notblank\", \"primarykey\", \"notblank\", \"encrypt\"]\xFE";
    z += "                nVal = CStr(Row[pName])\xFE";
    z += "                if nVal = \"false\" or nVal = \"0\" or nVal = \"\" then row[pName] = 0 Else row[pName] = 1\xFE";
    z += "                \xFE";
    z += "                nVal = CStr(OriginalRow[pName])\xFE";
    z += "                if nVal = \"false\" or nVal = \"0\" or nVal = \"\" then OriginalRow[pName] = 0 Else OriginalRow[pName] = 1\xFE";
    z += "            next\xFE";
    z += "            \xFE";
    z += "            \xFE";
    z += "            If Cmd.op = \"new\" Then\xFE";
    z += "                 write Row On fDict, PKID Else MsgBox(@Errors)\xFE";
    z += "              \xFE";
    z += "            Else If Cmd.op = \"update\" Then\xFE";
    z += "                If Left(Cmd.id, 1) = \"-\" Then ;* New Row\xFE";
    z += "                     write Row On fDict, PKID Else MsgBox(@Errors)\xFE";
    z += "                Else\xFE";
    z += "                    If originalPKID <> PKID And originalPKID <> \"\" Then ;*  Primary key change?\xFE";
    z += "                          delete fDict, \"!\":originalPKID else MsgBox(@Errors)\xFE";
    z += "                    End If\xFE";
    z += "\xFE";
    z += "                    write Row On fDict, PKID Else MsgBox(@Errors)\xFE";
    z += "                End If\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "end subroutine"
    window.cached_jsb_mdl["edittable"] = z;
    var z = "function editViewBtn(ProjectName, pageName, ViewName, btnText)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    ReadJSon ObjectModel From @fHandle(\"DICT\", ProjectName), ViewName Else Debug @Alert('Unable to find view ':ViewName); Return False\xFE";
    z += "    BtnI = @findBtnI(ObjectModel, btnText)\xFE";
    z += "    If !BtnI Then Return False\xFE";
    z += "    jsBTN = ObjectModel.custombtns[BtnI]\xFE";
    z += "    \xFE";
    z += "    Array =  []\xFE";
    z += "    Array[-1] = Clone(jsBTN)\xFE";
    z += "    \xFE";
    z += "    Ans = @Popup_jsondef(ProjectName, \"jsb_jsondefs\", \"customBtns\", \"\", \"\", Array, \"80%\", \"80%\", \"Buttons for view \":ViewName)\xFE";
    z += "    If !Ans Then Return False\xFE";
    z += "\xFE";
    z += "    If UBound(Ans) <> 1 Then Return False\xFE";
    z += "\xFE";
    z += "    ObjectModel.custombtns[BtnI] = Ans[1]\xFE";
    z += "    WriteJSon ObjectModel On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "    Call @Jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFE";
    z += "    Return True\xFE";
    z += "End function"
    window.cached_jsb_mdl["editviewbtn"] = z;
    var z = "*\xFE";
    z += "* Let's edit both the view and the table\xFE";
    z += "*\xFE";
    z += "Subroutine editViewColumn(ProjectName, PageName, ViewName, ColumnID, inIFrame)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    ReadJSon viewDataSet From @fHandle(\"DICT\", ProjectName), ViewName Else viewDataSet = @createNewView(ViewName)\xFE";
    z += "    TableName = viewDataSet.tableName\xFE";
    z += "\xFE";
    z += "    IsGrid = viewDataSet.templateName = \"Grid\"\xFE";
    z += "    canModify = viewDataSet.allowupdates Or viewDataSet.allowinserts\xFE";
    z += "    if !canModify Then \xFE";
    z += "        changed = false\xFE";
    z += "        for each viewRow In viewDataSet.columns\xFE";
    z += "            if viewRow.control = \"textbox\" then viewRow.control = \"label\"; changed = true\xFE";
    z += "        next\xFE";
    z += "        if changed then WriteJSon viewDataSet On @fHandle(\"DICT\", ProjectName), ViewName\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "   * Find the column\xFE";
    z += "    ColumnIdx = @findViewColumn(viewDataSet, ColumnID)\xFE";
    z += "    If ColumnIdx = 0 Then\xFE";
    z += "        Print \"editViewColumn: view: \":viewName:\" does not have a column named \":ColumnID\xFE";
    z += "        Debug ;* Ok\xFE";
    z += "        Return\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Call mdlSessionSetup(ProjectName, PageName, ViewName, viewDataSet)\xFE";
    z += "\xFE";
    z += "  * Extend it\xFE";
    z += "    Loop\xFE";
    z += "        Print @ClearScreen:\xFE";
    z += "        viewRow = viewDataSet.columns[ColumnIdx]\xFE";
    z += "\xFE";
    z += "      * Re-Read since we are changing it\xFE";
    z += "        viewModel = @modelForAllColumns()\xFE";
    z += "\xFE";
    z += "      * Extend Model for this type of control\xFE";
    z += "      callName = lcase(viewRow.control)\xFE";
    z += "      if left(callName, 4) = \"ctl_\" then callName = Mid(callName, 5)\xFE";
    z += "      \xFE";
    z += "      SubName = \"jsb_ctls|\":callName:\"_ExtraMeta\"\xFE";
    z += "      Call @?SubName(ByRef viewRow, viewModel)\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "      * fill defaults for any missing meta-data columns\xFE";
    z += "        @setDefaults(Viewname, viewModel.columns, viewRow)\xFE";
    z += "\xFE";
    z += "      * Display the record\xFE";
    z += "        Html = @formViewNColumns(ProjectName, viewModel, False, viewRow, viewName)\xFE";
    z += "      * Html = @jsb_mdl.putRowDataIntoHtml(ProjectName, viewModel, viewRow, viewBackDrop)\xFE";
    z += "\xFE";
    z += "        ToolBar = @SubmitBtn('edc_formBtn', \"SV\", 'Save')\xFE";
    z += "        If TableName Then ToolBar = ToolBar:@SubmitBtn('edc_formBtn', \"LD\", 'Load defaults')\xFE";
    z += "      \xFE";
    z += "        ToolBar = ToolBar:@SubmitBtn('edc_formBtn', \"D\", 'Delete from View')\xFE";
    z += "\xFE";
    z += "        If inIFrame Then\xFE";
    z += "            ToolBar = ToolBar: @SubmitBtn('edc_formBtn', \"B\", 'Close')\xFE";
    z += "        Else\xFE";
    z += "            If @hasTclParent Then\xFE";
    z += "                ToolBar = ToolBar:@SubmitBtn('edc_formBtn', 'Q', 'Quit')\xFE";
    z += "            ElseIf @hasParentProcess Then\xFE";
    z += "                ToolBar = ToolBar:@SubmitBtn('edc_formBtn', 'B', 'Back')\xFE";
    z += "            Else\xFE";
    z += "                ToolBar = ToolBar:@SubmitBtn('edc_formBtn', 'X', 'Exit') ;* From User Screen\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "\xFE";
    z += "        Html = @Rows2(\"%\", Html, \"33px\", ToolBar)\xFE";
    z += "        Print @ClearScreen:Html:\xFE";
    z += "\xFE";
    z += "        If ParentRefresh Then\xFE";
    z += "            Print @Script(\"if (parent.refreshData) parent.refreshData();\"):\xFE";
    z += "            ParentRefresh = 0\xFE";
    z += "        End If\xFE";
    z += "\xFE";
    z += "        @Server.pause\xFE";
    z += "\xFE";
    z += "        @standardUnload(viewModel.columns, viewRow)\xFE";
    z += "        Btn = @Formvar(\"edc_formBtn\") ;* Only Exists If This Is A Post Back\xFE";
    z += "      \xFE";
    z += "      * In case we msgbox\xFE";
    z += "      * Html = @jsb_mdl.putRowDataIntoHtml(ProjectName, viewModel, viewRow, viewBackDrop)\xFE";
    z += "      * Html = @formViewNColumns(ProjectName, viewModel, False, viewRow)\xFE";
    z += "      * print @ClearScreen:Html:\xFE";
    z += "\xFE";
    z += "      * What button did the user click?\xFE";
    z += "        Select Case Btn\xFE";
    z += "            Case \"Q\", \"B\", \"C\", \"X\"\xFE";
    z += "                Print @ClearScreen:@Script(\"if (parent.refreshData) parent.refreshData();\"):\xFE";
    z += "                Return\xFE";
    z += "\xFE";
    z += "            Case \"LD\"\xFE";
    z += "                ReadJSon tableRow From @fHandle(\"DICT\", TableName), \"!\":ColumnID Then\xFE";
    z += "                    For Each Tn In tableRow\xFE";
    z += "                        viewRow[Tn] = tableRow[Tn]\xFE";
    z += "                    Next\xFE";
    z += "                End If\xFE";
    z += "                viewDataSet.columns[ColumnIdx] = viewRow\xFE";
    z += "\xFE";
    z += "            Case \"D\"\xFE";
    z += "                Call DeleteViewColumn(ProjectName, PageName, ViewName, ColumnID, False)\xFE";
    z += "                Print @ClearScreen:@Script(\"if (parent.refreshData) parent.refreshData();\"):\xFE";
    z += "                Return\xFE";
    z += "    \xFE";
    z += "            Case \"SV\"\xFE";
    z += "            ' Save defaults\xFE";
    z += "                If TableName Then\xFE";
    z += "                    ReadJSon tableRow From @fHandle(\"DICT\", TableName), \"!\":ColumnID Else tableRow = {}\xFE";
    z += "                    @standardUnload(@tableColumns, tableRow)\xFE";
    z += "                    Write tableRow On @fHandle(\"DICT\", TableName), \"!\":ColumnID Else Stop @(-1):\"edc-\":System(28):\": \":@Errors\xFE";
    z += "                End If\xFE";
    z += "\xFE";
    z += "            ' Save view column\xFE";
    z += "                WriteJSon viewDataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edc-\":System(28):\": \":@Errors\xFE";
    z += "\xFE";
    z += "                If inIFrame Then\xFE";
    z += "                    ParentRefresh = 1\xFE";
    z += "                    Print @ClearScreen:@Script(\"if (parent.refreshData) parent.refreshData();\"):\xFE";
    z += "                    Return\xFE";
    z += "                Else\xFE";
    z += "                    Call @jsb_mdl.ReGenPageModel(ProjectName, PageName, False)\xFE";
    z += "\xFE";
    z += "                    ParentRefresh = 1\xFE";
    z += "                    Print @ClearScreen:@Script(\"if (parent.refreshData) parent.refreshData();\"):\xFE";
    z += "                    Return\xFE";
    z += "\xFE";
    z += "                End If\xFE";
    z += "        End Select\xFE";
    z += "\xFE";
    z += "    While 1 Do Repeat\xFE";
    z += "End Function\xFE";
    z += "Program editViewColumn\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    If !IsAdmin() Then Stop \"You must be an administrator to run this command\"\xFE";
    z += "   \xFE";
    z += "    ViewName = @ParamVar('viewname')\xFE";
    z += "    ColumnID = @ParamVar('id')\xFE";
    z += "    ProjectName = @ParamVar('projectname')\xFE";
    z += "    ViewName = @DropIfRight(ViewName, \".view\", True):\".view\"\xFE";
    z += "    inIFrame = @ParamVar(\"inIFrame\")\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "    closeWindow = @ParamVar('closeWindow')\xFE";
    z += "    PageName = @ParamVar('PageName')\xFE";
    z += "\xFE";
    z += "    Call editViewColumn(ProjectName, PageName, ViewName, ColumnID, inIFrame)\xFE";
    z += "    \xFE";
    z += "    If fromPage Then @Response.Redirect(fromPage)\xFE";
    z += "    If inIFrame Then Stop\xFE";
    z += "    \xFE";
    z += "    If closeWindow Or !@hasParentProcess Then @Server.End\xFE";
    z += "End Program"
    window.cached_jsb_mdl["editviewcolumn"] = z;
    var z = "Subroutine editViewModel(ProjectName, pageName, ViewName, showBackBtn)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    ' Grid ajax restful setup\xFE";
    z += "    // viewColumns = @modelForAllColumns()\xFE";
    z += "    ParentRefresh = 0\xFE";
    z += "    ViewName = @DropIfRight(ViewName, \".view\", True):\".view\"\xFE";
    z += "\xFE";
    z += "    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else dataSet = @createNewView(ViewName)\xFE";
    z += "    initialTable = dataSet.tableName\xFE";
    z += "\xFE";
    z += "    Loop\xFE";
    z += "        If System(1) = \"aspx\" Then\xFE";
    z += "            AttachDB dataSet.attachdb Else Debug @Alert(\"edv-\":System(28):\": Unable to attach to \":dataSet.attachdb:\" in view \":ViewName)\xFE";
    z += "        End If\xFE";
    z += "\xFE";
    z += "        * Does an ExtraMeta item exist to call?\xFE";
    z += "        ObjectModel = @modelForView()\xFE";
    z += "        Call addExtraColumns2ViewModel(ObjectModel, dataSet.templateName)\xFE";
    z += "        \xFE";
    z += "        Call mdlSessionSetup(ProjectName, pageName, ViewName, dataSet)\xFE";
    z += "        @setDefaults(ViewName, ObjectModel.columns, dataSet)\xFE";
    z += "        F = @Jsb_mdl.formViewNColumns(ProjectName, ObjectModel, False, dataSet, ViewName)\xFE";
    z += "\xFE";
    z += "        ToolBar = \"\"\xFE";
    z += "        If showBackBtn Then\xFE";
    z += "            ToolBar = ToolBar: @SubmitBtn('edv_formBtn', \"SG\", 'Save')\xFE";
    z += "            ToolBar = ToolBar: @SubmitBtn('edv_formBtn', \"B\", 'Cancel')\xFE";
    z += "        Else\xFE";
    z += "            If @hasTclParent Then\xFE";
    z += "                ToolBar = ToolBar:@SubmitBtn('edv_formBtn', 'Q', 'Quit')\xFE";
    z += "            ElseIf @hasParentProcess Then\xFE";
    z += "                ToolBar = ToolBar:@SubmitBtn('edv_formBtn', 'B', 'Back')\xFE";
    z += "            Else\xFE";
    z += "                ToolBar = ToolBar:@SubmitBtn('edv_formBtn', 'C', 'Close')\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "            ToolBar = ToolBar: @SubmitBtn('edv_formBtn', \"R\", 'Rename')\xFE";
    z += "            ToolBar = ToolBar: @SaveBtn('edv_formBtn', \"S\", 'Save')\xFE";
    z += "            ToolBar = ToolBar: @SubmitBtn('edv_formBtn', \"D\", 'Del')\xFE";
    z += "        End If\xFE";
    z += "\xFE";
    z += "        ToolBar = ToolBar: @SubmitBtn('edv_formBtn', \"@\", 'Cols')\xFE";
    z += "        ToolBar = ToolBar: @SaveBtn('edv_formBtn', \"Z\", 'SaveAs')\xFE";
    z += "        ToolBar = ToolBar: @SubmitBtn('edv_formBtn', \"X\", 'CopyFrom')\xFE";
    z += "        ToolBar = ToolBar: @SubmitBtn('edv_formBtn', \"#\", 'Ed Code')\xFE";
    z += "        ToolBar = ToolBar: @SubmitBtn('edv_formBtn', \"W\", 'Wizard')\xFE";
    z += "        ToolBar = ToolBar: @SubmitBtn('edv_formBtn', \"I\", 'Choose Cols')\xFE";
    z += "        ToolBar = ToolBar: @SubmitBtn('edv_formBtn', \"makeUpdate\", '+UpdBtn')\xFE";
    z += "        ToolBar = ToolBar: @SubmitBtn('edv_formBtn', \"makeDelete\", '+DelBtn')\xFE";
    z += "\xFE";
    z += "        Print @ClearScreen: @Rows2(\"%\", F, \"66px\", ToolBar):\xFE";
    z += "\xFE";
    z += "        If ParentRefresh Then\xFE";
    z += "            Print @Script(\"if (parent.refreshData) parent.refreshData();\"):\xFE";
    z += "            ParentRefresh = 0\xFE";
    z += "        End If\xFE";
    z += "\xFE";
    z += "        @Server.Pause\xFE";
    z += "\xFE";
    z += "        * Don't restrict to model, as we may change template types\xFE";
    z += "        @standardUnload(ObjectModel.columns, dataSet, False)\xFE";
    z += "        Cmd = @FormVar('edv_formBtn')\xFE";
    z += "\xFE";
    z += "        * Did we change tables?\xFE";
    z += "        If dataSet.tableName <> tableName Then\xFE";
    z += "            WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "            tableName = dataSet.tableName\xFE";
    z += "        End If\xFE";
    z += "\xFE";
    z += "        @Session.sqlColumns = possibleInputColumns(ProjectName, pageName, ViewName)\xFE";
    z += "        @Session.viewColumns = dataSet.columns\xFE";
    z += "\xFE";
    z += "        * In case we MsgBox\xFE";
    z += "        * F = @jsb_mdl.putRowDataIntoHtml(ProjectName, ObjectModel, dataSet, htmlBackDrop)\xFE";
    z += "        * F = @jsb_mdl.formViewNColumns(ProjectName, ObjectModel, false, dataSet)\xFE";
    z += "        * Print @ClearScreen:@Rows2(\"%\", F, \"66px\", ToolBar):\xFE";
    z += "\xFE";
    z += "        Select Case Cmd\xFE";
    z += "            Case \"Q\", \"C\", \"B\": Print @ClearScreen; Return\xFE";
    z += "\xFE";
    z += "            Case \"I\": WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "                Call ChooseColumns(ProjectName, pageName, ViewName)\xFE";
    z += "                ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else dataSet = @createNewView(ViewName)\xFE";
    z += "\xFE";
    z += "            Case \"W\": Call ViewWizard(ProjectName, pageName, ViewName, dataSet)\xFE";
    z += "\xFE";
    z += "            Case \"SG\": Print @ClearScreen:\xFE";
    z += "                WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "                Call @Jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFE";
    z += "                Return\xFE";
    z += "\xFE";
    z += "            Case \"#\": niceObjectName = @NiceName(@DropIfRight(ViewName, \".view\", True))\xFE";
    z += "                Execute 'ED ':ProjectName:' view_':niceObjectName\xFE";
    z += "\xFE";
    z += "            Case \"@\"; Call editViewModelColumns(ProjectName, pageName, ViewName, True)\xFE";
    z += "\xFE";
    z += "            Case \"S\": Print @ClearScreen:\xFE";
    z += "                Write dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "                Call @Jsb_mdl.ReGenPageModel(ProjectName, @DropIfRight(ViewName, \".view\", True), False) ;* Was GenerateView\xFE";
    z += "                \xFE";
    z += "                If @hasTclParent Or @hasParentProcess Then Return\xFE";
    z += "\xFE";
    z += "            Case \"E\"; Call editTable(ViewName, False)\xFE";
    z += "\xFE";
    z += "            Case \"R\"; If @RenameView(ProjectName, pageName, ViewName, \"\") Then\xFE";
    z += "                    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "                    ParentRefresh = 1\xFE";
    z += "                End If\xFE";
    z += "\xFE";
    z += "            Case \"X\": // Copy From\xFE";
    z += "                If @CopyViewFrom(ProjectName, ViewName) Then\xFE";
    z += "                    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else dataSet = @createNewView(ViewName)\xFE";
    z += "                    ParentRefresh = 1\xFE";
    z += "                End If\xFE";
    z += "\xFE";
    z += "            Case  \"Z\": // Clone a view\xFE";
    z += "                newViewName = @CloneViewTo(ProjectName, ProjectName, ViewName, '')\xFE";
    z += "\xFE";
    z += "                If newViewName Then\xFE";
    z += "                    ViewName = newViewName\xFE";
    z += "                    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else dataSet = @createNewView(ViewName)\xFE";
    z += "                    ParentRefresh = 1\xFE";
    z += "                End If\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "            Case \"D\": // Delete a view\xFE";
    z += "                If @DeleteView(ProjectName, pageName, ViewName, True) Then\xFE";
    z += "                    ParentRefresh = 1\xFE";
    z += "                    @Server.Flush\xFE";
    z += "                    Return\xFE";
    z += "                End If\xFE";
    z += "\xFE";
    z += "            Case \"V\";\xFE";
    z += "\xFE";
    z += "            Case \"makeUpdate\"\xFE";
    z += "                If dataSet.custombtns = '' Then dataSet.custombtns = []\xFE";
    z += "                dataSet.custombtns[-1] = { buttontxt:\"Save\",   verifyform: true, saveform: true, deleteform: false,  confirmop: 0, addoutputs: true, addfrompage: false, showwhen: 1, addnewrec: false, parentmayhide: true };\xFE";
    z += "                dataSet.custombtns[-1] = { buttontxt:\"Update\", verifyform: true, saveform: true, deleteform: false,  confirmop: 0, addoutputs: true, addfrompage: false, showwhen: 2, addnewrec: false, parentmayhide: true };\xFE";
    z += "\xFE";
    z += "            Case \"makeDelete\"\xFE";
    z += "                If dataSet.custombtns = '' Then dataSet.custombtns = []\xFE";
    z += "                dataSet.custombtns[-1] = { buttontxt:\"Delete\", verifyform: false, saveform: false, deleteform: true,  confirmop: 1, addoutputs: false, addfrompage: false, showwhen: 2, addnewrec: false, parentmayhide: true };\xFE";
    z += "        End Select\xFE";
    z += "    While 1 Do Repeat\xFE";
    z += "End Sub\xFE";
    z += "Program editViewModel\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    If !IsAdmin() Then Stop \"You must be an administrator to run this command\"\xFE";
    z += "\xFE";
    z += "    ViewName = @ParamVar('viewname')\xFE";
    z += "    ProjectName = @ParamVar('projectname')\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "    closeWindow = @ParamVar('closeWindow')\xFE";
    z += "    pageName = @ParamVar('pageName')\xFE";
    z += "\xFE";
    z += "    ViewName = @DropIfRight(ViewName, \".view\", True):\".view\"\xFE";
    z += "    If !pageName Then pageName = @DropIfRight(ViewName, \".view\", True):\".page\"\xFE";
    z += "    \xFE";
    z += "    If !ProjectName Then\xFE";
    z += "        Alert('editviewmodel missing projectname ':@Url)\xFE";
    z += "    Else\xFE";
    z += "        Call editViewModel(ProjectName, pageName, ViewName, True)\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    If fromPage Then @Response.Redirect(fromPage)\xFE";
    z += "    If closeWindow Or !@hasParentProcess Then @Server.End\xFE";
    z += "End Program"
    window.cached_jsb_mdl["editviewmodel"] = z;
    var z = "// Show a GRID of columns\xFE";
    z += "Subroutine editViewModelColumns(ProjectName, PageName, ViewName, showBackBtn)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "   ' onParentSelect setup a child launch\xFE";
    z += "    Url = @jsbRestCall(\"editViewColumn?viewname=\":@UrlEncode(ViewName):\"&id={id}&projectname=\":@UrlEncode(ProjectName):\"&inIFrame=1\")\xFE";
    z += "    containerName = \"newDiv\":Rnd(9999)\xFE";
    z += "    OnSelect = @genEventHandler(\"Select\", Url, 4, containerName) ;*  4 Open In An Iframe Whose Id Is containerName\xFE";
    z += "\xFE";
    z += "   ' Grid ajax restful setup\xFE";
    z += "    viewModel = @modelForAllColumns()\xFE";
    z += "    for each column in viewModel.columns\xFE";
    z += "        locate column.name in [\"tooltip\",\"encrypt\",\"Width\",\"pickfunction\",\"pickpbfunction\",\"newlineprefix\",\"ctlstyle\",\"lblstyle\",\"suppresslabel\",\"fullline\",\"collaspestart\",\"collaspeend\",\"collaspopen\",\"jsconditionals\",\"align\", \"sortable\", \"nounload\", \"minimumRole\"] then\xFE";
    z += "            column.display = \"gridhidden\"\xFE";
    z += "        end if\xFE";
    z += "    next\xFE";
    z += "    \xFE";
    z += "    jqGridRestCall = @jsbRestCall(\"fetchViewColumns?viewname=\":@UrlEncode(ViewName):\"&projectname=\":@UrlEncode(ProjectName))\xFE";
    z += "    Jq = @jqGrid(\"jqGrid001\", jqGridRestCall, viewModel.columns, {}):OnSelect\xFE";
    z += "\xFE";
    z += "    Loop\xFE";
    z += "        ToolBar = \"\"\xFE";
    z += "        If showBackBtn Then\xFE";
    z += "            ToolBar = ToolBar: @SubmitBtn('edv_formBtn', \"B\", 'Back')\xFE";
    z += "        Else\xFE";
    z += "            ToolBar = ToolBar: @SubmitBtn('edv_formBtn', \"Q\", 'Quit')\xFE";
    z += "        End If\xFE";
    z += "        Th = @Rows2(\"%\", Jq, \"6em\", @Center(ToolBar))\xFE";
    z += "        Print @ClearScreen:@Rows2(\"50%\", Th, \"50%\", @IFrame(containerName, \"\")):\xFE";
    z += "\xFE";
    z += "        @Server.Pause\xFE";
    z += "\xFE";
    z += "        Cmd = @FormVar('edv_formBtn')\xFE";
    z += "        Select Case Cmd\xFE";
    z += "            Case \"Q\": Stop @ClearScreen\xFE";
    z += "            Case \"B\": Return\xFE";
    z += "        End Select\xFE";
    z += "    While 1 Do Repeat\xFE";
    z += "End Sub"
    window.cached_jsb_mdl["editviewmodelcolumns"] = z;
    var z = "* edit a page\xFE";
    z += "Program Edp\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    if !isManager() Then Stop \"You must be at least a data manager to run program\"\xFE";
    z += "\xFE";
    z += "    ProjectName = @ParamVar('ProjectName')\xFE";
    z += "    pageName = @ParamVar('pageName')\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "    Sentence = Field(@Sentence, \"(\", 1)\xFE";
    z += "    \xFE";
    z += "    If ProjectName = \"\" And pageName = \"\" And fromPage = \"\" And InStr(Sentence, '=') = 0 Then\xFE";
    z += "        ProjectName = Field(Sentence, \" \", 2)\xFE";
    z += "        pageName = Field(Sentence, \" \", 3)\xFE";
    z += "        If LCase(ProjectName) = \"dict\" Then\xFE";
    z += "            ProjectName = Field(Sentence, \" \", 3)\xFE";
    z += "            pageName = Field(Sentence, \" \", 4)\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "    pageName = @DropIfRight(pageName, \".page\", True)\xFE";
    z += "\xFE";
    z += "    If ProjectName = \"\" Then Stop \"edp ProjectName viewname\"\xFE";
    z += "    Open \"\", ProjectName Else \xFE";
    z += "        if msgbox(\"The File/Project \":ProjectName:\" doesn't exist, would you like to create it?\", \"Yes,*No\") <> \"Yes\" Then Stop\xFE";
    z += "        x = fHandle(\"\", projectName, true)\xFE";
    z += "        x = fHandle(\"dict\", projectName, true)\xFE";
    z += "        Open \"\", ProjectName Else stop \"I'm sorry, I wasn't able to create that project\"\xFE";
    z += "    end if\xFE";
    z += "\xFE";
    z += "    B = @Response.buffer()\xFE";
    z += "    Call editPageModel(ProjectName, pageName, fromPage <> \"\", pageName <> \"\")\xFE";
    z += "\xFE";
    z += "    If fromPage Then @Response.Redirect(fromPage)\xFE";
    z += "    \xFE";
    z += "    @Response.buffer(B)\xFE";
    z += "    \xFE";
    z += "    if pageName <> Chr(27) and pagename <> \"\" Then \xFE";
    z += "        If @hasParentProcess  Then\xFE";
    z += "            If Msgbox(\"Launch page\", Pagename, \"*Yes,No\") <> \"Yes\" Then Return\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        @Response.Redirect(@jsbRootExecute(pageName))\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    if @hasTclParent then Stop \"Done\"\xFE";
    z += "    @Server.End\xFE";
    z += "End Program"
    window.cached_jsb_mdl["edp"] = z;
    window.cached_jsb_mdl["edp_pick"] = "Pick Function Edp_pick(fromUrl, fromValue)\xFE    * %options aspxC-\xFE    ProjectName = @ParamVar('projectName')\xFE    newFromValue = fromValue\xFE    Call editPageModel(ProjectName, newFromValue, True, fromValue = \"\")\xFE    If newFromValue = Chr(27) Then newFromValue = fromValue\xFE    newFromValue = @DropIfRight(newFromValue, \".page\", True)\xFE    If newFromValue Then newFromValue := '.page' Else newFromValue = Chr(27)\xFE    Return newFromValue\xFEEnd Function";
    window.cached_jsb_mdl["edt"] = "program edt\xFE    * %options aspxC-\xFE    \xFE    if !isManager() Then Stop \"You must be at least a data manager to run this command\"\xFE    paramVars = @ParamVars\xFE    \xFE    tableName = @ParamVar('tableName')  \xFE    fromPage = @ParamVar('fromPage')\xFE    closeWindow = @ParamVar('closeWindow')\xFE   \xFE    If tableName = \"\" And Len(ParamVars) <= 1 Then \xFE      Sentence = Field(@Sentence, \"(\", 1)\xFE      tableName = Field(Sentence, \" \", 2)\xFE    End If\xFE\xFE    Call editTable(tableName, false)\xFE    \xFE    print @(-1):\xFE     If fromPage Then @Response.Redirect(fromPage)  \xFE   If closeWindow or !@hasParentProcess Then @Server.End\xFEend program";
    var z = "function EdtBCode(ProjectName, pageName, ViewName, btnText)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    ReadJSon ObjectModel From @fHandle(\"DICT\", ProjectName), ViewName Else Debug @Alert('Unable to find view ':ViewName); Return False\xFE";
    z += "    niceViewName = @NiceName(@DropIfRight(ViewName, \".view\", True))\xFE";
    z += "\xFE";
    z += "    BtnI = @findBtnI(ObjectModel, btnText)\xFE";
    z += "    If !BtnI Then Return False\xFE";
    z += "    Btn = ObjectModel.custombtns[BtnI]\xFE";
    z += "\xFE";
    z += "    If Btn.customcall = \"\" Then\xFE";
    z += "        If @MsgBox(\"Confirm\", \"This button '\":btnText:\"' has no custom code, do you want to add some?\", \"*Yes,No\") <> \"Yes\" Then Return False\xFE";
    z += "        Btn.customcall = niceViewName:\"_\":@NiceName(btnText):\"_button\"\xFE";
    z += "        WriteJSon ObjectModel On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "        Call @Jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Read Code From @fHandle(\"\", ProjectName), @DropIfRight(pageName, \".page\", True) Else Return False\xFE";
    z += "    If Instr(LCase(Code), \"function \":LCase(Btn.customcall):\"(\") = 0 Then\xFE";
    z += "        Code<-1> = \"\"\xFE";
    z += "        Code<-1> = \"function \":Btn.customcall:\"(viewVars, rtnErrors)\"\xFE";
    z += "        Code<-1> = \"   return false ;* stops any transfers\"\xFE";
    z += "        Code<-1> = \"end function\"\xFE";
    z += "        Write Code On @fHandle(\"\", ProjectName), @DropIfRight(pageName, \".page\", True) Else Debug @Alert(@Errors)\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    @popoutWindow(ViewName:\" Custom Code\",  @JsbRootExecute(\"ed \":ProjectName:\" '\":@DropIfRight(pageName, \".page\", True):\"'\"), True, \"80%\", \"80%\")\xFE";
    z += "    Return True\xFE";
    z += "End function"
    window.cached_jsb_mdl["edtbcode"] = z;
    var z = "Program Edv\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    If !isManager() Then Stop \"You must be at least a data manager to run this command\"\xFE";
    z += "\xFE";
    z += "    ProjectName = @ParamVar('ProjectName')\xFE";
    z += "    ViewName = @ParamVar('ViewName')\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "    closeWindow = @ParamVar('closeWindow')\xFE";
    z += "    pageName = @ParamVar('pageName')\xFE";
    z += "    If !pageName Then pageName = @DropIfRight(ViewName, \".view\", True):\".page\"\xFE";
    z += "\xFE";
    z += "    If ProjectName = \"\" And ViewName = \"\" And Instr(@Sentence, '=') = 0 Then\xFE";
    z += "        Sentence = Field(@Sentence, \"(\", 1)\xFE";
    z += "        ProjectName = Field(Sentence, \" \", 2)\xFE";
    z += "        ViewName = Field(Sentence, \" \", 4)\xFE";
    z += "        \xFE";
    z += "        If ViewName Then\xFE";
    z += "            pageName = Field(Sentence, \" \", 3)\xFE";
    z += "        Else\xFE";
    z += "            ViewName = Field(Sentence, \" \", 3)\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    ViewName = @DropIfRight(ViewName, \".view\", True):\".view\"\xFE";
    z += "    If !pageName Then pageName = @DropIfRight(ViewName, \".view\", True):\".page\"\xFE";
    z += "    \xFE";
    z += "    If ProjectName = \"\" Or ViewName = \"\" Then Stop \"edv ProjectName {pageName} viewname\"\xFE";
    z += "    Open \"\", ProjectName Else Stop @(-1):\"File/Project \":ProjectName:\" not found\"\xFE";
    z += "\xFE";
    z += "    If Left(LCase(ViewName), 5) = \"view_\" Then\xFE";
    z += "        ReadJSon Dataset From @fHandle(\"DICT\", ProjectName), ViewName Else ViewName = Mid(ViewName, 6)\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    ReadJSon Dataset From @fHandle(\"DICT\", ProjectName), ViewName Else\xFE";
    z += "        Ans = @MsgBox(\"Warning\", \"The view \":ViewName:\" does not exist, do you want to create it?\", \"*Yes,No\")\xFE";
    z += "        If Ans <> \"Yes\" Then If fromPage Then @Response.Redirect(fromPage) Else Return\xFE";
    z += "        Dataset = @createNewView(ViewName)\xFE";
    z += "        WriteJSon Dataset On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "        Call @Jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    OriginalDB = @Account\xFE";
    z += "    If Dataset.attachdb Then AttachDB Dataset.attachdb Else Null\xFE";
    z += "    Call editViewModel(ProjectName, pageName, ViewName, fromPage <> \"\")\xFE";
    z += "    AttachDB OriginalDB Else Null\xFE";
    z += "\xFE";
    z += "    If fromPage Then @Response.Redirect(fromPage) Else Print @ClearScreen\xFE";
    z += "    If closeWindow Or !@hasParentProcess Then @Server.End\xFE";
    z += "End Program"
    window.cached_jsb_mdl["edv"] = z;
    var z = "Pick function Edv_pick(fromUrl, fromValue)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    ProjectName = @ParamVar('projectName')\xFE";
    z += "    If fromValue = \"\" Then ViewName = \"\" Else ViewName = @DropIfRight(fromValue, \".view\", True):\".view\"\xFE";
    z += "    fromPage = @ParamVar(\"fromPage\")\xFE";
    z += "\xFE";
    z += "    pageName = @ParamVar('pageName')\xFE";
    z += "    If !pageName Then pageName = @DropIfRight(ViewName, \".view\", True):\".page\"\xFE";
    z += "    \xFE";
    z += "    If ProjectName = \"\" Then Stop \"edv_pick ProjectName viewname\"\xFE";
    z += "    Open \"\", ProjectName Else Stop @(-1):\"File/Project \":ProjectName:\" not found\"\xFE";
    z += "\xFE";
    z += "    If ViewName = \"\" Then\xFE";
    z += "        Title = \"new view\"\xFE";
    z += "        Loop\xFE";
    z += "            ViewName = Trim(@InputBox(Title, \"Enter a new name\", ViewName, \"80%\", \"\"))\xFE";
    z += "            If ViewName = Chr(27) Or ViewName = \"\" Then Return fromValue\xFE";
    z += "            ViewName = @DropIfRight(ViewName, \".view\", True):\".view\"\xFE";
    z += "            ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Break\xFE";
    z += "            Title = \"View already exists!\"\xFE";
    z += "        While 1 Do Repeat\xFE";
    z += "\xFE";
    z += "        dataSet = @createNewView(ViewName)\xFE";
    z += "        WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "        Call @Jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFE";
    z += "    Else\xFE";
    z += "        ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else dataSet = @createNewView(ViewName)\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    OriginalDB = @Account\xFE";
    z += "    If dataSet.attachdb Then AttachDB dataSet.attachdb Else Null\xFE";
    z += "    Call editViewModel(ProjectName, pageName, (ViewName), True)\xFE";
    z += "    AttachDB OriginalDB Else Null\xFE";
    z += "\xFE";
    z += "    Return ViewName\xFE";
    z += "End function"
    window.cached_jsb_mdl["edv_pick"] = z;
    var z = "Function enabledHtmlEditing(BackDropHtml, NicEditID)\xFE";
    z += "    BackDropHtml = @jsb_html.nicEditor(NicEditID, BackDropHtml, 2)\xFE";
    z += "\xFE";
    z += "    BackDropHtml = BackDropHtml:@Html(`<input id='`:NicEditID:`_ViewProps' name='`:NicEditID:`_formBtn' type='submit' value='ViewProps' style='display:none'/>`:CRLF())\xFE";
    z += "    BackDropHtml = BackDropHtml:@Html(`<input id='`:NicEditID:`_PageProps' name='`:NicEditID:`_formBtn' type='submit' value='PageProps' style='display:none'/>`:CRLF())\xFE";
    z += "    BackDropHtml = BackDropHtml:@Html(`<input id='`:NicEditID:`_RstBak' name='`:NicEditID:`_formBtn' type='submit' value='RstBak' style='display:none'/>`:CRLF())\xFE";
    z += "    BackDropHtml = BackDropHtml:@Html(`<input id='`:NicEditID:`_SavBak' name='`:NicEditID:`_formBtn' type='submit' value='SavBak' style='display:none'/>`:CRLF())\xFE";
    z += "\xFE";
    z += "    * Create context menu on background BOBlock\xFE";
    z += "    S     = `$(document).on('contextmenu', '#x_`:NicEditID:`', function (e) { return `:NicEditID:`_myMenu(e, this) });`\xFE";
    z += "    S<-1> = ``\xFE";
    z += "    S<-1> = `var nicEditorEnabled = false;`\xFE";
    z += "    S<-1> = `function `:NicEditID:`_myMenu(e) {`\xFE";
    z += "    S<-1> = `   if ($('#`:NicEditID:`_myNicPanel').is(':visible')) return true;`\xFE";
    z += "    S<-1> = `   var cMenu = $('<ul id=\\'contextMenu\\' />');`\xFE";
    z += "    S<-1> = `   if (nicEditorEnabled) {`\xFE";
    z += "    S<-1> = `       $(cMenu).append('<li onClick=\\'`:NicEditID:`_SaveBackground()\\'>Save Changes</li>');`\xFE";
    z += "    S<-1> = `   } else {`\xFE";
    z += "    S<-1> = `       $(cMenu).append('<li onClick=\\'`:NicEditID:`_ViewProps()\\'>View Properties</li>');`\xFE";
    z += "    S<-1> = `       $(cMenu).append('<li onClick=\\'`:NicEditID:`_PageProps()\\'>Page Properties</li>');`\xFE";
    z += "    S<-1> = `       $(cMenu).append('<li><br/></li>');`\xFE";
    z += "    S<-1> = `       $(cMenu).append('<li onClick=\\'`:NicEditID:`_EnableEdit()\\'>Edit HTML<br /></li>');`\xFE";
    z += "    S<-1> = `       $(cMenu).append('<li onClick=\\'`:NicEditID:`_ResetBackground()\\'>Reset HTML<br /></li>');`\xFE";
    z += "    S<-1> = `   }`\xFE";
    z += "    S<-1> = `   return jsbContentMenu(e, cMenu)`\xFE";
    z += "    S<-1> = `}`\xFE";
    z += "    S<-1> = `function `:NicEditID:`_SaveBackground() { $('#`:NicEditID:`_SavBak').click(); }`\xFE";
    z += "    S<-1> = `function `:NicEditID:`_ResetBackground() { $('#`:NicEditID:`_RstBak').click(); }`\xFE";
    z += "    S<-1> = `function `:NicEditID:`_EnableEdit() { nicEditorEnabled = true; `:NicEditID:`_EnableEditing() }`\xFE";
    z += "    S<-1> = `function `:NicEditID:`_ViewProps() { $('#`:NicEditID:`_ViewProps').click(); }`\xFE";
    z += "    S<-1> = `function `:NicEditID:`_PageProps() { $('#`:NicEditID:`_PageProps').click(); }`\xFE";
    z += "\xFE";
    z += "    Return BackDropHtml:@Jsb_html.script(S)\xFE";
    z += "End Function"
    window.cached_jsb_mdl["enabledhtmlediting"] = z;
    var z = "******************************************************************************\xFE";
    z += "*\x20EDITOR-OPTION: AUTOFORMAT\xFE";
    z += "******************************************************************************\xFE";
    z += "Program ExcelUpload\xFE";
    z += "    Dim fromPage As String = @QueryVar('fromPage')\xFE";
    z += "    Dim roleMsg As String = Iff(@IsAuthenticated, \"\", \"You must be logged in to view this page. \":@Anchor(@LoginUrl, \"Click here to login\"))\xFE";
    z += "    If !@IsEmployee Then Stop Iff(roleMsg, roleMsg,  \"You must be at least an employee to view this page.\")\xFE";
    z += "\xFE";
    z += "    Dim centerviewVars As Json = { showAddRmvViews: true, fromParentPage: \"ExcelUpload.page\", parentMultiView: '', lastView: true }\xFE";
    z += "    Call View_excelupload_Setup(centerviewVars)\xFE";
    z += "\xFE";
    z += "    If @IspostBack Then\xFE";
    z += "        * Figure out what the user clicked\xFE";
    z += "        Dim pageBtn As String = @FormVar('pageBtn')\xFE";
    z += "        Dim ColumnID As String = Field(@FormVar(\"contextMenuVal\"), \":\", 2)\xFE";
    z += "        If Left(ColumnID, 4) = \"LBL_\" Then ColumnID = Mid(ColumnID, 5)\xFE";
    z += "        If Left(ColumnID, 4) = \"ctl_\" Then ColumnID = Mid(ColumnID, 5)\xFE";
    z += "\xFE";
    z += "        * Unload the form elements\xFE";
    z += "        Call View_excelupload_Unload(centerviewVars)\xFE";
    z += "\xFE";
    z += "        * Process the user command\xFE";
    z += "        Call View_excelupload_checkCommands(centerviewVars, pageBtn, ColumnID)\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Print @(-1):; // Clears output & reset activePage internal variable\xFE";
    z += "    Print @Style(`    \xFE";
    z += "    .form-control-label {\xFE";
    z += "        word-break: break-word;\xFE";
    z += "        white-space: normal;\xFE";
    z += "        max-height: 45px;\xFE";
    z += "        font-size: 11px;\xFE";
    z += "    }`):\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "    * Build and output HTML in user's theme\xFE";
    z += "    Print @Jsb_themes.theme_ifwis(\"mdl\", \"ExcelUpload\", @Display_excelupload(centerviewVars)):\xFE";
    z += "\xFE";
    z += "    * We will stop here, and wait for the user to click on something\xFE";
    z += "End Program"
    window.cached_jsb_mdl["excelupload"] = z;
    window.cached_jsb_mdl["excelupload_custommenu"] = "// This is a Call Back from the Themes allowing us to modify / extend the Theme Menu\xFESubroutine ExcelUpload_customMenu(ByRef MenuBar As Json)\xFE    * Placeholder\xFEEnd Subroutine";
    window.cached_jsb_mdl["fetchviewcolumns"] = "Restful Function fetchViewColumns(ProjectName, Viewname, _search, nd, rows, page, sidx, sord, searchField, searchOper, searchString)\xFE   * %options aspxC-\xFE   preventTimeOut = System(56)\xFE   ViewName = @DropIfRight(ViewName, \".view\", True):\".view\"\xFE   ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else return { errors: @Errors }\xFE   Return { page: 1, total: 1, records: Len(dataSet.columns), rows: dataSet.columns }\xFEEnd Function";
    window.cached_jsb_mdl["findbtni"] = "function findBtnI(ObjectModel, btnText)\xFE    * %options aspxC-\xFE    \xFE    For I = 1 To UBound(ObjectModel.custombtns)\xFE        If ObjectModel.custombtns[I].buttontxt = btnText Then Return I\xFE    Next\xFE    Debug @Alert('unable to find button ':btnText)\xFE    Return 0\xFEEnd function";
    window.cached_jsb_mdl["findviewcolumn"] = "Function findViewColumn(dataSet, Byval ColumnID)\xFE    * %options aspxC-\xFE    \xFE    VColumns = dataSet.columns\xFE    ColumnID = LCase(ColumnID)\xFE    If Left(ColumnID, 7) = \"ctllbl_\" Then ColumnID = Mid(ColumnID, 8)\xFE    niceColumnID = @NiceName(ColumnID)\xFE    For ColumnIdx = 1 To Len(VColumns)\xFE        viewRow = VColumns[ColumnIdx]\xFE        vName = LCase(viewRow.name)\xFE        If Vname = ColumnID Or @NiceName(Vname) = niceColumnID  Then Return ColumnIdx\xFE    Next\xFE    Return 0\xFEEnd Function";
    window.cached_jsb_mdl["formatcd"] = "function formatCD(cd)\xFE    * %options aspxC-\xFE    \xFE    //Loop while instr(cd, AM():AM()) do\xFE    //    cd = replace(cd, AM():AM(), AM())\xFE    //repeat\xFE    \xFE    cd = replacei(cd, AM():\"end func\":AM(), AM():\"End Func\":AM():AM())\xFE    cd = replacei(cd, AM():\"end sub\":AM(), AM():\"End Sub\":AM():AM())\xFE    cd = replacei(cd, AM():\"end program\":AM(), AM():\"End Program\":AM():AM())\xFE    cd = replacei(cd, AM():\"end function\":AM(), AM():\"End Function\":AM():AM())\xFE    cd = replacei(cd, AM():\"end subroutine\":AM(), AM():\"End Subroutine\":AM():AM())\xFE    \xFE    Return cd\xFEend function";
    var z = "// return a url quoted string for output in code generation (see vt templates)\xFE";
    z += "function formURL(byval url, byval addoutputs, byval outputFields, byval passparams, byval addnewrec, byval addFromPage)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    Url = \"'\":@DropIfRight(Url, '.page')\xFE";
    z += "    insideQuotes = True\xFE";
    z += "    \xFE";
    z += "    if InStr(url, \"?\") then sep = \"&\" Else sep = \"?\"\xFE";
    z += "    \xFE";
    z += "    if addoutputs And outputFields Then\xFE";
    z += "        if !insideQuotes Then url := \":'\"; insideQuotes = True\xFE";
    z += "        url := sep:Mid(@jsb_mdl.UrlOutputParams(outputFields), 2)\xFE";
    z += "        sep = \"&\"\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    if addnewrec then\xFE";
    z += "        if !insideQuotes Then url := \":'\"; insideQuotes = True\xFE";
    z += "        url := sep:`newRecord=1`\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    if addFromPage then\xFE";
    z += "        if !insideQuotes Then url := \":'\"; insideQuotes = True\xFE";
    z += "        url := sep:\"fromPage=':@Url\"\xFE";
    z += "        insideQuotes = False\xFE";
    z += "        sep = \"&\"\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    if passparams Then\xFE";
    z += "        if insideQuotes Then url := \"':\"; insideQuotes = False\xFE";
    z += "        url := `iif(@QueryString, '`:sep:`':Replace(Replace(@QueryString, \"newRecord=1\", \"\"), \"&&\", \"&\"), '')`\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    if insideQuotes then url := \"'\"\xFE";
    z += "    return Url\xFE";
    z += "end function"
    window.cached_jsb_mdl["formurl"] = z;
    var z = "Function formViewNColumns(ByVal ProjectName As String, ByVal objectModel As JSON, ByVal doKOBinding As Boolean, byval useRow As JSON, ByVal viewName As String)\xFE";
    z += "    Dim ctlHtml As Variable // All ctl_xxxx() expect variable --- change to string\xFE";
    z += "    Dim Column As JSON\xFE";
    z += "    Dim modelColumns As Array \xFE";
    z += "    \xFE";
    z += "    Dim Html As Array = []\xFE";
    z += "    if !useRow then useRow = {}\xFE";
    z += "    \xFE";
    z += "    Dim Style As String = \"\"\xFE";
    z += "    If objectModel.forecolor Then Style = Style:\"color:\":objectModel.forecolor:\"; \"\xFE";
    z += "    If objectModel.backcolor Then Style = Style:\"background-color:\":objectModel.backcolor:\"; \"\xFE";
    z += "    If objectModel.font Then Style = Style:\"font-family:\":objectModel.font:\"; \"\xFE";
    z += "    If objectModel.fontsize Then Style = Style:\"font-size:\":objectModel.fontsize:\"; \"\xFE";
    z += "    If objectModel.boxed = \"solid\" Or objectModel.boxed = \"dashed\" Then\xFE";
    z += "        Style = Style:\"border-style:\":objectModel.boxed:\"; border-width:1px;\"\xFE";
    z += "    ElseIf objectModel.boxed = \"double\" Then\xFE";
    z += "        Style = Style:\"border-style:double; border-width:3px;\"\xFE";
    z += "    ElseIf objectModel.boxed <> \"none\" And objectModel.boxed <> \"\" Then\xFE";
    z += "        Style = Style:\"border-style:\":objectModel.boxed:\"; border-width:4px;\"\xFE";
    z += "    End If\xFE";
    z += "    If Style Then Style = \" style='\":Style:\"'\"\xFE";
    z += "      \xFE";
    z += "    Dim startedFormGroupRow As Boolean = False\xFE";
    z += "    Dim startedCollaspe As Boolean = False\xFE";
    z += "    modelColumns = @DropGridColumns(objectModel.columns)\xFE";
    z += "    \xFE";
    z += "    For Each Column, Ci In modelColumns\xFE";
    z += "        If Column.control = \"\" Then Column.control = \"textbox\"\xFE";
    z += "        If Column.name = \"\" Then Column.name = \"no id\"\xFE";
    z += "        \xFE";
    z += "        If Column.display <> \"hidden\" Then\xFE";
    z += "            If Column.collaspestart Then\xFE";
    z += "                If startedFormGroupRow Then Html[-1] = @Html('</div>')\xFE";
    z += "\xFE";
    z += "                Html[-1] = @Html('<div class=\"collase_block\"><div class=\"collase_header\" onclick=\"$(this).next().slideToggle();\">&#8681;&nbsp;':HtmlEncode(Column.collaspestart):'&nbsp;&#8681;</div>')\xFE";
    z += "                If Column.collaspopen Then\xFE";
    z += "                    Html[-1] = @Html('<div class=\"collase_content\">')\xFE";
    z += "                Else\xFE";
    z += "                    Html[-1] = @Html('<div class=\"collase_content\" style=\"display: none\">')\xFE";
    z += "                End If\xFE";
    z += "\xFE";
    z += "                startedFormGroupRow = False\xFE";
    z += "                startedCollaspe = True\xFE";
    z += "            Else\xFE";
    z += "                If Column.newlineprefix Or Column.fullline Then\xFE";
    z += "                    If startedFormGroupRow Then Html[-1] = @Html('</div>')\xFE";
    z += "                    startedFormGroupRow = False\xFE";
    z += "                End If\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "            If !startedFormGroupRow Then\xFE";
    z += "                Html[-1] = @Html('<div class=\"form-group row\"':Style:'>')\xFE";
    z += "                startedFormGroupRow = True\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "            callName = LCase(Column.control)\xFE";
    z += "            CtlLabel = Column.label\xFE";
    z += "            If !CtlLabel Then CtlLabel = Column.name\xFE";
    z += "            Dim niceColumnName As String = @niceName(Column.name)\xFE";
    z += "\xFE";
    z += "            if left(callName, 4) <> \"ctl_\" then callName = \"ctl_\":callName\xFE";
    z += "            CallName = \"jsb_ctls.\":callName\xFE";
    z += "            If Column.ctlstyle Then additionalAttrs = { style: Column.ctlstyle } Else additionalAttrs = []\xFE";
    z += "            If Column.encrypt Then DataRef = 'decode(xts(Row[\"':Column.name:'\"]))' Else DataRef = 'Row[\"':Column.name:'\"]'\xFE";
    z += "\xFE";
    z += "            Call @CallName(ProjectName, niceColumnName, Column, useRow, ByRef ctlHtml, doKOBinding, additionalAttrs, False, viewName)\xFE";
    z += "\xFE";
    z += "            If Column.pickfunction Then\xFE";
    z += "                If Instr(Column.pickfunction, \".page\") Then PickURL = @DropRight(Column.pickfunction, \".page\") Else PickURL = Column.pickfunction\xFE";
    z += "                PickURL = Replace(PickURL, \"{projectname}\", @UrlEncode(ProjectName))\xFE";
    z += "                // If !Instr(PickURL, \"//\") And Left(PickURL, 1) <> \".\" and Left(PickURL, 1) <> \"/\" Then PickURL = \"./\":PickURL\xFE";
    z += "                ctlHtml = @jsb_html.addPick(ctlHtml, niceColumnName, PickURL, \"80%\", \"90%\", PickURL, Column.autopostback)\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "            If callName = \"ctl_json_inline\" Then\xFE";
    z += "                ctlHtml = Replace(ctlHtml, \"mdlctl\", \"nstctl\")\xFE";
    z += "                ctlHtml = Replace(ctlHtml, ' id=\"LBL_', ' id=\"lbln_')\xFE";
    z += "\xFE";
    z += "                If Column.suppresslabel Then\xFE";
    z += "                    Html[-1] = @Html(`<mdlctl id='ctl_`:niceColumnName:`' style='width: 100%'>`):ctlHtml:@Html(`</mdlctl>`)\xFE";
    z += "                Else\xFE";
    z += "                    Html[-1] = @lblCtlSet(CtlLabel, ctlHtml, niceColumnName, Column.fullline, Column.suppresslabel, Column.lblstyle)\xFE";
    z += "                End If\xFE";
    z += "            Else\xFE";
    z += "                Html[-1] = @lblCtlSet(CtlLabel, ctlHtml, niceColumnName, Column.fullline, Column.suppresslabel, Column.lblstyle)\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "            If Column.collaspeend And startedCollaspe Then\xFE";
    z += "                If startedFormGroupRow Then Html[-1] = @Html('</div>')\xFE";
    z += "                Html[-1] = @Html(\"</div></div>\") ;* Collase_block, Collase_content\xFE";
    z += "                startedFormGroupRow = False\xFE";
    z += "                startedCollaspe = False\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    If startedFormGroupRow Then\xFE";
    z += "        Html[-1] = @Html('</div>')\xFE";
    z += "        startedFormGroupRow = False\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Return Join(Html,\"\")\xFE";
    z += "End Function"
    window.cached_jsb_mdl["formviewncolumns"] = z;
    window.cached_jsb_mdl["fulllinecolumn"] = "Subroutine fulllineColumn(ProjectName, PageName, ViewName, ColumnID)\xFE    * %options aspxC-\xFE    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE    ColumnIdx = @findViewColumn(dataSet, ColumnID)\xFE    If ColumnIdx = 0 Then Return\xFE    dataSet.columns[ColumnIdx].fullline = !dataSet.columns[ColumnIdx].fullline\xFE    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edc-\":System(28):\": \":@Errors\xFE    Call @jsb_mdl.ReGenPageModel(ProjectName, PageName, False)\xFEEnd Subroutine";
    var z = "Function GenerateCodeFromTemplate(ProjectName, ByVal TemplateFileName, parentObjectName, parentObject, objectName, Results, compileResults, ByVal noModelingStuff)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    TemplateFileName = LCase(TrueFileName(TemplateFileName))\xFE";
    z += "    \xFE";
    z += "    If !IsManager() Then\xFE";
    z += "        compileResults = \"^You must be in the manager role or higher to generate templates\"\xFE";
    z += "        Return False\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    ReadJson objectModel From @fHandle(\"dict\", ProjectName), objectName Else\xFE";
    z += "        compileResults = \"^GenerateCodeFromTemplate \":ProjectName:\" \":objectName:\" not found.\"\xFE";
    z += "        Return False\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    TemplateName = LCase(objectModel.templateName)\xFE";
    z += "    If !TemplateName Then\xFE";
    z += "        compileResults = \"^GenerateCodeFromTemplate: Your '\":objectName:\"' is missing a templateName field.\":CStr(objectModel)\xFE";
    z += "        \xFE";
    z += "        If parentObject Then Results := 'This is coming from an embedded template \"':parentObject.templateName:'\"'\xFE";
    z += "        Return False\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Read Template From @fHandle(TemplateFileName), templateName Else\xFE";
    z += "        compileResults = \"^GenerateCodeFromTemplate: Your '\":objectName:\"' has an unknown template reference: '\":templateName:\"' from fHandle(\":TemplateFileName:\")\"\xFE";
    z += "        If parentObject Then compileResults := 'This is coming from an embedded template ':parentObject.templateName\xFE";
    z += "        Return False\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    templateJSON = Field(Template, \"******************************************************************************\", 1)\xFE";
    z += "    Template = Mid(Template, Col2())\xFE";
    z += "    If Instr(Template, \"`\") Then\xFE";
    z += "        compileResults =  \"^Your template \":templateName:\" is using the ` character.  You need change this.\"\xFE";
    z += "        Return False\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    // Make sure that all of the defaults from this template exist in the objectModel\xFE";
    z += "    templateJSON = JSON(\"[\":templateJSON:\"]\")\xFE";
    z += "    for each templateField in templateJSON\xFE";
    z += "       if templateField.name And templateField.defaultvalue then \xFE";
    z += "           if !hasTag(objectModel, templateField.name) then objectModel[templateField.name] = templateField.defaultvalue\xFE";
    z += "       end if\xFE";
    z += "    next\xFE";
    z += "    \xFE";
    z += "    if parentObject then\xFE";
    z += "        // process view\xFE";
    z += "        Code = [`Function genCodeStubView(ProjectName, pageName, pageModel, viewName, viewModel, TemplateFileName, Errors, noModelingStuff)`:AM()]\xFE";
    z += "        CodeName = \"genCodeStubView\"\xFE";
    z += "    Else\xFE";
    z += "        // process page\xFE";
    z += "        Code = [`Function genCodeStubPage(ProjectName, pageName, pageModel, TemplateFileName, Errors, noModelingStuff)`:AM()]\xFE";
    z += "        CodeName = \"genCodeStubPage\"\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Code[-1] = 'Gen = []'\xFE";
    z += "\xFE";
    z += "    If TemplateFileName = \"jsb_viewtemplates\" Then\xFE";
    z += "        If parentObject Then Code[-1] = 'pageTemplateName = \"':LCase(objectModel.templateName):'\"'\xFE";
    z += "        Code[-1] = 'viewTemplateName = \"':TemplateName:'\"'\xFE";
    z += "        \xFE";
    z += "    ElseIf TemplateFileName = \"jsb_pagetemplates\" Then\xFE";
    z += "        Code[-1] = 'pageTemplateName = \"':TemplateName:'\"'\xFE";
    z += "        \xFE";
    z += "    Else\xFE";
    z += "        Code[-1] = 'TemplateName = \"':TemplateName:'\"'\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Call ProcessTemplate(Code, TemplateFileName, templateName, Template)\xFE";
    z += "\xFE";
    z += "    Code[-1] = \"Gen = Join(Gen, '')\"\xFE";
    z += "\xFE";
    z += "    Code[-1] = \"Return Gen\"\xFE";
    z += "    Code[-1] = \"End Function\"\xFE";
    z += "    Code = Join(Code, AM())\xFE";
    z += "    \xFE";
    z += "    Write Code On @fHandle(\"TMP\"), CodeName Else Stop @(-1):\"Modeler-\":System(28):\": \":@Errors\xFE";
    z += "    Execute \"Basic TMP \":CodeName Capturing compileResults\xFE";
    z += "    compileResults = \"Generating \":ProjectName:\" \":objectName:crlf():Replace(compileResults, AM(), CRLF())\xFE";
    z += "    \xFE";
    z += "    If Instr(compileResults, \"^\") Or Instr(compileResults, \"You must be an administrator\")  Then\xFE";
    z += "        compileResults = \"Compiler error: Basic TMP \":CodeName:crlf(): compileResults:CRLF()\xFE";
    z += "        compileResults := @AnchorEdit(TemplateFileName, templateName)\xFE";
    z += "        Return False\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    compileResults := @AnchorEdit(ProjectName, DropIfRight(objectName, \".page\"))\xFE";
    z += "\xFE";
    z += "    if parentObject then\xFE";
    z += "        Results = @TMP.genCodeStubView(ProjectName, parentObjectName, parentObject, objectName, objectModel, TemplateFileName, Errors, noModelingStuff)\xFE";
    z += "    Else\xFE";
    z += "        Results = @TMP.genCodeStubPage(ProjectName, objectName, objectModel, TemplateFileName, Errors, noModelingStuff)\xFE";
    z += "    End if\xFE";
    z += "    \xFE";
    z += "    If Errors Then\xFE";
    z += "        compileResults = Errors\xFE";
    z += "        Return False\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Return True\xFE";
    z += "End Function"
    window.cached_jsb_mdl["generatecodefromtemplate"] = z;
    window.cached_jsb_mdl["getcolumndefinitions"] = "function getColumnDefinitions(byval tblID_Or_SQL, columnNames)\xFE    * %options aspxC-\xFE    \xFE    // Get the schemaColumns\xFE    isSelect = lcase(left(tblID_Or_SQL, 7)) = \"select \"\xFE    if isSelect Then\xFE        TableColumns = @getSelectColumnDefs(tblID_Or_SQL)\xFE    Else\xFE        TableColumns = @getTableColumnDefs(tblID_Or_SQL, False, False)\xFE    end if\xFE    \xFE    If HasTag(TableColumns[LBound(TableColumns)], \"Oridinal\") Then TableColumns = @Sort(TableColumns, \"Oridinal\")\xFE    If HasTag(TableColumns[LBound(TableColumns)], \"oridinal\") Then TableColumns = @Sort(TableColumns, \"oridinal\")\xFE    \xFE    columnNames = []\xFE    for each column in TableColumns\xFE        columnNames[-1] = column.name\xFE    next\xFE    \xFE    return TableColumns\xFEend function";
    var z = "function getDistinctValues(tblID_Or_SQL, Field, LimitNo, datatype)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    isSelect = LCase(Left(tblID_Or_SQL, 7)) = \"select \"\xFE";
    z += "    if limitNo Then Top = \"Top \":limitNo Else Top = \"\"\xFE";
    z += "    \xFE";
    z += "    if isSelect Then\xFE";
    z += "        sqlSelect = \"Select \":Top:\" Distinct [\":Field:\"] From \":Mid(tblID_Or_SQL, InStrI(tblID_Or_SQL, \" from \") + 1)\xFE";
    z += "        sqlSelect sqlSelect To Ss Else @Alert(@Errors); Return []\xFE";
    z += "    Else\xFE";
    z += "        open tblID_Or_SQL to f Else @Alert(@Errors); Return []\xFE";
    z += "        \xFE";
    z += "        if isSqlServer(f) Then\xFE";
    z += "            useName = tblID_Or_SQL\xFE";
    z += "            if dbViewExists(useName) Then \xFE";
    z += "                tmpTblName = \"##dview_\":tblID_Or_SQL:\"_\":NiceName(@UserName) \xFE";
    z += "                open tmpTblName to f Then useName = tmpTblName\xFE";
    z += "            End If    \xFE";
    z += "        \xFE";
    z += "            sqlSelect = \"Select distinct \":Top:\" [\":Field:\"] From \":Mid(useName, InStrI(useName, \" from \") + 1)\xFE";
    z += "            sqlSelect sqlSelect To Ss Else @Alert(@Errors); Return []\xFE";
    z += "            \xFE";
    z += "        else if Field = @primaryKeyName(tblID_Or_SQL) Then\xFE";
    z += "            select f to Ss Else @Alert(@Errors); Return []\xFE";
    z += "            Keys = GetList(Ss)\xFE";
    z += "            return split(Keys, Am())\xFE";
    z += "            \xFE";
    z += "        else\xFE";
    z += "            select \"distinct \":Top:\" [\":field:\"]\" from f to Ss Else @Alert(@Errors); Return []\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    return OrderDistinctValues(ss, Field, LimitNo, \"AI\") // L)eft, R)right, A)scending, D)escending, N)umeric, I)gnore case\xFE";
    z += "end function"
    window.cached_jsb_mdl["getdistinctvalues"] = z;
    var z = "function getDistinctYears(tblID_Or_SQL, Field, LimitNo, datatype)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    isSelect = LCase(Left(tblID_Or_SQL, 7)) = \"select \"\xFE";
    z += "    if limitNo Then Top = \"Top \":limitNo Else Top = \"\"\xFE";
    z += "    \xFE";
    z += "    if datatype = \"date\" Or datatype = \"time\" Or datatype = \"datetime\" then Fnc = \"Year([\":Field:\"])\" else Fnc = \"[\":Field:\"]\"\xFE";
    z += "    \xFE";
    z += "    if isSelect Then\xFE";
    z += "        sqlSelect = \"Select distinct \":Top:\" \":Fnc:\" As [\":Field:\"] From \":Mid(tblID_Or_SQL, InStrI(tblID_Or_SQL, \" from \") + 1)\xFE";
    z += "        sqlSelect sqlSelect To Ss Else @Alert(@Errors); Return []\xFE";
    z += "    Else\xFE";
    z += "        open tblID_Or_SQL to f Else @Alert(@Errors); Return []\xFE";
    z += "        \xFE";
    z += "        if isSqlServer(f) Then\xFE";
    z += "            useName = tblID_Or_SQL\xFE";
    z += "            if dbViewExists(useName) Then \xFE";
    z += "                tmpTblName = \"##dview_\":tblID_Or_SQL:\"_\":NiceName(@UserName)\xFE";
    z += "                open tmpTblName to f Then useName = tmpTblName\xFE";
    z += "            End If\xFE";
    z += "            \xFE";
    z += "            sqlSelect = \"Select distinct \":Top:\" \":Fnc:\" As [\":Field:\"] From \":Mid(useName, InStrI(useName, \" from \") + 1)\xFE";
    z += "            sqlSelect sqlSelect To Ss Else @Alert(@Errors); Return []\xFE";
    z += "                \xFE";
    z += "        else\xFE";
    z += "            open tblID_Or_SQL to f Else @Alert(@Errors); Return []\xFE";
    z += "            select \"distinct \":Top:\" \":Fnc:\" As [\":Field:\"]\" from f to Ss Else @Alert(@Errors); Return []\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    return OrderDistinctValues(ss, Field, LimitNo, \"ND\") // L)eft, R)right, A)scending, D)escending, N)umeric, I)gnore case\xFE";
    z += "end function"
    window.cached_jsb_mdl["getdistinctyears"] = z;
    window.cached_jsb_mdl["getextrapagecolumns"] = "Subroutine getExtraPageColumns(ModelColumns, pageTemplateName)\xFE    * %options aspxC-\xFE    \xFE    Read Template From @fHandle(\"JSB_pageTemplates\"), pageTemplateName Else\xFE        If pageTemplateName <> \"\" Then @Alert(\"JSB_pageTemplates Template \":pageTemplateName:\" not found\")\xFE        Return\xFE    End If\xFE\xFE    Columns = Field(Template, \"******************************************************************************\", 1)\xFE    Columns = Replace(Columns, Chr(254), \" \")\xFE    If Trim(Columns) = \"\" Then Return\xFE    Columns = JSon(\"[\" : Columns : \"]\")\xFE    If Typeof(Columns) = \"String\" Then\xFE        @Alert(\"Your JSB_pageTemplates \":pageTemplateName:\" does not have valid JSON\")\xFE        Return\xFE    End If\xFE    For Each XRow In Columns\xFE        ModelColumns[-1] = XRow\xFE    Next\xFEEnd Subroutine";
    window.cached_jsb_mdl["getjsondefdefaults"] = "function getJsonDefDefaults(jsondef_ID)\xFE    * %options aspxC-\xFE    \xFE    jsonDefs = readJsonDefs('jsb_jsondefs', jsondef_ID)\xFE    return buildDefaultRow(jsonDefs)\xFEEnd function";
    var z = "function GetRow(Settings, Rows, rowI)\xFE";
    z += "    Equ State_LookingForHeader To 1\xFE";
    z += "    Equ State_ProcessingHeader To 2\xFE";
    z += "    Equ State_ProcessingData To 3\xFE";
    z += "    \xFE";
    z += "    Row = []\xFE";
    z += "    srcRow = Rows[rowI]\xFE";
    z += "    \xFE";
    z += "    if Settings.State = State_LookingForHeader Then\xFE";
    z += "        Settings.FirstC = 1\xFE";
    z += "        Settings.LastC = UBound(srcRow)\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    For C = Settings.FirstC To Settings.LastC while C <= UBound(srcRow)\xFE";
    z += "        cellValue = srcRow[C]\xFE";
    z += "        If cellValue Then\xFE";
    z += "            If Settings.State = State_LookingForHeader Then\xFE";
    z += "                Settings.firstR = rowI\xFE";
    z += "                Settings.FirstC = C\xFE";
    z += "                Settings.State = State_ProcessingHeader \xFE";
    z += "            End If\xFE";
    z += "            \xFE";
    z += "        // Blank cell ?       \xFE";
    z += "        ElseIf Settings.State = State_ProcessingHeader Then \xFE";
    z += "            // allow blanks in column header?\xFE";
    z += "            If Settings.SideBySideTables Then\xFE";
    z += "                Settings.LastC = C - 1\xFE";
    z += "                Break\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        If Settings.State = State_ProcessingData Then \xFE";
    z += "            Row[-1] = cellValue\xFE";
    z += "            \xFE";
    z += "        ElseIf Settings.State = State_processingHeader then\xFE";
    z += "            Row[-1] = CStr(cellValue)\xFE";
    z += "        end if\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    Return Row\xFE";
    z += "end function"
    window.cached_jsb_mdl["getrow"] = z;
    var z = "* Return array of columns\xFE";
    z += "function getSelectionColumns(viewModel, CNames, optional byval orderAllColumns)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "\xFE";
    z += "    CNames = []\xFE";
    z += "    Columns = []\xFE";
    z += "    ActualCols = []\xFE";
    z += "\xFE";
    z += "    if viewModel.customsql Then\xFE";
    z += "        FlatFile = False\xFE";
    z += "    Else\xFE";
    z += "        FlatFile = True\xFE";
    z += "        Open viewModel.tableName to tFile Then\xFE";
    z += "            if left(tFile, 4) = \"ado:\" Then FlatFile = False\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Open viewModel.tableName to tFile Then\xFE";
    z += "        if left(tFile, 4) = \"ado:\" Then ActualCols = tfile.ColumnNames\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    if orderAllColumns then\xFE";
    z += "        // devExpress Grid uses ordinal for perserving the grid layout.  Make sure the column query order is the same by ordering the selection\xFE";
    z += "        if viewModel.customsql Then\xFE";
    z += "            myColumns = getColumnDefinitions(viewModel.customsql, columnNames) // Sorted by Ordinal\xFE";
    z += "        Else\xFE";
    z += "            myColumns = getColumnDefinitions(viewModel.tableName, columnNames)\xFE";
    z += "        end if\xFE";
    z += "    \xFE";
    z += "        for each c in myColumns\xFE";
    z += "            c.display = \"visible\"\xFE";
    z += "        next\xFE";
    z += "    else\xFE";
    z += "        myColumns = viewModel.columns\xFE";
    z += "    end if\xFE";
    z += "            \xFE";
    z += "    For Each Column In myColumns\xFE";
    z += "        CName = Column.field \xFE";
    z += "        If !CName Then CName = Column.name\xFE";
    z += "        If CName And Column.display <> \"hidden\" Then\xFE";
    z += "            If Len(ActualCols) Then \xFE";
    z += "                Locate CName In ActualCols Then CNames[-1] = \"[\":CName:\"]\"\xFE";
    z += "            Else\xFE";
    z += "                CNames[-1] = \"[\":CName:\"]\"\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "            if IsNumeric(Column.width) then\xFE";
    z += "                Column = Clone(Column)\xFE";
    z += "                Column.width = Column.width * 8 ;* Character size to pt size, roughly\xFE";
    z += "            end if\xFE";
    z += "            Columns[-1] = Column\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    LCNames = LCase(Join(CNames, AM()))\xFE";
    z += "\xFE";
    z += "    * If it's in the output, it must be selected too\xFE";
    z += "    for each Column in viewModel.outputs\xFE";
    z += "        CName = Column.field\xFE";
    z += "        If !CName Then CName = Column.name\xFE";
    z += "        If CName Then\xFE";
    z += "            Locate LCase(CName) In LCNames Else\xFE";
    z += "                If Len(ActualCols) Then \xFE";
    z += "                    Locate CName In ActualCols Then CNames[-1] = \"[\":CName:\"]\"\xFE";
    z += "                Else\xFE";
    z += "                    CNames[-1] = \"[\":CName:\"]\"\xFE";
    z += "                End If\xFE";
    z += "\xFE";
    z += "                LCNames<-1> = LCase(CName)\xFE";
    z += "                newColumn = {}\xFE";
    z += "                newColumn.name = CName\xFE";
    z += "                newColumn.control = 'label'\xFE";
    z += "                newColumn.display = \"hidden\" \xFE";
    z += "                Columns[-1] = newColumn\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    Return Columns\xFE";
    z += "end function"
    window.cached_jsb_mdl["getselectioncolumns"] = z;
    window.cached_jsb_mdl["gettableprimarykeycol"] = "function getTablePrimaryKeyCol(tableColumns)\xFE    * %options aspxC-\xFE    \xFE    primaryKeyName = ''\xFE    For Each Col In tableColumns\xFE        If Col.primarykey Then return Col\xFE    Next\xFE    \xFE    // Force a primaryKeyCol if none\xFE    primaryKeyName = 'ItemID'\xFE    newColumn = { name:primaryKeyName, primarykey: true, datatype: 'string' }\xFE    Call setColumnDefaults(newColumn.datatype, newColumn)\xFE    Return newColumn\xFEend function";
    window.cached_jsb_mdl["hasserversideparams"] = "function hasServerSideParams(viewModel)\xFE    * %options aspxC-\xFE    \xFE    If viewModel.outputs = \"\" Then Return False\xFE    for each Row in viewModel.outputs\xFE        If row.scope And row.scope <> \"UrlParam\" Then Return True\xFE    next\xFE    Return False\xFEEnd Function";
    window.cached_jsb_mdl["hideviewcolumn"] = "Subroutine hideViewColumn(ProjectName, PageName, ViewName, ColumnID)\xFE    * %options aspxC-\xFE    \xFE    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE    ColumnIdx = @findViewColumn(dataSet, ColumnID)\xFE    If ColumnIdx = 0 Then Return\xFE    VColumns = dataSet.columns\xFE    viewRow = VColumns[ColumnIdx]\xFE    viewRow.display = \"hidden\"\xFE    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edc-\":System(28):\": \":@Errors\xFE    Call @jsb_mdl.ReGenPageModel(ProjectName, PageName, False)\xFEEnd Subroutine";
    window.cached_jsb_mdl["highestviewindex"] = "Function highestViewIndex(dataSet)\xFE    * %options aspxC-\xFE    \xFE    VColumns = dataSet.columns\xFE    I = 0\xFE    For ColumnIdx = 1 To Len(VColumns)\xFE        viewRow = VColumns[ColumnIdx]\xFE        If viewRow.index > I Then I =  viewRow.index\xFE    Next\xFE    Return I + 1\xFEEnd Function";
    window.cached_jsb_mdl["isrowempty"] = "function isRowEmpty(Row)\xFE    if !Row Then Return True\xFE    return Trim(Join(Row, \"\")) = \"\"\xFEend function";
    window.cached_jsb_mdl["labelcolumn"] = "Subroutine labelColumn(ProjectName, PageName, ViewName, ColumnID)\xFE    * %options aspxC-\xFE    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE    ColumnIdx = @findViewColumn(dataSet, ColumnID)\xFE    If ColumnIdx = 0 Then Return\xFE    newValue = Trim(@InputBox(\"Column Property \":ColumnID, \"Label\", dataSet.columns[ColumnIdx].label, \"80%\", \"auto\"))\xFE    If newValue = Chr(27) Then Return\xFE    dataSet.columns[ColumnIdx].label = newValue\xFE    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edc-\":System(28):\": \":@Errors\xFE    Call @jsb_mdl.ReGenPageModel(ProjectName, PageName, False)\xFEEnd Subroutine";
    var z = "Function LblCtlPair(Label, ctlHtml, niceColumnName, Fullline, suppressLabel, Lblstyle)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    C1 = []\xFE";
    z += "    If Fullline Then\xFE";
    z += "        If suppressLabel Then\xFE";
    z += "            C1[-1] = @Html(`<div class=\"lblctlpair_FullLine lblctlpair_FullLine_suppressLabel\">`)\xFE";
    z += "            C1[-1] = @Html(`   <mdlctl id='ctl_`:niceColumnName:`'>`):ctlHtml:@Html(`</mdlctl>`)\xFE";
    z += "            C1[-1] = @Html(`</div>`)\xFE";
    z += "        Else\xFE";
    z += "            If True Then\xFE";
    z += "                Lbl = @Html(`<label id='LBL_`:niceColumnName:`' xfor='`:niceColumnName:`' style='float: left; overflow:hidden; text-align:right; width: 116px;`:Lblstyle:`'>`):Trim(Label):@Html(`&nbsp;</label>`)\xFE";
    z += "                Ctl = @Html(`<mdlctl id='ctl_`:niceColumnName:`'>`):ctlHtml:@Html(`</mdlctl>`)\xFE";
    z += "                C1[-1] = @Cols2(\"120px\", Lbl, \"%\", Ctl, \"\", \"overflow: hidden\", \"overflow: auto\") ;* Cols2(C1Width, C1Content, C2Width, C2Content, Height, C1Style, C2Style)\xFE";
    z += "            Else\xFE";
    z += "                C1[-1] = @Html(`<div class=\"lblctlpair_FullLine lblctlpair_FullLine_withLabel\" >`)\xFE";
    z += "                Lbl = @Html(`<label id='LBL_`:niceColumnName:`' xfor='`:niceColumnName:`' style='`:Lblstyle:`'>`):Trim(Label):@Html(`&nbsp;</label>`)\xFE";
    z += "                Ctl = @Html(`<mdlctl id='ctl_`:niceColumnName:`'>`):ctlHtml:@Html(`</mdlctl>`)\xFE";
    z += "                C1[-1] = Lbl:Ctl\xFE";
    z += "                C1[-1] = @Html(`</div>`)\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "    Else\xFE";
    z += "        If suppressLabel Then\xFE";
    z += "            C1[-1] = @Html(`<div class=\"lblctlpair lblctlpair_suppressLabel\">`)\xFE";
    z += "            C1[-1] = @Html(`   <mdlctl id='ctl_`:niceColumnName:`' >`):ctlHtml:@Html(`</mdlctl>`)\xFE";
    z += "            C1[-1] = @Html(`</div>`)\xFE";
    z += "        Else\xFE";
    z += "            C1[-1] = @Html(`<div class=\"lblctlpair lblctlpair_withLabel\">`)\xFE";
    z += "            C1[-1] = @Html(`<label id='LBL_`:niceColumnName:`' xfor='`:niceColumnName:`' style='`:LblStyle:`'>`):Trim(Label):@Html(`&nbsp;</label>`)\xFE";
    z += "            C1[-1] = @Html(`   <mdlctl id='ctl_`:niceColumnName:`'>`):ctlHtml:@Html(`</mdlctl>`)\xFE";
    z += "            C1[-1] = @Html(`</div>`)\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Return Join(C1, \"\")\xFE";
    z += "End Function"
    window.cached_jsb_mdl["lblctlpair"] = z;
    window.cached_jsb_mdl["makeclonename"] = "function makeCloneName(Byval ProjectName, Byval oldPageName, Byval oldViewName, Byval NewPageName)\xFE    * %options aspxC-\xFE    \xFE    oldViewName = LCase(@DropIfRight(oldViewName, \".view\", True))\xFE    NewPageName = LCase(@DropIfRight(NewPageName, \".page\", True))\xFE    oldPageName = LCase(@DropIfRight(oldPageName, \".page\", True))\xFE    \xFE    newViewName = Replace(oldViewName, oldPageName, NewPageName)\xFE    If newViewName <> oldPageName Then Return newViewName:\".view\"\xFE    \xFE    fDict = @fHandle(\"DICT\", ProjectName)\xFE    For I = 1 To 10\xFE        newViewName = oldViewName:\"_\":I:\".view\"\xFE        Read Test From fDict, newViewName Else Return newViewName\xFE    Next\xFE    \xFE    Return oldViewName:\"_\":Guid()\xFEEnd function";
    var z = "Program makeNewReport\xFE";
    z += "    * %options aspxC- \xFE";
    z += "    \xFE";
    z += "    roleMsg = Iff(@IsAuthenticated, \"\", \"You must be logged in to view this page. \":@Anchor(@LoginUrl, \"Click here to login\"))\xFE";
    z += "    If !@isManager Then Stop Iff(roleMsg, roleMsg, \"You must be at least a data manager to use this command.\")\xFE";
    z += "    \xFE";
    z += "    Theme('lumen')\xFE";
    z += "    \xFE";
    z += "    databaseName = @ParamVar('databaseName') // Table Name\xFE";
    z += "    If isMissing(databaseName) Then Stop \"databaseName is a required parameter\"\xFE";
    z += "    If !@Jsb_odb.AttachDBextended(databaseName) Then Stop @Errors\xFE";
    z += "    \xFE";
    z += "    tableID = @ParamVar('tableID') // Table Name\xFE";
    z += "    tabID = @ParamVar('tabID')\xFE";
    z += "\xFE";
    z += "    reportName = @ParamVar('reportName')\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "    \xFE";
    z += "    reportName = @DropIfRight(reportName, \".page\", True)\xFE";
    z += "    closeThisTab = reportName = \"\"\xFE";
    z += "\xFE";
    z += "    If !makeNewReport(tabID, databaseName, reportName, tableID) Then\xFE";
    z += "        If @Errors Then Msgbox(@Errors)\xFE";
    z += "        reportName = \"\"\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    If fromPage Then @Response.Redirect(fromPage)\xFE";
    z += "\xFE";
    z += "    If reportName <> Chr(27) And reportName <> \"\" Then\xFE";
    z += "        If @hasParentProcess  Then\xFE";
    z += "            If Msgbox(\"Launch report\", reportName, \"*Yes,No\") <> \"Yes\" Then Return\xFE";
    z += "        End If\xFE";
    z += "        msgbox(\"Redirecting to \":@jsbRootAct:reportName)\xFE";
    z += "        @Response.Redirect(@jsbRootAct:reportName)\xFE";
    z += "        stop\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    If @hasTclParent Then Stop \"Done\"\xFE";
    z += "    @Server.End\xFE";
    z += "End Program\xFE";
    z += "// Url is @jsbRootAccount():`makenewreport?tabID=`:@UrlEncode(tabID):`&tableID=`:@UrlEncode(tableID):`&databaseName=`:@UrlEncode(databaseName)\xFE";
    z += "\xFE";
    z += "function makeNewReport(Byval tabID As String, Byval databaseName As String, reportName, Optional Byval tblID_Or_SQL As String, Optional Byval visibleColumns As Array, Optional Byval defaultDevXGridLayout As String)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    Attachdb \"\" Else Null\xFE";
    z += "    ProjectName = \"dbBuilderReports\"\xFE";
    z += "    If !@isManager Then Stop \"You must be at least a data manager to use this command.\"\xFE";
    z += "\xFE";
    z += "    F = Fhandle(\"\", projectName, True)\xFE";
    z += "    fDictProject = Fhandle(\"dict\", projectName, True)\xFE";
    z += "    \xFE";
    z += "    isSelect = LCase(Left(tblID_Or_SQL, 7)) = \"select \"\xFE";
    z += "\xFE";
    z += "    If !tblID_Or_SQL Then\xFE";
    z += "        if reportName Then\xFE";
    z += "            ReadJson view From fHandle('dict', 'dbBuilderReports'), reportName:\".view\" Then\xFE";
    z += "                tblID_Or_SQL = view.tableName\xFE";
    z += "                if !databaseName Then\xFE";
    z += "                    databaseName = view.attachdb\xFE";
    z += "                    if Left(databaseName, 3) = \"db_\" Then databaseName = Mid(databaseName, 4)\xFE";
    z += "                End If\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    If !databaseName Then @Errors = \"A databaseName is a required URL parameter\"; Return False\xFE";
    z += "    If !@Jsb_odb.AttachDBextended(databaseName) Then Return False\xFE";
    z += "    \xFE";
    z += "    If !tblID_Or_SQL Then\xFE";
    z += "        tblID_Or_SQL = pickAtable(\"\", \"Pick a Table to use for your report\")\xFE";
    z += "        If !tblID_Or_SQL Then Return False\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    // If we have some dict !defs, this may help us choose  control and ref list\xFE";
    z += "    TableColumns = getColumnDefinitions(tblID_Or_SQL, columnNames)\xFE";
    z += "\xFE";
    z += "    // Get search setup and visibleColumns\xFE";
    z += "    SearchTypes = newSearchType(ProjectName, databaseName, tblID_Or_SQL, visibleColumns)\xFE";
    z += "    If SearchTypes = False Then Return False\xFE";
    z += "    \xFE";
    z += "    If visibleColumns Then visibleColumns = Split(LCase(visibleColumns), \",\")\xFE";
    z += "    \xFE";
    z += "    // define what outputs and then what inputs we need  \xFE";
    z += "    \xFE";
    z += "    SearchOutputs = [] // should match with gridViewInputs\xFE";
    z += "    gridViewInputs = []\xFE";
    z += "    SearchFields = []\xFE";
    z += "    gridColumns = []\xFE";
    z += "\xFE";
    z += "    // I/O       types: string;number;boolean;date\xFE";
    z += "    // I/O   operators: =;<>;>;<;<=;>=;Like ...%;Like %...;Like %...%;InList;Dynamic\xFE";
    z += "    nextLineCrlfPrefix = false\xFE";
    z += "    \xFE";
    z += "    For Each SearchRow In SearchTypes\xFE";
    z += "        If !SearchRow.queryfield Then Cycle\xFE";
    z += "        If !SearchRow.label Then SearchRow.label = SearchRow.name\xFE";
    z += "        \xFE";
    z += "        // predefine single fields\xFE";
    z += "        Field = SearchRow.name     // this is the database column\xFE";
    z += "        Name = SearchRow.label     // this is the url?parameterName=xxx\xFE";
    z += "        \xFE";
    z += "    \xFE";
    z += "        searchCtl = Clone(SearchRow)\xFE";
    z += "        searchCtl.control = \"textbox\"\xFE";
    z += "        searchCtl.fullline = False\xFE";
    z += "        searchCtl.width = 12\xFE";
    z += "        searchCtl.canedit = True\xFE";
    z += "        searchCtl.ctlstyle = \"\"\xFE";
    z += "        searchCtl.display = \"visible\"\xFE";
    z += "        searchCtl.required = False\xFE";
    z += "        searchCtl.notblank = False\xFE";
    z += "        searchCtl.primarykey = False\xFE";
    z += "        searchCtl.oktocache = true\xFE";
    z += "        searchCtl.newlineprefix = nextLineCrlfPrefix\xFE";
    z += "        searchCtl.addBlank = true\xFE";
    z += "        nextLineCrlfPrefix = False\xFE";
    z += "        \xFE";
    z += "        dataType = searchCtl.datatype\xFE";
    z += "\xFE";
    z += "        Select Case datatype \xFE";
    z += "            Case \"boolean\":\xFE";
    z += "                searchCtl.control = \"dropdownbox\"\xFE";
    z += "                searchCtl.reflist = \"false,0;true,1\"\xFE";
    z += "                searchCtl.addBlank = True\xFE";
    z += "                \xFE";
    z += "            Case \"date\":\xFE";
    z += "                searchCtl.control = \"datebox\"\xFE";
    z += "                \xFE";
    z += "            Case \"time\":\xFE";
    z += "                searchCtl.control = \"timebox\"\xFE";
    z += "                \xFE";
    z += "            Case \"datetime\":\xFE";
    z += "                searchCtl.control = \"datetimebox\"\xFE";
    z += "                \xFE";
    z += "            Case \"url\":\xFE";
    z += "                searchCtl.control = \"urlbox\"\xFE";
    z += "        End Select\xFE";
    z += "        \xFE";
    z += "        \xFE";
    z += "        searchCtl.defaultvalue = `{@ParamVar('`:searchCtl.name:`')}`\xFE";
    z += "        \xFE";
    z += "        outputCol = { field: field, name: name, scope: \"UrlParam\" }\xFE";
    z += "        inputCol = { field: field, 'and': 1, name: name, scope: \"UrlParam\", datatype: datatype, operator: \"Dynamic\", required: SearchRow.required }\xFE";
    z += "        // lparen, rparen, defaultvalue\xFE";
    z += "\xFE";
    z += "        // predefine for dual fields (range from ... to)\xFE";
    z += "        RangeColumn1 = Clone(searchCtl)\xFE";
    z += "        RangeColumn1.name = \"From_\":RangeColumn1.name; RangeColumn1.label = \"From \":RangeColumn1.label;\xFE";
    z += "        RangeColumn1.newlineprefix = True\xFE";
    z += "        RangeColumn1.defaultvalue = `{@ParamVar('`:RangeColumn1.name:`')}`\xFE";
    z += "        \xFE";
    z += "        RangeColumn2 = Clone(searchCtl)\xFE";
    z += "        RangeColumn2.name = \"To_\":RangeColumn2.name; RangeColumn2.label = \"To \":RangeColumn2.label;\xFE";
    z += "        RangeColumn2.defaultvalue = `{@ParamVar('`:RangeColumn2.name:`')}`\xFE";
    z += "\xFE";
    z += "        outputCol1 = { field: RangeColumn1.name, name: RangeColumn1.label, scope: \"UrlParam\" }\xFE";
    z += "        outputCol2 = { field: RangeColumn2.name, name: RangeColumn2.label, scope: \"UrlParam\" }\xFE";
    z += "        \xFE";
    z += "        inputCol1 = { field: field, 'and': 1, name: RangeColumn1.label, scope: \"UrlParam\", datatype: datatype, operator: \">=\", required: SearchRow.required }\xFE";
    z += "        inputCol2 = { field: field, 'and': 1, name: RangeColumn2.label, scope: \"UrlParam\", datatype: datatype, operator: \"<=\", required: SearchRow.required }\xFE";
    z += "        \xFE";
    z += "        // setup search operation: \xFE";
    z += "        dataType = searchCtl.datatype\xFE";
    z += "        searchCtl.datatype = \"string\"  // Make all inputs string so we can do > 4\xFE";
    z += "        \xFE";
    z += "        Select Case SearchRow.searchType\xFE";
    z += "            Case \"an exact string match\", \"GUID\"\xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "                \xFE";
    z += "            Case \"partial string match\"\xFE";
    z += "                inputCol.operator = \"Like %...%\"\xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "                \xFE";
    z += "            Case \"string starts with\"\xFE";
    z += "                inputCol.operator = \"Like %...\"\xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "                \xFE";
    z += "            Case \"string ends with\"\xFE";
    z += "                inputCol.operator = \"Like ...%\"\xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "                \xFE";
    z += "            Case \"an exact numeric value\"\xFE";
    z += "                inputCol.datatype = \"number\"\xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "\xFE";
    z += "            Case \"year range\"\xFE";
    z += "                Reflist = getDistinctYears(tblID_Or_SQL, Field, 0, datatype)\xFE";
    z += "\xFE";
    z += "                RangeColumn1.addBlank = True\xFE";
    z += "                RangeColumn1.reflist = Join(Reflist, \";\")\xFE";
    z += "                RangeColumn1.control = \"dropdownbox\"\xFE";
    z += "                RangeColumn1.addBlank = True\xFE";
    z += "                \xFE";
    z += "                RangeColumn2.addBlank = True\xFE";
    z += "                RangeColumn2.reflist = Join(Reflist, \";\")\xFE";
    z += "                RangeColumn2.control = \"dropdownbox\"\xFE";
    z += "                \xFE";
    z += "                SearchFields[-1] = RangeColumn1\xFE";
    z += "                SearchFields[-1] = RangeColumn2\xFE";
    z += "                nextLineCrlfPrefix = True\xFE";
    z += "                \xFE";
    z += "                SearchOutputs[-1] = outputCol1\xFE";
    z += "                SearchOutputs[-1] = outputCol2\xFE";
    z += "                \xFE";
    z += "                gridViewInputs[-1] = inputCol1\xFE";
    z += "                gridViewInputs[-1] = inputCol2\xFE";
    z += "                \xFE";
    z += "            Case \"an exact date\"\xFE";
    z += "                inputCol.datatype = \"date\"\xFE";
    z += "                searchCtl.control = \"datebox\"\xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol   // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "                \xFE";
    z += "            Case \"date range\"\xFE";
    z += "                SearchFields[-1] = RangeColumn1\xFE";
    z += "                SearchFields[-1] = RangeColumn2\xFE";
    z += "                nextLineCrlfPrefix = True\xFE";
    z += "                \xFE";
    z += "                SearchOutputs[-1] = outputCol1\xFE";
    z += "                SearchOutputs[-1] = outputCol2\xFE";
    z += "                \xFE";
    z += "                gridViewInputs[-1] = inputCol1\xFE";
    z += "                gridViewInputs[-1] = inputCol2\xFE";
    z += "                \xFE";
    z += "            Case \"time range\"\xFE";
    z += "                SearchFields[-1] = RangeColumn1\xFE";
    z += "                SearchFields[-1] = RangeColumn2\xFE";
    z += "                nextLineCrlfPrefix = True\xFE";
    z += "                \xFE";
    z += "                SearchOutputs[-1] = outputCol1\xFE";
    z += "                SearchOutputs[-1] = outputCol2\xFE";
    z += "                \xFE";
    z += "                gridViewInputs[-1] = inputCol1\xFE";
    z += "                gridViewInputs[-1] = inputCol2\xFE";
    z += "                \xFE";
    z += "            Case \"numeric range (inclusive)\"\xFE";
    z += "                SearchFields[-1] = RangeColumn1\xFE";
    z += "                SearchFields[-1] = RangeColumn2\xFE";
    z += "                nextLineCrlfPrefix = True\xFE";
    z += "                \xFE";
    z += "                SearchOutputs[-1] = outputCol1\xFE";
    z += "                SearchOutputs[-1] = outputCol2\xFE";
    z += "                \xFE";
    z += "                gridViewInputs[-1] = inputCol1\xFE";
    z += "                gridViewInputs[-1] = inputCol2\xFE";
    z += "                \xFE";
    z += "            Case \"numeric range (exclusive)\"\xFE";
    z += "                SearchFields[-1] = RangeColumn1\xFE";
    z += "                SearchFields[-1] = RangeColumn2\xFE";
    z += "                nextLineCrlfPrefix = True\xFE";
    z += "                \xFE";
    z += "                SearchOutputs[-1] = outputCol1\xFE";
    z += "                SearchOutputs[-1] = outputCol2\xFE";
    z += "                \xFE";
    z += "                inputCol1.operator = \">\"\xFE";
    z += "                inputCol2.operator = \"<\"\xFE";
    z += "                gridViewInputs[-1] = inputCol1\xFE";
    z += "                gridViewInputs[-1] = inputCol2\xFE";
    z += "                \xFE";
    z += "            Case \"dropdown (literal)\"\xFE";
    z += "                searchCtl.reflist = SearchRow.reflist\xFE";
    z += "                searchCtl.control = \"dropdownbox\"\xFE";
    z += "                searchCtl.addBlank = True\xFE";
    z += "                \xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "                \xFE";
    z += "            Case \"dropdown (ref-file)\"\xFE";
    z += "                // searchCtl.refsql = SearchRow.refsql\xFE";
    z += "                // searchCtl.refwhere = SearchRow.refwhere\xFE";
    z += "                \xFE";
    z += "                searchCtl.reffile = SearchRow.reffile\xFE";
    z += "                searchCtl.refpk = SearchRow.refpk\xFE";
    z += "                searchCtl.refdisplay = SearchRow.refdisplay\xFE";
    z += "            \xFE";
    z += "                searchCtl.control = \"dropdownbox\"\xFE";
    z += "                searchCtl.addBlank = True\xFE";
    z += "                \xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "                \xFE";
    z += "            Case \"dropdown (derived)\"\xFE";
    z += "                searchCtl.reffile = tblID_Or_SQL\xFE";
    z += "                searchCtl.refpk = Field\xFE";
    z += "                searchCtl.refdisplay = Field\xFE";
    z += "                \xFE";
    z += "                searchCtl.control = \"dropdownbox\"\xFE";
    z += "                \xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "\xFE";
    z += "            Case \"dropdown (derive now)\", \"dropdown\"\xFE";
    z += "                Reflist = getDistinctValues(tblID_Or_SQL, Field, 0, datatype)\xFE";
    z += "\xFE";
    z += "                searchCtl.addBlank = True\xFE";
    z += "                searchCtl.reflist = Join(Reflist, \";\")\xFE";
    z += "                \xFE";
    z += "                searchCtl.control = \"dropdownbox\"\xFE";
    z += "                \xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "\xFE";
    z += "            Case \"dropdown (Year(derive now))\", \"dropdown (Year())\"\xFE";
    z += "                Reflist = getDistinctYears(tblID_Or_SQL, Field, 0, datatype)\xFE";
    z += "                searchCtl.addBlank = True\xFE";
    z += "                searchCtl.reflist = Join(Reflist, \";\")\xFE";
    z += "                \xFE";
    z += "                searchCtl.control = \"dropdownbox\"\xFE";
    z += "                \xFE";
    z += "                SearchFields[-1] = searchCtl   // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol  // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "                \xFE";
    z += "            Case \"dropdown (Year(derived))\"\xFE";
    z += "                searchCtl.reffile = tblID_Or_SQL\xFE";
    z += "                if datatype = \"date\" Or datatype = \"time\" Or datatype = \"datetime\" then Fnc = \"Year([\":Field:\"])\" else Fnc = \"[\":Field:\"]\"\xFE";
    z += "                searchCtl.refpk = Fnc\xFE";
    z += "                searchCtl.refdisplay = Fnc\xFE";
    z += "                \xFE";
    z += "                searchCtl.control = \"dropdownbox\"\xFE";
    z += "                \xFE";
    z += "                SearchFields[-1] = searchCtl   // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol  // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "                \xFE";
    z += "            Case \"autocomplete (derived)\"\xFE";
    z += "                searchCtl.reffile = tblID_Or_SQL\xFE";
    z += "                searchCtl.refpk = Field\xFE";
    z += "                searchCtl.refdisplay = Field\xFE";
    z += "                \xFE";
    z += "                searchCtl.control = \"autotextbox\"\xFE";
    z += "                \xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "\xFE";
    z += "            Case \"autocomplete (ref-file)\"\xFE";
    z += "                searchCtl.reffile = SearchRow.reffile\xFE";
    z += "                searchCtl.refpk = SearchRow.refpk\xFE";
    z += "                searchCtl.refdisplay = SearchRow.refdisplay\xFE";
    z += "            \xFE";
    z += "                searchCtl.control = \"autotextbox\"\xFE";
    z += "                \xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "                \xFE";
    z += "            Case \"multi-select (literal)\"\xFE";
    z += "                searchCtl.reflist = SearchRow.reflist\xFE";
    z += "                searchCtl.control = \"multiselectdropdownbox\"\xFE";
    z += "                searchCtl.addBlank = True\xFE";
    z += "                \xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "            Case \"multi-select (ref-file)\"\xFE";
    z += "                searchCtl.reffile = SearchRow.reffile\xFE";
    z += "                searchCtl.refpk = SearchRow.refpk\xFE";
    z += "                searchCtl.refdisplay = SearchRow.refdisplay\xFE";
    z += "            \xFE";
    z += "                searchCtl.control = \"multiselectdropdownbox\"\xFE";
    z += "                searchCtl.addBlank = True\xFE";
    z += "                \xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "                \xFE";
    z += "            Case \"multi-select (derived)\"\xFE";
    z += "                searchCtl.reffile = tblID_Or_SQL\xFE";
    z += "                searchCtl.refpk = Field\xFE";
    z += "                searchCtl.refdisplay = Field\xFE";
    z += "                \xFE";
    z += "                inputCol.operator = \"InList\"\xFE";
    z += "                searchCtl.addBlank = True\xFE";
    z += "\xFE";
    z += "                searchCtl.control = \"multiselectdropdownbox\"\xFE";
    z += "                \xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "\xFE";
    z += "            Case \"multi-select (derive now)\", \"multi-select\"\xFE";
    z += "                Reflist = getDistinctValues(tblID_Or_SQL, Field, 0, datatype)\xFE";
    z += "                \xFE";
    z += "                inputCol.operator = \"InList\"\xFE";
    z += "                searchCtl.addBlank = True\xFE";
    z += "                searchCtl.reflist = Join(Reflist, \";\")\xFE";
    z += "                \xFE";
    z += "                searchCtl.control = \"multiselectdropdownbox\"\xFE";
    z += "                \xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "\xFE";
    z += "            Case \"multi-select (Year(derived))\"\xFE";
    z += "                searchCtl.reffile = tblID_Or_SQL\xFE";
    z += "                searchCtl.refpk = Field\xFE";
    z += "                searchCtl.refdisplay = Field\xFE";
    z += "                \xFE";
    z += "                inputCol.operator = \"InList\"\xFE";
    z += "                searchCtl.addBlank = True\xFE";
    z += "                \xFE";
    z += "                searchCtl.control = \"multiselectdropdownbox\"\xFE";
    z += "                \xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "            \xFE";
    z += "            Case \"multi-select (Year(derive now))\", \"multi-select Year() dropdown\"\xFE";
    z += "                Reflist = getDistinctYears(tblID_Or_SQL, Field, 0, datatype)\xFE";
    z += "                \xFE";
    z += "                inputCol.operator = \"InList\"\xFE";
    z += "                searchCtl.addBlank = True\xFE";
    z += "                searchCtl.reflist = Join(Reflist, \";\")\xFE";
    z += "                \xFE";
    z += "                searchCtl.control = \"multiselectdropdownbox\"\xFE";
    z += "                \xFE";
    z += "                SearchFields[-1] = searchCtl    // Place on Search Screen\xFE";
    z += "                SearchOutputs[-1] = outputCol // pass to Grid\xFE";
    z += "                gridViewInputs[-1] = inputCol\xFE";
    z += "            \xFE";
    z += "            \xFE";
    z += "  \xFE";
    z += "            Case Else\xFE";
    z += "                If @isAdmin Then Debug // shouldn't happen - unknown SearchRow.searchType\xFE";
    z += "                \xFE";
    z += "        End Case\xFE";
    z += "    Next\xFE";
    z += "        \xFE";
    z += "    if ubound(gridViewInputs) <> ubound(SearchOutputs) then\xFE";
    z += "        debug ;* should match\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    // create model for grid\xFE";
    z += "    gridColumns = []\xFE";
    z += "    For Each SearchRow In SearchTypes\xFE";
    z += "        If !SearchRow.displayfield Then Cycle\xFE";
    z += "        \xFE";
    z += "        gridColumn = Clone(SearchRow)\xFE";
    z += "        If visibleColumns Then\xFE";
    z += "            Locate LCase(gridColumn.name) In visibleColumns Else gridColumn.display = \"gridhidden\"\xFE";
    z += "        End If\xFE";
    z += "        gridColumns[-1] = gridColumn\xFE";
    z += "    Next\xFE";
    z += "        \xFE";
    z += "    editInputs = [] // should just be primary key\xFE";
    z += "    For Each SearchRow In SearchTypes\xFE";
    z += "        if SearchRow.primarykey Then \xFE";
    z += "            Field = SearchRow.name     // this is the database column\xFE";
    z += "            Name = SearchRow.label \xFE";
    z += "            editInputs[-1] = { field: Field, 'and': 1, name: Name, scope: \"UrlParam\", datatype: SearchRow.datatype, operator: \"Dynamic\", required: SearchRow.required }\xFE";
    z += "        end if\xFE";
    z += "    next\xFE";
    z += "    \xFE";
    z += "    editColumns = []\xFE";
    z += "    if editInputs Then\xFE";
    z += "        For Each SearchRow In SearchTypes\xFE";
    z += "            If !SearchRow.editfield Then Cycle\xFE";
    z += "            \xFE";
    z += "            editCtl = Clone(SearchRow)\xFE";
    z += "            editCtl.control = \"textbox\"\xFE";
    z += "            editCtl.fullline = False\xFE";
    z += "            editCtl.width = 12\xFE";
    z += "            editCtl.canedit = True\xFE";
    z += "            editCtl.ctlstyle = \"\"\xFE";
    z += "            editCtl.display = \"visible\"\xFE";
    z += "            editCtl.required = False\xFE";
    z += "            editCtl.notblank = False\xFE";
    z += "            editCtl.primarykey = False\xFE";
    z += "            editCtl.newlineprefix = nextLineCrlfPrefix\xFE";
    z += "            nextLineCrlfPrefix = False\xFE";
    z += "            \xFE";
    z += "            // Editing for year\xFE";
    z += "            if InStrI(SearchRow.searchType, \"year\") then datatype = \"integer\"\xFE";
    z += "            \xFE";
    z += "            Select Case editCtl.datatype\xFE";
    z += "                Case \"boolean\":\xFE";
    z += "                    editCtl.control = \"dropdownbox\"\xFE";
    z += "                    editCtl.reflist = \"false,0;true,1\"\xFE";
    z += "                    editCtl.addBlank = True\xFE";
    z += "                    \xFE";
    z += "                Case \"date\":\xFE";
    z += "                    editCtl.control = \"datebox\"\xFE";
    z += "                    \xFE";
    z += "                Case \"time\":\xFE";
    z += "                    editCtl.control = \"timebox\"\xFE";
    z += "                    \xFE";
    z += "                Case \"datetime\":\xFE";
    z += "                    editCtl.control = \"datetimebox\"\xFE";
    z += "                    \xFE";
    z += "                Case \"url\":\xFE";
    z += "                    editCtl.control = \"urlbox\"\xFE";
    z += "            End Select\xFE";
    z += "            \xFE";
    z += "            Select Case SearchRow.searchType  \xFE";
    z += "                Case \"dropdown (Year(derived))\", \"year range\", \"dropdown (Year(derived))\", \"multi-select (Year(derived))\"\xFE";
    z += "                    Reflist = getDistinctYears(tblID_Or_SQL, SearchRow.name, 0, SearchRow.datatype)\xFE";
    z += "                    editCtl.addBlank = True\xFE";
    z += "                    editCtl.reflist = Join(Reflist, \";\")\xFE";
    z += "                    editCtl.control = \"dropdownbox\"\xFE";
    z += "                \xFE";
    z += "                Case \"pick from derived\", \"pick multiple values\", \"multi-select dropdown\" // Editing\xFE";
    z += "                    Reflist = getDistinctValues(tblID_Or_SQL, SearchRow.name, 0, SearchRow.datatype)\xFE";
    z += "                    editCtl.addBlank = True\xFE";
    z += "                    editCtl.reflist = Join(Reflist, \";\")\xFE";
    z += "                    editCtl.control = \"dropdownbox\"\xFE";
    z += "                    \xFE";
    z += "                Case \"use a pic-list\"\xFE";
    z += "                    editCtl.reflist = SearchRow.reflist\xFE";
    z += "                    editCtl.control = \"dropdownbox\"\xFE";
    z += "                    editCtl.addBlank = True\xFE";
    z += "                    \xFE";
    z += "                Case \"use a pic-file\"\xFE";
    z += "                    editCtl.reffile = SearchRow.reffile\xFE";
    z += "                    editCtl.refpk = SearchRow.refpk\xFE";
    z += "                    editCtl.refdisplay = SearchRow.refdisplay\xFE";
    z += "                    editCtl.control = \"dropdownbox\"\xFE";
    z += "                    editCtl.addBlank = True\xFE";
    z += "                    \xFE";
    z += "            End Case\xFE";
    z += "            \xFE";
    z += "            editColumns[-1] = editCtl\xFE";
    z += "        Next\xFE";
    z += "    end if\xFE";
    z += "\xFE";
    z += "    // This prefix is used by the dbTree to find reports for given database\xFE";
    z += "    Prefix = Nicename(databaseName):\"_\"\xFE";
    z += "    // If reportName Then reportName = Prefix:reportName\xFE";
    z += "    \xFE";
    z += "    Print @(-1):\"Building search selection page\"; @Server.Flush\xFE";
    z += "    If !newPage(projectName, Prefix, reportName /* pageName */, SearchFields, [] /* gridViewInputs */, SearchOutputs, \"Report\" /* pageType */, tblID_Or_SQL, visibleColumns, defaultDevXGridLayout) Then Return False\xFE";
    z += "\xFE";
    z += "    // Make sure Project_Menus was compiled\xFE";
    z += "    Execute \"basic dbBuilderReports Project_Menus\" Capturing X\xFE";
    z += "    \xFE";
    z += "    // Add custom script\xFE";
    z += "    Read Src From fHandle('dbBuilderReports'), reportName Then\xFE";
    z += "        If !Instr(Src, '@Script(CrlfTrigger)') Then\xFE";
    z += "            Find = \"Print Html:\"\xFE";
    z += "            ReplaceWith = Find\xFE";
    z += "            ReplaceWith<-1> = `* <insert>`\xFE";
    z += "            ReplaceWith<-1> = `CrlfTrigger = \"window.oneTime = function (e) { if (e.keyCode != 13 || e.shiftKey) return true; $(document).off('keydown', oneTime); $('#formBtn_Query').click() }; $(document).on('keydown', oneTime);\"`\xFE";
    z += "            ReplaceWith<-1> = `Print @Script(CrlfTrigger):`\xFE";
    z += "            ReplaceWith<-1> = `* </insert>`\xFE";
    z += "            Src = Replace(Src, Find, ReplaceWith)\xFE";
    z += "            Write Src On fHandle('dbBuilderReports'), reportName Else Null\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        Execute \"basic dbBuilderReports \":reportName Capturing X\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    if !editColumns Then editInputs = []\xFE";
    z += "    Print \"Building grid report page\"; @Server.Flush\xFE";
    z += "    If !newPage(projectName, Prefix, reportName:\"_Grid\", gridColumns, gridViewInputs, editInputs /* output params */, \"Report(Grid)\", tblID_Or_SQL, visibleColumns, defaultDevXGridLayout) Then Return False\xFE";
    z += "    \xFE";
    z += "    If @isAdmin Then\xFE";
    z += "        Print \"Building pivot setup page\"; @Server.Flush\xFE";
    z += "        If !newPage(projectName, Prefix, reportName:\"_PivotSetup\", gridColumns, gridViewInputs, [], \"Report(Pivot Setup)\", tblID_Or_SQL, visibleColumns, \"\") Then Return False\xFE";
    z += "        \xFE";
    z += "        Print \"Building pivot report page\"; @Server.Flush\xFE";
    z += "        If !newPage(projectName, Prefix, reportName:\"_Pivot\", gridColumns, gridViewInputs, [], \"Report(Pivot)\", tblID_Or_SQL, visibleColumns, \"\") Then Return False\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    if editInputs and editColumns Then\xFE";
    z += "        ReadJson gridDataset From fHandle('dict', 'dbBuilderReports'), reportName:\"_Grid.view\" Then\xFE";
    z += "            gridDataset.gridDblOpenTo = 2 // New Window Tab\xFE";
    z += "            gridDataset.gridDblOpenUrl = reportName:\"_editRecord\"\xFE";
    z += "            gridDataset.passDblThruParams = False\xFE";
    z += "            gridDataset.addDblFromUrl = False\xFE";
    z += "            WriteJson gridDataset On fHandle('dict', 'dbBuilderReports'), reportName:\"_Grid.view\" Else stop @errors\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        Print \"Building edit page\"; @Server.Flush\xFE";
    z += "        \xFE";
    z += "        ReadJson oldView From fHandle('dict', 'dbBuilderReports'), reportName:\"_editRecord.view\" Else oldView = {}\xFE";
    z += "        \xFE";
    z += "        If !newPage(projectName, Prefix, reportName:\"_editRecord\", editColumns, editInputs, [] /* Outputs */, \"Form\", tblID_Or_SQL, visibleColumns, \"\" /* devXGridLayout */) Then Return False\xFE";
    z += "    \xFE";
    z += "        ReadJson newView From fHandle('dict', 'dbBuilderReports'), reportName:\"_editRecord.view\" Else Return False\xFE";
    z += "    \xFE";
    z += "        if oldView.columns then\xFE";
    z += "            // any column defs in oldView stay the same\xFE";
    z += "            newColumnNames = []\xFE";
    z += "            for each column in newView.columns\xFE";
    z += "                newColumnNames[-1] = column.name\xFE";
    z += "            next\xFE";
    z += "            \xFE";
    z += "            newColumns = []\xFE";
    z += "            gotit = []\xFE";
    z += "            for each column in oldView.columns\xFE";
    z += "                cname = column.name\xFE";
    z += "                locate cname in newColumnNames then\xFE";
    z += "                    newColumns[-1] = column\xFE";
    z += "                    gotit[-1] = cname\xFE";
    z += "                end if\xFE";
    z += "            Next\xFE";
    z += "            \xFE";
    z += "            for each column in newView.columns\xFE";
    z += "                cname = column.name\xFE";
    z += "                locate cname in gotit else newColumns[-1] = column\xFE";
    z += "            Next\xFE";
    z += "            \xFE";
    z += "            \xFE";
    z += "            oldView.columns = newColumns\xFE";
    z += "            WriteJson oldView On fHandle('dict', 'dbBuilderReports'), reportName:\"_editRecord.view\" Else stop @errors\xFE";
    z += "        else\xFE";
    z += "            for each btn in newView.custombtns\xFE";
    z += "                if btn.url then\xFE";
    z += "                    btn.opento = 16\xFE";
    z += "                    btn.url = \"\"\xFE";
    z += "                end if\xFE";
    z += "            next\xFE";
    z += "\xFE";
    z += "            WriteJson newView On fHandle('dict', 'dbBuilderReports'), reportName:\"_editRecord.view\" Else stop @errors\xFE";
    z += "        end if\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    reportName = @DropIfRight(reportName, \".page\", True)\xFE";
    z += "    Url = @jsbRootAccount():@UrlEncode(reportName):\"?tabID=\":@UrlEncode(tabID)\xFE";
    z += "    \xFE";
    z += "    If tabID Then\xFE";
    z += "        tabTitle = Mid(reportName, Len(Prefix) + 1)\xFE";
    z += "        \xFE";
    z += "        Print @(-1):@Script(`\xFE";
    z += "            if (window.parent.reloadDbTree) {\xFE";
    z += "                window.parent.reloadDbTree();\xFE";
    z += "                \xFE";
    z += "                if (true || isMobile()) {\xFE";
    z += "                    window.parent.openInTab(\"`:tabID:`\", `:jsEscapeString(reportName):`, `:jsEscapeString(tabTitle):`, `:jsEscapeString(Url):`);\xFE";
    z += "                    var tabID = dropLeft(window.frameElement.id, \"_\");\xFE";
    z += "                    window.parent.$('a[href=\"#tab_`:tabID:`\"]').click()\xFE";
    z += "                } else {\xFE";
    z += "                    windowOpen(`:jsEscapeString(Url):`, '_blank');\xFE";
    z += "                }\xFE";
    z += "                \xFE";
    z += "                window.parent.$(\"#tabli_\" + tabID).remove();\xFE";
    z += "                window.parent.$(\"#tab_\" + tabID).remove();\xFE";
    z += "                window.close();\xFE";
    z += "            }\xFE";
    z += "        `):\xFE";
    z += "        @Server.flush\xFE";
    z += "        @Server.End\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Return True\xFE";
    z += "End function"
    window.cached_jsb_mdl["makenewreport"] = z;
    window.cached_jsb_mdl["mdlgetreffields"] = "restful function mdlGetRefFields(databaseName, tableName, arg)\xFE    * %options aspxC-\xFE    \xFE    preventTimeOut = System(56)\xFE    \xFE    Attachdb \"\" Else Null\xFE\xFE    If !@isManager Then return { err: \"You must be at least a data manager to use this command.\" }    \xFE    If !databaseName Then return { err: \"A databaseName is a required URL parameter\" }\xFE    If !arg Then return { err: \"A arg value is a required URL parameter\" }\xFE    \xFE    If !@Jsb_odb.AttachDBextended(databaseName) Then Return False\xFE    \xFE    tblDefs = @getTableColumnDefs(arg, false, false)\xFE    columns = [\"\"]\xFE    For Each Column In tblDefs\xFE        columns[-1] = Column.name\xFE    Next\xFE    Return { results: columns }\xFEend function";
    var z = "* Resolve reference list\xFE";
    z += "Function mdlGetRefValues(ProjectName, Column, CRow)\xFE";
    z += "    RefFile = Replace(Column.reffile, \"{projectname}\", ProjectName)\xFE";
    z += "    \xFE";
    z += "    If Column.reflist Then\xFE";
    z += "        Values = makeArray(Column.reflist)\xFE";
    z += "\xFE";
    z += "    End Else If RefFile <> \"\" Then\xFE";
    z += "        If Left(RefFile, 2) = \"{!\" Then\xFE";
    z += "            // Table Columns\xFE";
    z += "            FromColumn = Field(Mid(RefFile, 3), \"}\", 1)\xFE";
    z += "            TableName = CRow[FromColumn]\xFE";
    z += "            Values = []\xFE";
    z += "            If TableName <> \"\" Then\xFE";
    z += "                Columns = @getTableColumnDefs(TableName, False, True)\xFE";
    z += "                For Each C In Columns\xFE";
    z += "                    Values[-1] = C.name\xFE";
    z += "                Next\xFE";
    z += "                Values = @Sort(Values)\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "        ElseIf LCase(RefFile) = \"{forms}\"  Or LCase(RefFile) = \"{views}\" Then\xFE";
    z += "        \xFE";
    z += "            Open \"dict\", ProjectName To F Then\xFE";
    z += "                Select F To Y Where \"ItemId Like '%.view'\" Then\xFE";
    z += "                    Values = @Sort(GetList(Y))\xFE";
    z += "                Else\xFE";
    z += "                    Values = ['unable to select file ':ProjectName:\" \":\"Modeler-\":System(28):\": \":@Errors]\xFE";
    z += "                End If\xFE";
    z += "            Else\xFE";
    z += "                Values = ['unable to open file ':ProjectName:\" \":\"Modeler-\":System(28):\": \":@Errors]\xFE";
    z += "            End If\xFE";
    z += "        Else\xFE";
    z += "            Values = @BF.getRefValuesBySelect(RefFile, Column.refpk, Column.refdisplay, Column.refwhere, Column.align = \"right\", Column.oktocache)\xFE";
    z += "        End If\xFE";
    z += "    Else\xFE";
    z += "        Values = ['Your reffile or reflist is not setup correctly']\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Return Values\xFE";
    z += "End Function"
    window.cached_jsb_mdl["mdlgetrefvalues"] = z;
    var z = "*   datatype:     guid, autointeger, integer, double, boolean, string, date, time, datetime, currency, blob, png, jpg, url, phone, memo, password, jsonarray - defaults to string\xFE";
    z += "**  control:      see ctls file: (defaults to textbox)\xFE";
    z += "**                textbox, dropDownBox, combobox, listbox, autotextbox, datebox, timebox, datetimebox, imagebox, currencybox\xFE";
    z += "**                maskedtextbox, radiobox, multiselectlistbox, multiselectdropDownBox, colorpick, slider\xFE";
    z += "**                htmlbox, label, imagebox, uploadimagebox, appendbox, passwordbox\xFE";
    z += "*\xFE";
    z += "\xFE";
    z += "Sub mdlSessionSetup(ProjectName, pageName, ViewName, viewDataSet)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    sqlColumns = possibleInputColumns(projectName, pageName, viewName)\xFE";
    z += "    @Session.sqlColumns = sqlColumns\xFE";
    z += "    \xFE";
    z += "    viewColumns = viewDataSet.columns\xFE";
    z += "    @Session.viewColumns = viewColumns\xFE";
    z += "    \xFE";
    z += "    For Each Column In viewColumns\xFE";
    z += "        CName = Column.name\xFE";
    z += "        foundIt = False\xFE";
    z += "        For Each SubC In sqlColumns\xFE";
    z += "            If SubC.name = CName Then\xFE";
    z += "                foundIt = True\xFE";
    z += "                Break\xFE";
    z += "            End If\xFE";
    z += "        Next\xFE";
    z += "        If !foundIt Then @Session.sqlColumns[-1] = Column\xFE";
    z += "    Next\xFE";
    z += "End Sub"
    window.cached_jsb_mdl["mdlsessionsetup"] = z;
    window.cached_jsb_mdl["modeler"] = "Sub Modeler";
    window.cached_jsb_mdl["modelforallcolumns"] = "Function modelForAllColumns()\xFE    * %options aspxC-\xFE    \xFE    allColumns = []\xFE    Model = @modelForTableColumns()\xFE    ViewModel = @modelForViewColumns\xFE\xFE    allColumns = Model.columns\xFE    For Each Column In ViewModel.columns\xFE        allColumns[-1] = Column\xFE    Next\xFE    allColumns = Sort(allColumns, `#index`)\xFE    Model.columns = allColumns\xFE    Return Model\xFEEnd Function";
    var z = "Function modelForPage(projectName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    defaultTheme = @Session.defaultTheme\xFE";
    z += "    if !defaultTheme Then\xFE";
    z += "        defaultTheme = \"theme_none\"\xFE";
    z += "        Open projectName To F Then Read menuPage From F, \"menu.page\" Then defaultTheme = menuPage.theme\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Columns = [\xFE";
    z += "        {name:'templateName', defaultvalue:\"simplePage\", index:1, label:'Template', datatype: 'string', width:90, control:'dropDownBox', required: false, notblank: false, autopostback: true, canedit:true, reffile:\"JSB_pageTemplates\", refpk:\"ItemID\", refwhere:\"ItemID >= 'a'\"  },\xFE";
    z += "        {name:'theme', defaultvalue:defaultTheme, index:2, label:'theme', width:18, control:'dropDownBox', canedit:true, required: false, notblank: false, reffile:\"jsb_themes\", refpk:\"ItemID\"},\xFE";
    z += "        { index: 3 },\xFE";
    z += "        \xFE";
    z += "        {name:'minimumRole', label:'minimum Role', defaultvalue:\"employee\", index:4,  width:18, control:'dropdownbox', canedit:true, required: false, notblank: false, reflist:\"Admin;Director;Manager;Clerk;Employee;User;Anonymous\" },\xFE";
    z += "        {name:'menucategory', defaultvalue:\"\", index:5, label:'Category', width:18, control:'comboBox', canedit:true, required: false, notblank: false, reffile:\"dict {projectname}\", refpk:\"menucategory\", refwhere:\"ItemID Like '%.page'\" } ,\xFE";
    z += "        {name:'menuitem', index:6, label:'Menu Item', width:18, control:'textbox', canedit:true, required: false, notblank: false } ,\xFE";
    z += "        {name:'glyphicon', label:'glyphicon', defaultvalue:\"\", index:4,  width:18, control:'dropdownbox', canedit:true, required: false, notblank: false, addBlank: true, reflist:\"asterisk,plus,minus,eur,euro,cloud,envelope,pencil,glass,music,search,heart,star,star-empty,user,film,th-large,th,th-list,ok,remove,zoom-in,zoom-out,off,signal,cog,trash,home,file,time,road,download-alt,download,upload,inbox,play-circle,repeat,refresh,list-alt,lock,flag,headphones,volume-off,volume-down,volume-up,qrcode,barcode,tag,tags,book,bookmark,print,camera,font,bold,italic,text-height,text-width,align-left,align-center,align-right,align-justify,list,indent-left,indent-right,facetime-video,picture,map-marker,adjust,tint,edit,share,check,move,step-backward,fast-backward,backward,play,pause,stop,forward,fast-forward,step-forward,eject,chevron-left,chevron-right,plus-sign,minus-sign,remove-sign,ok-sign,question-sign,info-sign,screenshot,remove-circle,ok-circle,ban-circle,arrow-left,arrow-right,arrow-up,arrow-down,share-alt,resize-full,resize-small,exclamation-sign,gift,leaf,fire,eye-open,eye-close,warning-sign,plane,calendar,random,comment,magnet,chevron-up,chevron-down,retweet,shopping-cart,folder-close,folder-open,resize-vertical,resize-horizontal,hdd,bullhorn,bell,certificate,thumbs-up,thumbs-down,hand-right,hand-left,hand-up,hand-down,circle-arrow-right,circle-arrow-left,circle-arrow-up,circle-arrow-down,globe,wrench,tasks,filter,briefcase,fullscreen,dashboard,paperclip,heart-empty,link,phone,pushpin,usd,gbp,sort,sort-by-alphabet,sort-by-alphabet-alt,sort-by-order,sort-by-order-alt,sort-by-attributes,sort-by-attributes-altunchecked,expand,collapse-down,collapse-up,log-in,flash,log-out,new-window,record,save,open,saved,import,export,send,floppy-disk,floppy-saved,floppy-remove,floppy-save,floppy-open,credit-card,transfer,cutlery,header,compressed,earphone,phone-alt,tower,stats,sd-video,hd-video,subtitles,sound-stereo,sound-dolby,sound-5-1,sound-6-1,sound-7-1,copyright-mark,registration-mark,cloud-download,cloud-upload,tree-conifer,tree-deciduous,cd,save-file,open-file,level-up,copy,paste,alert,equalizer,king,queen,pawn,bishop,knight,baby-formula,tent,blackboard,bed,apple,erase,hourglass,lamp,duplicate,piggy-bank,scissors,bitcoin,yen,ruble,scale,ice-lolly,ice-lolly-tasted,education,option-horizontal,option-vertical,menu-hamburger,modal-window,oil,grain,sunglasses,text-size,text-color,text-background,object-align-top,object-align-bottom,object-align-horizontal,object-align-left,object-align-vertical,object-align-right,triangle-right,triangle-left,triangle-bottom,triangle-top,console,superscript,subscript,menu-left,menu-right,menu-down,menu-up\"},\xFE";
    z += "        {name:'iconurl', label:'icon url', defaultvalue:\"\", index:4,  width:18, control:'textbox', canedit:true, required: false, notblank: false },\xFE";
    z += "        \xFE";
    z += "        {name:'pickpage', index:9, label:'Is Pick Page', width:\"12em\", control:'checkbox', canedit:true, required: false, notblank: true, defaultvalue:\"0\", reflist: \"false,0;true,1\" },\xFE";
    z += "        \xFE";
    z += "        { index: 10 }\xFE";
    z += "    ]\xFE";
    z += "\xFE";
    z += "    Model = {}\xFE";
    z += "    Model.columns = Columns\xFE";
    z += "    Return Model\xFE";
    z += "End Function"
    window.cached_jsb_mdl["modelforpage"] = z;
    window.cached_jsb_mdl["modelfortablecolumns"] = "Function modelForTableColumns()\xFE    * %options aspxC-\xFE    \xFE    Columns = @tableColumns\xFE    Model = {}\xFE    Model.columns = Columns\xFE    Return Model\xFEEnd Function";
    window.cached_jsb_mdl["modelforview"] = "function modelForView()\xFE    Columns = [\xFE    {name:'templateName', defaultvalue:\"Form\", index:1, label:'Template', datatype: 'string', width:90, control:'dropDownBox', required: false, notblank: false, autopostback: true, canedit:true, reffile:\"JSB_viewTemplates\", refpk:\"ItemID\", refwhere:\"ItemID >= 'a'\" }   ]\xFE    Model = {}\xFE    Model.columns = Columns\xFE    Return Model\xFEEnd function";
    window.cached_jsb_mdl["modelforviewcolumns"] = "Function modelForViewColumns()\xFE    * %options aspxC-\xFE    \xFE    Model = {}\xFE    Model.columns = @viewCOlumns\xFE    Return Model\xFEEnd Function";
    var z = "* pageType: \"Menu\", \"Editable Grid\", \"Readonly Grid\", \"Search Form\", \"Report\", \"Form > Grid\", \"Grid > Form\", \"Report(Grid)\", \"Report(Pivot)\", \"pivot\"\xFE";
    z += "*           \"Report(Pivot Setup)\", \"pivotSetup\", \"Chart\", \"HTML\", \"HtmlBlock\", viewPages...\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "function newPage(byval ProjectName As String, ByVal pageNamePrefix As String, ByRef pageName As String, ByVal predefinedColumns As Array, ByVal predefinedInputs As Array, ByVal predefinedOutputs As Array, ByRef pageType As String, ByRef tblID_Or_SQL, Optional ByVal visibleColumns, Optional ByVal devXGridLayout)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    pageName = @DropIfRight(pageName, \".page\", True)\xFE";
    z += "    open \"dict\", ProjectName to fDictProject else Return Null\xFE";
    z += "    isSelect = lcase(left(tblID_Or_SQL, 7)) = \"select \"\xFE";
    z += "    \xFE";
    z += "    If InStrI(pageType, \"Report\") Then Desc = \"report\" else Desc = \"page\"\xFE";
    z += "    Title = \"Create a new \":Desc\xFE";
    z += "    if pageName = \"\" Then\xFE";
    z += "        if !Instr(tblID_Or_SQL, ' ') and Desc = \"report\" then \xFE";
    z += "            suggestedName = NiceName(tblID_Or_SQL:\" Report\")\xFE";
    z += "        end if\xFE";
    z += "            \xFE";
    z += "        Loop While True Do\xFE";
    z += "            Caption = \"New \":Desc:\" name?\"\xFE";
    z += "            pageName = Trim(@InputBox(Title, Caption, suggestedName, \"80%\", \"\"))\xFE";
    z += "            pageName = @DropIfRight(pageName, \".page\", True)\xFE";
    z += "            \xFE";
    z += "            If pageName = Chr(27) Or pageName = \"\" Then pageName = \"\"; Return Null\xFE";
    z += "            pageName = NiceName(pageName)\xFE";
    z += "            ReadJson pageDataSet From fDictProject, pageNamePrefix:pageName:\".page\" Else Break\xFE";
    z += "            Ans = MsgBox(\"Warning\", \"The \":Desc:\" \":pageName:\" already exists. OverWrite?\", \"Yes,*No\")\xFE";
    z += "            if Ans = \"\" Or Ans = Chr(27) Then Return Null\xFE";
    z += "            if Ans = \"Yes\" Then Break\xFE";
    z += "            suggestedName = \"\"\xFE";
    z += "        Repeat\xFE";
    z += "        \xFE";
    z += "        pageName = pageNamePrefix:pageName\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    pageModel = @modelForPage(ProjectName)\xFE";
    z += "    \xFE";
    z += "    If pageType Then\xFE";
    z += "        useType = pageType\xFE";
    z += "    Else\xFE";
    z += "        StdTypes = Split(\"Menu,Editable Grid,Readonly Grid,Form,Search Form,Form > Grid,Grid > Form,Chart,HTML\", \",\")\xFE";
    z += "        \xFE";
    z += "        xtraTypes = Fselect('vt', 'ItemID > \"1\"') // Chart?Form?Grid?HtmlBlock?NoCrud_Form?pivot?pivotSetup?tree\xFE";
    z += "        For Each Xtype In xtraTypes\xFE";
    z += "            Locate LCase(Xtype) In LCase(StdTypes) Else StdTypes[-1] = Xtype\xFE";
    z += "        Next\xFE";
    z += "        \xFE";
    z += "        useType = @Jsb_bf.InputListBox(\"Page Type\", \"What type of page?\", StdTypes, \"Form\", \"80%\", \"\") ;* ,Report(Grid),Report(Pivot)\xFE";
    z += "        If useType = Chr(27) Or useType = \"\" Then pageName = \"\"; Return Null\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Select Case useType\xFE";
    z += "        Case \"Menu\"\xFE";
    z += "            pageType = \"simplePage\"\xFE";
    z += "            viewType = \"NoCrud_Form\"\xFE";
    z += "            \xFE";
    z += "        Case \"Editable Grid\", \"Readonly Grid\"\xFE";
    z += "            pageType = \"simplePage\"\xFE";
    z += "            viewType = \"Grid\"\xFE";
    z += "            \xFE";
    z += "        Case \"Search Form\", \"Report\"\xFE";
    z += "            pageType = \"simplePage\"\xFE";
    z += "            viewType = \"NoCrud_Form\"\xFE";
    z += "            \xFE";
    z += "        Case \"Form > Grid\"\xFE";
    z += "            pageType = \"twoViews\"\xFE";
    z += "            viewType = \"Form,Grid\"\xFE";
    z += "            \xFE";
    z += "        Case \"Grid > Form\"\xFE";
    z += "            pageType = \"twoViews\"\xFE";
    z += "            viewType = \"Grid,Form\"\xFE";
    z += "            \xFE";
    z += "        Case \"Report(Grid)\"\xFE";
    z += "            pageType = \"simplePage\"\xFE";
    z += "            viewType = \"Grid\"\xFE";
    z += "            \xFE";
    z += "        Case \"Report(Pivot)\", \"pivot\"\xFE";
    z += "            pageType = \"simplePage\"\xFE";
    z += "            viewType = \"Pivot\"\xFE";
    z += "            useType = \"Report(Pivot)\"\xFE";
    z += "            \xFE";
    z += "        Case \"Report(Pivot Setup)\", \"pivotSetup\"\xFE";
    z += "            pageType = \"simplePage\"\xFE";
    z += "            viewType = \"PivotSetup\"\xFE";
    z += "            useType = \"Report(Pivot Setup)\"\xFE";
    z += "            \xFE";
    z += "        Case \"Chart\"\xFE";
    z += "            pageType = \"simplePage\"\xFE";
    z += "            viewType = \"Chart\"\xFE";
    z += "            \xFE";
    z += "        Case \"HTML\", \"HtmlBlock\"\xFE";
    z += "            pageType = \"simplePage\"\xFE";
    z += "            viewType = \"HTMLBlock\"\xFE";
    z += "            \xFE";
    z += "        Case Else\xFE";
    z += "            pageType = \"simplePage\"\xFE";
    z += "            viewType = useType\xFE";
    z += "    End Select\xFE";
    z += "    \xFE";
    z += "    Call getExtraPageColumns(pageModel.columns, pageType)\xFE";
    z += "\xFE";
    z += "    * Create the page from the meta data (pageModel)\xFE";
    z += "    pageDataSet = @newRow(pageName, pageModel.columns)\xFE";
    z += "\xFE";
    z += "    pageDataSet.templateName = pageType\xFE";
    z += "    pageDataSet.menuitem = pageName\xFE";
    z += "    pageDataSet.minimumRole = \"employee\"\xFE";
    z += "    \xFE";
    z += "    // Setup Master view for two views\xFE";
    z += "    If LCase(pageType) = \"twoviews\" Then\xFE";
    z += "        ViewName = pageName:\"_Master.view\"\xFE";
    z += "        pageDataSet.westview = ViewName\xFE";
    z += "        masterViewDataSet = @createNewView(ViewName)\xFE";
    z += "        masterViewDataSet.templateName = DropIfRight(viewType, \",\")\xFE";
    z += "        \xFE";
    z += "        tableName = pickAtable(\"\", \"Pick your \":DropIfRight(viewType, \",\"):\" Table\")\xFE";
    z += "        If !tableName Then pageName = \"\"; Return Null\xFE";
    z += "        \xFE";
    z += "        masterViewDataSet.attachdb = @account\xFE";
    z += "        masterViewDataSet.tableName = tableName\xFE";
    z += "        masterViewDataSet.newRecord = False\xFE";
    z += "        masterViewDataSet.allowNewRecord = False\xFE";
    z += "        masterViewDataSet.allowupdates = False\xFE";
    z += "        masterViewDataSet.allowdeletes = False\xFE";
    z += "        masterViewDataSet.allowinserts = False\xFE";
    z += "        masterViewDataSet.header = Mid(ViewName, Len(pageNamePrefix)+1)\xFE";
    z += "        \xFE";
    z += "        ' pick columns\xFE";
    z += "        schemaColumns = @getTableColumnDefs(masterViewDataSet.tableName, True, True)\xFE";
    z += "        primaryKeyCol = getTablePrimaryKeyCol(schemaColumns)\xFE";
    z += "        primaryKeyName = primaryKeyCol.name\xFE";
    z += "\xFE";
    z += "        If !@ChooseColumns_ss(ProjectName, ViewName, masterViewDataSet, schemaColumns) Then pageName = \"\"; Return Null\xFE";
    z += "\xFE";
    z += "        GotPK = False\xFE";
    z += "        For Each Column In masterViewDataSet.columns\xFE";
    z += "            If Column.name = primaryKeyName Then GotPK = True; Break\xFE";
    z += "        Next\xFE";
    z += "        If !GotPK Then\xFE";
    z += "            newColumn = Clone(primaryKeyCol)\xFE";
    z += "            Call setColumnDefaults(newColumn.datatype, newColumn)\xFE";
    z += "            masterViewDataSet.columns[-1] = newColumn\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        ' Define master Outputs\xFE";
    z += "        masterViewDataSet.outputs = []\xFE";
    z += "        masterViewDataSet.outputs[-1] = { \"field\": primaryKeyName, \"name\": \"\", \"scope\": \"memoryVar\" }\xFE";
    z += "        \xFE";
    z += "        Call mdlSessionSetup(ProjectName, pageName, ViewName, masterViewDataSet)\xFE";
    z += "        Ans = @Popup_jsondef(ProjectName, \"jsb_jsondefs\", \"viewOutputs\", \"DEL\", \"Add Output Parameter\", masterViewDataSet.outputs, \"80%\", \"80%\", \"Outputs for view \":ViewName, True)\xFE";
    z += "        If !isArray(Ans) Then pageName = \"\"; Return Null\xFE";
    z += "        If Len(Ans) Then masterViewDataSet.outputs = Ans\xFE";
    z += "        \xFE";
    z += "        WriteJson masterViewDataSet On fDictProject, ViewName Else Stop @(-1):\"Edp-\":System(28):\": \":@Errors\xFE";
    z += "        \xFE";
    z += "        Title = \"Pick your \":DropIfLeft(viewType, \",\"):\" Table\"\xFE";
    z += "    Else\xFE";
    z += "        Title = \"Pick a table for your \":UseType:\" view\"\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    * Create a center view\xFE";
    z += "    ViewName = pageName:\".view\"\xFE";
    z += "    pageDataSet.centerview = ViewName\xFE";
    z += "    \xFE";
    z += "    viewDataSet = @createNewView(ViewName)\xFE";
    z += "    viewDataSet.templateName = DropIfLeft(viewType, \",\")\xFE";
    z += "    viewDataSet.attachdb = @account\xFE";
    z += "    viewDataSet.header = Mid(pageName, Len(pageNamePrefix)+1)\xFE";
    z += "    \xFE";
    z += "    If useType <> \"Menu\" Then\xFE";
    z += "        If !tblID_Or_SQL Then\xFE";
    z += "            tblID_Or_SQL = pickAtable(tblID_Or_SQL, Title)\xFE";
    z += "            If !tblID_Or_SQL Then\xFE";
    z += "                If LCase(pageType) = \"twoviews\" Then Delete fDictProject, ViewName Else If @Errors Then Alert(@Errors)\xFE";
    z += "                pageName = \"\"; Return Null\xFE";
    z += "            End If\xFE";
    z += "            viewDataSet.tableName = tblID_Or_SQL\xFE";
    z += "\xFE";
    z += "        ElseIf isSelect Then\xFE";
    z += "            viewDataSet.customsql = tblID_Or_SQL\xFE";
    z += "\xFE";
    z += "        Else\xFE";
    z += "            viewDataSet.tableName = tblID_Or_SQL\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    viewDataSet.newRecord = False\xFE";
    z += "    viewDataSet.allowNewRecord = False\xFE";
    z += "    viewDataSet.allowupdates = False\xFE";
    z += "    viewDataSet.allowdeletes = False\xFE";
    z += "    viewDataSet.allowinserts = False\xFE";
    z += "    viewDataSet.usedevx = true\xFE";
    z += "    viewDataSet.custombtns = []\xFE";
    z += "    if predefinedColumns Then viewDataSet.columns = predefinedColumns Else viewDataSet.columns = []\xFE";
    z += "    if predefinedInputs Then viewDataSet.inputs = predefinedInputs Else viewDataSet.inputs = []\xFE";
    z += "    if predefinedOutputs Then viewDataSet.outputs = predefinedOutputs Else viewDataSet.outputs = []\xFE";
    z += "    \xFE";
    z += "    if UseType = \"Report(Grid)\" Then\xFE";
    z += "        viewDataSet.devXGridLayout = devXGridLayout\xFE";
    z += "        viewDataSet.visibleColumns = visibleColumns\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    // Get the schemaColumns\xFE";
    z += "    if isSelect Then\xFE";
    z += "        schemaColumns = @getSelectColumnDefs(tblID_Or_SQL)\xFE";
    z += "    Else\xFE";
    z += "        schemaColumns = @getTableColumnDefs(tblID_Or_SQL, False, False)\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    ' Get defined table columns\xFE";
    z += "    primaryKeyCol = getTablePrimaryKeyCol(schemaColumns)\xFE";
    z += "    primaryKeyName = primaryKeyCol.name\xFE";
    z += "\xFE";
    z += "    // Does user need to pick columns?\xFE";
    z += "    if !predefinedColumns Then\xFE";
    z += "        viewDataSet.columns = []\xFE";
    z += "        For Each newColumn In schemaColumns\xFE";
    z += "            Call setColumnDefaults(newColumn.datatype, newColumn)\xFE";
    z += "            viewDataSet.columns[-1] = newColumn\xFE";
    z += "        Next\xFE";
    z += "\xFE";
    z += "        if UseType = \"Report(Grid)\" Then\xFE";
    z += "            D = \"Pick columns that should be on the columnar report (grid view)\"\xFE";
    z += "            \xFE";
    z += "        Else if UseType = \"Report(Pivot)\" Then\xFE";
    z += "            D = \"Pick columns that should be enabled on PIVOT setup (for avg, sum, etc..)\"\xFE";
    z += "        \xFE";
    z += "        Else if UseType = \"Report\" Then\xFE";
    z += "            D = \"Pick columns that should be on the report's search form\" \xFE";
    z += "        else \xFE";
    z += "            D = \"Pick columns to place on the \":UseType\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        If !@ChooseColumns_ss(ProjectName, ViewName, viewDataSet, schemaColumns, D) Then pageName = \"\"; Return Null\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    pickInputs = LCase(pageType) = \"twoviews\" And !predefinedInputs\xFE";
    z += "    pickOutputs = False\xFE";
    z += "    pickGridURL = False\xFE";
    z += "    \xFE";
    z += "    // Insure primary key there if twoviews\xFE";
    z += "    If LCase(pageType) = \"twoviews\" And primaryKeyName Then\xFE";
    z += "        GotPK = False\xFE";
    z += "        For Each Column In viewDataSet.columns\xFE";
    z += "            If Column.name = primaryKeyName Then GotPK = True; Break\xFE";
    z += "        Next\xFE";
    z += "        If !GotPK Then\xFE";
    z += "            newColumn = Clone(primaryKeyCol)\xFE";
    z += "            Call setColumnDefaults(newColumn.datatype, newColumn)\xFE";
    z += "            viewDataSet.columns[-1] = newColumn\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    nicePageName = NiceName(pageName)\xFE";
    z += "    ourURL = nicePageName:'.page'\xFE";
    z += "    Select Case useType\xFE";
    z += "        Case \"Menu\"\xFE";
    z += "            * toType is \"Reset Form\",\"Search Form\",\"ReadOnly Form\", or \"Menu Form\"\xFE";
    z += "            if !predefinedColumns Then Call doWizard(ViewName, viewDataSet, \"Menu Form\")\xFE";
    z += "\xFE";
    z += "        Case \"Editable Grid\"\xFE";
    z += "            pickInputs = !predefinedInputs\xFE";
    z += "            \xFE";
    z += "            viewDataSet.allowupdates = True\xFE";
    z += "            viewDataSet.allowdeletes = True\xFE";
    z += "            viewDataSet.allowinserts = True\xFE";
    z += "            \xFE";
    z += "            // update btn\xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Save\", opento: 10, url: ourURL, verifyform: true, saveform: true, deleteform: false, confirmop:'0', addoutputs: true, addfrompage: false, showwhen: 1, addnewrec: false, parentmayhide: true };\xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Cancel\", opento: 10, url: ourURL, verifyform: false, saveform: false, deleteform: false, confirmop: 2, addoutputs: false, addfrompage: false, showwhen: 0, addnewrec: false, parentmayhide: false };\xFE";
    z += "\xFE";
    z += "        Case \"Readonly Grid\"\xFE";
    z += "            pickInputs = !predefinedInputs\xFE";
    z += "            pickOutputs = !predefinedOutputs\xFE";
    z += "            pickGridURL = True\xFE";
    z += "            \xFE";
    z += "        Case \"Form\"\xFE";
    z += "            pickInputs = !predefinedInputs\xFE";
    z += "            \xFE";
    z += "            viewDataSet.allowNewRecord = True\xFE";
    z += "            viewDataSet.allowupdates = True\xFE";
    z += "            viewDataSet.allowdeletes = True\xFE";
    z += "            viewDataSet.allowinserts = True\xFE";
    z += "            \xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Save\", opento: 10,  url: ourURL, verifyform: true, saveform: true, deleteform: false, confirmop: 0, addoutputs: true, addfrompage: false, showwhen: 1, addnewrec: false, parentmayhide: true };\xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Update\", opento: 10, url: ourURL, verifyform: true, saveform: true, deleteform: false, confirmop: 0, addoutputs: true, addfrompage: false, showwhen: 2, addnewrec: false, parentmayhide: true };\xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Delete\", opento: 10,  url: ourURL, verifyform: false, saveform: false, deleteform: true, confirmop: 1, addoutputs: false, addfrompage: false, showwhen: 2, addnewrec: false, parentmayhide: true };\xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Cancel\", opento: 10,  url: ourURL, verifyform: false, saveform: false, deleteform: false, confirmop: 2, addoutputs: false, addfrompage: false, showwhen: 0, addnewrec: false, parentmayhide: false };\xFE";
    z += "\xFE";
    z += "        Case \"Form > Grid\"\xFE";
    z += "            viewDataSet.allowupdates = True\xFE";
    z += "            viewDataSet.allowdeletes = True\xFE";
    z += "            viewDataSet.allowinserts = True\xFE";
    z += "            \xFE";
    z += "            ' Define slave Inputs\xFE";
    z += "            if !predefinedInputs Then\xFE";
    z += "                viewDataSet.inputs = []\xFE";
    z += "                If primaryKeyName Then\xFE";
    z += "                    viewDataSet.inputs[-1] = { \"and\": true, \"field\": primaryKeyName, \"name\": null, \"scope\": \"memoryVar\", \"datatype\": \"string\", \"operator\": \"=\", \"required\": false, defaultvalue: \"\" }\xFE";
    z += "                End If\xFE";
    z += "            End If\xFE";
    z += "            \xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Cancel\", opento: 10, url: ourURL, verifyform: false, saveform: false, deleteform: false, confirmop: 2, addoutputs: false, addfrompage: false, showwhen: 0, addnewrec: false, parentmayhide: false };\xFE";
    z += "            \xFE";
    z += "            viewDataSet.allowNewRecord = True\xFE";
    z += "\xFE";
    z += "        Case \"Grid > Form\"\xFE";
    z += "            viewDataSet.allowupdates = True\xFE";
    z += "            viewDataSet.allowdeletes = True\xFE";
    z += "            viewDataSet.allowinserts = True\xFE";
    z += "\xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Save\", opento: 10, url: ourURL, verifyform: true, saveform: true, deleteform: false, confirmop: 0, addoutputs: true, addfrompage: false, showwhen: 1, addnewrec: false, parentmayhide: true };\xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Update\", opento: 10, url: ourURL, verifyform: true, saveform: true, deleteform: false, confirmop: 0, addoutputs: true, addfrompage: false, showwhen: 2, addnewrec: false, parentmayhide: true };\xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Delete\", opento: 10, url: ourURL, verifyform: false, saveform: false, deleteform: true, confirmop: 1, addoutputs: false, addfrompage: false, showwhen: 2, addnewrec: false, parentmayhide: true };\xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Cancel\", opento: 10, url: ourURL, verifyform: false, saveform: false, deleteform: false, confirmop: 2, addoutputs: false, addfrompage: false, showwhen: 0, addnewrec: false, parentmayhide: false };\xFE";
    z += "            \xFE";
    z += "            ' Define slave Inputs\xFE";
    z += "            if !predefinedInputs Then\xFE";
    z += "                viewDataSet.inputs = []\xFE";
    z += "                If primaryKeyName Then\xFE";
    z += "                    viewDataSet.inputs[-1] = { \"and\": true, \"field\": primaryKeyName, \"name\": null, \"scope\": \"memoryVar\", \"datatype\": \"string\", \"operator\": \"=\", \"required\": false, defaultvalue: \"\" }\xFE";
    z += "                End If\xFE";
    z += "            End If\xFE";
    z += "            \xFE";
    z += "            viewDataSet.allowNewRecord = True\xFE";
    z += "            \xFE";
    z += "        Case \"Search Form\", \"Report\"\xFE";
    z += "            * toType is \"Reset Form\",\"Search Form\",\"ReadOnly Form\", or \"Menu Form\"\xFE";
    z += "            if !predefinedColumns Then Call doWizard(ViewName, viewDataSet, \"Search Form\")\xFE";
    z += "            \xFE";
    z += "            ' Pick URL to goto for click and dblClick\xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Query\", opento: 10, url: niceName(pageName):\"_grid\", verifyform: true, addoutputs: true };\xFE";
    z += "            \xFE";
    z += "            if @isAdmin Then\xFE";
    z += "                viewDataSet.custombtns[-1] = { buttontxt:\"Pivot\", opento: 10, url: niceName(pageName):\"_pivotsetup\", verifyform: true, addoutputs: true };\xFE";
    z += "            End If\xFE";
    z += "            \xFE";
    z += "            // Every column we put on the seach form is an output automatically\xFE";
    z += "            if !predefinedOutputs Then\xFE";
    z += "                searchOutputs = []\xFE";
    z += "                for each Column in viewDataSet.columns\xFE";
    z += "                     CName = Column.name\xFE";
    z += "                     if Column.name <> Column.label And Column.label <> \"\" Then label = Column.label Else label = \"\"\xFE";
    z += "                     searchOutputs[-1] = { \"field\": Column.name, \"name\": label, \"scope\": \"UrlParam\" }\xFE";
    z += "                next\xFE";
    z += "                viewDataSet.outputs = searchOutputs\xFE";
    z += "            end if\xFE";
    z += "            \xFE";
    z += "        Case \"Report(Grid)\"\xFE";
    z += "            // Every column we put on the seach form is an output automatically\xFE";
    z += "            basePageName = DropIfRight(pageName, '_') \xFE";
    z += "            viewDataSet.header = useType:\" Search Results for \":Mid(basePageName, Len(pageNamePrefix)+1)\xFE";
    z += "            \xFE";
    z += "            if Len(predefinedInputs) = 0 Then\xFE";
    z += "                predefinedInputs = []\xFE";
    z += "                for each Column in viewDataSet.columns\xFE";
    z += "                    // operator types: \"=;<>;>;<;<=;>=;Like ...%;Like %...;Like %...%;InList\"\xFE";
    z += "                    // datatypes:      \"string;number;boolean;date\"\xFE";
    z += "                    // Scope types:    \"UrlParam;SessionVar;ApplicationVar;ProfileVar;AppCode;memoryVar\"\xFE";
    z += "                    if Column.name <> Column.label And Column.label <> \"\" Then label = Column.label Else label = \"\"\xFE";
    z += "                    predefinedInputs[-1] = { \"and\": \"1\", lparen: False, field: Column.name, name: label, scope: 'UrlParam', datatype: column.datatype, operator: '=', required: False, rparen: False, defaultvalue: \"\" }\xFE";
    z += "                next\xFE";
    z += "            End If\xFE";
    z += "            \xFE";
    z += "            viewDataSet.inputs = predefinedInputs\xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Back\", opento: 10, url: NiceName(basePageName), confirmop: 2, passparams: true };\xFE";
    z += "            \xFE";
    z += "        ////// PIVOTS ///////\xFE";
    z += "        Case \"Report(Pivot Setup)\"\xFE";
    z += "            // Every column we put on the seach form is an output automatically\xFE";
    z += "            basePageName = DropIfRight(pageName, '_') \xFE";
    z += "            viewDataSet.header = useType:\" Pivot setup for \":Mid(basePageName, Len(pageNamePrefix)+1)\xFE";
    z += "            \xFE";
    z += "            if Len(predefinedInputs) = 0 Then\xFE";
    z += "                predefinedInputs = []\xFE";
    z += "                for each Column in viewDataSet.columns\xFE";
    z += "                    // operator types: \"=;<>;>;<;<=;>=;Like ...%;Like %...;Like %...%;InList\"\xFE";
    z += "                    // datatypes:      \"string;number;boolean;date\"\xFE";
    z += "                    // Scope types:    \"UrlParam;SessionVar;ApplicationVar;ProfileVar;AppCode;memoryVar\"\xFE";
    z += "                    if Column.name <> Column.label And Column.label <> \"\" Then label = Column.label Else label = \"\"\xFE";
    z += "                    predefinedInputs[-1] = { \"and\": \"1\", lparen: False, field: Column.name, name: label, scope: 'UrlParam', datatype: column.datatype, operator: '=', required: False, rparen: False, defaultvalue: \"\" }\xFE";
    z += "                next\xFE";
    z += "            End If\xFE";
    z += "            \xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Back\", opento: 10, url: NiceName(basePageName), confirmop: 2, passparams: true };\xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Requery Meta\", customcall: \"view_\":nicePageName:\"_ReQueryMeta\" };\xFE";
    z += "            \xFE";
    z += "            // Our search form parameters are already setup in the URL - so pass them through\xFE";
    z += "            // add a javascript call to saveRowsAndCols  (opento: 11:  pure javascript in containerName )\xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Next\", opento: 11, url: niceName(basePageName):\"_pivot\", onParentExtra:\"if (!saveRowsAndCols()) return false; \", customcall: \"view_\":nicePageName:\"_Next\", verifyform: true, passparams: true, addoutputs: true };\xFE";
    z += "            \xFE";
    z += "        Case \"Report(Pivot)\"\xFE";
    z += "            basePageName = DropIfRight(pageName, '_') \xFE";
    z += "            \xFE";
    z += "            // Every column we put on the seach form is an output automatically\xFE";
    z += "            viewDataSet.header = useType:\" Pivot Results for \":Mid(basePageName, Len(pageNamePrefix)+1)\xFE";
    z += "            \xFE";
    z += "            if Len(predefinedInputs) = 0 Then\xFE";
    z += "                predefinedInputs = []\xFE";
    z += "                for each Column in viewDataSet.columns\xFE";
    z += "                    // operator types: \"=;<>;>;<;<=;>=;Like ...%;Like %...;Like %...%;InList\"\xFE";
    z += "                    // datatypes:      \"string;number;boolean;date\"\xFE";
    z += "                    // Scope types:    \"UrlParam;SessionVar;ApplicationVar;ProfileVar;AppCode;memoryVar\"\xFE";
    z += "                    if Column.name <> Column.label And Column.label <> \"\" Then label = Column.label Else label = \"\"\xFE";
    z += "                    predefinedInputs[-1] = { \"and\": \"1\", lparen: False, field: Column.name, name: label, scope: 'UrlParam', datatype: column.datatype, operator: '=', required: False, rparen: False, defaultvalue: \"\" }\xFE";
    z += "                next\xFE";
    z += "            End If\xFE";
    z += "            \xFE";
    z += "            viewDataSet.inputs = predefinedInputs\xFE";
    z += "            viewDataSet.custombtns[-1] = { buttontxt:\"Back\", opento: 10, url: niceName(basePageName):\"_pivotsetup\", confirmop: 2, passparams: true };\xFE";
    z += "           \xFE";
    z += "        Case \"Chart\"\xFE";
    z += "            pickInputs = !predefinedInputs\xFE";
    z += "\xFE";
    z += "        Case \"HTML\"\xFE";
    z += "\xFE";
    z += "    End Select\xFE";
    z += "\xFE";
    z += "    If pickOutputs Then\xFE";
    z += "        Call mdlSessionSetup(ProjectName, pageName, ViewName, viewDataSet)\xFE";
    z += "        \xFE";
    z += "        Ans = @Popup_jsondef(ProjectName, \"jsb_jsondefs\", \"viewOutputs\", \"DEL\", \"Add Output Parameter\", viewDataSet.outputs, \"80%\", \"80%\", \"Outputs for view \":ViewName, True)\xFE";
    z += "        If !isArray(Ans) Then pageName = \"\"; Return Null\xFE";
    z += "        If Len(Ans) Then viewDataSet.outputs = Ans\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    If pickInputs Then\xFE";
    z += "        Call mdlSessionSetup(ProjectName, pageName, ViewName, viewDataSet)\xFE";
    z += "        Ans = @Popup_jsondef(ProjectName, \"jsb_jsondefs\", \"viewInputs\", \"DEL\", \"Add Input Parameter\", viewDataSet.inputs, \"80%\", \"80%\", \"Inputs for view \":ViewName, True)\xFE";
    z += "        If !isArray(Ans) Then pageName = \"\"; Return Null\xFE";
    z += "        If Len(Ans) Then viewDataSet.inputs = Ans\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    If pickGridURL Then\xFE";
    z += "        Ans = @Popup_jsondef(ProjectName, \"jsb_jsondefs\", \"gridPickUrl\", \"DEL\", \"Add\", [{}], \"80%\", \"80%\", \"Click & DblClick selections for view \":ViewName)\xFE";
    z += "        If !isArray(Ans) Then pageName = \"\"; Return Null\xFE";
    z += "        If Len(Ans) Then\xFE";
    z += "            Ans = Ans[LBound(Ans)]\xFE";
    z += "            viewDataSet.gridOpenTo = Ans.gridOpenTo\xFE";
    z += "            viewDataSet.gridOpenUrl = Ans.gridOpenUrl\xFE";
    z += "            viewDataSet.gridOpenExtra = Ans.gridOpenExtra\xFE";
    z += "            viewDataSet.passThruParams = Ans.passThruParams\xFE";
    z += "            viewDataSet.addFromUrl = Ans.addFromUrl\xFE";
    z += "            \xFE";
    z += "            viewDataSet.gridDblOpenTo = Ans.gridDblOpenTo\xFE";
    z += "            viewDataSet.gridDblOpenUrl = Ans.gridDblOpenUrl\xFE";
    z += "            viewDataSet.gridDblOpenExtra = Ans.gridDblOpenExtra\xFE";
    z += "            viewDataSet.passDblThruParams = Ans.passDblThruParams\xFE";
    z += "            viewDataSet.addDblFromUrl = Ans.addDblFromUrl\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    WriteJson viewDataSet On fDictProject, ViewName Else Stop @(-1):\"Edp-\":System(28):\": \":@Errors\xFE";
    z += "\xFE";
    z += "    WriteJson pageDataSet On fDictProject, pageName:\".page\" Else Stop @(-1):\"Edp-\":System(28):\": \":@Errors\xFE";
    z += "\xFE";
    z += "    Call ReGenPageModel(ProjectName, pageName, False)\xFE";
    z += "    \xFE";
    z += "    Return True\xFE";
    z += "End function"
    window.cached_jsb_mdl["newpage"] = z;
    window.cached_jsb_mdl["newrow"] = "Function newRow(objectName, Columns)\xFE    newRow = {}\xFE    @jsb_mdl.setDefaults(objectName, Columns, newRow)\xFE    Return newRow\xFEEnd Function";
    var z = "// updates the dataset on fHandle('dict', 'dbBuilderReports'), rptID\xFE";
    z += "\xFE";
    z += "function newSearchType(Byval ProjectName, ByVal dataBaseName, Byval tblID_Or_SQL, Optional Byval visibleColumns)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    if ProjectName Then \xFE";
    z += "        rptID = \"rptdef_\":niceName(ProjectName):\"_\":niceName(tblID_Or_SQL):\".rpt\"\xFE";
    z += "    Else\xFE";
    z += "        ProjectName = \"css\"\xFE";
    z += "        rptID = \"rptdef_\":niceName(dataBaseName):\"_\":niceName(tblID_Or_SQL):\".rpt\"\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Readjson priorDataSet From fHandle('dict', 'dbBuilderReports'), rptID Else priorDataSet = []\xFE";
    z += "    \xFE";
    z += "startOver:\xFE";
    z += "    searchTypeArray = []\xFE";
    z += "    searchTypeArray[-1] = \"an exact string match\"\xFE";
    z += "    searchTypeArray[-1] = \"partial string match\"\xFE";
    z += "    searchTypeArray[-1] = \"string starts with\"\xFE";
    z += "    searchTypeArray[-1] = \"string ends with\"\xFE";
    z += "    searchTypeArray[-1] = \"an exact numeric value\"\xFE";
    z += "    searchTypeArray[-1] = \"year range\"\xFE";
    z += "    searchTypeArray[-1] = \"an exact date\"\xFE";
    z += "    searchTypeArray[-1] = \"date range\"\xFE";
    z += "    searchTypeArray[-1] = \"time range\"\xFE";
    z += "    searchTypeArray[-1] = \"numeric range (inclusive)\"\xFE";
    z += "    searchTypeArray[-1] = \"numeric range (exclusive)\"\xFE";
    z += "    searchTypeArray[-1] = \"GUID\"\xFE";
    z += "    \xFE";
    z += "    searchTypeArray[-1] = \"dropdown (literal)\"\xFE";
    z += "    searchTypeArray[-1] = \"dropdown (ref-file)\"\xFE";
    z += "    searchTypeArray[-1] = \"dropdown (derived)\"\xFE";
    z += "    searchTypeArray[-1] = \"dropdown (derive now)\"\xFE";
    z += "    searchTypeArray[-1] = \"dropdown (Year(derived))\"\xFE";
    z += "    searchTypeArray[-1] = \"dropdown (Year(derive now))\"\xFE";
    z += "    \xFE";
    z += "    searchTypeArray[-1] = \"autocomplete (ref-file)\"\xFE";
    z += "    searchTypeArray[-1] = \"autocomplete (derived)\"\xFE";
    z += "    \xFE";
    z += "    \xFE";
    z += "    searchTypeArray[-1] = \"multi-select (literal)\"\xFE";
    z += "    searchTypeArray[-1] = \"multi-select (ref-file)\"\xFE";
    z += "    searchTypeArray[-1] = \"multi-select (derived)\"\xFE";
    z += "    searchTypeArray[-1] = \"multi-select (derive now)\"\xFE";
    z += "    searchTypeArray[-1] = \"multi-select (Year(derived))\"\xFE";
    z += "    searchTypeArray[-1] = \"multi-select (Year(derive now))\"\xFE";
    z += "    \xFE";
    z += "\xFE";
    z += "    searchTypes = Join(searchTypeArray, \";\")\xFE";
    z += "    \xFE";
    z += "    // Definitions for knockOut (can build these with EDV and get the dict .view)\xFE";
    z += "    Jsconditional =  [{\"allany\": \"All\",\"block\": \"a\",\"jsfunction\": \"cssVisibility\",   \"field\": \"queryfield\", \"operator\": \"=\", \"tovalue\": \"1\"}]\xFE";
    z += "    \xFE";
    z += "    jsCondRefList = [{\"allany\": \"All\",\"block\": \"a\",\"jsfunction\": \"cssVisibility\",   \"field\": \"queryfield\", \"operator\": \"=\", \"tovalue\": \"1\"},\xFE";
    z += "                     \xFE";
    z += "                     {\"allany\": \"All\",\"block\": \"a\",\"jsfunction\": \"cssVisibility\",   \"field\": \"reffile\", \"operator\": \"=\", \"tovalue\": '\"\"'},\xFE";
    z += "                     {\"allany\": \"Any\",\"block\": \"b\",\"jsfunction\": \"cssVisibility\",   \"field\": \"searchType\", \"operator\": \"InList\", \"tovalue\": '[\"dropdown (literal)\", \"multi-select (literal)\", \"autocomplete (literal)\"]'}\xFE";
    z += "                     ]\xFE";
    z += "                    \xFE";
    z += "    jsCondRefFile = [{\"allany\": \"All\",\"block\": \"a\",\"jsfunction\": \"cssVisibility\",   \"field\": \"queryfield\", \"operator\": \"=\", \"tovalue\": \"1\"},\xFE";
    z += "                     {\"allany\": \"All\",\"block\": \"a\",\"jsfunction\": \"cssVisibility\",   \"field\": \"searchType\", \"operator\": \"InList\", \"tovalue\": '[\"dropdown (ref-file)\",\"multi-select (ref-file)\",\"autocomplete (ref-file)\"]'}\xFE";
    z += "                     ]\xFE";
    z += "\xFE";
    z += "    \xFE";
    z += "    fieldDefinitions = [\xFE";
    z += "        {name:'queryfield', label:'On Selection Screen', datatype: 'boolean', control:'checkbox', canedit:true, required: false, notblank: true, defaultvalue:\"0\" },\xFE";
    z += "        {name:'displayfield', label:'Display in Grid', datatype: 'boolean', control:'checkbox', canedit:true, required: false, notblank: true, defaultvalue:\"1\" },\xFE";
    z += "        {name:'editfield', label:'On Edit Page', datatype: 'boolean', control:'checkbox', canedit:true, required: false, notblank: true, defaultvalue:\"1\" },\xFE";
    z += "        \xFE";
    z += "        {name:'name', label:'Field', datatype: 'string',  control:'label' },\xFE";
    z += "        {name:'label', index:11, label:'Label', control:'textbox', canedit:true, required: true, notblank: true },\xFE";
    z += "        {name:'searchType', label:'Search Type', datatype: 'string', width:\"200px\", control:'dropDownBox', canedit:true, required: false, notblank: true, defaultvalue:\"string\", reflist: searchTypes, jsconditionals: jsconditional },\xFE";
    z += "        {name:'required', label:'Required', datatype: 'boolean', control:'checkbox', canedit:true, required: false, notblank: true, defaultvalue:\"1\", jsconditionals: jsconditional },\xFE";
    z += "        \xFE";
    z += "        {name:'reffile', index:21, label:'Select Pic File', width:\"200px\", control:'comboBox', canedit:true, required: false, notblank: false, reffile:\"{listfiles}\", jsconditionals: jsCondRefFile },\xFE";
    z += "        {name:'refpk', index:23, label:'Ref Value Field', width:\"12em\", control:'cascadingDropDownBox', parentCtlID: 'reffile', canedit:true, required: false, notblank: false, customRoutine: \"mdlGetRefFields?databaseName={databaseName}&tableName={tablename}\", jsconditionals: jsCondRefFile },\xFE";
    z += "        {name:'refdisplay', index:24, label:'Ref Display Field', width:\"12em\", control:'cascadingDropDownBox', parentCtlID: 'reffile', canedit:true, required: false, notblank: false, customRoutine: \"mdlGetRefFields?databaseName={databaseName}&tableName={tablename}\", jsconditionals: jsCondRefFile  },\xFE";
    z += "    \xFE";
    z += "        {name:'reflist', index:26, label:'Ref List', width:23, control:'textbox', canedit:true, required: false, notblank: false, jsconditionals: jsCondRefList, tooltip: \"Lbl,Val;.. Or Lbl,Lbl,..\" }\xFE";
    z += "    ]\xFE";
    z += "\xFE";
    z += "    // {name:'operator', label:'Operator', datatype: 'string', width:12, control:'dropDownBox', canedit:true, required: false, notblank: false, defaultvalue:\"Dynamic\", reflist: \"=;<>;>;<;<=;>=;Like ...%;Like %...;Like %...%;InList;Dynamic\", jsconditionals: jsconditional },\xFE";
    z += "    isSelect = LCase(Left(tblID_Or_SQL, 7)) = \"select \"\xFE";
    z += "    \xFE";
    z += "    // Get the schemaColumns\xFE";
    z += "    schemaColumns = getColumnDefinitions(tblID_Or_SQL, columnNames)\xFE";
    z += "    \xFE";
    z += "    ' numericTypes = Split(\"autointeger;integer;double;currency\", \";\")\xFE";
    z += "    ' dateTypes = Split(\"date;time;datetime\", \";\")\xFE";
    z += "    ' stringTypes = Split(\"memo;string\", \";\")\xFE";
    z += "    ' ignoreNames = Split(\"llid;lat;lon;lng;latitude;longitude\", \";\")\xFE";
    z += "    \xFE";
    z += "    ignoreTypes = Split(\"guid;blob;png;jpg;password;json;jsonarray\", \";\")\xFE";
    z += "\xFE";
    z += "    visibleColumns = Split(LCase(visibleColumns), \",\")\xFE";
    z += "    \xFE";
    z += "    dataSet = []\xFE";
    z += "    columnNames = []\xFE";
    z += "    default_LatName = \"\"\xFE";
    z += "    default_LngName = \"\"\xFE";
    z += "    \xFE";
    z += "    For Each Column, ColumnI In schemaColumns\xFE";
    z += "        cName = Column.name\xFE";
    z += "        If !cName Then Cycle\xFE";
    z += "\xFE";
    z += "        lcName = LCase(cName)\xFE";
    z += "        \xFE";
    z += "        Dt = Column.datatype\xFE";
    z += "        Locate Dt In ignoreTypes Then Cycle\xFE";
    z += "        If Left(lcName, 4) = \"aud_\" Then Cycle\xFE";
    z += "        If lcName = \"llid\" Then Cycle\xFE";
    z += "        \xFE";
    z += "        columnNames[-1] = Column.name\xFE";
    z += "\xFE";
    z += "        Sf = Clone(Column)\xFE";
    z += "        Sf.queryfield = False\xFE";
    z += "        Sf.displayfield = True\xFE";
    z += "        Sf.editfield = False\xFE";
    z += "        Sf.required = False\xFE";
    z += "        Sf.datatype = Dt\xFE";
    z += "\xFE";
    z += "        \xFE";
    z += "        // Get previous changes when editing dataset\xFE";
    z += "        For Each PriorRow In priorDataSet\xFE";
    z += "            If PriorRow.name = Sf.name Then \xFE";
    z += "                PriorField = PriorRow\xFE";
    z += "                Break\xFE";
    z += "            end if\xFE";
    z += "            PriorRow = {}\xFE";
    z += "        next\xFE";
    z += "        \xFE";
    z += "        if PriorRow Then\xFE";
    z += "            Sf.queryfield = PriorRow.queryfield\xFE";
    z += "            Sf.displayfield = PriorRow.displayfield\xFE";
    z += "            Sf.editfield = PriorRow.editfield\xFE";
    z += "            Sf.label = PriorRow.label\xFE";
    z += "            Sf.searchType = PriorRow.searchType\xFE";
    z += "            Sf.required = PriorRow.required\xFE";
    z += "            Sf.reffile = PriorRow.reffile\xFE";
    z += "            Sf.refpk = PriorRow.refpk\xFE";
    z += "            Sf.refdisplay = PriorRow.refdisplay\xFE";
    z += "            Sf.reflist = PriorRow.reflist\xFE";
    z += "            Sf.isLatitude = PriorRow.isLatitude\xFE";
    z += "            Sf.isLongitude = PriorRow.isLongitude\xFE";
    z += "\xFE";
    z += "        Else\xFE";
    z += "            if !default_LatName Then If instr(lcname, \"latitude\") then default_LatName = cName\xFE";
    z += "            if !default_LngName Then If instr(lcname, \"longitude\") then default_LngName = cName\xFE";
    z += "            \xFE";
    z += "            if !default_LngName then if instr(lcname, \"lng\") or instr(lcname, \"long\") then default_LngName = cName\xFE";
    z += "            if !default_LatName then if instr(lcname, \"lat\") then default_LatName = cName\xFE";
    z += "            \xFE";
    z += "            If Right(lcName, 5) = \"codes\" Then\xFE";
    z += "                Sf.queryfield = True\xFE";
    z += "                Sf.searchType = \"dropdown (ref-file)\"\xFE";
    z += "                \xFE";
    z += "            Else If Left(lcName, 4) = \"pic_\" Or Instr(lcName, \"_pic_\") Then\xFE";
    z += "                Sf.queryfield = True\xFE";
    z += "                Sf.searchType = \"dropdown (ref-file)\"\xFE";
    z += "                \xFE";
    z += "            Else If Dt = \"guid\" Then\xFE";
    z += "                Sf.queryfield = False\xFE";
    z += "                Sf.searchType = \"GUID\"\xFE";
    z += "                \xFE";
    z += "            Else If Instr(lcName, \"year\") Then\xFE";
    z += "                Sf.queryfield = True\xFE";
    z += "                Sf.searchType = \"multi-select Year() dropdown\"\xFE";
    z += "                \xFE";
    z += "            Else If Dt = \"date\" Then\xFE";
    z += "                if Instr(lcName, \"start\") or Instr(lcName, \"end\") Then\xFE";
    z += "                    Sf.queryfield = True\xFE";
    z += "                    Sf.searchType = \"date\"\xFE";
    z += "                else\xFE";
    z += "                    Sf.queryfield = True\xFE";
    z += "                    Sf.searchType = \"date range\"\xFE";
    z += "                End If\xFE";
    z += "                \xFE";
    z += "            Else If Dt = \"autointeger\" Or Dt = \"integer\" Then\xFE";
    z += "                Sf.queryfield = True\xFE";
    z += "                Sf.searchType = \"an exact numeric value\"\xFE";
    z += "                \xFE";
    z += "            Else If Dt = \"double\" Or Dt = \"currency\" Then\xFE";
    z += "                Sf.queryfield = True\xFE";
    z += "                Sf.searchType = \"numeric range (inclusive)\"\xFE";
    z += "                \xFE";
    z += "            Else If Dt = \"boolean\" Then\xFE";
    z += "                Sf.queryfield = True\xFE";
    z += "                Sf.searchType = \"dropdown (literal)\"\xFE";
    z += "                Sf.reflist = \"True,1;False,0\"\xFE";
    z += "                \xFE";
    z += "            Else If Instr(lcName, \"date\") Then\xFE";
    z += "                Sf.queryfield = True\xFE";
    z += "                Sf.searchType = \"date range\"\xFE";
    z += "    \xFE";
    z += "            Else\xFE";
    z += "                Reflist = getDistinctValues(tblID_Or_SQL, Column.name, 40, datatype)\xFE";
    z += "                \xFE";
    z += "                If Len(Reflist) > 1 And Len(Reflist) < 40 Then\xFE";
    z += "                    If Len(Reflist) < 5 Then\xFE";
    z += "                        rf = []\xFE";
    z += "                        for each v in reflist\xFE";
    z += "                           rf[-1] = ltrim(rtrim(v))\xFE";
    z += "                        next\xFE";
    z += "                        Sf.reflist = Join(rf, \";\")\xFE";
    z += "                        Sf.searchType = \"dropdown (literal)\"\xFE";
    z += "                    Else\xFE";
    z += "                        Sf.searchType = \"dropdown (derived)\"\xFE";
    z += "                    End If\xFE";
    z += "                Else\xFE";
    z += "                    Sf.queryfield = True\xFE";
    z += "                    Sf.searchType = \"partial string match\"\xFE";
    z += "                End If\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        If visibleColumns Then\xFE";
    z += "            Locate lcName In visibleColumns Else Sf.queryfield = False\xFE";
    z += "        End If\xFE";
    z += "            \xFE";
    z += "        if Sf.isLatitude Then default_LatName = Sf.name\xFE";
    z += "        if Sf.isLongitude Then default_LngName = Sf.name\xFE";
    z += "        \xFE";
    z += "        dataSet[-1] = Sf\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    \xFE";
    z += "    If !ProjectName Then ProjectName = \"searchType\"\xFE";
    z += "    \xFE";
    z += "    Loop\xFE";
    z += "\xFE";
    z += "        Html = []\xFE";
    z += "        Html[-1] = @Html(`<input id='dataset' name='dataset' type=\"hidden\" value='' />`)\xFE";
    z += "\xFE";
    z += "        Html[-1] = H1(\"Select columns for the Selection Screen, the display grid, and the edit screen for the \":tblID_Or_SQL:\" report\"):crlf()\xFE";
    z += "        \xFE";
    z += "        Html[-1] = @Jsb_Html.repeaterLoad(projectName, Null /* DefaultRow */, dataSet)\xFE";
    z += "        Html[-1] = @Jsb_ctls.RepeaterGridBackground(ProjectName, projectName, { columns: fieldDefinitions, attachdb: dataBaseName, tableName: tblID_Or_SQL }, dataSet, \"\", false, \"\", \"\")\xFE";
    z += "        \xFE";
    z += "        jsScript = jsConditionalsScript(projectName, fieldDefinitions, true)\xFE";
    z += "        if jsScript Then Html[-1] = @Script(jsScript)\xFE";
    z += "        \xFE";
    z += "        \xFE";
    z += "        Html[-1] =  @Html(`<br>GPS Coordinate columns:<br>`)\xFE";
    z += "        Html[-1] =  @Label(\"Longitude: \", \"colLongitude\"): @Dropdownbox(\"colLongitude\", columnNames, default_LngName, true)\xFE";
    z += "        Html[-1] =  @Label(\"Latitude: \", \"colLatitude\") : @Dropdownbox(\"colLatitude\", columnNames, default_LatName, true)\xFE";
    z += "        Html[-1] = @Html(`<br>`)\xFE";
    z += "        \xFE";
    z += "        \xFE";
    z += "        // Add some btns\xFE";
    z += "        Btns = []\xFE";
    z += "        Btns[-1] = @Submitbtn(\"Btn\", \"OK\",     { onclick: `storeVal('dataset', ko.toJSON(koModel.`:projectName:`))` })\xFE";
    z += "        Btns[-1] = @Submitbtn(\"Btn\", \"Cancel\", { onclick: `parsleyDestroy(); storeVal('dataset', ko.toJSON(koModel.`:projectName:`))` })\xFE";
    z += "        Btns[-1] = @SubmitBtn(\"Btn\", \"Reset\",  { onclick: `parsleyDestroy(); storeVal('dataset', ko.toJSON(koModel.`:ProjectName:`))` })\xFE";
    z += "            \xFE";
    z += "        Btns[-1] = @Button('BtnSelectAll', 'Select None', { \xFE";
    z += "            onclick: `\xFE";
    z += "                 var ck = $('#BtnSelectAll').text() == 'Select All'; \xFE";
    z += "                 if (ck) $('#BtnSelectAll').text('Select None'); else $('#BtnSelectAll').text('Select All');\xFE";
    z += "                 koModel.`:ProjectName:`().forEach(function(item, index) { item.queryfield(ck) } );\xFE";
    z += "                 $(\"[id^='queryfield_'\").each(function () { $(this).trigger('change') });\xFE";
    z += "            ` })\xFE";
    z += "            \xFE";
    z += "        Btns[-1] =  @Button(\"BtnDisplayAll\", \"Display None\", { \xFE";
    z += "            onclick: `\xFE";
    z += "                var ck = $('#BtnDisplayAll').text() == 'Display All'; \xFE";
    z += "                if (ck) $('#BtnDisplayAll').text('Display None'); else $('#BtnDisplayAll').text('Display All');\xFE";
    z += "                koModel.`:ProjectName:`().forEach(function(item, index) { item.displayfield(ck) } );\xFE";
    z += "                $(\"[id^='displayfield_'\").each(function () { $(this).trigger('change') });\xFE";
    z += "            ` })\xFE";
    z += "        \xFE";
    z += "            \xFE";
    z += "        Btns[-1] =  @Button(\"BtnEditAll\", \"Edit None\", { \xFE";
    z += "            onclick: `\xFE";
    z += "                var ck = $('#BtnEditAll').text() == 'Edit All'; \xFE";
    z += "                if (ck) $('#BtnEditAll').text('Edit None'); else $('#BtnEditAll').text('Edit All');\xFE";
    z += "                koModel.`:ProjectName:`().forEach(function(item, index) { item.editfield(ck) } );\xFE";
    z += "                $(\"[id^='editfield_'\").each(function () { $(this).trigger('change') });\xFE";
    z += "            ` })\xFE";
    z += "        \xFE";
    z += "\xFE";
    z += "        Html[-1] = @Center(Join(Btns, \"\"))\xFE";
    z += "    \xFE";
    z += "        Print Join(Html, \"\"):\xFE";
    z += "        @server.pause\xFE";
    z += "        \xFE";
    z += "        // Unload\xFE";
    z += "        btn = @FormVar('Btn')\xFE";
    z += "        colLatitude = formVar('colLatitude')\xFE";
    z += "        colLongitude = formVar('colLongitude')\xFE";
    z += "        sResults = @jsb_bf.FormVar('dataset')\xFE";
    z += "        isAutoPostBack = formVar(\"isAutoPostBack\")\xFE";
    z += "        \xFE";
    z += "        // Process command\xFE";
    z += "        if btn = \"Cancel\" Then return False\xFE";
    z += "        \xFE";
    z += "        dataSet = JSon(sResults)\xFE";
    z += "        For Each sf in dataSet\xFE";
    z += "           Remove sf, \"__ko_mapping__\"\xFE";
    z += "        Next\xFE";
    z += "        \xFE";
    z += "        // Clear any column that thinks is a lat or a long and reset with given values\xFE";
    z += "        for each Sf in dataSet\xFE";
    z += "            If Sf.isLatitude Or SF.isLongitude THEN \xFE";
    z += "                Remove sf, \"isLatitude\"\xFE";
    z += "                Remove sf, \"isLongitude\"\xFE";
    z += "            end if\xFE";
    z += "        next\xFE";
    z += "        \xFE";
    z += "        if colLatitude or colLongitude then\xFE";
    z += "            For Each sf in dataSet\xFE";
    z += "               if Sf.name = colLatitude then Sf.isLatitude = true\xFE";
    z += "               if Sf.name = colLongitude then Sf.isLongitude = true\xFE";
    z += "            Next\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        if isAutoPostBack Then Cycle\xFE";
    z += "        \xFE";
    z += "        if btn = \"Reset\" Then \xFE";
    z += "            if msgbox(\"Are you sure you want to reset the grid?\", \"Yes,*No\") = \"Yes\" Then\xFE";
    z += "                priorDataSet = []\xFE";
    z += "                goto startOver\xFE";
    z += "            End If\xFE";
    z += "        End If        \xFE";
    z += "        \xFE";
    z += "        // Check proper pic-list setup\xFE";
    z += "        passed = true\xFE";
    z += "        for each Sf in dataSet\xFE";
    z += "            if sf.queryfield And Sf.searchType = \"dropdown (literal)\" And !Sf.reflist Then\xFE";
    z += "                msgbox(\"You need to complete your pic-list on column: \":sf.name)\xFE";
    z += "                passed = false\xFE";
    z += "                exit for\xFE";
    z += "            end if\xFE";
    z += "            if sf.queryfield And Sf.searchType = \"dropdown (ref-file)\" And (!Sf.reffile Or !Sf.refpk) Then\xFE";
    z += "                msgbox(\"You need to complete your pic-file fields on column: \":sf.name)\xFE";
    z += "                passed = false\xFE";
    z += "                exit for\xFE";
    z += "            end if\xFE";
    z += "        next\xFE";
    z += "    Until passed Do Repeat\xFE";
    z += "    \xFE";
    z += "    \xFE";
    z += "    // Did we need update any labels?\xFE";
    z += "    if !isSelect Then\xFE";
    z += "        fDictHandle = fHandle('dict', tblID_Or_SQL)\xFE";
    z += "        for each sf in dataSet\xFE";
    z += "            if sf.queryfield and Trim(sf.label) <> \"\" Then\xFE";
    z += "                For Each Column In schemaColumns\xFE";
    z += "                    if sf.name = Column.name then\xFE";
    z += "                        if sf.label <> Column.label Then\xFE";
    z += "                            ReadJson J From fDictHandle, \"!\":Column.name Then\xFE";
    z += "                                j.label = sf.label\xFE";
    z += "                                WriteJson J on fDictHandle, \"!\":Column.name else null\xFE";
    z += "                            End If\xFE";
    z += "                            break\xFE";
    z += "                        end if\xFE";
    z += "                    end if\xFE";
    z += "                next\xFE";
    z += "            end if\xFE";
    z += "        next\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "\xFE";
    z += "    Writejson dataset on fHandle('dict', 'dbBuilderReports'), rptID Else null\xFE";
    z += "    return dataset\xFE";
    z += "end function"
    window.cached_jsb_mdl["newsearchtype"] = z;
    window.cached_jsb_mdl["newwebsitemodel"] = "Program newWebSiteModel\xFE* %options aspxC-\xFE    If !IsManager() Then Stop \"You must be at least a manager to run this command\"\xFE    fromPage = @ParamVar('fromPage')\xFE    \xFE    Title = \"New Project\"\xFE    Loop\xFE        ActName = @InputBox(Title, \"New Web Site Name\", \"\", \"80%\", \"\")\xFE        If ActName = Chr(27) Or ActName = \"\" Then If fromPage Then @Response.Redirect(fromPage) Else Return\xFE        ActName = @NiceName(ActName)\xFE    Until createAccount(ActName) Do\xFE        MsgBox(@Errors)\xFE    Repeat\xFE\xFE    // Get them to create a basic page\xFE    @Response.Redirect(@HtmlRoot:ActName:\"/edp%20BP%20\":ActName)\xFEEnd Program";
    window.cached_jsb_mdl["nextrowisdifferent"] = "function nextRowIsDifferent(Settings, Rows, nxtRowI)\xFE    // Make sure the next row has at least 60% of the Header Columns\xFE    if Settings.SideBySideTables then NxtRow = GetRow(Settings, Rows, nxtRowI) Else NxtRow = Rows[nxtRowI]\xFE    if !NxtRow Then Return True\xFE            \xFE    nxtRowCC = UBound(nxtRow)\xFE    if !nxtRowCC Then Return True\xFE    \xFE    if nxtRowCC > UBound(Settings.HdrRow) then Return True\xFE    \xFE    if Settings.SideBySideTables Then\xFE        if Join(nxtRow, \"\") = \"\" Then Return True\xFE    end if\xFE        \xFE    if nxtRowI < 100 Then\xFE        minimumColumns = UBound(Settings.HdrRow) * .40\xFE        Return nxtRowCC < minimumColumns \xFE    end if\xFE    \xFE    return false\xFEend function";
    window.cached_jsb_mdl["okaytooutputtbl"] = "function okayToOutputTbl(Settings, tbl, ByVal sheetname)\xFE   rowCnt = UBound(tbl)\xFE   if Settings.ignoreTablesWithNoRows And rowCnt <= 1 then \xFE        @Errors = \"Ignored... not enough rows\"\xFE        return false\xFE    end if\xFE    \xFE    Settings.HdrRow = tbl[1]\xFE    colCnt = ubound(Settings.HdrRow)\xFE    if colCnt < Settings.ignoreTablesWithLessThanNColumns then  \xFE        @Errors = \"Ignored... not enough columns\"\xFE        return false\xFE    end if\xFE  \xFE    return True\xFEend function";
    window.cached_jsb_mdl["opentableandcheckid"] = "Function openTableAndCheckID(objectModel, viewName, fTable, pkID, rtnErrors)\xFE    * %options aspxC-\xFE    \xFE    If objectModel.tableName = \"\" Then tblName = \"applications\" Else tblName = objectModel.tableName\xFE\xFE    If pkID = \"\" Then\xFE        rtnErrors = \"This record in '\":viewName:\"' does not have a primary key and autokeys are not enabled.\"\xFE        Return False\xFE    End If\xFE\xFE    Return openTable(objectModel.tableName, viewName, fTable, rtnErrors)\xFEEnd Function";
    var z = "Subroutine OrderButtons(ProjectName, pageName, ViewName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    ReadJSon ObjectModel From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE";
    z += "\xFE";
    z += "    btnNames = []\xFE";
    z += "    For Each Btn In ObjectModel.custombtns\xFE";
    z += "        btnNames[-1] = Btn.buttontxt\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    btnNames = @Jsb_bf.inputSortableList(\"Order Buttons\", \"Order Buttons:\", btnNames, \"50%\", \"80%\")\xFE";
    z += "    If btnNames = \"\" Or btnNames = Chr(27) Then Return\xFE";
    z += "\xFE";
    z += "    newOrder = []\xFE";
    z += "    For Each btnName In btnNames\xFE";
    z += "        For Each Btn In ObjectModel.custombtns\xFE";
    z += "            If Btn.buttontxt = btnName Then newOrder[-1] = Btn\xFE";
    z += "        Next\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    ObjectModel.custombtns = newOrder\xFE";
    z += "    WriteJSon ObjectModel On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "    Call @Jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFE";
    z += "End Sub"
    window.cached_jsb_mdl["orderbuttons"] = z;
    var z = "Subroutine OrderColumns(ProjectName, pageName, ViewName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE";
    z += "\xFE";
    z += "    allColumns = []\xFE";
    z += "    For Each Column In dataSet.columns\xFE";
    z += "        CName = Trim(Column.name)\xFE";
    z += "        If CName Then allColumns[-1] = CName\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    SelectedCols = @Jsb_bf.inputSortableList(\"Order Columns\", \"Order columns:\", allColumns, \"50%\", \"80%\")\xFE";
    z += "    If SelectedCols = \"\" Or SelectedCols = Chr(27) Then Return\xFE";
    z += "\xFE";
    z += "    newColumns = []\xFE";
    z += "    For Each ColumnName In SelectedCols\xFE";
    z += "        For Each Column In dataSet.columns\xFE";
    z += "            If Column.name = ColumnName Then newColumns[-1] = Column\xFE";
    z += "        Next\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    dataSet.columns = newColumns\xFE";
    z += "    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "    Call @Jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFE";
    z += "End Sub"
    window.cached_jsb_mdl["ordercolumns"] = z;
    window.cached_jsb_mdl["orderdistinctvalues"] = "function OrderDistinctValues(ss, Field, LimitNo, SortOrder)\xFE    dFields = Getlist(Ss)\xFE    UB = ubound(dFields)\xFE    \xFE    // print field:\" \":UB; @server.flush\xFE    // debug\xFE    \xFE    if LimitNo And UB > LimitNo Then Return []\xFE    \xFE    if UB > 200 Then\xFE        MsgBox(\"Excessive data!\", \"Your field '\":Field:\"' has \":ubound(dFields):\" distinct values.  It will be limited to 200\")\xFE        if @IsAdmin Then Debug\xFE        UB = 200\xFE    end if\xFE    \xFE    // Make JSON into an array\xFE    Reflist = []\xFE    For Each Row, RowI In dFields\xFE        V = Row[Field]\xFE        If V Then Reflist[-1] = V\xFE        if RowI > UB Then Exit For\xFE    Next\xFE \xFE    Return Sort(Reflist, SortOrder)\xFEEnd function";
    var z = "function outputTable(Settings, tbl, ByVal sheetname)\xFE";
    z += "   rowCnt = UBound(tbl)\xFE";
    z += "   \xFE";
    z += "    // give a different name if 1st Tbl in the set\xFE";
    z += "    if Settings.SheetTblCnt then\xFE";
    z += "        sheetname = sheetName:\" (\":Settings.firstR:\":\":Settings.FirstC:\")\"\xFE";
    z += "    else\xFE";
    z += "        sheetname = sheetName\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "     // Shorten name\xFE";
    z += "    dbTblName = Settings.XlsFileName:`\\`:sheetname\xFE";
    z += "\xFE";
    z += "    Settings.HdrRow = tbl[1]\xFE";
    z += "    colCnt = ubound(Settings.HdrRow)\xFE";
    z += "    \xFE";
    z += "    Settings.SheetTblCnt += 1\xFE";
    z += "\xFE";
    z += "   // Convert upto the 1st 1000 Rows to json to get an analysis\xFE";
    z += "   jsArray = []\xFE";
    z += "   stepsize = cint(rowCnt / 100) + 1\xFE";
    z += "   \xFE";
    z += "   for rowI = 2 to rowCnt step stepsize\xFE";
    z += "       row = tbl[rowi]\xFE";
    z += "       rec = { RowNumber: Rowi }\xFE";
    z += "       for each name, coli in Settings.HdrRow\xFE";
    z += "           if name then rec[name] = row[coli]\xFE";
    z += "        next\xFE";
    z += "        jsArray[-1] = rec\xFE";
    z += "    next\xFE";
    z += "    \xFE";
    z += "    forceAllowNulls = True\xFE";
    z += "    PrimaryKeyName = \"RowNumber\"\xFE";
    z += "\xFE";
    z += "    LastFailedRowI = 0\xFE";
    z += "redo:\xFE";
    z += "    Call statusPrint(\"Sheet '\":dbTblName:\"' of \":rowCnt:\" Rows and \":ubound(Settings.HdrRow):\" columns\")\xFE";
    z += "\xFE";
    z += "    \xFE";
    z += "    ColumnDefs = analyseJson(jsArray, PrimaryKeyName, forceAllowNulls)\xFE";
    z += "\xFE";
    z += "    // Create a new table\xFE";
    z += "    dbTblName = Replace(dbTblName, \"'\", \"\")\xFE";
    z += "    \xFE";
    z += "    if Settings.deleteAndRecreateTables Then\xFE";
    z += "        Open dbTblName To sqlHandle Then \xFE";
    z += "            if typeoffile(sqlHandle) = \"ado\" then\xFE";
    z += "                DeleteFile sqlHandle Else  Return False\xFE";
    z += "            end if\xFE";
    z += "        end if\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    Open dbTblName To sqlHandle Else \xFE";
    z += "        If createTable(dbTblName, ColumnDefs, forceAllowNulls) Else \xFE";
    z += "            debug\xFE";
    z += "            // Return False\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        Open dbTblName To sqlHandle Else             \xFE";
    z += "            debug\xFE";
    z += "            Return False\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "    end if\xFE";
    z += "   \xFE";
    z += "    // Write out the records\xFE";
    z += "    for rowI = 2 to UBound(tbl) \xFE";
    z += "       row = tbl[rowi]\xFE";
    z += "       rec = { RowNumber: Rowi }\xFE";
    z += "       for each name, coli in Settings.HdrRow\xFE";
    z += "           if name then\xFE";
    z += "               rec[name] = row[coli]\xFE";
    z += "            end if\xFE";
    z += "        next\xFE";
    z += "        \xFE";
    z += "        writejson rec on sqlHandle, rec[PrimaryKeyName] else \xFE";
    z += "            if Settings.deleteAndRecreateTables And instr(@Errors, \"truncated\") Then\xFE";
    z += "                if rowI > LastFailedRowI then\xFE";
    z += "                    LastFailedRowI = rowI\xFE";
    z += "                    \xFE";
    z += "                    for rowI = RowI to RowI + 100 while RowI <= UBound(tbl) \xFE";
    z += "                       row = tbl[rowi]\xFE";
    z += "                       rec = { RowNumber: Rowi }\xFE";
    z += "                       for each name, coli in Settings.HdrRow\xFE";
    z += "                           if name then rec[name] = row[coli]\xFE";
    z += "                        next\xFE";
    z += "                        \xFE";
    z += "                        jsArray[-1] = rec\xFE";
    z += "                    next\xFE";
    z += "                    \xFE";
    z += "                    Call statusPrint(\"Redoing analysis of metadata\")\xFE";
    z += "                    goto redo\xFE";
    z += "                end if\xFE";
    z += "            end if\xFE";
    z += "            \xFE";
    z += "            @Errors = @Errors:@crlf:rec\xFE";
    z += "            Return false\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        if Mod(RowI, 1000) = 0 then Call statusPrint(\"Writing row \":RowI:\" of \":UBound(Tbl))\xFE";
    z += "    next\xFE";
    z += "\xFE";
    z += "    // record column names\xFE";
    z += "    hdrs = {}\xFE";
    z += "    cnu = Settings.columnNamesUsed\xFE";
    z += "    for each name, i in Settings.HdrRow\xFE";
    z += "       if name then \xFE";
    z += "           hdrs[name] = i\xFE";
    z += "           locate name in Cnu else Cnu[-1] = name\xFE";
    z += "        end if\xFE";
    z += "    next\xFE";
    z += "   \xFE";
    z += "   return True\xFE";
    z += "End Sub"
    window.cached_jsb_mdl["outputtable"] = z;
    window.cached_jsb_mdl["pickatable"] = "// Attach to your database 1st\xFEfunction pickAtable(byval defaultTableName, byval Title)\xFE    * %options aspxC-\xFE    \xFE    if !Title Then Title = \"Pick a Table\"\xFE\xFE    tables = @fileList(false, true)\xFE    tables = Sort(tables, \"LAI\")\xFE    tables[-1] = \"*New Table*\"\xFE    tableName = @jsb_bf.InputListBox(Title, \"pick a Table\", tables, defaultTableName)\xFE    If tableName = Chr(27) Then Return \"\"\xFE    if tableName <> \"*New Table*\" Then Return tableName\xFE    \xFE    newtableName = InputBox(\"Create Table\", \"New Table Name\", \"\", \"80%\", \"\")\xFE    If newtableName = Chr(27) Or newtableName = \"\" Then Return \"\"\xFE    fH = fHandle(\"\", newtableName, true)\xFE    call editTable(newtableName, false)\xFE\xFE    return newtableName\xFEend function";
    window.cached_jsb_mdl["picktable"] = "Pick Function picktable(fromUrl, fromValue)\xFE    * %options aspxC-\xFE    \xFE    call editTable(fromValue, false)\xFE    print @(-1):\xFE    return fromValue\xFEend function";
    var z = "Subroutine pickViewInputs(ProjectName, Byval pageName, byVal ViewName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    pageName = @DropIfRight(pageName, \".page\", True):\".page\"\xFE";
    z += "    ViewName = @DropIfRight(ViewName, \".view\", True):\".view\"\xFE";
    z += "\xFE";
    z += "    ReadJSon pageDataSet From @fHandle(\"dict\", ProjectName), pageName Else\xFE";
    z += "        Alert(\"Unable to find page \":pageName:\" \":@Errors)\xFE";
    z += "        Return\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    ReadJSon viewDataSet From @fHandle(\"dict\", ProjectName), ViewName Else\xFE";
    z += "        Alert(\"Unable to find view \":pageName:\" \":ViewName:\" \":@Errors)\xFE";
    z += "        Return\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    @Session.sqlColumns = possibleInputColumns(ProjectName, pageName, ViewName)\xFE";
    z += "    @Session.viewColumns = viewDataSet.columns\xFE";
    z += "    \xFE";
    z += "    Ans = @Popup_jsondef(ProjectName, \"jsb_jsondefs\", \"viewInputs\", \"DEL\", \"Add Input Parameter\", viewDataSet.inputs, \"80%\", \"80%\", \"Inputs for view \":ViewName, True)\xFE";
    z += "    If Len(Ans) Then\xFE";
    z += "        viewDataSet.inputs = Ans\xFE";
    z += "        WriteJSon viewDataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "        Call @Jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFE";
    z += "    End If\xFE";
    z += "End Subroutine"
    window.cached_jsb_mdl["pickviewinputs"] = z;
    var z = "Subroutine pickViewOutputs(ProjectName, byVal pageName, byVal ViewName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    pageName = @DropIfRight(pageName, \".page\", True):\".page\"\xFE";
    z += "    ViewName = @DropIfRight(ViewName, \".view\", True):\".view\"\xFE";
    z += "\xFE";
    z += "    ReadJSon pageDataSet From @fHandle(\"dict\", ProjectName), pageName Else\xFE";
    z += "        Alert(\"Unable to find page \":pageName:\" \":@Errors)\xFE";
    z += "        Return\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    ReadJSon viewDataSet From @fHandle(\"dict\", ProjectName), ViewName Else\xFE";
    z += "        Alert(\"Unable to find view \":pageName:\" \":ViewName:\" \":@Errors)\xFE";
    z += "        Return\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    @Session.sqlColumns = @getTableColumnDefs(viewDataSet.tableName, True, True)\xFE";
    z += "    @Session.viewColumns = viewDataSet.columns\xFE";
    z += "    \xFE";
    z += "    Ans = @Popup_jsondef(ProjectName, \"jsb_jsondefs\", \"viewOutputs\", \"DEL\", \"Add Output Parameter\", viewDataSet.outputs, \"80%\", \"80%\", \"Outputs for view \":ViewName, True)\xFE";
    z += "    If Len(Ans) Then\xFE";
    z += "        viewDataSet.outputs = Ans\xFE";
    z += "        WriteJSon viewDataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "        Call @Jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFE";
    z += "    End If\xFE";
    z += "End Subroutine"
    window.cached_jsb_mdl["pickviewoutputs"] = z;
    var z = "function pkColumnID(ByVal viewModel, optional byval ProjectName, optional byval ViewName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    CNames = []\xFE";
    z += "    \xFE";
    z += "    If !viewModel Then\xFE";
    z += "        ViewName = @DropIfRight(ViewName, \".view\", True):\".view\"\xFE";
    z += "        viewModel = fReadJson('dict', ProjectName, ViewName)\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    // Count # of primary key columns defined\xFE";
    z += "    For Each Column In viewModel.columns\xFE";
    z += "        If Column.primarykey Then CNames[-1] = Column\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    If Len(CNames) = 1 Then Return CNames[1].name\xFE";
    z += "    \xFE";
    z += "    pkName = @PrimaryKeyName(@fHandle(viewModel.tableName))\xFE";
    z += "    \xFE";
    z += "    lPkName = LCase(pkName)\xFE";
    z += "    If !pkName Or lPkName = \"itemid\" Then\xFE";
    z += "        pkName = \"ItemID\"\xFE";
    z += "        lPkName = \"itemid\"\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    // Fix so we don't have to do this again\xFE";
    z += "    If ProjectName And ViewName Then\xFE";
    z += "        If Len(CNames) > 1 Then Alert(\"Your view \":ViewName:\" has two many primary keys fields defined for table \":viewModel.tableName:\"; fixing to \":pkName)\xFE";
    z += "        \xFE";
    z += "        pHandle = fHandle('dict', ProjectName)\xFE";
    z += "        ViewName = @DropIfRight(ViewName, \".view\", True):\".view\"\xFE";
    z += "        \xFE";
    z += "        ReadJSon Model From pHandle, ViewName Then\xFE";
    z += "            For Each Column In Model.columns\xFE";
    z += "                Column.primarykey = LCase(Column.name) = lPkName\xFE";
    z += "            Next\xFE";
    z += "            \xFE";
    z += "            WriteJSon Model On pHandle, ViewName Else Stop @Errors\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Return pkName\xFE";
    z += "End function\xFE";
    z += ""
    window.cached_jsb_mdl["pkcolumnid"] = z;
    var z = "// We can get inputs from any SQL column in the current table (view), and also any other viewdataset column name\xFE";
    z += "Function possibleInputColumns(projectName, byVal pageName, Byval currentViewName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    pageName = @DropIfRight(pageName, \".page\", True)\xFE";
    z += "    currentViewName = LCase(@DropIfRight(currentViewName, \".view\", True):\".view\")\xFE";
    z += "    \xFE";
    z += "    // we can pick any column in the current view's table\xFE";
    z += "    ReadJson viewDataSet From @fHandle(\"DICT\", ProjectName), currentViewName Then\xFE";
    z += "        Columns = @getTableColumnDefs(viewDataSet.tableName, True, True)\xFE";
    z += "    Else\xFE";
    z += "        // No table?\xFE";
    z += "        Columns = []\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    ColumnNames = []\xFE";
    z += "    For Each Column In Columns\xFE";
    z += "        Cname = Column.cname\xFE";
    z += "        If Cname Then ColumnNames[-1] = LCase(Cname)\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    // We can also pick any column from another form field in another view\xFE";
    z += "    Views = ViewsInPage(ProjectName, pageName)\xFE";
    z += "    If Len(Views) = 0 Then Views[-1] = pageName:\".view\"\xFE";
    z += "    \xFE";
    z += "    For Each ViewName In Views\xFE";
    z += "        ViewName = LCase(viewName)\xFE";
    z += "        If viewName <> currentViewName Then\xFE";
    z += "            ReadJson viewDataSet From @fHandle(\"DICT\", ProjectName), ViewName Then\xFE";
    z += "                For Each Column In viewDataset.columns\xFE";
    z += "                    Cname = LCase(Column.name)\xFE";
    z += "                    Locate Cname In ColumnNames Else\xFE";
    z += "                        Columns[-1] = Column\xFE";
    z += "                        ColumnNames[-1] = Cname\xFE";
    z += "                    End If\xFE";
    z += "                Next\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    Return Columns\xFE";
    z += "End Function"
    window.cached_jsb_mdl["possibleinputcolumns"] = z;
    var z = "function ProcessExcelFile(Settings, BaseDirectory, XlsFileName, sqlDBName)\xFE";
    z += "    if Right(BaseDirectory, 1) <> `\\` then BaseDirectory := `\\`\xFE";
    z += "\xFE";
    z += "    if left(XlsFileName, len(BaseDirectory)) = BaseDirectory Then XlsFileName = Mid(XlsFileName, Len(BaseDirectory) + 1)\xFE";
    z += "    if !XlsFileName Then return true\xFE";
    z += "    \xFE";
    z += "    If Settings.excelObj Then\xFE";
    z += "        excelObj = Settings.excelObj\xFE";
    z += "    Else\xFE";
    z += "        excelObj = Createobject('excel')\xFE";
    z += "        If !excelObj Then Return False\xFE";
    z += "        Settings.excelObj = excelObj\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Settings.sqlDBName = sqlDBName\xFE";
    z += "    Settings.BaseDirectory = BaseDirectory\xFE";
    z += "    Settings.XlsFileName = XlsFileName\xFE";
    z += "    \xFE";
    z += "    Settings.DefaultEmptyValuesFromPreviousRow = instr(XlsFileName, \"Basset Report Form 2007.xlsx\")\xFE";
    z += "    \xFE";
    z += "    Success = excelObj.OpenExistingWorkbook(BaseDirectory:XlsFileName)\xFE";
    z += "    If !Success Then \xFE";
    z += "        @Errors = \"Could not open \":XlsFileName\xFE";
    z += "        return false\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    Sheets = excelObj.EnumerateSheets()\xFE";
    z += "    For each sheetName in Sheets\xFE";
    z += "        if instr(sheetName, \"LookUp Values\") And InStr(XlsFileName, \"Foster\") Then\xFE";
    z += "            Settings.SideBySideTables = True\xFE";
    z += "        Else\xFE";
    z += "            Settings.SideBySideTables = False\xFE";
    z += "        End If\xFE";
    z += "\xFE";
    z += "        if !ProcessSheet(Settings, sheetName) Then Return False\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    Return true\xFE";
    z += "End function"
    window.cached_jsb_mdl["processexcelfile"] = z;
    var z = "function ProcessNewDataRow(Settings, Tbl, Row, RowI)\xFE";
    z += "    // Does the Row contain any numbers?  Should have at least one\xFE";
    z += " \xFE";
    z += "    If Settings.DataMustHaveOneNumericRow Then\xFE";
    z += "        validData = 0\xFE";
    z += "        for each term in Row\xFE";
    z += "            if isNum(term) or Term = \"\" Or InStr(term, \"-\") then validData += 1\xFE";
    z += "        next\xFE";
    z += "        \xFE";
    z += "        if !validData Then \xFE";
    z += "            if isRowEmpty(Tbl[UBound(tbl)]) then\xFE";
    z += "                tbl.Delete(UBound(tbl))\xFE";
    z += "                RowI -= 1\xFE";
    z += "                return false\xFE";
    z += "            end if\xFE";
    z += "            return false\xFE";
    z += "        end if\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    if Settings.DefaultEmptyValuesFromPreviousRow And UBound(Tbl) > 1 Then\xFE";
    z += "        previousRow = Tbl[UBound(Tbl)]\xFE";
    z += "        for each term,TermI in Row\xFE";
    z += "            if !Term Then \xFE";
    z += "                Row[termI] = previousRow[TermI]\xFE";
    z += "            end if\xFE";
    z += "        next\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Tbl[-1] = Row\xFE";
    z += "\xFE";
    z += "    return True\xFE";
    z += "End Sub"
    window.cached_jsb_mdl["processnewdatarow"] = z;
    var z = "function ProcessNewHeader(Settings, Tbl, Rows, RowI) \xFE";
    z += "    Equ State_LookingForHeader To 1\xFE";
    z += "    Equ State_ProcessingHeader To 2\xFE";
    z += "    Equ State_ProcessingData To 3\xFE";
    z += "    \xFE";
    z += "    // Begin valid Settings.HdrRow\xFE";
    z += "    HdrRowI = RowI\xFE";
    z += "    Settings.State = State_ProcessingData\xFE";
    z += "    \xFE";
    z += "    // Allow a blank row after header\xFE";
    z += "    if isRowEmpty(Rows(rowI+1)) Then \xFE";
    z += "        if ubound(Rows[rowI+2]) > 3 then RowI += 1\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    if !Settings.SideBySideTables Then\xFE";
    z += "        // Keep accepting header Rows until we have actual data or an empty row\xFE";
    z += "        Loop \xFE";
    z += "            nxtRow = Rows[RowI+1]\xFE";
    z += "            \xFE";
    z += "            // adjust bounds?\xFE";
    z += "            for I = 1 to UBound(nxtRow)\xFE";
    z += "                cell = nxtRow[I]\xFE";
    z += "                if cell Then\xFE";
    z += "                    if I < Settings.FirstC Then Settings.FirstC = I\xFE";
    z += "                    if I > Settings.LastC Then Settings.LastC = I\xFE";
    z += "                end if\xFE";
    z += "            next\xFE";
    z += "\xFE";
    z += "            nxtRow = GetRow(Settings, Rows, rowI+1)\xFE";
    z += "            if rowHasNumbers(nxtRow) then break\xFE";
    z += "            if isRowEmpty(nxtRow) then break\xFE";
    z += "            \xFE";
    z += "        While true do\xFE";
    z += "            RowI += 1\xFE";
    z += "        Repeat\xFE";
    z += "    End If\xFE";
    z += "    Settings.HdrLastC = Settings.LastC    \xFE";
    z += "    \xFE";
    z += "    // allow one blank on previous column incase the key field isn't named\xFE";
    z += "    If Settings.FirstC > 1 Then\xFE";
    z += "        nxtRow = Rows[rowI + 1]\xFE";
    z += "        if !nxtRow Then nxtRow = []\xFE";
    z += "        V2 = nxtRow[Settings.FirstC - 1]\xFE";
    z += "        If V2 Then Settings.FirstC -= 1\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    // Build header  \xFE";
    z += "    HdrRow = []\xFE";
    z += "    lastI = False\xFE";
    z += "    for I = RowI to HdrRowI Step - 1\xFE";
    z += "        Row = GetRow(Settings, Rows, I)\xFE";
    z += "        \xFE";
    z += "        for J = 1 to UBound(Row)\xFE";
    z += "            C = Row[J]\xFE";
    z += "            if C = \"*\" Then\xFE";
    z += "               lastI = True\xFE";
    z += "            ElseIf C And Len(C) < 80 Then\xFE";
    z += "                HdrRow[J] = Trim(C:\" \":HdrRow[J])\xFE";
    z += "            End If\xFE";
    z += "        next\xFE";
    z += "        if lastI Then Break\xFE";
    z += "    next\xFE";
    z += "\xFE";
    z += "    noOfEmptyCells = 0\xFE";
    z += "    noOfNumbers = 0\xFE";
    z += "    \xFE";
    z += "    for each term, termI in HdrRow\xFE";
    z += "        term = Trim(term)\xFE";
    z += "        \xFE";
    z += "        if !term Then \xFE";
    z += "            noOfEmptyCells += 1\xFE";
    z += "            // HdrRow[TermI] = \"Column_\":TermI\xFE";
    z += "            \xFE";
    z += "        ElseIf IsNum(Term) Then\xFE";
    z += "            noOfNumbers += 1\xFE";
    z += "            HdrRow[TermI] = \"#\":Term\xFE";
    z += "            \xFE";
    z += "        Else\xFE";
    z += "            HdrRow[TermI] = Term\xFE";
    z += "        End If\xFE";
    z += "    next\xFE";
    z += "\xFE";
    z += "    If UBound(HdrRow) And noOfEmptyCells > (UBound(HdrRow) / 2) then return False\xFE";
    z += "    \xFE";
    z += "    // Does the header contain numbers?  Problably not really a header then\xFE";
    z += "    if noOfNumbers > 1 And UBound(HdrRow) = 1 Then\xFE";
    z += "        // Maybe they forgot to make a header?\xFE";
    z += "        H = []\xFE";
    z += "        for each term, I in HdrRow\xFE";
    z += "            h[-1] = \"Column_\":I\xFE";
    z += "        next\xFE";
    z += "        HdrRow = H\xFE";
    z += "        RowI -= 1\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Settings.HdrRow = HdrRow\xFE";
    z += "    Tbl = [HdrRow]\xFE";
    z += "\xFE";
    z += "    // Allow a blank row after header\xFE";
    z += "    if isRowEmpty(Rows(rowI+1)) Then \xFE";
    z += "        if ubound(Rows[rowI+2]) > 3 then RowI += 1\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    return True\xFE";
    z += "end sub"
    window.cached_jsb_mdl["processnewheader"] = z;
    var z = "function ProcessSheet(Settings, sheetName)\xFE";
    z += "    Equ State_LookingForHeader To 1\xFE";
    z += "    Equ State_ProcessingHeader To 2\xFE";
    z += "    Equ State_ProcessingData To 3\xFE";
    z += "    \xFE";
    z += "    Settings.sheetName = sheetName\xFE";
    z += "     \xFE";
    z += "    excelObj = Settings.excelObj\xFE";
    z += "    excelObj.selectSheet(sheetName)\xFE";
    z += "    Rows = excelObj.getAllCells()\xFE";
    z += "    rowCount = UBound(Rows)\xFE";
    z += "    \xFE";
    z += "    rowI = 0\xFE";
    z += "    if !rowCount Then Return True\xFE";
    z += "    Settings.HdrRow = []\xFE";
    z += "\xFE";
    z += "    Settings.SheetTblCnt = 0\xFE";
    z += "    Loop\xFE";
    z += "        // How many tables can we find?\xFE";
    z += "        Tbl = []\xFE";
    z += "        Settings.State = State_LookingForHeader \xFE";
    z += "        if Settings.SideBySideTables Then rowI = 0\xFE";
    z += "        \xFE";
    z += "        For rowI = rowI + 1 To rowCount\xFE";
    z += "            if Mod(rowi, 1000) = 0 then Call statusPrint(\"Extrcting row \":RowI:\" of \":rowCount)\xFE";
    z += "    \xFE";
    z += "            Row = GetRow(Settings, Rows, rowI)\xFE";
    z += "            \xFE";
    z += "            // Is the row a Header?\xFE";
    z += "            if Settings.State = State_ProcessingHeader then\xFE";
    z += "                If !ProcessNewHeader(Settings, Tbl, Rows, RowI) Then Break\xFE";
    z += "                if nextRowIsDifferent(Settings, Rows, rowI + 1) Then Break\xFE";
    z += "                // if Settings.verbose then Call statusPrint(Join(Settings.HdrRow, \" - \"))\xFE";
    z += "                \xFE";
    z += "            else If Settings.State = State_ProcessingData Then\xFE";
    z += "                If !ProcessNewDataRow(Settings, Tbl, Row, RowI) Then Break\xFE";
    z += "                if nextRowIsDifferent(Settings, Rows, rowI + 1) Then\xFE";
    z += "                    if Settings.SideBySideTables Then Break\xFE";
    z += "                    if nextRowIsDifferent(Settings, Rows, rowI + 2) Then Break\xFE";
    z += "                End If\xFE";
    z += "            End If\xFE";
    z += "        Next\xFE";
    z += "        \xFE";
    z += "        if okayToOutputTbl(Settings, tbl, sheetname) Then\xFE";
    z += "            if !outputTable(Settings, tbl, SheetName) Then Return false\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        print showTable(Settings, tbl, SheetName):\xFE";
    z += "        \xFE";
    z += "        \xFE";
    z += "    While RowI < rowCount Do\xFE";
    z += "        // clear range \xFE";
    z += "        for ri = Settings.firstR to RowI\xFE";
    z += "            srcRow = Rows[ri]\xFE";
    z += "            for ci = Settings.FirstC to UBound(srcRow) While ci <= Settings.LastC\xFE";
    z += "                srcRow[ci] = \"\"\xFE";
    z += "            next\xFE";
    z += "        next\xFE";
    z += "    Repeat\xFE";
    z += "    \xFE";
    z += "    return True\xFE";
    z += "end function"
    window.cached_jsb_mdl["processsheet"] = z;
    var z = "Subroutine ProcessTemplate(Code, ByVal TemplateFileName, ByVal templateName, ByVal Template)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    originalTemplate = Template\xFE";
    z += "    \xFE";
    z += "    // Drop leading spaces\xFE";
    z += "    For I = 6 To 2 Step -1\xFE";
    z += "        Loop While Instr(Template, Am():Space(I)) Do\xFE";
    z += "            Template = Replace(Template, Am():Space(I), Am():\" \")\xFE";
    z += "        Repeat\xFE";
    z += "    Next\xFE";
    z += "        \xFE";
    z += "    Loop\xFE";
    z += "        S = Instr(Template, \"<%\")\xFE";
    z += "        E = Instr(Template, \"%>\")\xFE";
    z += "    While S < E And S <> 0 Do\xFE";
    z += "        UpTo = Left(Template, S-1)\xFE";
    z += "        Section = Mid(Template, S + 2, E-S-2)\xFE";
    z += "        After = Mid(Template, E + 2)\xFE";
    z += "        IFile = \"\"\xFE";
    z += "        \xFE";
    z += "        Code[-1] = \"Gen[-1] = `\":UpTo:\"`\"\xFE";
    z += "        If Left(Section, 1) = \"=\" Then\xFE";
    z += "            Code[-1] = \"Gen[-1] = \":Mid(Section,2)\xFE";
    z += "        ElseIf LCase(Left(LTrim(Section), 8)) = \"$include\" Then\xFE";
    z += "            Section = Trim(Section)\xFE";
    z += "            IFile = Field(Section, \" \", 2)\xFE";
    z += "            IItem = Field(Section, \" \", 3)\xFE";
    z += "            If !IItem Then IItem = IFile; IFile = TemplateFileName\xFE";
    z += "            Open IFile To FFile Else @Alert( \"You're include file \":IFile:\" wasn't found.\")\xFE";
    z += "            Read ITemplate From FFile, IItem Else @Alert(\"You're include item \":IItem:\" wasn't found.\")\xFE";
    z += "            If Instr(ITemplate, \"`\") Then @Alert( \"Your template \":IItem:\" is using the ` character.  You need change this.\")\xFE";
    z += "            'NewCode = []\xFE";
    z += "            Call ProcessTemplate(Code, IFile, IItem, ITemplate)\xFE";
    z += "            if Left(After,1) = Am() Then After = Mid(After, 2)\xFE";
    z += "        Else\xFE";
    z += "            Code[-1] = Section\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        LNo += Count(UpTo, AM())\xFE";
    z += "        LNo += Count(Section, AM())\xFE";
    z += "        \xFE";
    z += "        upto = rtrim(upto)\xFE";
    z += "\xFE";
    z += "        Template = After\xFE";
    z += "        if Left(After,1) = Am() And !IFile Then\xFE";
    z += "            After = LTrim(Mid(After, 2))\xFE";
    z += "            if Right(upto, 1) = Am() Then Template = After\xFE";
    z += "        End If\xFE";
    z += "    Repeat\xFE";
    z += "    If Template Then Code[-1] = \"Gen[-1] = `\":Template:\"`\"\xFE";
    z += "\xFE";
    z += "    If S Or E Then\xFE";
    z += "       // If S Then LNo2 = DCount(Left(Template, S), AM())  \xFE";
    z += "        \xFE";
    z += "        LNo2 = LNo + Dcount(Left(Template, E), AM())\xFE";
    z += "\xFE";
    z += "        Read Ot From fHandle(TemplateFileName), templateName Then\xFE";
    z += "            I = Instr(Ot, \"******************************************************************************\")\xFE";
    z += "            If I Then\xFE";
    z += "                LNo += Count(Left(Ot, I), AM())\xFE";
    z += "                LNo2 += Count(Left(Ot, I), AM())\xFE";
    z += "                originalTemplate = Ot\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        Print @(-1):\"Ending marker missing in template \":TemplateFileName:\" \":templateName:\" at line number \":LNo\xFE";
    z += "        Print\xFE";
    z += "        For I = LNo To LNo2\xFE";
    z += "            If I > 0 Then Print I:\" \":Replace(Replace(originalTemplate<I>, \"<%\", @Bold(\"<%\")), \"%>\", @Bold(\"%>\"))\xFE";
    z += "        Next\xFE";
    z += "        \xFE";
    z += "        Print \"Ending marker missing in template \":TemplateFileName:\" \":templateName:\" at line number \":LNo\xFE";
    z += "        Print\xFE";
    z += "        \xFE";
    z += "        Print\xFE";
    z += "        Print @Html('<a href=':jsbRootExecute('ED ':TemplateFileName:' ':templateName:' (':Lno2, True):' target=\"_blank\">':Chr(29):'ED ':TemplateFileName:' ':templateName:Chr(28):'</a>')\xFE";
    z += "        Print\xFE";
    z += "        Print @SubmitBtn('formBtn', 'OK'); @Server.Pause\xFE";
    z += "    End If\xFE";
    z += "End Subroutine"
    window.cached_jsb_mdl["processtemplate"] = z;
    var z = "Subroutine Project_Menus(ByRef MenuBar As JSON, ByVal edpName As String)\xFE";
    z += "*\x20EDITOR-OPTION: AUTOFORMAT\")\xFE";
    z += "   MenuBar = {}\xFE";
    z += "   If @IsAdmin Then\xFE";
    z += "      Dim fromPage As String\xFE";
    z += "      If InStr(@Url, \"\\\\\":edpName) Then fromPage = @Url Else fromPage = edpName\xFE";
    z += "\xFE";
    z += "      MenuBar[\"Web Page\"] = {}\xFE";
    z += "      MenuBar[\"Web Page\"][\"View Page Props\"] = {}\xFE";
    z += "      MenuBar[\"Web Page\"][\"View Page Props\"].id = \"?edp&projectName=\":@UrlEncode(System(27)):\"&pageName=\":@UrlEncode(edpName):\"&fromPage=\":@UrlEncode(fromPage)\xFE";
    z += "      MenuBar[\"Web Page\"][\"ReGen Page\"] = {}\xFE";
    z += "      MenuBar[\"Web Page\"][\"ReGen Page\"].id = \"?ReGenPageModel&projectName=\":@UrlEncode(System(27)):\"&pageName=\":@UrlEncode(edpName):\"&fromPage=\":@UrlEncode(fromPage)\xFE";
    z += "      MenuBar[\"Web Page\"].seperator1 = true\xFE";
    z += "      MenuBar[\"Web Page\"][\"Add Page\"] = {}\xFE";
    z += "      MenuBar[\"Web Page\"][\"Add Page\"].id = \"?edp&projectName=\":@UrlEncode(System(27)):\"&fromPage=\":@UrlEncode(fromPage)\xFE";
    z += "      MenuBar[\"Web Page\"][\"Clone Page As\"] = {}\xFE";
    z += "      MenuBar[\"Web Page\"][\"Clone Page As\"].id = \"?clonePageModel&projectName=\":@UrlEncode(System(27)):\"&pageName=\":@UrlEncode(edpName):\"&fromPage=\":@UrlEncode(fromPage)\xFE";
    z += "      MenuBar[\"Web Page\"].seperator2 = true\xFE";
    z += "      MenuBar[\"Web Page\"][\"Rename Page\"] = {}\xFE";
    z += "      MenuBar[\"Web Page\"][\"Rename Page\"].id = \"?renamePageModel&projectName=\":@UrlEncode(System(27)):\"&pageName=\":@UrlEncode(edpName):\"&fromPage=\":@UrlEncode(fromPage)\xFE";
    z += "      MenuBar[\"Web Page\"].seperator3 = true\xFE";
    z += "      MenuBar[\"Web Page\"][\"Delete Page\"] = {}\xFE";
    z += "      MenuBar[\"Web Page\"][\"Delete Page\"].id = \"?deletePageModel&projectName=\":@UrlEncode(System(27)):\"&pageName=\":@UrlEncode(edpName):\"&fromPage=Menu\"\xFE";
    z += "\xFE";
    z += "      // Can collaspe here after Any HTML\xFE";
    z += "      MenuBar.collaspable = True\xFE";
    z += "\xFE";
    z += "      MenuBar[\"Menus\"] = {}\xFE";
    z += "      MenuBar[\"Menus\"][\"Main Menu\"] = {}\xFE";
    z += "      MenuBar[\"Menus\"][\"Main Menu\"].id = \"?Menu\"\xFE";
    z += "      MenuBar[\"Menus\"][\"Add Page To Menu\"] = {}\xFE";
    z += "      MenuBar[\"Menus\"][\"Add Page To Menu\"].id = \"?addPageToMenu&projectName=\":@UrlEncode(System(27)):\"&pageName=\":@UrlEncode(edpName):\"&fromPage=\":@UrlEncode(fromPage)\xFE";
    z += "      MenuBar[\"Menus\"][\"Add Page To Reference Menu\"] = {}\xFE";
    z += "      MenuBar[\"Menus\"][\"Add Page To Reference Menu\"].id = \"?addPageToReferenceMenu&projectName=\":@UrlEncode(System(27)):\"&pageName=\":@UrlEncode(edpName):\"&fromPage=\":@UrlEncode(fromPage)\xFE";
    z += "\xFE";
    z += "      MenuBar[\"TCL\"] = {}\xFE";
    z += "      MenuBar[\"TCL\"].id = \"tcl\"\xFE";
    z += "\xFE";
    z += "      MenuBar[\"Web Security\"] = {}\xFE";
    z += "      MenuBar[\"Web Security\"][\"Security\"] = {}\xFE";
    z += "      MenuBar[\"Web Security\"][\"Security\"].id = \"?WebSiteSecurity&projectName=\":@UrlEncode(System(27)):\"&fromPage=\":@UrlEncode(fromPage)\xFE";
    z += "\xFE";
    z += "      MenuBar[\"Websites\"] = {}\xFE";
    z += "      MenuBar[\"Websites\"][\"ReGen MenuBar\"] = {}\xFE";
    z += "      MenuBar[\"Websites\"][\"ReGen MenuBar\"].id = \"?updateMenus&projectName=\":@UrlEncode(System(27)):\"&fromPage=\":@UrlEncode(fromPage)\xFE";
    z += "      MenuBar[\"Websites\"].seperator1 = true\xFE";
    z += "      MenuBar[\"Websites\"][\"ReGen Website\"] = {}\xFE";
    z += "      MenuBar[\"Websites\"][\"ReGen Website\"].id = \"?RegenWebSiteModel&projectName=\":@UrlEncode(System(27)):\"&fromPage=\":@UrlEncode(fromPage)\xFE";
    z += "      MenuBar[\"Websites\"].seperator2 = true\xFE";
    z += "      MenuBar[\"Websites\"][\"New Website\"] = {}\xFE";
    z += "      MenuBar[\"Websites\"][\"New Website\"].id = \"?newWebSiteModel&fromPage=\":@UrlEncode(fromPage)\xFE";
    z += "      MenuBar[\"Websites\"][\"Clone Website\"] = {}\xFE";
    z += "      MenuBar[\"Websites\"][\"Clone Website\"].id = \"?cloneWebSite&fromPage=\":@UrlEncode(fromPage)\xFE";
    z += "      MenuBar[\"Websites\"].seperator3 = true\xFE";
    z += "      MenuBar[\"Websites\"][\"Delete Website\"] = {}\xFE";
    z += "      MenuBar[\"Websites\"][\"Delete Website\"].id = \"?deleteWebSiteModel&projectName=\":@UrlEncode(System(27)):\"\"\xFE";
    z += "   End If\xFE";
    z += "\xFE";
    z += "    Dim customMenu As String = 'mdl.':NiceName(edpName):'_customMenu'\xFE";
    z += "    Call @?customMenu(MenuBar)\xFE";
    z += "End Sub"
    window.cached_jsb_mdl["project_menus"] = z;
    var z = "Function putRowDataIntoHtml(ProjectName, objectModel, Row, htmlBackDrop, viewName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    dim ctlHtml As String\xFE";
    z += "    \xFE";
    z += "    If !htmlBackDrop Then Return formViewNColumns(ProjectName, objectModel, False, Row, viewName)\xFE";
    z += "\xFE";
    z += "    BackDropHtml = Change(htmlBackDrop, AM(), CRLF())\xFE";
    z += "    BackDropHtml = Change(BackDropHtml, \"<mdlCtl\", \"<mdlctl\")\xFE";
    z += "\xFE";
    z += "    ' Need to remove all \"<head>\" stuff from htmlBackDrop, It will get replaced with the new Controls\xFE";
    z += "    Loop\xFE";
    z += "        I = Instr(BackDropHtml, '<head')\xFE";
    z += "        J = Instr(I, BackDropHtml, \"</head>\")\xFE";
    z += "    While I <> 0 And J > I Do\xFE";
    z += "        BackDropHtml = Left(BackDropHtml, I-1):Mid(BackDropHtml, J+7)\xFE";
    z += "    Repeat\xFE";
    z += "\xFE";
    z += "    ' Check that each control is defined in the background\xFE";
    z += "    NiceColumnNames = []\xFE";
    z += "\xFE";
    z += "    For Each Column In objectModel.columns\xFE";
    z += "        If Column.control = \"\" Then Column.control = \"textbox\"\xFE";
    z += "        If Column.name = \"\" Then Column.name = \"no id\"\xFE";
    z += "        If Column.display <> \"hidden\" Then\xFE";
    z += "            niceColumnName = @NiceName(Column.name)\xFE";
    z += "            NiceColumnNames[-1] = niceColumnName\xFE";
    z += "\xFE";
    z += "            ' Build New Ctl\xFE";
    z += "            CtlLabel = Column.label\xFE";
    z += "            If !CtlLabel Then CtlLabel = Column.name\xFE";
    z += "            \xFE";
    z += "            callName = LCase(Column.control)\xFE";
    z += "            if left(callName, 4) <> \"ctl_\" then callName = \"ctl_\":callName\xFE";
    z += "            callName = \"jsb_ctls.\":callName\xFE";
    z += "            \xFE";
    z += "            additionalAttrs = [`style='width:auto;`:Column.ctlstyle:`'`]\xFE";
    z += "            If Column.encrypt Then\xFE";
    z += "                H = Row[Column.name]\xFE";
    z += "                Row[Column.name] = Decode(Xts(H))\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "            Call @CallName(ProjectName, (niceColumnName), False, Column, Row, ByRef newCtl, False, additionalAttrs, viewName)\xFE";
    z += "\xFE";
    z += "            If Column.encrypt Then Row[Column.name] = H\xFE";
    z += "\xFE";
    z += "            If Column.pickfunction Then\xFE";
    z += "                If Instr(Column.pickfunction, \".page\") Then PickURL = @DropRight(Column.pickfunction, \".page\") Else PickURL = Column.pickfunction\xFE";
    z += "                PickURL = Replace(PickURL, \"{projectname}\", @UrlEncode(ProjectName))\xFE";
    z += "                newCtl = @jsb_html.addPick(newCtl, niceColumnName, \"Pick a \":CtlLabel, \"80%\", \"90%\", PickURL, Column.autopostback)\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "            ' If Control already exists in BackDropHtml, replace it with the new one we just built\xFE";
    z += "            I = Instr(BackDropHtml, '<mdlctl id=\"ctl_':niceColumnName:'\"')\xFE";
    z += "            If I = 0 Then I = Instr(BackDropHtml, \"<mdlctl id='ctl_\":niceColumnName:\"'\")\xFE";
    z += "            If I Then I = Instr(I, BackDropHtml, \">\":Chr(29)) + 2 ;* Skip To Inner Stuff\xFE";
    z += "\xFE";
    z += "            J = Instr(I, BackDropHtml, Chr(28):\"</mdlctl>\")\xFE";
    z += "\xFE";
    z += "            * Start and stop of MDLCTL found?\xFE";
    z += "            If I And J Then\xFE";
    z += "                OldCtl = Mid(BackDropHtml, I, J-I)\xFE";
    z += "\xFE";
    z += "                If OldCtl <> newCtl Then\xFE";
    z += "                    OldStylesCnt = Count(OldCtl, \"style=\")\xFE";
    z += "                    NewStylesCnt = Count(newCtl, \"style=\")\xFE";
    z += "                    If OldStylesCnt = OldStylesCnt And Left(callName, 9) <> \"ctl_json_\" Then\xFE";
    z += "                        For StyleI = 1 To OldStylesCnt\xFE";
    z += "                            posI = Index(OldCtl, \"style=\", StyleI)\xFE";
    z += "                            posI = posI + Len(\"style=\")\xFE";
    z += "                            oldC = Mid(OldCtl, posI, 1)\xFE";
    z += "                            endI = Instr(Posi + 1, OldCtl, oldC)\xFE";
    z += "                            If !endI Then\xFE";
    z += "                                @Alert(\"unable to find style marker \":oldC:\" in source \": OldCtl)\xFE";
    z += "                                Debug\xFE";
    z += "                            End If\xFE";
    z += "\xFE";
    z += "                            oldStyle = Mid(OldCtl, posI, EndI - posI + 1)\xFE";
    z += "\xFE";
    z += "                            posI = Index(newCtl, \"style=\", StyleI)\xFE";
    z += "                            posI = posI + Len(\"style=\")\xFE";
    z += "                            newC = Mid(newCtl, posI, 1)\xFE";
    z += "                            endI = Instr(Posi + 1, newCtl, newC)\xFE";
    z += "                            If !endI Then\xFE";
    z += "                                @Alert(\"unable to find style marker \":newC:\" in source \": newCtl)\xFE";
    z += "                                Debug\xFE";
    z += "                            End If\xFE";
    z += "\xFE";
    z += "                            newStyle = Mid(newCtl, posI, EndI - posI + 1)\xFE";
    z += "\xFE";
    z += "                            newCtl = Left(newCtl, posI-1):oldStyle:Mid(newCtl, EndI + 1)\xFE";
    z += "\xFE";
    z += "                        Next\xFE";
    z += "                    End If\xFE";
    z += "                End If\xFE";
    z += "\xFE";
    z += "                BackDropHtml = Left(BackDropHtml, I):newCtl:Mid(BackDropHtml, J-1)\xFE";
    z += "\xFE";
    z += "            Else\xFE";
    z += "                ' Place a new control\xFE";
    z += "                C1 = @LblCtlSet(Column.label, newCtl, niceColumnName, Column.fullline, Column.suppresslabel, Column.lblstyle)\xFE";
    z += "\xFE";
    z += "                I = InStrRev(BackDropHtml, \"</mdlctl>\", -1)\xFE";
    z += "                If I Then I = Instr(I, BackDropHtml, \"</div>\")\xFE";
    z += "                If I Then\xFE";
    z += "                    I = I + 6\xFE";
    z += "                    BackDropHtml = Left(BackDropHtml, I-1):C1:Mid(BackDropHtml, I)\xFE";
    z += "                Else\xFE";
    z += "                    BackDropHtml = BackDropHtml:C1\xFE";
    z += "                End If\xFE";
    z += "            End If\xFE";
    z += "            ' End If\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    ' Remove extra controls\xFE";
    z += "    J = 1\xFE";
    z += "    Loop\xFE";
    z += "        DivHeader = '<mdlctl id=\"ctl_'\xFE";
    z += "        I = Instr(J, BackDropHtml, DivHeader)\xFE";
    z += "        J = Instr(I, BackDropHtml, \"</mdlctl>\")\xFE";
    z += "    While I <> 0 And J <> 0 Do\xFE";
    z += "        niceColumnName = Field(Mid(BackDropHtml, I + Len(DivHeader), 60), '\"', 1)\xFE";
    z += "        Locate niceColumnName In NiceColumnNames Setting Spot Else BackDropHtml = Left(BackDropHtml, I-1):Mid(BackDropHtml, J+9)\xFE";
    z += "    Repeat\xFE";
    z += "\xFE";
    z += "    ' Remove extra labels\xFE";
    z += "    J = 1\xFE";
    z += "    Loop\xFE";
    z += "        DivHeader = ' id=\"LBL_'\xFE";
    z += "        I = Instr(J, BackDropHtml, DivHeader)\xFE";
    z += "        J = Instr(I, BackDropHtml, \"</label>\")\xFE";
    z += "    While I <> 0 And J <> 0 Do\xFE";
    z += "        niceColumnName = Field(Mid(BackDropHtml, I + Len(DivHeader), 60), '\"', 1)\xFE";
    z += "        Locate niceColumnName In NiceColumnNames Setting Spot Else\xFE";
    z += "            * Search I backwards for beginning of <label\xFE";
    z += "            I = InStrRev(BackDropHtml, \"<label\", I)\xFE";
    z += "            BackDropHtml = Left(BackDropHtml, I-1):Mid(BackDropHtml, J+8)\xFE";
    z += "        End If\xFE";
    z += "    Repeat\xFE";
    z += "\xFE";
    z += "    Return BackDropHtml\xFE";
    z += "End Function"
    window.cached_jsb_mdl["putrowdataintohtml"] = z;
    window.cached_jsb_mdl["readonlycolumn"] = "Subroutine readOnlyColumn(ProjectName, PageName, ViewName, ColumnID)\xFE    * %options aspxC-\xFE    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE    ColumnIdx = @findViewColumn(dataSet, ColumnID)\xFE    If ColumnIdx = 0 Then Return\xFE    dataSet.columns[ColumnIdx].canedit = !dataSet.columns[ColumnIdx].canedit\xFE    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edc-\":System(28):\": \":@Errors\xFE    Call @jsb_mdl.ReGenPageModel(ProjectName, PageName, False)\xFEEnd Subroutine";
    window.cached_jsb_mdl["rebuild"] = "// Use from TCL \xFEProgram rebuild\xFE* %options aspxC-\xFE   Chain \"Regen \":DropLeft(@Sentence, \" \",1)\xFEEnd program";
    var z = "function refreshViewModel(ByVal ViewName As String, ByVal viewModel As Json, Optional ByVal mergeDict As Boolean, Optional ByVal getAllDictCols As Boolean) As JSon\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    dictTableMeta = {}\xFE";
    z += "    dictTableMeta.tableName = viewModel.tableName\xFE";
    z += "    dictTableMeta.columns = @getTableColumnDefs(viewModel.tableName, False, True) ;* Suppress Messages, doRefresh\xFE";
    z += "\xFE";
    z += "    ' Insure every dictColumn(!) exists in viewColumns\xFE";
    z += "    viewColumns = viewModel.columns\xFE";
    z += "    For Each dictColumn In dictTableMeta.columns\xFE";
    z += "        FoundIt = False\xFE";
    z += "        For Each viewColumn In viewColumns\xFE";
    z += "            If viewColumn.name = dictColumn.name Then\xFE";
    z += "                FoundIt = True\xFE";
    z += "                Exit For\xFE";
    z += "            End If\xFE";
    z += "        Next\xFE";
    z += "\xFE";
    z += "        If FoundIt Then\xFE";
    z += "            If mergeDict Then\xFE";
    z += "                For Each Tn In dictColumn\xFE";
    z += "                    If Tn <> \"name\" And Tn <> \"index\" Then viewColumn[Tn] = dictColumn[Tn]\xFE";
    z += "                Next\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "        ElseIf getAllDictCols Then\xFE";
    z += "            * Not found\xFE";
    z += "            If mergeDict Then\xFE";
    z += "                viewColumn = JSon(CStr(dictColumn))\xFE";
    z += "            End Else\xFE";
    z += "                viewColumn = {}\xFE";
    z += "                viewColumn.name = dictColumn.name\xFE";
    z += "                Updated = 1\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "            Call setColumnDefaults(dictColumn.datatype, viewColumn)\xFE";
    z += "\xFE";
    z += "            viewColumns[-1] = viewColumn\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    ' Remove any extra view columns from view not found in the Table (DICT)\xFE";
    z += "    'For ColumnsListI = 1 to UBound(viewColumns) while ColumnsListI <= UBound(viewColumns)\xFE";
    z += "    '   viewColumn = viewColumns[ColumnsListI]\xFE";
    z += "    '   FoundIt = false\xFE";
    z += "    '   For Each dictColumn In dictTableMeta.columns\xFE";
    z += "    '      If viewColumn.name = dictColumn.name Then\xFE";
    z += "    '         FoundIt = true\xFE";
    z += "    '         Exit For\xFE";
    z += "    '      End If\xFE";
    z += "    '   Next\xFE";
    z += "    '   If FoundIt = False Then \xFE";
    z += "    '      viewColumns.Delete(ColumnsListI)\xFE";
    z += "    '      ColumnsListI = ColumnsListI - 1\xFE";
    z += "    '      Updated = 1\xFE";
    z += "    '   End If\xFE";
    z += "    '   if !viewColumn.index Then\xFE";
    z += "    '      viewColumn.index = ColumnsListI\xFE";
    z += "    '      Updated = 1\xFE";
    z += "    '   End If\xFE";
    z += "    'Next\xFE";
    z += "\xFE";
    z += "    viewColumns = @Sort(viewColumns, \"#index\")\xFE";
    z += "\xFE";
    z += "    If Updated Then viewModel.columns = viewColumns\xFE";
    z += "\xFE";
    z += "    If Not(mergeDict) And Updated Then\xFE";
    z += "        Open \"DICT\", viewModel.tableName To fDictHandle Else Stop @(-1):\"refreshViewModel: edv: \":@Errors\xFE";
    z += "\xFE";
    z += "        WriteJSon viewModel On fDictHandle, ViewName Else Null\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Return viewModel\xFE";
    z += "End Sub\xFE";
    z += ""
    window.cached_jsb_mdl["refreshviewmodel"] = z;
    var z = "Program ReGen\xFE";
    z += "* %options aspxC-\xFE";
    z += "    If  !IsAdmin() Then Stop \"You are not an administrator\"\xFE";
    z += "    \xFE";
    z += "    Dim IgnoreFileNotFound As Boolean = False\xFE";
    z += "    Dim DftAllItems As Boolean = False\xFE";
    z += "    Dim Help As Array = ['ReGen <TableName> <itemnames> (N']\xFE";
    z += "    Help[-1] = \"   option N)o inline modeler generation\"\xFE";
    z += "    \xFE";
    z += "    $Include Jsb_tcl __shell\xFE";
    z += "    \xFE";
    z += "    if !f_file then stop Replace(help, am(), crlf())\xFE";
    z += "    if !INames Then Chain \"ReGenWebSiteModel \":Fname\xFE";
    z += "    \xFE";
    z += "    Fname = UCase(TrueTableName(TableName))\xFE";
    z += "    if fname = \"jsb_docs\" then stop \"Try compile jsb_docs instead\"\xFE";
    z += "\xFE";
    z += "    noModelingStuff = InStr(Options, \"N\")\xFE";
    z += "    fDict = @fHandle(\"dict\", Fname)\xFE";
    z += "    \xFE";
    z += "    Errors = []\xFE";
    z += "    lcTime = @Session(\"LastMenuCompile_\":Fname)\xFE";
    z += "    \xFE";
    z += "    For each iName As String, ItemI As Integer In INames\xFE";
    z += "        Iname = @DropIfRight(Iname, \".view\", True)\xFE";
    z += "        Iname = @DropIfRight(Iname, \".page\", True)\xFE";
    z += "        \xFE";
    z += "        if left(iname, 1) = \"_\" then cycle\xFE";
    z += "        \xFE";
    z += "        pageName = Iname:\".page\"\xFE";
    z += "        ReadJson pageDataSet From fDict, pageName then\xFE";
    z += "            @Session(\"LastMenuCompile_\":Fname) = Time() + 30 // delay until end\xFE";
    z += "            Call ReGenPageModel(Fname, Iname, True /* showResults */, True /* No Stopping */, noModelingStuff)\xFE";
    z += "            @Server.Flush\xFE";
    z += "        Else\xFE";
    z += "            Errors[-1] = \"Unable to find page: \":Fname:\" \":pageName\xFE";
    z += "        end if\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    If Errors Then Print MonoSpace(Join(Errors, crlf()))\xFE";
    z += "    \xFE";
    z += "    @Session(\"LastMenuCompile_\":Fname) = lcTime ' restore previous def\xFE";
    z += "\xFE";
    z += "    call updateMenu(Fname)\xFE";
    z += "    Stop 'Done'\xFE";
    z += "End Program"
    window.cached_jsb_mdl["regen"] = z;
    var z = "Sub ReGenPageModel(byVal ProjectName, byVal ipageName, byVal showResults, optional byval NoStopping, optional byval noModelingStuff)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    pageName = @DropIfRight(ipageName, \".page\", True):\".page\"\xFE";
    z += "\xFE";
    z += "    ReadJson pageDataSet From @fHandle(\"dict\", ProjectName), pageName Else\xFE";
    z += "        Print \"Unable to find page \":PageName:\" \":@Errors\xFE";
    z += "        Return\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Call updateMenu(ProjectName)\xFE";
    z += "    @jsb_mdl.GenerateCodeFromTemplate(ProjectName, \"JSB_pageTemplates\", \"\" /* parentObjectName */, Null /* parentObject */, pageName /* objectName */, \"\" /* output */, compileResults, noModelingStuff)\xFE";
    z += "    If ShowResults Then\xFE";
    z += "        If compileResults Then\xFE";
    z += "            if NoStopping Then Print compileResults Else Print @(-1):compileResults:@SubmitBtn('edv_formBtn', 'OK'); @Server.Pause\xFE";
    z += "        ElseIf !NoStopping Then\xFE";
    z += "            Alert(\"Sucessful generation of page \":pageName)\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "    ElseIf Instr(compileResults, \"^\") Then\xFE";
    z += "        if NoStopping Then Print compileResults Else Print @(-1):compileResults:@SubmitBtn('edv_formBtn', 'OK'); @Server.Pause\xFE";
    z += "    End If\xFE";
    z += "End Sub\xFE";
    z += "Program ReGenPageModel\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    if !isManager() Then Stop \"You must be at least a data manager to run program\"\xFE";
    z += "\xFE";
    z += "    ProjectName = @ParamVar('ProjectName')\xFE";
    z += "    pageName = @ParamVar('pageName')\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "\xFE";
    z += "    If ProjectName = \"\" And InStr(@Sentence, '=') = 0 Then\xFE";
    z += "        Sentence = Field(@Sentence, \"(\", 1)\xFE";
    z += "        ProjectName = Field(Sentence, \" \", 2)\xFE";
    z += "        pageName = Field(Sentence, \" \", 3)\xFE";
    z += "        If LCase(ProjectName) = \"dict\" Then\xFE";
    z += "            ProjectName = Field(Sentence, \" \", 3)\xFE";
    z += "            pageName = Field(Sentence, \" \", 4)\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Print @(-1):\"Working...\":\xFE";
    z += "    Call ReGenPageModel(ProjectName, pageName, False /* showResults */)\xFE";
    z += "\xFE";
    z += "    Print @(-1):\"Complete..\":\xFE";
    z += "    If fromPage Then @Response.Redirect(fromPage)\xFE";
    z += "    if !system(22) then ResponseRedirect(@jsbRootExecute(pageName))\xFE";
    z += "End Function"
    window.cached_jsb_mdl["regenpagemodel"] = z;
    var z = "Program ReGenWebSiteModel\xFE";
    z += "* %options aspxC-\xFE";
    z += "    If !IsAdmin() Then Stop \"You must be an administrator to run this command\"\xFE";
    z += "\xFE";
    z += "    ProjectName = @ParamVar('ProjectName')\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "\xFE";
    z += "    If ProjectName = \"\" And Instr(@Sentence, \"=\") = 0 Then\xFE";
    z += "        Sentence = Field(@Sentence, \"(\", 1)\xFE";
    z += "        ProjectName = Field(Sentence, \" \", 2)\xFE";
    z += "    End If\xFE";
    z += "    If !ProjectName Then ProjectName = \"cs\"\xFE";
    z += "\xFE";
    z += "    Open \"\", ProjectName To Scp Else Goto Done\xFE";
    z += "    Open \"dict\", ProjectName To Dscp Else Goto Done\xFE";
    z += "\xFE";
    z += "    Print @(-1):\xFE";
    z += "    Select Dscp To Sl Where \"ItemID Like '%.page'\" Else Stop @Errors\xFE";
    z += "    L = Getlist(Sl)\xFE";
    z += "    \xFE";
    z += "    L = @inputMultiSelect('Select pages to regenerate', 'Pages', L, L)\xFE";
    z += "    If Len(L) = 0 Or L = Chr(27) Then Goto Done\xFE";
    z += "    \xFE";
    z += "    For Each Id In L\xFE";
    z += "        If Id <> \".page\" Then\xFE";
    z += "            Print \"-------------------------------------------------------\"\xFE";
    z += "            Print Id\xFE";
    z += "            @Session(\"LastMenuCompile_\":id) = Time() + 30\xFE";
    z += "            Call ReGenPageModel(ProjectName, Id, True /* showResults */)\xFE";
    z += "            @Server.flush\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    @Session(\"LastMenuCompile_\":id) = Time() - 30\xFE";
    z += "    call updateMenu(id)\xFE";
    z += "    Print @MsgBox('done')\xFE";
    z += "\xFE";
    z += "Done: \xFE";
    z += "    If fromPage Then @Response.Redirect(fromPage)\xFE";
    z += "    If @hasTclParent Or @hasParentProcess Then Stop\xFE";
    z += "End Program"
    window.cached_jsb_mdl["regenwebsitemodel"] = z;
    var z = "Program renamePageModel\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    if !isManager() Then Stop \"You must be at least a data manager to run program\"\xFE";
    z += "\xFE";
    z += "    ProjectName = @ParamVar('ProjectName')\xFE";
    z += "    oldPageName = @ParamVar('pageName')\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "    closeWindow = @ParamVar('closeWindow')\xFE";
    z += "\xFE";
    z += "    If ProjectName = \"\" And InStr(@Sentence, '=') = 0 Then\xFE";
    z += "        Sentence = Field(@Sentence, \"(\", 1)\xFE";
    z += "        ProjectName = Field(Sentence, \" \", 2)\xFE";
    z += "        oldPageName = Field(Sentence, \" \", 3)\xFE";
    z += "        If LCase(ProjectName) = \"dict\" Then\xFE";
    z += "            ProjectName = Field(Sentence, \" \", 3)\xFE";
    z += "            oldPageName = Field(Sentence, \" \", 4)\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "    oldPageName = @DropIfRight(oldPageName, \".page\", True)\xFE";
    z += "    \xFE";
    z += "    newPageName = Trim(@InputBox(\"Rename\", \"Enter a new name\", \"\", \"80%\", \"\"))\xFE";
    z += "    newPageName = @DropIfRight(newPageName, \".page\", True)\xFE";
    z += "    If newPageName = Chr(27) Or newPageName = \"\" Then\xFE";
    z += "        If fromPage Then ResponseRedirect(fromPage)\xFE";
    z += "        If closeWindow Or !@hasParentProcess Then @Server.End\xFE";
    z += "        ResponseRedirect(@jsbRootExecute(oldPageName))\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    @Session(\"LastMenuCompile_\":ProjectName) = Time() - 30\xFE";
    z += "    \xFE";
    z += "    If clonePageModel(ProjectName, oldPageName, newPageName) Then\xFE";
    z += "        @deletePageModel(ProjectName, oldPageName)\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    If fromPage Or @hasTclParent Then\xFE";
    z += "        If MsgBox(\"Where to?\", \"Go to new page?\", \"*Yes,No\") <> \"Yes\" Then ResponseRedirect(fromPage)\xFE";
    z += "    Else\xFE";
    z += "        If closeWindow Or !@hasParentProcess Then @Server.End\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    if @hasTclParent then Stop \"Done\"\xFE";
    z += "    \xFE";
    z += "    ResponseRedirect(@jsbRootExecute(newPageName))\xFE";
    z += "End Program"
    window.cached_jsb_mdl["renamepagemodel"] = z;
    var z = "function RenameView(ProjectName, pageName, ViewName, newViewName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    ViewName = @DropIfRight(ViewName, \".view\", True)\xFE";
    z += "    fDict = @fHandle(\"DICT\", ProjectName)\xFE";
    z += "    \xFE";
    z += "    ReadJSon dataSet From fDict, ViewName:\".view\" Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "\xFE";
    z += "    If !newViewName Then\xFE";
    z += "        newViewName = Trim(@InputBox(\"Rename view\", \"Enter a new name\", ViewName, \"80%\", \"\"))\xFE";
    z += "        If newViewName = Chr(27) Or newViewName = \"\" Then Return False\xFE";
    z += "        \xFE";
    z += "        newViewName = @DropIfRight(newViewName, \".view\", True)\xFE";
    z += "        if LCase(newViewName) = LCase(ViewName) Then Return False\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    newViewName = @DropIfRight(newViewName, \".view\", True)\xFE";
    z += "    Read Tmp From fDict, newViewName:\".view\" Then\xFE";
    z += "        @Alert(newViewName:\" already exists\", False)\xFE";
    z += "        Return False\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    if CloneViewTo(ProjectName, ProjectName, ViewName, newViewName) then\xFE";
    z += "        DeleteView(ProjectName, pageName, ViewName, false)\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    ViewName = newViewName:\".view\"\xFE";
    z += "    Return True\xFE";
    z += "End function"
    window.cached_jsb_mdl["renameview"] = z;
    window.cached_jsb_mdl["requirecolumn"] = "Subroutine requireColumn(ProjectName, PageName, ViewName, ColumnID)\xFE    * %options aspxC-\xFE    \xFE    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE    ColumnIdx = @findViewColumn(dataSet, ColumnID)\xFE    If ColumnIdx = 0 Then Return\xFE    dataSet.columns[ColumnIdx].required = !dataSet.columns[ColumnIdx].required\xFE    dataSet.columns[ColumnIdx].notblank = dataSet.columns[ColumnIdx].notblank\xFE    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edc-\":System(28):\": \":@Errors\xFE    Call @jsb_mdl.ReGenPageModel(ProjectName, PageName, False)\xFEEnd Subroutine";
    var z = "Subroutine RequiredColumns(ProjectName, pageName, ViewName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE";
    z += "\xFE";
    z += "    allColumns = []\xFE";
    z += "    SelColumns = []\xFE";
    z += "    For Each Column In dataSet.columns\xFE";
    z += "        CName = Trim(Column.name)\xFE";
    z += "        If CName Then\xFE";
    z += "            allColumns[-1] = CName\xFE";
    z += "            If Column.required Or Column.notblank Then SelColumns[-1] = CName\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    SelectedCols = @Jsb_bf.InputMultiSelect(\"Required Columns\", \"Select required columns:\", allColumns, SelColumns, \"50%\", \"80%\")\xFE";
    z += "    If SelectedCols = \"\" Or SelectedCols = Chr(27) Then Return\xFE";
    z += "\xFE";
    z += "    For Each Column In dataSet.columns\xFE";
    z += "        CName = Trim(Column.name)\xFE";
    z += "        Locate CName In SelectedCols Then Column.required = True Else Column.required = False\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "    Call @Jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFE";
    z += "End Sub"
    window.cached_jsb_mdl["requiredcolumns"] = z;
    window.cached_jsb_mdl["resetbackground"] = "Function resetBackground(ByVal ProjectName As String, ByVal objectModel As JSON, ByRef htmlBackDrop As String, ByVal viewName As String)\xFE    * %options aspxC-\xFE    \xFE    Ans = @MsgBox(\"Warning!\", \"Reset background to:\", \"New,Appended Columns,No Format,Cancel\") ;* FormView\xFE    Select Case Ans\xFE        Case \"Appended Columns\"\xFE            htmlBackDrop = @putRowDataIntoHtml(ProjectName, objectModel, {}, htmlBackDrop, viewName)\xFE\xFE        Case \"New\"\xFE            htmlBackDrop = \"\"\xFE\xFE        Case \"No Format\"\xFE            htmlBackDrop = @standardFormView(ProjectName, objectModel, False, viewName)\xFE\xFE        Case Else\xFE            Return False\xFE    End Select\xFE\xFE    Return True\xFEEnd Function";
    window.cached_jsb_mdl["responseredirect"] = "function ResponseRedirect(toPage)\xFE    * %options aspxC-\xFE    \xFE    print @(-1):@Script('window.open(':jsEscapeString(toPage):')'):\xFE    @Server.Flush\xFE    Stop\xFEEnd Function";
    var z = "// This is a restful api function\xFE";
    z += "//   - paramters:\xFE";
    z += "//      databaseName\xFE";
    z += "//      tableName\xFE";
    z += "//\xFE";
    z += "//  - optional parameters:\xFE";
    z += "//      skip\xFE";
    z += "//      take\xFE";
    z += "//      requireTotalCount\xFE";
    z += "//      requireGroupCount\xFE";
    z += "//      sort\xFE";
    z += "//      filter\xFE";
    z += "//      totalSummary\xFE";
    z += "//      groupSummary\xFE";
    z += "//\xFE";
    z += "\xFE";
    z += "program restApiFetch()\xFE";
    z += "    Dim noTimeOut As String = System(56)\xFE";
    z += "    Dim clause As Json \xFE";
    z += "    Dim databaseName As String = @jsb_bf.ParamVar('databaseName')\xFE";
    z += "    Dim tableName As String = @jsb_bf.ParamVar('tableName')\xFE";
    z += "    \xFE";
    z += "    Dim result As Json\xFE";
    z += "    \xFE";
    z += "    attachdb databaseName else result = { errors: @errors }; rtnResult(result); return\xFE";
    z += "    Dim fTable As FileHandle\xFE";
    z += "    open tableName to fTable Else result = { errors: @errors }; rtnResult(result); return\xFE";
    z += "    \xFE";
    z += "    if !isSqlServer(fTable) then result = { errors: \"not a arySQL table\" }; rtnResult(result); return\xFE";
    z += "    \xFE";
    z += "    Dim skip As String = @jsb_bf.ParamVar('skip')\xFE";
    z += "    Dim take As String = @jsb_bf.ParamVar('take')\xFE";
    z += "    Dim requireTotalCount As String = @jsb_bf.ParamVar('requireTotalCount')\xFE";
    z += "    Dim requireGroupCount As String = @jsb_bf.ParamVar('requireGroupCount')\xFE";
    z += "    Dim order As String = @jsb_bf.ParamVar('sort') // [{selector:Age, desc:false}]\xFE";
    z += "    Dim Filter As String = @jsb_bf.ParamVar('filter')\xFE";
    z += "    Dim totalSummary As String = @jsb_bf.ParamVar('totalSummary')\xFE";
    z += "    Dim group As String = @jsb_bf.ParamVar('group')\xFE";
    z += "    Dim groupSummary As String = @jsb_bf.ParamVar('groupSummary')\xFE";
    z += "    \xFE";
    z += "    if Len(take) then \xFE";
    z += "        Take = \" fetch next \":take:\" rows only\"\xFE";
    z += "        if !len(Skip) then skip = \"0\"\xFE";
    z += "        skip = \"  Offset \":Skip:\" rows\"\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Dim filterByClause As String = \"\"\xFE";
    z += "    if filter then\xFE";
    z += "        Dim filterBy As Array = restApiBuildWhere(json(filter))\xFE";
    z += "        filterByClause = Join(filterBy, \" \")\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    // simple fetch: skip=0&take=12&requireTotalCount=true\xFE";
    z += "    Dim orderByClause As String = \"\"\xFE";
    z += "    dim aryOrder As Array = []\xFE";
    z += "    Dim orderBy As Array = []\xFE";
    z += "    Dim arySQL As Array = []\xFE";
    z += "    \xFE";
    z += "    Dim sl As SelectList\xFE";
    z += "    \xFE";
    z += "    if !group then\xFE";
    z += "        if order then\xFE";
    z += "            aryOrder = json(order)\xFE";
    z += "            for each clause in aryOrder\xFE";
    z += "                orderBy[-1] = \"[\":clause.selector:\"]\":iif(clause.desc, ' desc', '')\xFE";
    z += "            next\xFE";
    z += "            orderByClause = Join(orderBy, \", \")\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        if filterByClause then filterByClause = \" where \":filterByClause\xFE";
    z += "        \xFE";
    z += "        if !orderByClause then \xFE";
    z += "            Dim pk As String = fTable.PrimaryKeyColumnName()\xFE";
    z += "            if pk then orderByClause = \" [\":pk:\"]\" else result = { errors: 'No primary key in table ':tableName:`; `:databaseName }; rtnResult(result); return\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        if orderByClause Then orderByClause = \" order by \":orderByClause\xFE";
    z += "        \xFE";
    z += "        Dim sqlcmd As String = \"Select * from [\":tableName:\"]\":filterByClause:orderByClause:skip:take\xFE";
    z += "        \xFE";
    z += "        SqlSelect Sqlcmd to sl else result = { errors: @errors:\"; \":databaseName:\": \":arySQL }; rtnResult(result); return\xFE";
    z += "        \xFE";
    z += "        Dim recs As Array = getList(sl)\xFE";
    z += "\xFE";
    z += "        result =  {  data: recs }\xFE";
    z += "        if requireTotalCount then \xFE";
    z += "            result.totalCount = fTable.Execute(\"Select Count(*) From [\":tableName:\"]\":filterByClause)\xFE";
    z += "            result.totalCount = result.totalCount + 0\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        rtnResult(result); return\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    // grouping request: databaseName=sgs tableName=strm_fish & group=[{\"selector\":\"SexDeterminationID\",\"desc\":false,\"isExpanded\":false}]\xFE";
    z += "    \xFE";
    z += "    if !group Then group = \"[]\"\xFE";
    z += "    Dim aryGroup As Array = json(group)\xFE";
    z += "    \xFE";
    z += "    for grpI As Integer = UBound(aryGroup) + 1 To 1 Step -1\xFE";
    z += "        Dim newSQL As Array = []\xFE";
    z += "        \xFE";
    z += "        if grpI > UBound(aryGroup) Then\xFE";
    z += "            newSQL[-1] = `(select * from [`:tableName:`] As F`:GrpI\xFE";
    z += "        else\xFE";
    z += "            clause = aryGroup[grpI]\xFE";
    z += "            if clause.isExpanded then\xFE";
    z += "                newSql[-1] = iif(grpI > 1, `(`, ``):`select [`:clause.selector:`] As \"key\", count(*) As \"count\", items = `\xFE";
    z += "                for each innserSQL As String in arySQL\xFE";
    z += "                    newSql[-1] = `   `:innserSQL\xFE";
    z += "                next\xFE";
    z += "            else\xFE";
    z += "                newSql[-1] = iif(grpI > 1, `(`, ``):`select [`:clause.selector:`] As \"key\", count(*) As \"count\", items = null`\xFE";
    z += "            end if\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        Dim wc As Array = []\xFE";
    z += "        if grpI = 1 then\xFE";
    z += "            if filterByClause then wc[-1] = filterByClause\xFE";
    z += "        Else\xFE";
    z += "            for grpI2 As Integer = 1 to grpI-1\xFE";
    z += "                Dim clause2 As Json = aryGroup[grpI2]\xFE";
    z += "                wc[-1] = `F`:GrpI2:`.[`:clause2.selector:`] = F`:GrpI:`.[`:clause2.selector:`]`\xFE";
    z += "            next\xFE";
    z += "        End If\xFE";
    z += "\xFE";
    z += "        if grpI <= UBound(aryGroup) Then\xFE";
    z += "            newSql[-1] = `   from [`:tableName:`] As F`:GrpI\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        if wc then newSql[-1] = `   where `:Join(wc, ` And `)\xFE";
    z += "\xFE";
    z += "        If grpI > UBound(aryGroup) Then \xFE";
    z += "            orderBy = []\xFE";
    z += "            Dim alreadyDone As Array = []\xFE";
    z += "            \xFE";
    z += "            \xFE";
    z += "            for each clause in aryGroup\xFE";
    z += "                orderBy[-1] = \"[\":clause.selector:\"]\":iif(clause.desc, ' desc', '')\xFE";
    z += "                alreadyDone[-1] = clause.selector\xFE";
    z += "            next\xFE";
    z += "            \xFE";
    z += "            for each clause in aryOrder\xFE";
    z += "                locate clause.selector in alreadyDone else\xFE";
    z += "                    orderBy[-1] = \"[\":clause.selector:\"]\":iif(clause.desc, ' desc', '')\xFE";
    z += "                    alreadyDone[-1] = clause.selector\xFE";
    z += "                end if\xFE";
    z += "            next\xFE";
    z += "        \xFE";
    z += "            newSql[-1] = `   Order By `:Join(orderBy, \", \")\xFE";
    z += "            \xFE";
    z += "        Else\xFE";
    z += "            newSql[-1] = `   Group By [`:clause.selector:`] Order By [`:clause.selector:`]`:iif(clause.desc, ' desc', '')\xFE";
    z += "\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        if grpI > 1 then \xFE";
    z += "            newSql[-1] = `   for json auto, INCLUDE_NULL_VALUES `\xFE";
    z += "            newSql[-1] = `)`\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        arySQL = newSQL\xFE";
    z += "    next\xFE";
    z += "    \xFE";
    z += "    dim sSQL As String = Join(arySQL, crlf())\xFE";
    z += "    \xFE";
    z += "    SqlSelect sSql to sl else result = { errors: @errors:`; `:databaseName:`: `:sSQL }; rtnResult(result); return\xFE";
    z += "    dim sqlDataSet As Array = getList(sl)\xFE";
    z += "    \xFE";
    z += "    if UBound(aryGroup) > 1 Then\xFE";
    z += "        for each rec As Json in sqlDataSet\xFE";
    z += "            rec.items = json(rec.items)\xFE";
    z += "        next\xFE";
    z += "    end if\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "    result = {  data: sqlDataSet }\xFE";
    z += "end program\xFE";
    z += "\xFE";
    z += "function rtnResult(byRef Result As String)\xFE";
    z += "    @Response.Buffer(''); \xFE";
    z += "    @Response.Header.Set('Content-Type', 'application/json'); \xFE";
    z += "    @Response.BinaryWrite(result)\xFE";
    z += "    @Server.End\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "function restApiBuildWhere(byVal filter As Array)\xFE";
    z += "    filterBy = []\xFE";
    z += "    for each clause As Object in filter\xFE";
    z += "        Dim c As String = \"\"\xFE";
    z += "        \xFE";
    z += "        if isArray(clause) Then\xFE";
    z += "            if isArray(clause[1]) Then\xFE";
    z += "                c = \"(\":restApiBuildWhere(clause):\")\"\xFE";
    z += "            else if UBound(clause) = 3 then\xFE";
    z += "                if isNull(clause[3]) then \xFE";
    z += "                    if clause[2] = \"=\" then clause[2] ='Is' else clause[2] = 'Is Not'\xFE";
    z += "                    clause[3] = 'null'\xFE";
    z += "                \xFE";
    z += "                else \xFE";
    z += "                    clause[3] = \"'\":clause[3]:\"'\"\xFE";
    z += "                    \xFE";
    z += "                end if\xFE";
    z += "        \xFE";
    z += "                c = \"[\":clause[1]:\"] \":clause[2]:\" \":clause[3]\xFE";
    z += "            else\xFE";
    z += "                c = join(clause, ' ')\xFE";
    z += "            end if\xFE";
    z += "        else\xFE";
    z += "            c = clause\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        filterBy[-1] = c\xFE";
    z += "    next\xFE";
    z += "    \xFE";
    z += "    return join(filterBy, ' ')\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "/* Group fetch\xFE";
    z += "    if orderby then\xFE";
    z += "        // [{\"selector\":\"OrderNumber\",\"desc\":false}]\xFE";
    z += "        orderby = cjson(orderby)\xFE";
    z += "        sp = []\xFE";
    z += "        if !metaData then metaData = getColumnMeta()\xFE";
    z += "        metaByName = {}\xFE";
    z += "        for each meta in metaData\xFE";
    z += "           metaByName[meta.dataField] = meta\xFE";
    z += "        next\xFE";
    z += "        for each clause in orderBy \xFE";
    z += "        \xFE";
    z += "            meta = metaByName[clause.selector]\xFE";
    z += "            if !meta then meta = { dataType: 'xnumber' }\xFE";
    z += "            \xFE";
    z += "            // dataField: 'Amount',\xFE";
    z += "            // caption: 'Sale Amount',\xFE";
    z += "            // dataType: 'number',\xFE";
    z += "            // format: 'currency',\xFE";
    z += "            // alignment: 'right',\xFE";
    z += "\xFE";
    z += "            // Options may be # (numeric), \"<\" descending, \">\" ascending, \"!\" rightJustify, ~ ignorecase\xFE";
    z += "            sp[-1] = iif(meta.dataType = 'number', \"#\", ''):iif(clause.desc, \"<\", \">\"):clause.selector\xFE";
    z += "        next\xFE";
    z += "        \xFE";
    z += "        debug\xFE";
    z += "        \xFE";
    z += "        recs = sort(recs, Join(sp, \",\"))\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "*/"
    window.cached_jsb_mdl["restapifetch"] = z;
    window.cached_jsb_mdl["rowhasnumbers"] = "function rowHasNumbers(Row)\xFE    // Does the header contain numbers?  Problably not a header then\xFE    numbersInHdr = 0\xFE    for each term in Row\xFE        if isNum(term) then numbersInHdr += 1\xFE    next\xFE    return numbersInHdr\xFEend function";
    var z = "Subroutine setButtonURL(ProjectName, PageName, ViewName, ColumnID)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE";
    z += "    ColumnIdx = @findViewColumn(dataSet, ColumnID)\xFE";
    z += "    If ColumnIdx = 0 Then Return\xFE";
    z += "    \xFE";
    z += "    Btn = [{ }]\xFE";
    z += "    Btn[1].label = dataSet.columns[ColumnIdx].label\xFE";
    z += "    Btn[1].datausuage = dataSet.columns[ColumnIdx].datausuage\xFE";
    z += "    Btn[1].transferto = dataSet.columns[ColumnIdx].transferto\xFE";
    z += "    Btn[1].transferurl = dataSet.columns[ColumnIdx].transferurl\xFE";
    z += "    Btn[1].onParentExtra = dataSet.columns[ColumnIdx].onParentExtra\xFE";
    z += "    Btn[1].transferaddfrompage = dataSet.columns[ColumnIdx].transferaddfrompage\xFE";
    z += "\xFE";
    z += "    Btn = @Popup_jsondef(projectName, \"jsb_jsondefs\", \"buttonurl\", \"\", \"\", Btn, \"80%\", \"auto\", \"Button selections for view \":ViewName:\" \":ColumnID)\xFE";
    z += "    \xFE";
    z += "    If Len(Btn) Then\xFE";
    z += "        dataSet.columns[ColumnIdx].label = Btn[1].label\xFE";
    z += "        dataSet.columns[ColumnIdx].datausuage = Btn[1].datausuage\xFE";
    z += "        dataSet.columns[ColumnIdx].transferto = Btn[1].transferto\xFE";
    z += "        dataSet.columns[ColumnIdx].transferurl = Btn[1].transferurl\xFE";
    z += "        dataSet.columns[ColumnIdx].onParentExtra = Btn[1].onParentExtra\xFE";
    z += "        dataSet.columns[ColumnIdx].transferaddfrompage = Btn[1].transferaddfrompage\xFE";
    z += "\xFE";
    z += "        WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edc-\":System(28):\": \":@Errors\xFE";
    z += "        Call @jsb_mdl.ReGenPageModel(ProjectName, PageName, False)\xFE";
    z += "    End If\xFE";
    z += "End Subroutine"
    window.cached_jsb_mdl["setbuttonurl"] = z;
    var z = "Sub setColumnDefaults(Datatype, viewColumn)\xFE";
    z += "   * %options aspxC-\xFE";
    z += "   *\xFE";
    z += "   * Setup defaults\xFE";
    z += "   * \xFE";
    z += "    viewColumn.display = \"visible\"\xFE";
    z += "    viewColumn.width = 12\xFE";
    z += "    viewColumn.control = \"textbox\"\xFE";
    z += "    viewColumn.canedit = True\xFE";
    z += "    viewColumn.suppresslabel = False\xFE";
    z += "    viewColumn.fullline = False\xFE";
    z += "    viewColumn.ctlstyle = \"\"\xFE";
    z += "\xFE";
    z += "    Select Case Datatype\xFE";
    z += "        Case \"guid\":\xFE";
    z += "            viewColumn.control = \"label\"\xFE";
    z += "\xFE";
    z += "        Case \"autointeger\":\xFE";
    z += "            viewColumn.control = \"label\"\xFE";
    z += "\xFE";
    z += "        Case \"integer\":\xFE";
    z += "            viewColumn.control = \"textbox\"\xFE";
    z += "\xFE";
    z += "        Case \"double\":\xFE";
    z += "            viewColumn.control = \"textbox\"\xFE";
    z += "\xFE";
    z += "        Case \"boolean\":\xFE";
    z += "            viewColumn.control = \"checkbox\"\xFE";
    z += "\xFE";
    z += "        Case \"string\":\xFE";
    z += "            viewColumn.control = \"textbox\"\xFE";
    z += "\xFE";
    z += "        Case \"date\":\xFE";
    z += "            viewColumn.control = \"datebox\"\xFE";
    z += "\xFE";
    z += "        Case \"time\":\xFE";
    z += "            viewColumn.control = \"timebox\"\xFE";
    z += "\xFE";
    z += "        Case \"datetime\":\xFE";
    z += "            viewColumn.control = \"datetimebox\"\xFE";
    z += "\xFE";
    z += "        Case \"currency\":\xFE";
    z += "            viewColumn.control = \"currencyboxUS\"\xFE";
    z += "\xFE";
    z += "        Case \"blob\":\xFE";
    z += "            viewColumn.display = \"hidden\"\xFE";
    z += "\xFE";
    z += "        Case \"jpg\":\xFE";
    z += "            viewColumn.control = \"uploadimagebox\"\xFE";
    z += "\xFE";
    z += "        Case \"png\":\xFE";
    z += "            viewColumn.control = \"uploadimagebox\"\xFE";
    z += "\xFE";
    z += "        Case \"url\":\xFE";
    z += "            viewColumn.control = \"urlbox\"\xFE";
    z += "\xFE";
    z += "        Case \"memo\":\xFE";
    z += "            viewColumn.control = \"htmlbox\"\xFE";
    z += "            viewColumn.fullline = True\xFE";
    z += "\xFE";
    z += "        Case \"password\":\xFE";
    z += "            viewColumn.control = \"passwordbox\"\xFE";
    z += "\xFE";
    z += "        Case \"jsonarray\":\xFE";
    z += "            viewColumn.control = \"jsonarray\"\xFE";
    z += "\xFE";
    z += "    End Select\xFE";
    z += "End Sub"
    window.cached_jsb_mdl["setcolumndefaults"] = z;
    window.cached_jsb_mdl["setdefaults"] = "Function setDefaults(objectName, Columns, Row)\xFE    Changed = False\xFE \xFE    For Each Column In Columns\xFE        cName = Column.name\xFE        If cName Then\xFE            If IsNothing(Row[cName]) Then\xFE                dValue = getDefaultValue(Row[cName], Column.defaultvalue, cName, objectName)\xFE                If !IsNothing(dValue) Then\xFE                    Row[cName] = dValue\xFE                    Changed = True\xFE                End If\xFE            End If\xFE        End If\xFE    Next\xFE    Return Changed\xFEEnd Function";
    window.cached_jsb_mdl["setviewheader"] = "Subroutine setViewHeader(ProjectName, pageName, ViewName)\xFE    * %options aspxC-\xFE    \xFE    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE    newValue = Trim(@InputBox(\"View Header for\":ViewName, \"Header\", dataSet.header, \"80%\", \"\"))\xFE    If newValue = Chr(27) Or newValue = \"\" Then Return\xFE    dataSet.header = newValue\xFE    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE    Call @Jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFEEnd Sub";
    var z = "Subroutine setVisibleColumns(ProjectName, pageName, ViewName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE";
    z += "\xFE";
    z += "    allColumns = []\xFE";
    z += "    SelColumns = []\xFE";
    z += "    For Each Column In dataSet.columns\xFE";
    z += "        CName = Trim(Column.name)\xFE";
    z += "        If CName Then\xFE";
    z += "            allColumns[-1] = CName\xFE";
    z += "            If Column.display <> \"hidden\" And Column.display <> \"gridhidden\" Then SelColumns[-1] = CName\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    SelectedCols = @Jsb_bf.InputMultiSelect(\"Visible Columns\", \"Select Visible Columns:\", allColumns, SelColumns, \"50%\", \"80%\")\xFE";
    z += "    If SelectedCols = \"\" Or SelectedCols = Chr(27) Then Return\xFE";
    z += "\xFE";
    z += "    For Each Column In dataSet.columns\xFE";
    z += "        CName = Trim(Column.name)\xFE";
    z += "        Locate CName In SelectedCols Then Column.display = \"visible\" Else\xFE";
    z += "            If Column.display <> \"hidden\" And Column.display <> \"gridhidden\" Then Column.display = \"hidden\"\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE";
    z += "    Call @Jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFE";
    z += "End Sub"
    window.cached_jsb_mdl["setvisiblecolumns"] = z;
    window.cached_jsb_mdl["show1000contextmenu"] = "// GRID context menu for each column\xFEfunction show1000ContextMenu(Byval gridID, Byval ColumnName)\xFE* %options aspxC-\xFE* $options ijs\xFE\xFE    niceColumnName = NiceName(ColumnName)\xFE    niceGridName = NiceName(gridID)\xFE    \xFE    CtlID = niceGridName:\"_\":niceColumnName\xFE    \xFE    Cm = {\xFE        \"Set Column Label\":     { cmd: \"SetLbl\",  val: CtlID },\xFE        \"Hide Column\":          { cmd: \"HideCol\", val: CtlID },\xFE        \"Show Column\":          { cmd: \"ShowCol\", val: CtlID }\xFE    }\xFE    \xFE    Return @Jsb_html.ContextMenu(\"[id='\":CtlID:\"']\", Cm, True, CtlID:\"_contextMenu\")\xFEEnd function";
    var z = "function showExcelForm(centerviewVars, BaseDirectory, XlsFileName, sqlDBName)\xFE";
    z += "    \xFE";
    z += "    if InStr(BaseDirectory, \"SCP Permits\") Then sqlDBName = \"SCP Permits\"\xFE";
    z += "    \xFE";
    z += "    Call View_excelupload_Setup(centerviewVars, BaseDirectory, XlsFileName, sqlDBName)\xFE";
    z += "\xFE";
    z += "    form = @Display_excelupload(centerviewVars)\xFE";
    z += "    \xFE";
    z += "    Print @(-1):;\xFE";
    z += "    Print @Style(`\xFE";
    z += "        .form-control-label {\xFE";
    z += "            word-break: break-word;\xFE";
    z += "            white-space: normal;\xFE";
    z += "            max-height: 45px;\xFE";
    z += "            font-size: 11px;\xFE";
    z += "        }`):\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "    Print @Jsb_themes.theme_ifwis(\"mdl\", \"ExcelUpload\", form):@Script(`$('.navbar-default').hide();`):\xFE";
    z += " \xFE";
    z += "    @Server.Pause\xFE";
    z += "    Dim Btn As String = @FormVar(\"formBtn_ExcelUpload\")\xFE";
    z += "    Call View_excelupload_Unload(centerviewVars)\xFE";
    z += "    \xFE";
    z += "    if Btn = \"Cancel\" Then \xFE";
    z += "        @Errors = \"\"\xFE";
    z += "        Return False\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Print @Style(`.IFrame { background-color: aliceblue; }`):@script(`\xFE";
    z += "        openInTab(\"Excel2SQL\", \"Status\", \"Status\", \"\");\xFE";
    z += "        $(\"#tab_Status\").html(\"<div id='xlsStatus' class='IFrame'></div>\");\xFE";
    z += "        spinnerCnt--;\xFE";
    z += "    `):\xFE";
    z += "\xFE";
    z += "    Settings = centerviewVars.Row\xFE";
    z += "    \xFE";
    z += "    dstDB = Settings.commonDatabaseName\xFE";
    z += "    if !dstDB Then dstDB = XlsFileName\xFE";
    z += " \xFE";
    z += "    if !dbDatabaseExists(dstDB) Then\xFE";
    z += "        Attachdb \"\" Else Null\xFE";
    z += "        If !dbCreateSqlDatabase(dstDB) Then Call statusPrint(@Errors); return false\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    If !@jsb_odb.AttachDBextended(dstDB, \"databaseBuilder_rw\") Then Call statusPrint(@Errors); return false\xFE";
    z += "\xFE";
    z += "    Options = \"Importing Excel file: \":XlsFileName:\" into SQL Database \":dstDB:Crlf()\xFE";
    z += "    Options := \"   Option: Data rows must have at least one numeric cell \":Settings.DataMustHaveOneNumericRow:Crlf()\xFE";
    z += "    Options := \"   Option: Allow Side By Side Tables \":Settings.SideBySideTables:Crlf()\xFE";
    z += "    Options := \"   Option: Ignore Tables With No Rows \":Settings.ignoreTablesWithNoSettingss:Crlf()\xFE";
    z += "    Options := \"   Option: Ignore Tables With Less Than \":Settings.ignoreTablesWithLessThanNColumns:\" Columns \":Crlf()\xFE";
    z += "    Options := \"   Option: One Table Per Sheet \":Settings.OneTablePerSheet:Crlf()\xFE";
    z += "    Options := \"   Option: Allow Data to have Blank Rows \":Settings.AllowBlankRows:Crlf()\xFE";
    z += "    Options := \"   Option: Default Empty Values From Previous Row \":Settings.DefaultEmptyValuesFromPreviousRow:Crlf()\xFE";
    z += "    Options := \"   Option: Delete And Recreate Sql Table \":Settings.deleteAndRecreateTables:Crlf()\xFE";
    z += "    Options := \"   Option: Show Imported Data \":Settings.showTables:Crlf()\xFE";
    z += "    Call statusPrint(Options)\xFE";
    z += "    \xFE";
    z += "    if !ProcessExcelFile(Settings, BaseDirectory, XlsFileName, dstDB) Then  Call statusPrint(@Errors); return false\xFE";
    z += "    \xFE";
    z += "    Call statusPrint(\"Done\")\xFE";
    z += "    return true\xFE";
    z += "end function"
    window.cached_jsb_mdl["showexcelform"] = z;
    var z = "function showTable(Settings, tbl, SheetName)\xFE";
    z += "    html =  @html(`<style>\xFE";
    z += "        table, th, td {\xFE";
    z += "          border: 1px solid black;\xFE";
    z += "          border-collapse: collapse;\xFE";
    z += "        }\xFE";
    z += "        th, td {\xFE";
    z += "          padding: 5px;\xFE";
    z += "        }\xFE";
    z += "        th {\xFE";
    z += "          text-align: left;\xFE";
    z += "        }\xFE";
    z += "    </style>`)\xFE";
    z += "    \xFE";
    z += "   html :=  @html(\"<table>\")\xFE";
    z += "   \xFE";
    z += "   Settings.HdrRow = tbl[1]\xFE";
    z += "   html :=  @html(\"<tr>\")\xFE";
    z += "   for each col, coli in Settings.HdrRow\xFE";
    z += "       html :=  @html(\"<th>\"):Col:@html(\"</th>\")\xFE";
    z += "    next\xFE";
    z += "    html :=  @html(\"</tr>\")\xFE";
    z += "\xFE";
    z += "   rc = UBound(tbl)\xFE";
    z += "   for rowI = 2 to rc while RowI < 10\xFE";
    z += "       row = tbl[rowi]\xFE";
    z += "\xFE";
    z += "       html :=  @html(\"<tr>\")\xFE";
    z += "       for each col, coli in row\xFE";
    z += "           html :=  @html(\"<td>\"):Col:@html(\"</td>\")\xFE";
    z += "        next\xFE";
    z += "        html :=  @html(\"</tr>\")\xFE";
    z += "    next\xFE";
    z += "    html :=  @html(\"</table>\")\xFE";
    z += "    if rowi > 10 then \xFE";
    z += "        html :=  \".......................\":rc-10:\" more Rows\"\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    if okayToOutputTbl(Settings, tbl, sheetname) Then\xFE";
    z += "        return @Style(`.IFrame { background-color: aliceblue; }`):@script(`openInTab(\"Excel2SQL\", \"`:SheetName:`\", \"`:SheetName:`\", `:jsEscapeString(html):`)`)\xFE";
    z += "    else\xFE";
    z += "        html := @Color(\"lightgray\", Html)\xFE";
    z += "        html := @Color(\"Red\", @Errors)\xFE";
    z += "        \xFE";
    z += "        print @Script(`\xFE";
    z += "            $(\"#xlsStatus\").append(`:jsEscapeString(html):`); \xFE";
    z += "            $(\"#Excel2SQL\").tabs(\"option\", \"active\", 0);\xFE";
    z += "        `):\xFE";
    z += "    \xFE";
    z += "        call statusPrint(Crlf())\xFE";
    z += "        Html = \"\"\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    return html\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "/* Column names used:\xFE";
    z += "\xFE";
    z += "#160330\xFE";
    z += "Dr. Kelly M. Cassidy\xFE";
    z += "Yes\xFE";
    z += "Bill Loftus\xFE";
    z += "Yellow Warbler\xFE";
    z += "Setophaga petechia\xFE";
    z += "Inventory/Targeted Survey\xFE";
    z += "Specimen taken\xFE";
    z += "#1\xFE";
    z += "Absolute\xFE";
    z += "Unknown\xFE";
    z += "Dead\xFE";
    z += "Migatory Corridor\xFE";
    z += "Window kill, UI campus\xFE";
    z += "#43691\xFE";
    z += "#-117.01696\xFE";
    z += "#46.727457000000001\xFE";
    z += "Decimal Degrees GCS WGS 1984\xFE";
    z += "Estimated Precision (< 1km/0.6mi)\xFE";
    z += "Landowner: University of ID Regent\xFE";
    z += "IDFG Employee Notified (Provision 6 of permit)\xFE";
    z += "Observer\xFE";
    z += "Day\xFE";
    z += "Month\xFE";
    z += "Year\xFE";
    z += "Species\xFE";
    z += "Type\xFE";
    z += "Observer's Confidence\xFE";
    z += "Sex\xFE";
    z += "Age\xFE";
    z += "Count\xFE";
    z += "Count Accuracy\xFE";
    z += "Location Use\xFE";
    z += "Comments\xFE";
    z += "Coordinate System\xFE";
    z += "Horizontal Datum\xFE";
    z += "Coordinate Unit\xFE";
    z += "Easting\xFE";
    z += "Northing\xFE";
    z += "Landmark\xFE";
    z += "Land Owner\xFE";
    z += "PIT Tag #\xFE";
    z += "L Ear Tag #\xFE";
    z += "R Ear Tag #\xFE";
    z += "Activity\xFE";
    z += "Field Site\xFE";
    z += "Band Number\xFE";
    z += "Disposition\xFE";
    z += "Aux Marker Combined\xFE";
    z += "Bird Status\xFE";
    z += "How Aged\xFE";
    z += "How Sexed\xFE";
    z += "Locations::Lat Deg\xFE";
    z += "Locations::Lat Min\xFE";
    z += "Locations::Lat Sec\xFE";
    z += "Locations::Lat Hemisphere\xFE";
    z += "Locations::Long Deg\xFE";
    z += "Locations::Long Min\xFE";
    z += "Locations::Long Sec\xFE";
    z += "Locations::Long Hemisphere\xFE";
    z += "Locations::Location Precision\xFE";
    z += "Locations::Region\xFE";
    z += "Banding Date\xFE";
    z += "Location::Location ID\xFE";
    z += "latitude\xFE";
    z += "longitude\xFE";
    z += "Lat\xFE";
    z += "Long\xFE";
    z += "Permit Number\xFE";
    z += "Permit Holder (name)\xFE";
    z += "Data Collected (Yes/No)\xFE";
    z += "Observer(s)\xFE";
    z += "Position\xFE";
    z += "Organization\xFE";
    z += "e-mail Address\xFE";
    z += "Phone Number\xFE";
    z += "Address 1\xFE";
    z += "Address 2\xFE";
    z += "City\xFE";
    z += "Settings.State\xFE";
    z += "ZIP Code\xFE";
    z += "Observer Background Notes\xFE";
    z += "Species Common Name\xFE";
    z += "Species Scientific Name\xFE";
    z += "Species Confidence\xFE";
    z += "Survey Method\xFE";
    z += "Observation Method\xFE";
    z += "Capture Method\xFE";
    z += "Count Type\xFE";
    z += "Life Settings.State\xFE";
    z += "Life Stage\xFE";
    z += "Species Account\xFE";
    z += "Marker Type\xFE";
    z += "Auxiliary Marker Type\xFE";
    z += "Photo Included?\xFE";
    z += "SpecimenNumber\xFE";
    z += "Museum\xFE";
    z += "Start Date (e.g. 01/01/2013)\xFE";
    z += "Start Time (e.g. 12:00am)\xFE";
    z += "End Date (e.g. 01/01/2013)\xFE";
    z += "End Time (e.g. 12:00am)\xFE";
    z += "Time Zone\xFE";
    z += "Date Comments\xFE";
    z += "Northing (Latitude)\xFE";
    z += "Easting (Longitude)\xFE";
    z += "Location Confidence\xFE";
    z += "Directions\xFE";
    z += "Habitat Description\xFE";
    z += "Identification Tools\xFE";
    z += "References or Documentation Included?\xFE";
    z += "Do Not Share?\xFE";
    z += "California Condors\xFE";
    z += "# of Eggs Layed\xFE";
    z += "# of New Females Laying Eggs\xFE";
    z += "# of Eggs Hatched\xFE";
    z += "# of Chicks Survived\xFE";
    z += "Northern Aplomado Falcon\xFE";
    z += "Taita Falcon\xFE";
    z += "Scientific Name\xFE";
    z += "Common Name\xFE";
    z += "Male\xFE";
    z += "Female\xFE";
    z += "Juvenile\xFE";
    z += "Other *\xFE";
    z += "Unknown Gender\xFE";
    z += "band number\xFE";
    z += "sex\xFE";
    z += "capture date\xFE";
    z += "capture time\xFE";
    z += "siteName\xFE";
    z += "status\xFE";
    z += "age\xFE";
    z += "wing chord\xFE";
    z += "weight\xFE";
    z += "Upper mandible length\xFE";
    z += "callType\xFE";
    z += "Bill Depth\xFE";
    z += "UNIQUE_ID\xFE";
    z += "PTT ID SERIAL_NO\xFE";
    z += "FREQUENCY\xFE";
    z += "SPECIES\xFE";
    z += "SEX\xFE";
    z += "AGE\xFE";
    z += "AHY = After Hatch Year (yearling) WEIGHT_g\xFE";
    z += "DATE\xFE";
    z += "TIME\xFE";
    z += "LATITUDE_Yddwgs84\xFE";
    z += "LONGITUDE_Xddwgs84\xFE";
    z += "GPS_HORIZONTAL_ERROR\xFE";
    z += "COMMENTS (LEK ID)\xFE";
    z += "ee = Ethan Ellsworth am = Ann Moser bs = Bruce Schoeberl JR = Jordan Rabon OBSERVER\xFE";
    z += "STUDYAREA\xFE";
    z += "GPS_BRAND\xFE";
    z += "GPS_TYPE\xFE";
    z += "DUTYCYCLE_DESCRIPTION\xFE";
    z += "SERIAL_NO\xFE";
    z += "DATE_GMT\xFE";
    z += "TIME_GMT\xFE";
    z += "DATA_TYPE\xFE";
    z += "LOCATION_METHOD\xFE";
    z += "LOCATION_TYPE\xFE";
    z += "LOCATION_NO\xFE";
    z += "COMMENTS\xFE";
    z += "MST_DATE\xFE";
    z += "MST_TIME\xFE";
    z += "OBSERVER\xFE";
    z += "*/"
    window.cached_jsb_mdl["showtable"] = z;
    var z = "* %options aspxC-\xFE";
    z += "\xFE";
    z += "Program showTop1000\xFE";
    z += "\xFE";
    z += "    roleMsg = Iff(@IsAuthenticated, \"\", \"You must be logged in to view this page. \":@Anchor(@LoginUrl, \"Click here to login\"))\xFE";
    z += "    If !@IsEmployee Then Stop Iff(roleMsg, roleMsg, \"I'm sorry, you must be at least an IDFG employee to view this page.\")\xFE";
    z += "    Call ?CheckIn()\xFE";
    z += "\xFE";
    z += "    Dim databaseName As String = @ParamVar('databaseName') // Table Name\xFE";
    z += "    Dim tableID As String = @ParamVar('tableID') // Table Name\xFE";
    z += "    Dim tabID As String = @ParamVar('tabID')\xFE";
    z += "    \xFE";
    z += "    Dim devXGridLayout As String = @ParamVar(\"layout\")\xFE";
    z += "    \xFE";
    z += "    // Did we run from TCL? setup something for testing\xFE";
    z += "    If !tableID Then\xFE";
    z += "        Dim S As String = RTrim(Field(@Sentence, \"(\", 1))\xFE";
    z += "        Dim Cmd As String = Field(S, \" \", 1)\xFE";
    z += "        If LCase(Cmd) = \"run\" Then tableID = Field(S, \" \", 4) Else tableID = Field(S, \" \", 2)\xFE";
    z += "        \xFE";
    z += "        if !tableID Then\xFE";
    z += "            // for testing\xFE";
    z += "            if @Domain = \"idfg.idaho.gov\" Then\xFE";
    z += "                databaseName = \"SGS\"\xFE";
    z += "                tableID = \"PIC_Transect\"\xFE";
    z += "                attachdb databaseName else stop \"Unable to attach to \":databaseName\xFE";
    z += "            else\xFE";
    z += "                tableID = \"democustomers.json\"\xFE";
    z += "                databaseName = \"\"\xFE";
    z += "            end if\xFE";
    z += "        end if\xFE";
    z += "    Else\xFE";
    z += "        if isMissing(databaseName) then Stop \"databaseName is a required parameter\"\xFE";
    z += "    End If\xFE";
    z += "     \xFE";
    z += "    Dim reportName As String = databaseName:\"_\":tableID\xFE";
    z += "    if !showTop1000(tabID, databaseName, tableID, reportName, devXGridLayout) Then Stop @Errors\xFE";
    z += "    If @hasTclParent Or @hasParentProcess Then Stop Else @Server.End\xFE";
    z += "end program\xFE";
    z += "\xFE";
    z += "function showTop1000(byval tabID As String, byval databaseName As String, byval tableName As String, byval reportName As String, optional byval devXGridLayout As String)\xFE";
    z += "    Dim fTmp As TableHandle = @fHandle('tmp')\xFE";
    z += "    Dim gridID As String = \"showGrid\"\xFE";
    z += "    Dim reportName As String = databaseName:'_gridViewGridDefs_'\xFE";
    z += "    \xFE";
    z += "    Theme = @jsbConfig(\"default_jsb_Themes\", \"theme_none\")\xFE";
    z += "    if Theme Then Theme = \"jsb_themes.\":Theme\xFE";
    z += "    \xFE";
    z += "    Dim fTable As TableHandle = Nothing\xFE";
    z += "    \xFE";
    z += "    if databaseName Then \xFE";
    z += "        if !@@AttachDBextended(ByVal databaseName) Then Return False\xFE";
    z += "        if @@dbViewExists(ByVal tableName) Then \xFE";
    z += "            Dim tmpTblName As String = \"##dview_\":tableName:\"_\":NiceName(@UserName)\xFE";
    z += "            open tmpTblName to fTable Else\xFE";
    z += "                fTable = @@dbMakeTmpTable(ByVal tableName)\xFE";
    z += "            End If\xFE";
    z += "        end if\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    if !fTable Then \xFE";
    z += "        Open tableName To fTable Else return false\xFE";
    z += "    end if\xFE";
    z += "                    \xFE";
    z += "    Dim columnNames As String = \"*\"\xFE";
    z += "    Dim hideExportBtns As Boolean = False\xFE";
    z += "    Dim UrlBase As String = @jsbRootAccount():`?showTop1000&databaseName=`:@UrlEncode(databaseName):`&tableID=`:@UrlEncode(tableName)\xFE";
    z += "    \xFE";
    z += "    Dim Cmd As String = \"\"\xFE";
    z += "    if !devXGridLayout Then\xFE";
    z += "       ReadJson devXGridLayout From fTmp, reportName Else devXGridLayout = {}\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Dim Msg  As String = \"\"\xFE";
    z += "    Dim GridWidth  As String = \"\"\xFE";
    z += "\xFE";
    z += "    // Do we have a lat and a lng column?\xFE";
    z += "    // TableColumns = @@getTableColumnDefs(ByVal tableName, True /* Suppress Msgs */, True /* Refresh */)\xFE";
    z += "    TableColumns = @getTableColumnDefs(tableName, True /* Suppress Msgs */, True /* Refresh */)\xFE";
    z += "    If HasTag(TableColumns[LBound(TableColumns)], \"ordinal\") Then TableColumns = Sort(TableColumns, \"ordinal\")\xFE";
    z += "    If HasTag(TableColumns[LBound(TableColumns)], \"Ordinal\") Then TableColumns = Sort(TableColumns, \"Ordinal\")\xFE";
    z += "    \xFE";
    z += "    latColumnName = \"\"\xFE";
    z += "    lngColumnName = \"\"\xFE";
    z += "    primaryKeyField = \"\"\xFE";
    z += "    dtColumns = []\xFE";
    z += "    \xFE";
    z += "    for Each Column In TableColumns\xFE";
    z += "        cName = Column.Name\xFE";
    z += "        lcName = LCase(cName)\xFE";
    z += "        If lngColumnName = \"\" Then\xFE";
    z += "            If InStr(1, lcname, \"longitude\") Then lngColumnName = cName\xFE";
    z += "        End If\xFE";
    z += "        If latColumnName = \"\" Then\xFE";
    z += "            If InStr(1, lcname, \"latitude\") Then latColumnName = cName\xFE";
    z += "        End If\xFE";
    z += "            \xFE";
    z += "        dtColumns[-1] = cName\xFE";
    z += "        if Column.isLatitude Then latColumnName = cName\xFE";
    z += "        if Column.isLongitude Then lngColumnName = cName\xFE";
    z += "        if Column.primarykey Then primaryKeyField = cName\xFE";
    z += "    next\xFE";
    z += "    \xFE";
    z += "    if !primaryKeyField Then primaryKeyField = @PrimaryKeyName(fTable)\xFE";
    z += "    \xFE";
    z += "    // ======================================================================\xFE";
    z += "    // Setup the DevxGrid\xFE";
    z += "    // ======================================================================\xFE";
    z += "    Settings = {}\xFE";
    z += "    Settings.hideExportBtns = hideExportBtns\xFE";
    z += "    Settings.latColumnName = latColumnName\xFE";
    z += "    Settings.lngColumnName = lngColumnName\xFE";
    z += "    Settings.databaseName = databaseName\xFE";
    z += "    Settings.tableName = tableName\xFE";
    z += "    Settings.primaryKeyField = primaryKeyField\xFE";
    z += "    if devXGridLayout.columnAutoWidth then \xFE";
    z += "        Settings.columnAutoWidth = true \xFE";
    z += "    else \xFE";
    z += "        Settings.columnAutoWidth = false\xFE";
    z += "    end if\xFE";
    z += "    remove devXGridLayout, \"columnAutoWidth\"\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "    Loop\xFE";
    z += "        Settings.devXGridLayout = devXGridLayout\xFE";
    z += "\xFE";
    z += "        HtmlGrid = @devXGrid(gridID, tableName, Settings)\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "        // ======================================================================\xFE";
    z += "        // Create a toolbar\xFE";
    z += "        // ======================================================================\xFE";
    z += "        ToolBar =  @Submitbtn(\"Btn\", \"Update URL\")\xFE";
    z += "        \xFE";
    z += "        if @isManager Then ToolBar := @Submitbtn(\"Btn\", \"Make Report\")\xFE";
    z += "\xFE";
    z += "        ToolBar := @Submitbtn(\"Btn\", \"Reset Layout\", { class: 'btnReset' })\xFE";
    z += "        ToolBar := @Submitbtn(\"Btn\", \"Fit to Screen\")\xFE";
    z += "        ToolBar := @Submitbtn(\"Btn\", \"Fit to Data\")\xFE";
    z += "        \xFE";
    z += "        if !hideExportBtns Then\xFE";
    z += "            ToolBar := @Submitbtn(\"Btn\", \"Export to CSV\")\xFE";
    z += "        End If\xFE";
    z += "\xFE";
    z += "        if TabID Or @hasTclParent Then ToolBar := @Submitbtn(\"Btn\", \"Quit\")\xFE";
    z += "        \xFE";
    z += "        // Create JS to capture when the layout changes\xFE";
    z += "        preScripts = []\xFE";
    z += "        postScripts = []\xFE";
    z += "        \xFE";
    z += "        postScripts[-1] = `\xFE";
    z += "            function onFormSubmitEvent_`:gridID:`(event) {\xFE";
    z += "                var devXGridLayout = localStorage[\"`:gridID:`\" ];\xFE";
    z += "                \xFE";
    z += "                if (devXGridLayout) {\xFE";
    z += "                    // .columns (array), .allowedPageSizes (array, .filterPanel (json) .filterValue (string), .searchText (string), \xFE";
    z += "                    // .pageIndex (integer), .pageSize (integer), .selectedRowKeys (array)\xFE";
    z += "    \xFE";
    z += "                    $('#jsb').append('<input id=\"`:gridID:`_devXGridLayout\"  name=\"`:gridID:`_devXGridLayout\" type=\"hidden\" />');\xFE";
    z += "                    $(\"#`:gridID:`_devXGridLayout\").val(devXGridLayout);\xFE";
    z += "                }\xFE";
    z += "            }\xFE";
    z += "            \xFE";
    z += "            $(\"#jsb\").submit(onFormSubmitEvent_`:gridID:`);\xFE";
    z += "        `\xFE";
    z += "\xFE";
    z += "        preScripts[-1] = `\xFE";
    z += "            function `:gridID:`_onInit(s, e) { \xFE";
    z += "                // debugger;\xFE";
    z += "                $('.BtnReset').prop('disabled', false) \xFE";
    z += "            }\xFE";
    z += "        `\xFE";
    z += "        \xFE";
    z += "        preScripts[-1] = `\xFE";
    z += "            function `:gridID:`_LayoutChanged(s, e) { \xFE";
    z += "                debugger;\xFE";
    z += "                $('.BtnReset').prop('disabled', false) \xFE";
    z += "            }\xFE";
    z += "        `\xFE";
    z += "        \xFE";
    z += "        if UBound(preScripts) Then preScripts = @Script(Join(preScripts, crlf()))\xFE";
    z += "        if UBound(postScripts) Then postScripts = @Script(Join(postScripts, crlf()))\xFE";
    z += "        \xFE";
    z += "        Html = preScripts:Rows2(\"%\", HtmlGrid, \"66px\", ToolBar):postScripts\xFE";
    z += "        \xFE";
    z += "        // Theme screen\xFE";
    z += "        if !tabId And Theme Then \xFE";
    z += "            Html = @((Theme))(System(27) /* FromFile */, System(28) /* edpPage */, Html, \"\" /* Brand */)\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        // ======================================================================\xFE";
    z += "        // Show it all and give user a chance to interact\xFE";
    z += "        // ======================================================================\xFE";
    z += "        Print @(-1):Html:\xFE";
    z += "        @Server.Pause\xFE";
    z += "        // ======================================================================\xFE";
    z += "        // ======================================================================\xFE";
    z += "\xFE";
    z += "        devXGridLayout = CJson(@formVar(gridID:'_devXGridLayout'))\xFE";
    z += "        i_WriteJson devXGridLayout On fTmp, reportName Else Null\xFE";
    z += "        \xFE";
    z += "        // ======================================================================\xFE";
    z += "        // What does the user want to do?\xFE";
    z += "        // ======================================================================\xFE";
    z += "        Cmd = @formVar('Btn')\xFE";
    z += "        \xFE";
    z += "        // Context menu command?\xFE";
    z += "        If !Cmd Then\xFE";
    z += "            Cmd = @formVar(\"contextMenuCmd\")\xFE";
    z += "            CtlText = @formVar(\"contextMenuCtlText\")\xFE";
    z += "            CtlID = @formVar(\"contextMenuVal\")\xFE";
    z += "            ContextMenuText = @formVar(\"contextMenuText\")\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "\xFE";
    z += "        // ======================================================================\xFE";
    z += "        // Adjust Column widths to data\xFE";
    z += "        // ======================================================================\xFE";
    z += "        if Cmd = \"Fit to Data\" Then\xFE";
    z += "            // just use rows in the grid??\xFE";
    z += "            debugger\xFE";
    z += "            Settings.columnAutoWidth = true\xFE";
    z += "            devXGridLayout = {}\xFE";
    z += "        \xFE";
    z += "        else If False Then\xFE";
    z += "            select \"top 100 *\" from fTable to selectList else stop @errors\xFE";
    z += "            Dim dt As Array = getList(selectList)\xFE";
    z += "            searchRowCnt = Len(dt)\xFE";
    z += "            if searchRowCnt Then\xFE";
    z += "                Row1 = dt[LBound(dt)]\xFE";
    z += "                dtColCnt = Len(Row1)\xFE";
    z += "                dtColumns = []\xFE";
    z += "                for Each Tag In Row1\xFE";
    z += "                    dtColumns[-1] = Tag\xFE";
    z += "                next\xFE";
    z += "            else\xFE";
    z += "                dtColumns = []\xFE";
    z += "                dtColCnt = 0\xFE";
    z += "            end if\xFE";
    z += "            \xFE";
    z += "            ColWidths = {}\xFE";
    z += "            For Each Row As Json In dt\xFE";
    z += "                For Each colName In Row\xFE";
    z += "                    V = RTrim(Row[colName])\xFE";
    z += "                    LenOfV = Len(V)\xFE";
    z += "                    if LenOfV > ColWidths[colName] then ColWidths[colName] = LenOfV\xFE";
    z += "                Next\xFE";
    z += "            Next\xFE";
    z += "  \xFE";
    z += "            Dim dxColumns As Array = devXGridLayout.columns\xFE";
    z += "            for Each DC As Json In dxColumns\xFE";
    z += "                colName = DC.dataField\xFE";
    z += "                CW = ColWidths[colName]\xFE";
    z += "                If CW < 3 Then CW = 3\xFE";
    z += "                \xFE";
    z += "                Caption = DC.caption ;* ID?\xFE";
    z += "                if !Caption Then Caption = colName\xFE";
    z += "                If Len(Caption)  +2 > CW Then CW = Len(Caption)+2\xFE";
    z += "                if CW > 60 Then CW = 60\xFE";
    z += "                DC.width = (CW / 1.8) : \"em\"\xFE";
    z += "            Next\xFE";
    z += "            \xFE";
    z += "        Else If Cmd = \"Fit to Screen\" Then\xFE";
    z += "            debugger\xFE";
    z += "            \xFE";
    z += "            dxColumns = devXGridLayout.columns\xFE";
    z += "            visibleColumnCnt = 0\xFE";
    z += "            \xFE";
    z += "            for Each DC As Json In dxColumns\xFE";
    z += "                if DC.visible then visibleColumnCnt += 1\xFE";
    z += "            next\xFE";
    z += "            \xFE";
    z += "            CP = CInt(1000 / visibleColumnCnt) / 10\xFE";
    z += "            \xFE";
    z += "            for Each DC As Json In dxColumns\xFE";
    z += "                DC.width = CP:\"%\"\xFE";
    z += "            Next\xFE";
    z += "            \xFE";
    z += "            // devXGrid.Width = CreateObject(\"Unit(Percentage, 100)\")\xFE";
    z += "            Settings.columnAutoWidth = false\xFE";
    z += "            Remove devXGridLayout, \"columnAutoWidth\"\xFE";
    z += "            \xFE";
    z += "        Else If Cmd = \"Reset Layout\" Then\xFE";
    z += "            debugger\xFE";
    z += "            \xFE";
    z += "            // Let the devXGrid figure out the layut\xFE";
    z += "            devXGridLayout = {}\xFE";
    z += "            Settings.columnAutoWidth = False\xFE";
    z += "            \xFE";
    z += "            Delete fTmp, reportName Else Null\xFE";
    z += "            \xFE";
    z += "            if @ParamVar(\"filter\") Or @ParamVar(\"layout\") then\xFE";
    z += "                delete fTmp, reportName\xFE";
    z += "                if tabID Then \xFE";
    z += "                    Print @Script(`windowOpen(`:jsEscapeString(UrlBase):`, '_blank'); doJsbSubmit();`):\xFE";
    z += "                    @Server.Flush\xFE";
    z += "                    Print @(-1):\xFE";
    z += "                Else\xFE";
    z += "                    @Response.Redirect(UrlBase)\xFE";
    z += "                End If\xFE";
    z += "            End If\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        \xFE";
    z += "        wx = clone(devXGridLayout)\xFE";
    z += "        if Settings.columnAutoWidth then wx.columnAutoWidth = true\xFE";
    z += "        i_WriteJson wx On fTmp, reportName Else Null\xFE";
    z += "        \xFE";
    z += "        // ======================================================================\xFE";
    z += "        //  Exporting\xFE";
    z += "        // ======================================================================\xFE";
    z += "        If Cmd = \"Export KML\" Then \xFE";
    z += "            debugger\xFE";
    z += "            \xFE";
    z += "            devxGrid_downloadKML(gridID, Settings, false)\xFE";
    z += "        \xFE";
    z += "        Else If Cmd = \"Export to CSV\" Then\xFE";
    z += "            debugger\xFE";
    z += "            \xFE";
    z += "            e64 = Encode(SelectList.GetCSV(), 64)\xFE";
    z += "            \xFE";
    z += "            print @script(`\xFE";
    z += "               const b64Data = '`:E64:`';\xFE";
    z += "               saveBlob(b64toBlob(b64Data, 'text/plain'), \"`:reportName:`.csv\")\xFE";
    z += "            `):\xFE";
    z += "            \xFE";
    z += "            E64 = \"\"\xFE";
    z += "            Item = []\xFE";
    z += "            \xFE";
    z += "\xFE";
    z += "        ElseIf Cmd = \"Update URL\" Then\xFE";
    z += "            debugger\xFE";
    z += "            \xFE";
    z += "            // Open this report in a seperate window with it's own URL\xFE";
    z += "            Url = UrlBase\xFE";
    z += "\xFE";
    z += "            if devXGridLayout Then Url := \"&layout=\":@UrlEncode(devXGridLayout)\xFE";
    z += "\xFE";
    z += "            runScript(`\xFE";
    z += "                if (window.self !== window.parent) { \xFE";
    z += "                    w = window.parent.open(`:jsEscapeString(Url):`, '_blank'); \xFE";
    z += "                    setTimeout(function () { window.location = \"close_html\"; }, 500);\xFE";
    z += "                } else { \xFE";
    z += "                    window.open(`:jsEscapeString(Url):`, '_self'); \xFE";
    z += "                } \xFE";
    z += "            `)\xFE";
    z += "          \xFE";
    z += "        ElseIf Cmd = \"Make Report\" Then\xFE";
    z += "            debugger\xFE";
    z += "            \xFE";
    z += "            Url = @jsbRootAccount():`?makenewreport&databaseName=`:@UrlEncode(databaseName):`&tableID=`:@UrlEncode(tableName)\xFE";
    z += "            runScript(`debugger; window.parent.open(`:jsEscapeString(Url):`, '_blank'); jsb.submit();`)\xFE";
    z += "            \xFE";
    z += "        End If\xFE";
    z += "\xFE";
    z += "    While Cmd <> \"Quit\" Do Repeat\xFE";
    z += "    \xFE";
    z += "    Return True\xFE";
    z += "End Program\xFE";
    z += "\xFE";
    z += "function runScript(s)\xFE";
    z += "    redirectPage = `<!DOCTYPE html>\xFE";
    z += "    <html>\xFE";
    z += "    <head>\xFE";
    z += "     <meta http-equiv='Access-Control-Allow-Origin' content='*' />\xFE";
    z += "     <meta http-equiv='Access-Control-Allow-Headers' content='Content-Type, Accept, SOAPAction, Origin' />\xFE";
    z += "     <meta http-equiv='Access-Control-Max-Age' content='1728000' />\xFE";
    z += "     <meta http-equiv='Content-Security-Policy' content=\"img-src * data:; default-src *; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'\" /> \xFE";
    z += "     <meta http-equiv='cache-control' content='max-age=0' />\xFE";
    z += "     <meta http-equiv='expires' content='0' />\xFE";
    z += "     <meta http-equiv='expires' content='Tue, 01 Jan 1980 1:00:00 GMT' />\xFE";
    z += "     <meta http-equiv='pragma' content='no-cache' />\xFE";
    z += "    <title>devXGrid Redirect</title>\xFE";
    z += "    </head>\xFE";
    z += "    <body>\xFE";
    z += "    <form id='jsb' method='post' action='' class='jsb' enctype='multipart/form-data'>\xFE";
    z += "    <input name='_SID_' type='hidden' value='`:@UserNo:`' />\xFE";
    z += "    <input name='userClearedTclScreen' type='hidden' value='1' />\xFE";
    z += "    <input name='isJsbPost' type='hidden' value='1' />\xFE";
    z += "    </form>\xFE";
    z += "    <script>\xFE";
    z += "    `:s:`\xFE";
    z += "    </script>\xFE";
    z += "    </html>`\xFE";
    z += "    \xFE";
    z += "    @Response.Buffer('') ;* Clear buffer\xFE";
    z += "    @Response.Header.Set('Content-Type', 'text/html; charset=UTF-8') \xFE";
    z += "    @Response.BinaryWrite(redirectPage)\xFE";
    z += "    @server.flush\xFE";
    z += "    @Response.Buffer('') ;* Clear buffer\xFE";
    z += "              \xFE";
    z += "    Return\xFE";
    z += "end function\xFE";
    z += "\xFE";
    z += ""
    window.cached_jsb_mdl["showtop1000"] = z;
    var z = "/*\xFE";
    z += "Program showTop1000\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    if !@islocalhost Then\xFE";
    z += "        roleMsg = Iff(@IsAuthenticated, \"\", \"You must be logged in to view this page. \":@Anchor(@LoginUrl, \"Click here to login\"))\xFE";
    z += "        If !@IsEmployee Then Stop Iff(roleMsg, roleMsg, \"I'm sorry, you must be at least an IDFG employee to view this page.\")\xFE";
    z += "        \xFE";
    z += "        Call ?CheckIn()\xFE";
    z += "    end if\xFE";
    z += "   \xFE";
    z += "    databaseName = @ParamVar('databaseName') // Table Name\xFE";
    z += "    tableID = @ParamVar('tableID') // Table Name\xFE";
    z += "    tabID = @ParamVar('tabID')\xFE";
    z += "    devXGridFilter = @ParamVar(\"filter\")\xFE";
    z += "    devXGridLayout = @ParamVar(\"layout\")\xFE";
    z += "    \xFE";
    z += "    // Did we run from TCL? setup something for testing\xFE";
    z += "    If !tableID Then\xFE";
    z += "        S = RTrim(Field(@Sentence, \"(\", 1))\xFE";
    z += "        Cmd = Field(S, \" \", 1)\xFE";
    z += "        If LCase(Cmd) = \"run\" Then tableID = Field(S, \" \", 4) Else tableID = Field(S, \" \", 2)\xFE";
    z += "        \xFE";
    z += "        If !@isAdmin And !tableID Then Stop 'tableID (the Table Name) is a required parameter'\xFE";
    z += "        \xFE";
    z += "        // for testing\xFE";
    z += "        if @Domain = \"idfg.idaho.gov\" Then\xFE";
    z += "            databaseName = \"SGS\"\xFE";
    z += "            tableID = \"PIC_Transect\"\xFE";
    z += "        else\xFE";
    z += "            tableID = \"democustomers.json\"\xFE";
    z += "            databaseName = \"\"\xFE";
    z += "        end if\xFE";
    z += "    Else\xFE";
    z += "        if isMissing(databaseName) then Stop \"databaseName is a required parameter\"\xFE";
    z += "    End If\xFE";
    z += "     \xFE";
    z += "    reportName = databaseName:\"_\":tableID\xFE";
    z += "    noLimits = True\xFE";
    z += "    if !showTop1000(tabID, databaseName, tableID, reportName, devXGridFilter, devXGridLayout, nolimits) Then Stop @Errors\xFE";
    z += "    If @hasTclParent Or @hasParentProcess Then Stop Else @Server.End\xFE";
    z += "end program\xFE";
    z += "\xFE";
    z += "function showTop1000(byval tabID, byval databaseName, byval tableName, byval reportName, optional byval devXGridFilter, optional byval devXGridLayout, optional byval nolimits)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    fTmp = @fHandle('tmp')\xFE";
    z += "    gridID = \"showGrid\"\xFE";
    z += "    reportName = databaseName:'_gridViewGridDefs_'\xFE";
    z += "    \xFE";
    z += "    dftRowLimit = 10000\xFE";
    z += "    \xFE";
    z += "    Theme = @jsbConfig(\"default_jsb_Themes\", \"theme_none\")\xFE";
    z += "    if Theme Then Theme = \"jsb_themes.\":Theme\xFE";
    z += "    \xFE";
    z += "    if !@jsb_odb.AttachDBextended(databaseName) Then Return False\xFE";
    z += "    \xFE";
    z += "    columnNames = \"*\"\xFE";
    z += "    hideExportBtns = False\xFE";
    z += "    UrlBase = @jsbRootAccount():\"showTop1000\":`?databaseName=`:@UrlEncode(databaseName):`&tableID=`:@UrlEncode(tableName)\xFE";
    z += "    \xFE";
    z += "    Cmd = \"\"\xFE";
    z += "    if !devXGridLayout Then\xFE";
    z += "       Read devXGridLayout From fTmp, reportName Else devXGridLayout = \"\"\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Msg = \"\"\xFE";
    z += "    clearCookies = false\xFE";
    z += "    GridWidth = \"\"\xFE";
    z += "    fTable = Nothing\xFE";
    z += "    \xFE";
    z += "    if dbViewExists(tableName) Then \xFE";
    z += "        tmpTblName = \"##dview_\":tableName:\"_\":NiceName(@UserName)\xFE";
    z += "        open tmpTblName to fTable Else\xFE";
    z += "            fTable = dbMakeTmpTable(tableName)\xFE";
    z += "        End If\xFE";
    z += "    end if\xFE";
    z += "    \xFE";
    z += "    if !fTable Then \xFE";
    z += "        Open tableName To fTable Else return false\xFE";
    z += "    end if\xFE";
    z += "\xFE";
    z += "queryAgain:\xFE";
    z += "    // Select table to get a dataset\xFE";
    z += "    select \"top 300 *\" from fTable to selectList else stop @errors\xFE";
    z += "    \xFE";
    z += "    dt = SelectList.RowHandle.Table\xFE";
    z += "    dtColumns = dt.Columns\xFE";
    z += "    dtColCnt = dtColumns.Count\xFE";
    z += "\xFE";
    z += "    dtRows = Dt.Rows\xFE";
    z += "    searchRowCnt = dtRows.Count\xFE";
    z += "\xFE";
    z += "    // Do we have a lat and a lng column?\xFE";
    z += "    TableColumns = @getTableColumnDefs(tableName, false , True)\xFE";
    z += "    \xFE";
    z += "    If HasTag(TableColumns[LBound(TableColumns)], \"Oridinal\") Then TableColumns = @Sort(TableColumns, \"Oridinal\")\xFE";
    z += "    If HasTag(TableColumns[LBound(TableColumns)], \"oridinal\") Then TableColumns = @Sort(TableColumns, \"oridinal\")\xFE";
    z += "    \xFE";
    z += "    latColumnName = \"\"\xFE";
    z += "    lngColumnName = \"\"\xFE";
    z += "    primaryKeyField = \"\"\xFE";
    z += "    \xFE";
    z += "    for Each Column In TableColumns\xFE";
    z += "        if Column.isLatitude Then latColumnName = Column.name\xFE";
    z += "        if Column.isLongitude Then lngColumnName = Column.name\xFE";
    z += "        if Column.primarykey Then primaryKeyField = Column.name\xFE";
    z += "    next\xFE";
    z += "    \xFE";
    z += "    if !primaryKeyField Then primaryKeyField = @PrimaryKeyName(fTable)\xFE";
    z += "    \xFE";
    z += "    Print @(-1): // Create a new Page\xFE";
    z += "    Loop\xFE";
    z += "        \xFE";
    z += "        // ======================================================================\xFE";
    z += "        // Create a DevGrid\xFE";
    z += "        Settings = {}\xFE";
    z += "        Settings.devXGridLayout = devXGridLayout\xFE";
    z += "        Settings.devXGridFilter = devXGridFilter\xFE";
    z += "        Settings.hideExportBtns = hideExportBtns\xFE";
    z += "        Settings.HorizontalScrollBarMode = \"0\" // Hide\xFE";
    z += "        Settings.latColumnName = latColumnName\xFE";
    z += "        Settings.lngColumnName = lngColumnName\xFE";
    z += "        Settings.databaseName = databaseName\xFE";
    z += "        Settings.tableName = tableName\xFE";
    z += "        Settings.primaryKeyField = primaryKeyField\xFE";
    z += "\xFE";
    z += "        HtmlGrid = @devXGrid(gridID, tableName, Settings)\xFE";
    z += "        \xFE";
    z += "        // ======================================================================\xFE";
    z += "\xFE";
    z += "\xFE";
    z += "        // Create a toolbar\xFE";
    z += "        ToolBar =  @Submitbtn(\"Btn\", \"Update URL\")\xFE";
    z += "        if TabID Then ToolBar := @Submitbtn(\"Btn\", \"Quit\")\xFE";
    z += "        if @isManager Then ToolBar := @Submitbtn(\"Btn\", \"Make Report\")\xFE";
    z += "\xFE";
    z += "        ToolBar := @Submitbtn(\"BtnReset\", \"Reset Layout\")\xFE";
    z += "        ToolBar := @Submitbtn(\"Btn\", \"Fit to Screen\")\xFE";
    z += "        ToolBar := @Submitbtn(\"Btn\", \"Fit to Data\")\xFE";
    z += "        \xFE";
    z += "        if hideExportBtns Then\xFE";
    z += "            ToolBar := @Submitbtn(\"Btn\", \"Export to CSV\")\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        // Adjust Column widths to data\xFE";
    z += "        if Cmd = \"Fit to Data\" Then\xFE";
    z += "            clearCookies = true\xFE";
    z += "            \xFE";
    z += "            ColWidths = []\xFE";
    z += "            For RowNo = 0 To searchRowCnt - 1\xFE";
    z += "                Row = dtRows(RowNo)\xFE";
    z += "                \xFE";
    z += "                For ColNo = 1 To dtColCnt\xFE";
    z += "                    V = RTrim(Row(ColNo-1))\xFE";
    z += "                    LenOfV = Len(V)\xFE";
    z += "                    if LenOfV > ColWidths[ColNo] then ColWidths[ColNo] = LenOfV\xFE";
    z += "                Next\xFE";
    z += "            Next\xFE";
    z += "  \xFE";
    z += "            for ColNo = 1 to dxColumns.Count \xFE";
    z += "                DC = dxColumns[ColNo-1]\xFE";
    z += "                CW = ColWidths[ColNo]\xFE";
    z += "                If CW < 3 Then CW = 3\xFE";
    z += "                \xFE";
    z += "                Caption = DC.Caption\xFE";
    z += "                if !Caption Then Caption = DC.Name\xFE";
    z += "                if !Caption Then Caption = dtColumns(ColNo-1).Caption\xFE";
    z += "                If Len(Caption)  +2 > CW Then CW = Len(Caption)+2\xFE";
    z += "                if CW > 60 Then CW = 60\xFE";
    z += "                DC.Width = CW * 11\xFE";
    z += "            Next\xFE";
    z += "            \xFE";
    z += "            // devXGridLayout = devXGrid.SaveClientLayout()\xFE";
    z += "            // Write devXGridLayout On fTmp, reportName Else Null\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        if Cmd = \"Fit to Screen\" Then\xFE";
    z += "            dxColumns = devXGrid.DataColumns\xFE";
    z += "            clearCookies = true\xFE";
    z += "            \xFE";
    z += "            visibleColumnCnt = 0\xFE";
    z += "            for ColNo = 1 to dxColumns.Count \xFE";
    z += "                DC = dxColumns[ColNo-1]\xFE";
    z += "                IF DC.Visible Then visibleColumnCnt += 1\xFE";
    z += "            Next\xFE";
    z += "            \xFE";
    z += "            If !visibleColumnCnt Then visibleColumnCnt = 1\xFE";
    z += "            CP = CInt(1000 / visibleColumnCnt) / 10\xFE";
    z += "            CP = CreateObject(\"Unit(Percentage, \":CP:\")\")\xFE";
    z += "            \xFE";
    z += "            for ColNo = 1 to dxColumns.Count \xFE";
    z += "                DC = dxColumns[ColNo-1]\xFE";
    z += "                DC.Width = CP\xFE";
    z += "            Next\xFE";
    z += "            \xFE";
    z += "            devXGrid.Width = CreateObject(\"Unit(Percentage, 100)\")\xFE";
    z += "            devXGridLayout = devXGrid.SaveClientLayout()\xFE";
    z += "            Write devXGridLayout On fTmp, reportName Else Null\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        If Cmd = \"Export KML\" Then devxGrid_downloadKML(gridID, Settings, false)\xFE";
    z += "        \xFE";
    z += "        // Setup some javascript for client side processing\xFE";
    z += "        preScripts = []\xFE";
    z += "        postScripts = []\xFE";
    z += "        \xFE";
    z += "        if False And devXGridLayout = \"\" Then\xFE";
    z += "            // We are virgin, when we change, enable the reset button\xFE";
    z += "            devXGrid = System(29).getControl(gridID)   // Don't set breakpoints until done using\xFE";
    z += "            devXGrid.ClientSideEvents.ColumnGrouping = gridID:`_LayoutChanged`\xFE";
    z += "            devXGrid.ClientSideEvents.ColumnMoving   = gridID:`_LayoutChanged`\xFE";
    z += "            devXGrid.ClientSideEvents.ColumnResized  = gridID:`_LayoutChanged`\xFE";
    z += "            devXGrid.ClientSideEvents.ColumnSorting  = gridID:`_LayoutChanged`\xFE";
    z += "             \xFE";
    z += "            // Set Reset enabled on load\xFE";
    z += "            devXGrid.ClientSideEvents.Init = gridID:\"_onInit\"\xFE";
    z += "            preScripts[-1] = `function `:gridID:`_onInit(s, e) { $('#BtnReset').prop('disabled', true) }`\xFE";
    z += "        Else\xFE";
    z += "            preScripts[-1] = `function `:gridID:`_onInit(s, e) { $('#BtnReset').prop('disabled', false) }`\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        preScripts[-1] = `function `:gridID:`_LayoutChanged(s, e) { $('#BtnReset').prop('disabled', false) }`\xFE";
    z += "        \xFE";
    z += "        // Create an easy javaScript Handle\xFE";
    z += "        postScripts[-1] = `myGrid = ASPx.GetControlCollection().Get('`:gridID:`')`\xFE";
    z += "\xFE";
    z += "        if clearCookies Then\xFE";
    z += "            postScripts[-1] = `ASPxClientUtils.DeleteCookie(\"ASPxGridViewCookies\")`\xFE";
    z += "            clearCookies = false\xFE";
    z += "        end if\xFE";
    z += "        \xFE";
    z += "        postScripts[-1] = `$($(\".dxpLite\")[0]).hide()` // Hide top devexpress aspxgridview page size control\xFE";
    z += "\xFE";
    z += "        if UBound(preScripts) Then preScripts = @Script(Join(preScripts, crlf()))\xFE";
    z += "        if UBound(postScripts) Then postScripts = @Script(Join(postScripts, crlf()))\xFE";
    z += "        \xFE";
    z += "        Html = preScripts:Rows2(\"%\", HtmlGrid, \"66px\", ToolBar):postScripts\xFE";
    z += "        \xFE";
    z += "        // Theme screen\xFE";
    z += "        if !tabId And Theme Then \xFE";
    z += "            Html = @((Theme))(System(27),System(28), Html)\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        // ======================================================================\xFE";
    z += "        // Show it all and give user a chance to interact\xFE";
    z += "        Print Html:\xFE";
    z += "        @Server.Pause\xFE";
    z += "        // ======================================================================\xFE";
    z += "\xFE";
    z += "        // Get current stuff\xFE";
    z += "        if False Then\xFE";
    z += "            devXGrid = System(29).getControl(gridID)\xFE";
    z += "            devXGridFilter = devXGrid.FilterExpression \xFE";
    z += "            devXGridLayout = devXGrid.SaveClientLayout()\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        visibleColumns = @formVar(gridID:'_visibleColumns') \xFE";
    z += "        i_Write devXGridLayout On fTmp, reportName Else Null\xFE";
    z += "        \xFE";
    z += "        Cmd = @formVar('Btn'):@formVar('BtnReset')\xFE";
    z += "        \xFE";
    z += "        // Context menu command?\xFE";
    z += "        If !Cmd Then\xFE";
    z += "            Cmd = @formVar(\"contextMenuCmd\")\xFE";
    z += "            CtlText = @formVar(\"contextMenuCtlText\")\xFE";
    z += "            CtlID = @formVar(\"contextMenuVal\")\xFE";
    z += "            ContextMenuText = @formVar(\"contextMenuText\")\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        // Clear screen so MSGBOX or other pause doesn't have to repaint grid\xFE";
    z += "        Print @(-1): \xFE";
    z += "\xFE";
    z += "    While Cmd <> \"Quit\" Do\xFE";
    z += "    \xFE";
    z += "        If Cmd = \"Export to CSV\" Then\xFE";
    z += "            e64 = Encode(SelectList.GetCSV(), 64)\xFE";
    z += "            \xFE";
    z += "            print @script(`\xFE";
    z += "               const b64Data = '`:E64:`';\xFE";
    z += "               saveBlob(b64toBlob(b64Data, 'text/plain'), \"`:reportName:`.csv\")\xFE";
    z += "            `):\xFE";
    z += "            \xFE";
    z += "            E64 = \"\"\xFE";
    z += "            Item = []\xFE";
    z += "            \xFE";
    z += "        ElseIf Cmd = \"Reset Layout\" Then\xFE";
    z += "            devXGridLayout = \"\"\xFE";
    z += "            devXGridFilter = \"\"\xFE";
    z += "            Write devXGridLayout On fTmp, reportName Else Null\xFE";
    z += "            HorizontalScrollBarMode = \"\"\xFE";
    z += "            clearCookies = True\xFE";
    z += "            \xFE";
    z += "            if @ParamVar(\"filter\") Or @ParamVar(\"layout\") then\xFE";
    z += "                delete fTmp, reportName\xFE";
    z += "                if tabID Then \xFE";
    z += "                    Print @Script(`windowOpen(`:jsEscapeString(UrlBase):`, '_blank'); doJsbSubmit();`):\xFE";
    z += "                    @Server.Flush\xFE";
    z += "                    Print @(-1):\xFE";
    z += "                Else\xFE";
    z += "                    @Response.Redirect(UrlBase)\xFE";
    z += "                End If\xFE";
    z += "            End If\xFE";
    z += "            \xFE";
    z += "        ElseIf Cmd = \"Update URL\" Then\xFE";
    z += "            Url = UrlBase\xFE";
    z += "\xFE";
    z += "            if devXGridLayout Then Url := \"&layout=\":@UrlEncode(devXGridLayout)\xFE";
    z += "            if devXGridFilter Then Url := \"&filter=\":@UrlEncode(devXGridFilter)\xFE";
    z += "\xFE";
    z += "            runScript(`\xFE";
    z += "                if (window.self !== window.parent) { \xFE";
    z += "                    w = window.parent.open(`:jsEscapeString(Url):`, '_blank'); \xFE";
    z += "                    setTimeout(function () { window.location = \"close_html\"; }, 500);\xFE";
    z += "                } else { \xFE";
    z += "                    window.open(`:jsEscapeString(Url):`, '_self'); \xFE";
    z += "                } \xFE";
    z += "            `)\xFE";
    z += "          \xFE";
    z += "        ElseIf Cmd = \"Make Report\" Then\xFE";
    z += "            Url = @jsbRootAccount():`makenewreport?&databaseName=`:@UrlEncode(databaseName):`&tableID=`:@UrlEncode(tableName)\xFE";
    z += "            runScript(`debugger; window.parent.open(`:jsEscapeString(Url):`, '_blank'); jsb.submit();`)\xFE";
    z += "            goto queryAgain\xFE";
    z += "            \xFE";
    z += "        Else If Cmd = \"Save Default Layout\" Then\xFE";
    z += "            //\xFE";
    z += "            \xFE";
    z += "        ElseIf Left(Cmd, 4) = \"Load\" Then\xFE";
    z += "            noLimits = True\xFE";
    z += "            goto queryAgain\xFE";
    z += "        \xFE";
    z += "        Else If Cmd = \"Fit to Screen\" Then\xFE";
    z += "            // HorizontalScrollBarMode = \"0\" // 0-Hidden, 1-Visible (Allows user to change columns), 0-Hidden\xFE";
    z += "            devXGridLayout = \"\"\xFE";
    z += "            \xFE";
    z += "        Else If Cmd = \"Fit to Data\" Then\xFE";
    z += "            // HorizontalScrollBarMode = \"2\" // 0-Hidden, 1-Visible (Allows user to change columns), 2-Auto\xFE";
    z += "            devXGridLayout = \"\"\xFE";
    z += "            \xFE";
    z += "        Else If Cmd = \"Export KML\" Or Cmd = \"Show Map\" Then\xFE";
    z += "        \xFE";
    z += "        ElseIf Cmd Then\xFE";
    z += "            print @Script(\"alert(\":jsEscapeString(Cmd:\" not yet implemented for CtlText: \":CtlText:\"; CtlID:\":CtlID:\"; ContextMenuText:\":ContextMenuText):\");\"):\xFE";
    z += "        End If\xFE";
    z += "    Repeat\xFE";
    z += "    \xFE";
    z += "    Return True\xFE";
    z += "End Program\xFE";
    z += "*/\xFE";
    z += ""
    window.cached_jsb_mdl["showtop1000.old"] = z;
    window.cached_jsb_mdl["showtop1000_mygrid"] = "function showTop1000_myGrid(byVal gridID As String)\xFE     return System(29).getControl(gridID)\xFEend function";
    var z = "Subroutine showViewColumn(ProjectName, PageName, ViewName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else dataSet = @createNewView(ViewName)\xFE";
    z += "\xFE";
    z += "    CNames = []\xFE";
    z += "    VColumns = dataSet.columns\xFE";
    z += "    For ColumnIdx = 1 To Len(VColumns)\xFE";
    z += "        viewRow = VColumns[ColumnIdx]\xFE";
    z += "        If viewRow.display = \"hidden\" Then CNames[-1] = viewRow.name\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    If Len(CNames) = 0 Then\xFE";
    z += "        @Alert(\"All columns are currently being displayed\")\xFE";
    z += "        Return\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    ColumnID = @InputDropDownBox(\"Pick a Column\", \"\", CNames)\xFE";
    z += "    If ColumnID = Chr(27) Then Return\xFE";
    z += "\xFE";
    z += "    ColumnIdx = @findViewColumn(dataSet, ColumnID)\xFE";
    z += "    If ColumnIdx = 0 Then Return\xFE";
    z += "    VColumns = dataSet.columns\xFE";
    z += "    viewRow = VColumns[ColumnIdx]\xFE";
    z += "    viewRow.display = \"visible\"\xFE";
    z += "    viewRow.index = 0\xFE";
    z += "    viewRow.index = @highestViewIndex(dataSet)\xFE";
    z += "    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edc-\":System(28):\": \":@Errors\xFE";
    z += "    Call @jsb_mdl.ReGenPageModel(ProjectName, PageName, False)\xFE";
    z += "End Subroutine"
    window.cached_jsb_mdl["showviewcolumn"] = z;
    var z = "Program sqlQueryBuilder\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    roleMsg = Iff(@IsAuthenticated, \"\", \"You must be logged in to view this page. \":@Anchor(@LoginUrl, \"Click here to login\"))\xFE";
    z += "    If !@isManager Then Stop Iff(roleMsg, roleMsg, \"You must be at least at least a data manager to use this command.\")\xFE";
    z += "    \xFE";
    z += "    databaseName = @ParamVar('databaseName') // Table Name\xFE";
    z += "    If isMissing(databaseName) Then Stop \"databaseName is a required parameter\"\xFE";
    z += "    \xFE";
    z += "    \xFE";
    z += "    sqlID = @ParamVar('sqlID') // without extension\xFE";
    z += "    tabID = @ParamVar('tabID')\xFE";
    z += "    databaseName = @ParamVar('databaseName') // Table Name\xFE";
    z += "    Attachdb \"\" Else Null\xFE";
    z += "    fSystem = Fhandle('system')\xFE";
    z += "    \xFE";
    z += "    Open \"jsbCustomSQL\" To fSQL Else\xFE";
    z += "        Fhandle = @Fhandle(\"\", \"jsbCustomSQL\", True)\xFE";
    z += "        fSQL = @Fhandle(\"dict\", \"jsbCustomSQL\", True)\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    If sqlID = \"*NEW*\" Then\xFE";
    z += "        lastXmlQuery = \"\"\xFE";
    z += "    Else\xFE";
    z += "        Read lastXmlQuery From fSQL, sqlID:\".devX\" Then\xFE";
    z += "            pDatabase = Field(lastXmlQuery, `<Parameter Name=\"database\" Value=`, 2)\xFE";
    z += "            pDatabase = Field(pDatabase, '\"', 2)\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    queryBuilderID = 'myQB_':Replace(Right(Timer(), 4), \".\", \"\")\xFE";
    z += "    \xFE";
    z += "    // Save\xFE";
    z += "    myBtnICon1 = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAN1wAADdcBQiibeAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAA8dSURBVHic7d1vjFzVecfx3xZUkFy1oiVSUhAiUqRUEFKaBFJjsfY6xRvhbUP8lxUVYAurFIkK1nbKupQXsHggCymFNrFCWOPdWdbr8VppaxpmrdRmqb0KNpQ4DS2igigqiRRSUK2iEoR5+mKu679M7pmdM+fec74faV5Y2rnn0b3PnPn5zr33dJmZAKTpV0IXACAcJgAgYUwAQMKYAICEMQEACWMCABLGBAAkjAkASBgTAJAwJgAgYWe3+sbZ2dkrJS2XdIWkz0r69XYVBSTqiKQXJB2UNDV//vznfQ/Y5XovwOzs7NmS7pG0SdJZPooCoKOSNku6d/78+e/7GsRpAjhw4MDZkv5J0tW+CgJwkuckLb7qqqu8TAKu5wC+Ij78QCddrcbnzovcCWD//v2flPR9Sef4KgbAGf1C0u8uWLDglXZv2CUB/LH48AMhnKPG56/tcv8KYGa/56MAALlc7mOjLgnASwEAcvHyBeySAC7wUQCAXLx8/rgSEEiYSwLwWcdcvCPp65JmJO3v7u5+O3A9KJmZmZnzJC2Q1C3pNknzwlbUObl/BpyZmSniDPC6pC91d3f/IHQhiMPMzMxlkv5O0sdD13Kq7u7urnZvs8wJ4EeSrli4cOF/hS4E8eju7v7Bs88+e4WkQ5IuDlyOd2U+BzDIhx8+ZH01GLqOTihrAnhe0mToIhAvM5uUdKekK0PX4lPLtwP/Ej9X427B70p6fdGiRafNHvv27etS4/9ZX1DjrqfzHbY/caZtAu2yaNEi27dv34SYABocEsCbki7v6en5SbM/yj7Ar0l6be/evU9LeknSR3KO8cO8xQCtMrPo+8zHOYDBX/bhP1X29y7/5/pXt5KAlkTfZ7knADPL+6q3UoiZ1fOO0dPT89NWxgBc9PT0/NSh772/fGh7Ali8ePF/dvJ9AFpXqF8BCvZLAxB9T5b5OgAAc0QCAJqIvSdJAEDCSABAE7H3pK8rAQtpz549X5D0R2osZHK5ErrtM0HvqHFx2QuS/v6aa675buB6CqntCWB6evrCJUuWOP+kNz09faHrexy2fZ6kRyTd6GsMFM48Ne7xXyDpz6anp0cl3bFkyRKn50XEngB8nAPo7fD7mpqenv5NNb4J+PCn7UZJL2X9gIyPcwCVer3+nd7e3tyXA9fr9d+WVMn79y7MbIuki3xsG6VzkaQtklblfUPsCcDHOYCPSPp+vV7//7sBe3t7T9uL9Xp9LncD5lKv16+TtLLd20WprazX69f19vZ+O3QhReDrV4DzJX3z2D+eeeYZl/e2jZl9McjAKLovSso1AcSeAGK/DuBzoQtAIdEXmUJdB9BuZvbJ0DWgkHL3RRn73kXsCaDtiykiCvRFJvYEcEiNi36AEx3K+4dl7HsXsSeAMGcfUXT0RSbqBHDttdd+++mnn66JnwJxXG3p0qW5fwIsY9+7iD0BSNKtkn4cuggUwo/V6Adkok4AkrR06dK3du/efbm4FyB1o5Lu6Ovr416AEyRxN2B20G/avXv3qLgbMBUn3Q3Y19fH3YBnEH0COFHWBDQCcouh75tJ4RwAgA+RVAIAXMXe9yQAIGEkAKCJ2PueBAAkjAQANBF735MAgISRAIAmYu97EgCQMBIA0ETsfU8CABJGAgCaiL3vSQBAwkgAQBOx9330zwPYuXNnl6Q7JN2gxjMAzgpbEQI4qsazAcYlPbJixYq4P9UOok8AZjYhaXXoOhDUWWo8BOazkj4v6fq8byxr3+cV9TmAWq22XHz4cbLVWV9AkScAM+MBkDiTWyVN5fnDMva9i6gTgKRPhy4AhURfZGJPAKFLQMnF3kOxJ4DDoQtAIdEXmdgTwBZJfxC6DhTOlrx/WMa+dxF1Arj++uunJE2GrgOFMpn1BRR5ApAkM+uX9D1xIVDKTroQyOWNZe37vKK/ErC/v98k/VX2AnCC6BMAMBex933U5wAANEcCAJqIve9JAEDCSABAE7H3PQkASBgJAGgi9r4nAQAJIwEATcTe9yQAIGEkAKCJ2PueBAAkjAQANBF735MAgIRFnwC2bt3KwiA46XkAa9asyd3MZe37vKJ/HoAkFgZBywuDxC7qBDAyMsLCIDjV6pGRkdratWtZF0DxnwNgYRCcCX2RiToBmBkLQOBMcvdFGfveRewJAEATsSeAw2JdAJwu98IgZex7F7EngNwLQCAp9EUm6gRwyy23TD3++OOT4pcAHDe5bt263AuDlLHvXcSeACSpX9KApBfUuCAE6TmqxvEfUKMfkIk6AUjSunXrWBgELStr3+eVQgIA8CGiTwDAXMTe9yQAIGEkAKCJ2PueBAAkjAQANBF735MAgISRAIAmYu97EgCQMBIA0ETsfU8CABJGAgCaiL3vSQBAwkgAQBOx93306wI89thjLAyCkxYGuf322+P+VDuIPgGYGQuDoOWFQcra93lFfQ7g0UcfZWEQnGp11hdQ5AnAzFgAAmdyqyRWBlLkCUAOC0AgKfRFJvYEELoElFzsPRR7Asi9AASSQl9kYk8AW8TKQDhd7oVBytj3LqJOAHfeeeeUpMnQdaBQJrO+gCJPAJJkZv2SvicuBErZSRcCubyxrH2fV/RXAg4MDLAwCPAhok8AwFzE3vdMAEATsfd91CcBATRHAgCaiL3vSQBAwkgAQBOx9z0JAEgYCQBoIva+JwEACSMBAE3E3vckACBhuScAMyvMq1KpfMznTgEkqVKpfCx0r5/48qGsCeBToQtAEqLvs7KeA7hU0p7QRSBuZnZp6Bp8K2sC6N+8eXNX6CIQr6y/+kPX4VtZE8CVajzvf3voQhAnM1utRp9FrawJQJIq999//2+FLgLxyfqqErqOTijlrwDZ62IzOzg0NHSZzx2EtAwNDV1mZgez/grd495/BSj7I8E+Lml2aGjo65JmJO2/++673w5cE0pmaGjoPEkLJHVLuk3SvLAVdU5ZzwGcaJ6kjdlL9913X9hqgBIp8zkAAHMUQwIA0CISAJAwEgCQMBIAkDASAJAwEgCQMBIAkDASAJAwEgCQMBIAkDASAJAwEgCQMBIAkDASAJAwEgCQMBIAkDASAJAwEgCQMBLAmb0oaUrSrKSDlUrlfwLXg8zg4OCvSbpC0nxJyyV9JmxF5Vb2pwK32weSHpR0T6VSeT90MThdNhnvlbR3cHDwq5LulfTnIs22hARw3AeS/vCBBx74x9CFIJ9skt501113/bOkfxCTgDN22HHf4MNfTtlx+0boOsqIBNDwhqRNoYtA68xsk6TrJF0QupYyIQE0bH3wwQePhC4CrcuO39bQdZQNCaDhpdAFYO7MjOPoiATQQOPEgePoiATQ8FroAjB3ZsZxdMR1AJKGh4dbnt02btx4gRory/6OWk9UH0j6d0n7h4eH32i1ltQNDw/bxo0bQ5dRKiSAFm3YsOHTkiYkXdLm7b4sqf+hhx463M7tpoI+dcM5gBZs2LBhhaQDavOHP3OJpAPZGIBXJABH69ev/4ykHZK6PA4zT9KO9evXf+7hhx9+0eM40aFP3ZAA3H1Nfj/8x3RlYwHe5J4AzCzaV14DAwN9Zrawg7UtHBgY6GvpyCYqdC8VoU9dkADcXJPImEgE5wAcmNmlAYYNMWZp0aduSABumAAQFRKAAzP7aIBhQ4xZWvSpGxIAkDASgAP2QfFxjNyQAICEkQAcsA+Kj2PkhgQAJIwE4IB9UHwcIzckACBhJAAH7IPi4xi5IQEACSMBOGAfFB/HyA0JAEgYCcAB+6D4OEZuSABAwkgADtgHxccxckMCABJGAnDAPig+jpEbEgCQMBKAA/ZB8XGM3JAAgISRABywD4qPY+SGBAAkjATggH1QfBwjNy4J4G1vVQAIwiUBvCHpPI+1FB7fLsXHMXLjkgB+4q0KAEG4JIBDkpZ4rKXw+HYpPo6RG5cE8KSvIgCEkTsBPPHEE6+uXbv2OUlXe6yn0Ph2KT6OkRvX6wD+1ksVAILInQAkaWRkZHLNmjVrlei5AL5dio9j5KaVKwH/RNI77S4EQOc5JQBJ2rp1649uvvnmTZL+2kM9hca3S/FxjNy0ei/A30ja18Y6yuK9RMZEIpwTgCQ9+eSTH9x0002rJB2SdFF7SyouM3tF0mUdHvaVDo9XaiQANy3fDbht27Y3JX1Z0v+2r5zC+2EiYyIRc7odeNu2bS+a2TozU5lfeZnZ4QD1HZ7LMUpN6F4qQp+6mPPzAEZHR8clfa0NtZTBE5KOdHC8I9mYgBdteSCImX3FzPaEniF9z6yjo6M/M7NKB2urjI6O/qwdxygVoXupCH3qoi0TwNjY2FFJKyW93I7tFdwjkg52YJyD2ViAN217JNjY2Nh/m1mfmb0Zeqb0ObOOjY29a2bdZjbmsaYxM+seGxt7t13HJxWhe6kofZpXW58JWK1WX5f0JUlRN261Wn23Wq3eKGmVpG9J+jdJczlClm3jW5JWVavVG6vVatT7EMXQ0nUAzVSr1dkbbrjhZkkTkrravf0iqVarNUm10HXgOF/flLHy8lTg8fHxSUn3+Ng2gPbx9ljw8fHxITMbDf3/plD/t0IYoXupbH3qe12AdZJmPI8BoEVeJ4CnnnrqPTP7spm9Gnr2JAGkIXQvla1Pva8MNDEx8ZakpZLe8j0WADcdWRpsYmLiVTNbZmbvhZ5FSQBxC91LZevTjq0NuH379mfVOCcAoCA6ujjo9u3bR83s/tAzKQkgXqF7qWx9GmJ14L+UNBlgXACn6ArxDbhq1apzJe2V9PsdHxwoqR07drT9ytoQCUA7dux4V417Bl4PMT6AhiAJ4JiVK1deIumApN8IVgRQDm/UarUL273RIAngmFqt9rIazxF4P2QdQAn8i4+Ntv1uQFe1Wm3PihUrVksal3Ru6HqAgnrJx0aDJoBjdu7cuUvSYkk/D10LUEC/kFT1seGg5wBOtXz58k9I+o6kT4SuBSiQv5iamtrsY8OFSADHTE1N/Yek+ZK+qbTWGwA+zHOSvupr44VKACdatmzZ+ZL+VNJtkj4auByg045K2izp3l27dnk7SV7YCeCYZcuWnSPp85I+dcLrYjVOGJ4r6RxJvxqqPqCNjkh6QY0nQk/t2rXred8DFn4CAOBPoc4BAOgsJgAgYUwAQMKYAICEMQEACWMCABLGBAAkjAkASBgTAJCw/wOS0gLRE6r/QwAAAABJRU5ErkJggg==`\xFE";
    z += "    myBtnOnclick1 = `assignBtn(\"Btn\", \"Save\");`\xFE";
    z += "    btnSave = devXQueryBuilderBtn(queryBuilderID, myBtnOnclick1, myBtnICon1, True /* doSaveFirst */, True /* do PostBack */, 'left')\xFE";
    z += "    HideOtherSave = `$(\".dxqb-image-save\").hide();`\xFE";
    z += "    btnSave := HideOtherSave\xFE";
    z += "    btnSave = \"\"\xFE";
    z += "    \xFE";
    z += "    // Quit\xFE";
    z += "    myBtnICon2 = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAAAAABWESUoAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfjCRsPOSWY0G+jAAACjElEQVQ4y11U7VITMRTt4yq/cJTN6l94AHDY7BYcH0ABK/oA0m7bHz6EQ6HttsCMg3aTe29y401aPsam2ZM7zd7Pc9oJgZ8+/v9zCJ3gXWD0gYgZXHDIXiwBRhd/67Anh4gOwMWN4AjRAxBFy3FHfK2AsXXcWqaVYwPBRbDsWwpywSPFBYiQFm1WejB3Alnv5Ko14goDtOxaAeO9QSaIHpy1BBbJWjkBmmiBbEJL7Dscrj7oqiyqqhA4LKuiENCVPqzK44nkEHy99V6XR7roVkXZ1brb1VW31N1K72/VXsrkOpuJyxjHCJh1LENkZnmdQoyzecAVSe2BWueNlTIpwjIbxTLDUDWrk0Kf/v05Rrr4cf91cnlUHh1+WjVZnXLo58vp693is/2ummX+5TbvTz7uvtg//T3LB7GTYaSaGzVwRNdvz87eNU0+cthXU/BNNgwxh1HW3Kk+s7W9V9u9MFNjD3U+BclhnFo9yBezbE9/XvnJjrqGZd53oVZLb+d57eOw+moxz/aKk5avMnWNC4kcBmrhQS5wyiFb3KkLljH2tmOIfBxMCrFYh4hl3uQDIprGJOcxSTdQDblGDR/KnL2RHOy5am7z3q26cFzv3HgzfyqzPSv0yZ9hjdgf3Z9fEv36do9+7WHT6pakTE6tBgGx4KHVXOdzi5EUQoU4pQ0QzFKZgeuXB3HA5WbclYy7KmXrg61h7EMiTCFM0UX5SJg1HF+lTkZ2AQhfrTgHtBaTJawD8om0wnYSmrKLpDXMQmFovW+FtCgeRCgQSb8BOSQhiYKQKM1CyPMonDYpRjyyMQ/CEX3Jmx7sGkR6dgMgmoqtFvKDiFdUuxavqJafife5/EP6rv8DvI87hH/2yn7V6u5rEwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0wOS0yN1QxNTo1NzozNy0wNDowMCIsQBkAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMDktMjdUMTU6NTc6MzctMDQ6MDBTcfilAAAAAElFTkSuQmCC`\xFE";
    z += "    //myBtnICon2 = `ui-icon-closethick`\xFE";
    z += "    myBtnOnclick2 = `if (confirm(\"Are you sure you want to quit?\")) { assignBtn(\"Btn\", \"Quit\"); doJsbSubmit(false); } `\xFE";
    z += "    btnQuit = devXQueryBuilderBtn(queryBuilderID, myBtnOnclick2, myBtnICon2, False /* doSaveFirst */, False /* do PostBack */, 'right')\xFE";
    z += "    \xFE";
    z += "    // Delete\xFE";
    z += "    myBtnICon3 = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAAAPFBMVEX///+SkpKVlZXy8vL8/PykpKS+vr6enp6wsLDNzc2YmJj5+fnS0tK5ubmnp6fR0dHe3t7r6+vj4+PY2NgBRovlAAABSElEQVR4nO3bzW6DMBBGUdtgMIQ/J+//rvVQVe3CJIoHV6W63y6yxnMYQNkYYwghhJCCxM47m4nzXfyF9u2ca/6Vrq3ef3nW39pQW/D0+vcZ1O0fpYffbrm12+Zlte5z0En/bPud4KuPQDpsx8ub+KoC5P07HEAagbyNVQFykzXrAAAAuA7g1V9OSQBcC/ATUlR4Uj0AAAD+HkD7GwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMA1AYrz8q3VHnTu0w5Nebmche9VgJB2mMrL11QeVIAh7bCUl8tZ+EEFaKxmBDIAzR2UyBcV7l5We5ez+LOuv2lkE1c0g0lKR+UAjHnIGO0yxbfexjau+/ce9qHt//kcFmfV908zGEvbjydcv6R5+W1PPrP6/n8ThtBnP+86iuvDcF57Qsh/zgezKwxHulPuywAAAABJRU5ErkJggg==`\xFE";
    z += "    myBtnOnclick3 = `if (confirm(\"Are you sure you want to delete `:sqlID:`?\")) { assignBtn(\"Btn\", \"Delete\"); doJsbSubmit(false); } `\xFE";
    z += "    btnDelete = devXQueryBuilderBtn(queryBuilderID, myBtnOnclick3, myBtnICon3, False /* doSaveFirst */, False /* do PostBack */, 'left')\xFE";
    z += "    HideOtherDelete = `$(\".dxqb-toolbar-item-container>div[title='Delete']\").hide();`\xFE";
    z += "    btnDelete := HideOtherDelete\xFE";
    z += "    \xFE";
    z += "    // Make Report\xFE";
    z += "    myBtnICon4 = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHEAAABxCAIAAABtHNuHAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAAB3RJTUUH4wkbDy003M6YBAAAHCZJREFUeNrdfXuMrVd131pr7+9xHnPncX3H92Jf4wfGwY/awQFiHApplDhJK1VQteIvt5FsyQKaCoFoQ2NBMapcVKLemECrFCyFlkRVWtKqUkKbtsFBvG3jllKbCzYX29x7Z+5jZu6cc77v23ut1T/2Od98c+Y8Z87M3LB07+jMme+1f996r7X3RlWFWRBrQUoguScSwJgJDAmxgQiAZnKLvyqEu8BUVRGx70tm9gQeOYHYCgBBoc6wkol2HvzTTXYX5wzESFEijujCK8Xl/1EA4cI98fJdYDNQA2qg7wwF+OnFeTeYDiShCE//fuupfxEn5GyNist63S/aez9ilm4GAAAPahV7SP70Agq7ln0RUdVwrqoSUbHx6pX/9Z6a6dR+4QlTuwVf+fP15z5eYG3+gSdd4/pEM9UaKBOgXjWAiggAYI9U1VpbjujgMFXVzc3Nzc3NqlZFRNZ1WpO4trQ5B9Zrni5Erz5/zdfetX79L/Od/zwBaGMRA6AhEX+VWK0w9jAKRGTm+fn5ZrO5x8tOMbbAnhsbG+vr61mWhZdc/inmozJ/1DXjNI+t97X1V3Du1kvLb+XzXwf1KEjgFQOgM1M4e4Gy/Oy9z/Pcew8AFy5cWFtb2+P1pxheEPZ2u42IjUbDGGOMQUQRQUQFG0MG0nZxgnFK7caGvXw0O290fnVurgYtq6lIDam4Gpg08KaIiIj3PgCKiFEUdTqder0exzEM8XBmg2l4sUTUarWKorDWxrEVwMyB4bUrksbiKKo7tQYBcpdzO82X9Pt/0Fr5ptz2sVq+ds5TSo7AKRLIbDziyeEL2p+IjDFFUQTtCQDGGGutMSYgi4jhs3MuYLo7L3BqMSSCKIk7nRwIvWs7IYdx4jP/wr931y7Qwt+1dNZmzfzKl48+/dH11zwYv/6drkBiMeAdiRyGhQpodjodZl5aWrpy5QoREREzM7O1NvwKPc7d4+12galFBWbmghMLhcY1WyQ/+Qv92oeTe38jvu7vtWCpeeVi9s0Przdvqd/7Xp9eg9JeqCecI9nD0aSImKZplmVPPPHEww8/fN11121sbARMAydqj4L132NsOfUgRXyeq7WW2eW5SxrzvPnDjWc+nr7m1trPfLDTaKdrPnvm43zhx/YdX3DHbon9RZPUAHKtpbExIAqEeFDSH9AJ3Fev119++eXHHnvs0UcfPXbsWJ7nxhgi8t4754JymEnINzWmCkwEea6oMdk0J+avPW6ylej+3/HLJ2Muoh/8x87/+w/FPQ8d/Zm/KbRhk3kVi4gRKCqAAQBBNLPKM0xCIhJEu9lsnj59+tSpU+9///uXl5dbrRYAeO+DsZ1VDD01pt57BAOkKIhRM3vmiYUXvpj/0qnipnfM8ZXNs2c2v/Z+Wbx9+c4POzpPRZK7GDDrs/Wo/iD1KiIGTIloYWHh9OnTjz/++Ac/+MHjx49vbm7GcRxEfla3m17BacyM1miG3r/6l3Nff2zzlr81d9uD6v1l7sR/8aHMbS7c/7FOI7WZRjbOXNsQADAiSmDVA6dSaSZJYq1dXFw8e/bsJz7xiQ996EPXXnttlmUB04D73sGd2lW0JiGLDJi3NvVbH2mnS/r2fwYxxRy7b3xq/aUvmZ97zJ68nzGz6NrcslEwqoSIFujgyRhTBtPW2lqtVqvVFhcXV1ZWPvnJT549ezaKImbuA3Qvlmo8pgqQKyMLS2YoNawdvqJi5Du/qytPL/78B44svRGtXjr3VPz0v6Ib35Xc/W7lVqpWEAgQpDSqKlsG9qDJGAMAcRzHcRycpwDrpz/96YsXLzYaDedcGf7vUb2OxxQBrPqWKYhSt/LtTF8iuDU7/V/oe/8mfsPfz+96GDZXi7VXWn/26Pm4duQXf7sWxQYFABRmY0Z3Rz0uozIWEhFrbRRF1to4jo0xi4uLr7766qc+9amVlZV6vR54Oc/zPYr/KEwFFEBUlTwjxp1Xv/Xi/zyF9ibbfu7Stz9G9bvxjb9lQTXmtW+cwvPPXnPfv8xOXE+MVhuHBWVJvdcpVYittUmSpGkax3GaplEUHTt27MKFC6dOnVpdXY3j2DkHe1apNPJvGN6zRrbu6Mf/+dHiwndsOle89JXGpZXivt+GxjwRXnnhT1rf+H188yMLd7w77ag1KGR6gxFFOKx/ffiqqrVxHMdRFCVJEj4QUbPZXFtb+9znPre6ulqr1YiozGHOHtPuEahI8YWv/utLz39p7s53e8nBLGVe1P2oVjtaXPj+2n//SO3Efcv3/xOPLaPgmdF3SBDQKzlBL+gF5eD/MQmTKHpVRQVLkcU4pH6CEgjqNYqi+fn58+fPP/nkkxcvXjTG5Hm+F0xH+FICQKqMaDbOP/vSn/xW855fv+Ht7zvzcmZuubNxywPtLz124cVvtlefTtbd4rv+MTXnMS+ACADYKCIxRCAYa9672kETolFlVfXqHakaFzXYdiz0Eivlz5A5PX/+/Gc/+9lHHnnkxIkT5ffBuM0KU4JejePlr37ByJXX/9rjHVpq6nfX66+p/eoT+u1/607/sV++aemB37PX/7wUHUJjABWBVQ26CNGaqCNpebWDJeneVMkQRAaLHFEbUZQBQMieBDH33hORiFxzzTWrq6uf//znP/CBDxw9ejR8v5t3OZrDg9H83u/9nQLa97z3T1sbqy9fOlfLltvRWqxpEiULST1PusIFvToEQaTK6C9z5xLi4WagFQCAWMl0Ns0f/eEXL7scehmA4LcGfFXVOYeI7Xb7jjvueOSRR+bm5sqgdioaO2ABMGhrcvGsBwBR4xvetBIWp5mtpy4uULwxaTczrSoixpq1H/y7+v/5A60dTY6+doah9O4IJdeoU2weRwuKUb2IC6UcrqBBo4QWQ47KGCOgdYDnnnvuM5/5zHve855arVYURRRFgbcmHMVoPhVVRTQ/fuG/Pf87D/y1f/ifmq975+qLp32iqAQAjSSNm3WQkDELgsZkG7zyHPzXX9flGxtvedCCAz0EZQqK0AuERWLCROX8F56i588upHhRBDSvAxaCmQiIeO+DevWFZxLY2Gy94Q23ve9972s0GmVya0LdOhzTsgQvIAj/9w/fu/qVJ2/8jU/D0b/u2BOoKtYa9UatHiLlrv8h3tQW5YU/li8/rPc9WPvJd9sv/xAostg9AFDhQNMnykoNKto+grn8+dbd3770axsmZ1qjIjeaejAiXkSYNSiEMle9ubl5++23P/TQQ0eOHAkh1oR6wHz0ox8d8jQSQFVQgXz5zl/Vi+d+8q0v1m5/JxIhqIjGUVStMagqIoBJYOMc/+hPXaul5573URPQM4qSMoqgHqxHxYqYiffxRpThIqy18OImz3u4FjVBJEULYACMAgh7CAWVOALVer2+urp66dKl2267LY7jycV/jN0PeBEYUHzdg7/bePGFyzlHRCKAulWuKYu6GKyUSpa3o/WXMppH8T0TfLBlqK48EIBnSdEl7JXA3RX/79eaVzt8XVarGd20ogAIbrN27HXx/f/UqGGjRtgYo0DGRIiKFZrk1kMx7Ym+ABCIQVRA2zh249rZV7wwKigMyNyIiAEA9U6BlFAdeGEwh+KfChKpIABCoQIFqoCZg3wRz4pZY0CwRYQEEiFdoLllvv6GSJENkuYqW6ozNFIEC7wnPu2d2q18EVlEQORQ9VSAIAo7BwIABXplryKqACoAooCzzfuOJSUkYem7o7osapAlEGeYPVNLTQSk3sTekPeo6AWMsMK2HoAuJnvk0yoZYwPjqpbvikKaecexJADEKBCKZQwsgiiodMCcKsDV3xBIAUGhEIeZoAcfqVVE51RQi+AkICKAAikBld7htI7ghA5590Uxl88pqhrqjiEICQ+kQYGhgCB7dOpiVAUiOWiD30ek3WEo5AiKDIoMQkZjVRSOigJqhpSdUYtqFbXPWswc0+0AV5Lh1e8FFJQAQJEUjCgAExMrKEJvTIdNjEgCAARKFPwQZVZnumV9geBgIqKCGgSe+qGnr5sOARS6plYEQD0KgxKpimcBoCqTHi7DAmiQNUE2wVEEEkYIvTYKDCTAAdLdtczMEtNABlHZe5fHcapsEFgRuSd9EJj1KmBYElAiUFJEZvXiEFEQFMQoyB7M6aT9UmVDYZlWKEs91QMAjbpOcvIOXrjHn/t60UTwapQC/15tpJAY7xk0t/Hine8ylKrmiCJUypHsov94N3w6Ig2OiOyLtHnTrX/71IXn/ww6a2id0cNv5NtJAiTUjtAXndryDW9q3P4redFG3BbR666U1IwxBQBEzGWts3zrwsmfs1lbTcR4FWFKCoIAAATi2YqojYvcUDvL7LbARABodz71bux+cNyG/VVVDRxJfatw59oENW/wauJTqXyIwIChvFPUjHdiAKMdR+2GRmE6zN0tvyyzOL1vCAAQRWQTCYymRi3v8PUnefk7b42lYUMBANjze2LQCEVRGZJcUkJf+eOeLj4K08FzdnrpkkEaoAef9i6LBVYesXuWCo57aEQA4OrYgnODWkIrALvsY66MnEA0AtfLtsyGpr5QCWV1gsHI65e3kN4pE1bNtj1bWZ4BoGA5psoVjRrLtoecAU2qT8t+V9hlkbar8kVkq/o2kkIEMehIQR1vKsdSmUeHWYchE2Fa1YDlh74e7XFj6+lDQjBp4ZyFocqaUFW8JXC67bLlyGMUk8aZiEUL6qoTnMYPmEmRPKhw5rxHm3T9+9mFIVPw6c4PY2OqvleCqNamZ1559ctP/SV7N1hsFUHciePLv/Q33qHdbqdu+rUU+baD7//wBx32RqxKMZX4RwJOAaP41huPN2sRe9mL9tgTplUcqwmbiRUrAID3gsjnzp179tlnrI0GHkNEzhVnzpx529veVquFBqYgECF4YzTUdvrN577Xdi4GO22pmAw6ZvVyZO6+uRteg+pmPlFzNz5/mViEydRZlZ1tFAFAkqRxnA48vfBiIkobzcJxmipsiXw3b0RAyhJbY9MEnLB3U/Xhe8njmvUdiNSRisfZz32dVJ9W52eUAFUT4JOos66uVPXeW+sHHm+MUdagrLuvrTdoRYDQbG3oSLPZbretsRqbYMiCV6A4xgIS2MK7ZK6eNI96tLAtc32AmO6kKqAwcVEhpLG77wB0oF0wREKgAIim3+0P2TiGI/X4gbfdFyaOKCEQVpNyo98uigIAkqZJXZyf3LjtI6Z9dmkqBT+JOykiiCaUF4cOVYo0xiSKjSEuPCKA6StyDL0LIimhiASHITSDzhDQPWHaB9asngwRVQfL4xZqFHfygohqUU2N88wUQOz1bMFwRU/GOBUKbdPGDLvX6PHOGNNgoIL3Xs4krDoAY08P3fUDha68CDMPTAv1fu1OtM/zXBWJLCJ7l0OI0HRUzCreIakoChIaw8WkvtTkEjn7PP/oxwqjZWYxA4w1EYVaC1HgJKmeu5UP02CKwvfkXYeIavUmKlXjvcGYAgs4SxF7X/GRaYYdCAeKKRFZa0PPPCKG3kTYngphQRHvfRzasMpKbQkWIlbHj8hEpCZeudwqWp1u1mo4eQFVTWNzpJGayGLoUhfGkdnLfcd01xNdwzz1Y8eOnThxQthjzz5scRaqgnHO3XTjyShKCu+oz/TvGDkCGGNy0T//8lcurF82BsOU1uEjjhHRuOwd97/l5htOsvMICDMNpSbFtJwOAztYdXJww/T5W2587UP/4MEtRx23poYgIntV1VqaEpH3xSh0AACAmZWENYnStF400JIOAajb8qjGIJFiZBMi4m4j10RpnRljOuwpJ7NO3XJ0YAcV32wkZRS/45rlChBbrd+j80aIJrZE4jvtlh03nZ3IFOwNO2QBCWjibOcUH0xjOKlq6ESAYIi8MLud1llVyRrE7uy/rfhtOKDGWhFQn7/5Z+9i2dJMQ9BHr2KREHTxyHzQ7DCLOaYHj2lQHagq0PPGhvbHqqhodf7daGIhUEZ1J4/NKxkWGj1NmJGNIlnjhYuiiIwdO6PhcDAdsd4FohHvCIQAhUiBtBuUDsOrWwVQUOn1BI0mVSCTtAuvKqPXr1IAY7wqiJAXMiYSGePz76KUMANMRwep3hfWxpbQORdFUdcfmiavPkGQFkYRj3lOBET0BbD4KIpAPOn43p1D4NP+PpQdf0VUL+7yRuFR41ZWtTwzArQ8VCYppjoGVUyMazQsQAQ4y8A60Gxkf4R02IhePHP2q996zqR1Ep1KjKYri47FVBUAXGRUvfHZ2+970/XHTxSFpxmnUGbkS8EQhlJVGyUdX7RcnqZ1FZkkZ7GHYsb4ZCiBsZS4op11hFlBWMfVcaddHWlmdn94vgp95kmUOx1rJpP6/WxRF5c51Ugx6q4eNvsemX33pbyTG68/acmiOcwlEkoSASIwpEtLC5UOmlnSvmPqcr80v7B4ZM6YbpM/AIDSsGTH3mR/PKGKqAdERXL5dDXXCWl/ZR8AkCB3bRGxZFi3Ap39Q200EaCoJyIkO2ENbdpb7DufhkgxzKNAwrI3eL/vO4IIIlXdP619ELFpr+CxrSsAR2aPxkYvM+T0mc8vmBmmw3ypkjF7fyVjII4t0eBbh2xAuYbezqQ19JYr6mYLxzln/Y8EoGoAhJklzILY1SSofcS02gs28MmqOdaQoj93Yf2Zp58tXE7a13GFgqACnt3x48ff+pY3VyepVwM2ETn9o1c2M2dFgHCrTWUCEhQFG0Xm5uuOpZEVpMCmwxg/LJdwQJgObJocm+NJ0/TMmTNPPfUUWQMSEoCVZiFAsnGe54vzzTfefU+jHoelXgFEkUI7HxFtZNlXn/mOx8iCAgDDUPkYPGAkFt9M7r755PWZ8wQzXvBu95iWQj155qZMiaZpGsVDkmxoY2vTON2emunNsFIIINpaIl6jyAiD2d4zMZoiBOcYyQRewH3YKeBAFysJFdNh5aweiOB9DpgS9euTslJQp6hGFgwSs0FSUZ2mopSksair1WqjE0CHg2kYc1nxH5Fd79OGIwpZqmqMhdAJ0G0921bYYOYktr/yC2/t5AWBKoVug0lxYVAFNIbmm6n3vrvuw9WTl+orRg174WVdvrpTwiQXD+uxhPtUrywijbqda0SBO4MOmviyqIoInqUr/TNEcwaYVmkEm2wJ7wQO/7BcDGx317ywMiBicHun8DGl2ysYVs6bKZhdOmh9ClMKGvaMiKKg0BZX9VpSRAR7CxhMcuXuM4T/hLuoO4ylmcn+8CSj9Fqcu3Y8SRJEVDADxa7bJUnkNVSkAXudpQJd8KrYCZIBIWEwQMaacQUsEcIodiqKHlzPuYah/fzluCZfv2vfcyjV2WKqHDbCKIoCzeBbk7Us3jsXIoLRgSwAICohGaSNdqtdtEoEhsk1MbCyJPb4wpEy5A+9K1OOa/8xHWv3EVEVmHlhYeHIwhEdwtdIyIWcWD4WWWDm8QvPM5DBvNBvPPfd1Y02oRnhwquqUQEQBv/We+49eWLZe0FUPZT5UWNp7PsMIZBz7rbbbvtHv/mb4vzAwxjUItRTaxHamQ9rFoy4LIJ4L2psq1AvYgxq6JcaEgUooE0b2eZlUSCyANnMTf/M4v1J+uJEABF9njXSBNNo2PGI6FzeKRwQIZKyjOiaEvHWxoiURno5zyhJRyg+VWUDXGwaL5ZCFmb27tRebRRME4eEw9gXbZePPJAQFbFn2QhH9IciGu+9sfSzd77+pisFmWhMporQF0WN7DULiy7fl02CZiD7U3pI3UmSI642KMoaCpMl471HgOWjy8tHBUFwpP9PGLODiNA7l3vfq5kO1TCHaaMmub2qAimMdnemmXAFAJFibKlwRd7xGCEYQBklNAY9sxZEXpiISBU1tFcedl9fyQuhj3kkmoQKhc+jKLIGSXUGXd4V0FQYGCwBJbZXUBh2Wpj4b5RADUSRBc+qk67PsY/9/N2RbI/xR6hUAqOgeSGZz3pNk0iiMiPDUL3vJHIaCTtlrJkjcY3Z9coNh9rPP4y0sgpqOVoRIQNnXvnJ977/A0/AaFXKWTeHU+azII4LMXL/3fdee2zRF2FywShADy7PX8VuYIW5+ytpK+usXmml8wvsClC/92U39kKWSI1pd1p54Qj2pYg7m17JgS1T3V/Rk0XvfafTAXakCMBhRcJDIbYGGCAHVRRFHde5dkB2v0/Mq2W+nU/jC75+eflNd4lTawwSoBzeKmiIqChefR3NsYWm8zlsZbXGj3qWa3UOeLIhZeedfMqOF5sLS3ceFUUFHtvXt98UNouz6H3hOkVubKyqk9ioyRl2ljZqIJ+qsevZFRA2RAx4mMoUBQCMRsBSWBWVsPMmAIyIKWbf29PH8EHkwzflqn1h66uh+dOQ7zUkAIYM4qHCCkCoYoDIhOXQxk4Y2JnQGKsExmBaWcoEAaDRaMzPz6+trZUr1SNilmXW2mG3QQUE7M58EFWYhc+/B+Jp9jCrViSrXw48eIvbJrmu9vZeS9P05ptvTtNUVZm50+mU/WWwfQpatQTQ9+tVQgOftqxC7uKBKzXzySaIl8ARUafTWVlZ6XQ6Ybc7Y0zYj2WaHu1ZzkXcBZpjeQ0qMnrttdc2m83JaydDMd3WctOz6eXqMkH2NzY2VlZWoKdb974r8FVCZbtCGPKJEyfm5ubKxbPLcs6o9qFhmO58M6Ua1d40/LE56cPt4N07GWOiKILKxhzbVhIYREMxrS7GC5XNgUqGhcp8fO/9sMmzJaB/hcCtjjoYjzDA6saS1QacvtOHjjMg6L1n5nKf+sCYYTf1sNFKURQz38d21zRtjmoSMsakaRr65oLSK6kEtA/ZAcwVUPPeZ1mW57lzLuyyHnDM85yZvffhGO99s9lcXFwcGK2OUDr7oXyHOT3V9bEmwT2wSFEURVGEU4JElpsjxnEcPoTvy63muxDvLKCHy7Xb7cuXL7darXa7vbm5GXAMP0s/AxHDbqDhHfb1RQWUR07vHXD3vVD1FQ6L6/r6ratacifcJWOGnuywg2fYzTNQrVar1+thy+TyChZ2mJdwuQDr+vr6xsZGnuel7EdRVOrW8H5Utd1u9/Hp2PFXo4aZAAo9Cdvil4rtHmhVhvEsVsj77gZIRJTnebvdLmEN28wSUZibXJ5u+56p6uGXIURQz1rpdOzr5yn1985nHVEW3g8VXDWJ1WfoY8OdPbB97Z59eqN6euDuclw7i8cD9CkiWmvr9frS0lLYtLooijBpIRilYLWCXARLtfMKpX7Y+dcq1qU8lpHY7ti2qi7LK1Q3gdlZ4Cl3jy/PLY8s30EJn7U27IpqrQ3b+AY9UKvVkiQp5bX7MDuVTrcKz1wURTBTAdBgkYLaDrCGfasDBZeg1KfV70ejAACljh7t943GtDsFq4fC6Eipelj5EwCCNS91aAgUA5TBUQ17TYcPAetA24RgoACWSqAcc6lDA5rlz+BvBW1bSkHpfpULpe2karwQDN1UHb99VCISxgkAfTpu5zsI4li6RAGjElzs7W4eICtfQIl4tWLU9wqHYhq+79uVHnp2oNwOMKBT8lefWdiZ1Nl5i/KtVDX4tEwKFTVX0sCCbpVPy7PKY0opDpptm4e0/Wf5nAGH8ZiOpTKOqvpVO59+BN9VZX/XqaA+TPvwGn1KNY1ZKvSqGz+QD/pezMCL/386Sbz3vJW5bwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0wOS0yN1QxNTo0NTo1Mi0wNDowMHMAacQAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMDktMjdUMTU6NDU6NTItMDQ6MDACXdF4AAAAAElFTkSuQmCC`\xFE";
    z += "    //myBtnOnclick4 = `if (confirm(\"Are you sure you build a report for `:sqlID:`?\")) { assignBtn(\"Btn\", \"Make Report\"); doJsbSubmit(false); } `\xFE";
    z += "    myBtnOnclick4 = `assignBtn(\"Btn\", \"Make Report\"); `\xFE";
    z += "    btnMakeReport = devXQueryBuilderBtn(queryBuilderID, myBtnOnclick4, myBtnICon4, True /* doSaveFirst */, True /* do PostBack */, 'left')\xFE";
    z += "    \xFE";
    z += "    ToolBar = \"\"\xFE";
    z += "    //ToolBar := @SubmitBtn('Btn', 'Make Report')\xFE";
    z += "    //ToolBar := @SubmitBtn('Btn', 'Quit')\xFE";
    z += "    \xFE";
    z += "    Msg = \"\"\xFE";
    z += "\xFE";
    z += "    Loop\xFE";
    z += "        Print @(-1):Rows2(\"%\", devXSqlBuilder(queryBuilderID, databaseName, lastXmlQuery, btnSave:btnQuit:btnDelete:btnMakeReport, UserName, Passwrd, InitialCat), \"66px\", ToolBar):\xFE";
    z += "        \xFE";
    z += "        // Do not break or pause between getting the page and the flush (server.pause)\xFE";
    z += "        If Msg Then\xFE";
    z += "            B = @Response.buffer()\xFE";
    z += "            Print @Script(`alert(\"`:Msg:`\")`):\xFE";
    z += "            @Server.pause\xFE";
    z += "            @Response.buffer(B)\xFE";
    z += "            Msg = \"\"\xFE";
    z += "        Else\xFE";
    z += "            @Server.Pause\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        lastXmlQuery = System(29).lastXmlQuery\xFE";
    z += "        myLastSql = System(29).myLastSql\xFE";
    z += "        \xFE";
    z += "        Cmd = @formVar('Btn')\xFE";
    z += "        If !Cmd Then Cmd = formVar('Btns')\xFE";
    z += "        If !Cmd Then\xFE";
    z += "            Cmd = @formVar(\"contextMenuCmd\")\xFE";
    z += "            CtlText = @formVar(\"contextMenuCtlText\")\xFE";
    z += "            CtlID = @formVar(\"contextMenuVal\")\xFE";
    z += "            ContextMenuText = @formVar(\"contextMenuText\")\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "    While Cmd <> \"Quit\" And Cmd <> \"Q\" Do\xFE";
    z += "        If Cmd = \"Delete\" Then\xFE";
    z += "            If sqlID <> \"*NEW*\" Then\xFE";
    z += "                Delete fSQL, sqlID:\".devX\" Else Alert(@Errors)\xFE";
    z += "                Delete fSQL, sqlID:\".SQL\" Else Alert(@Errors)\xFE";
    z += "                Print @(-1):@Script(`\xFE";
    z += "                            if (window.parent.reloadDbTree) window.parent.reloadDbTree();\xFE";
    z += "                        `):\xFE";
    z += "                @Server.flush; Print @(-1):; @Server.flush\xFE";
    z += "            End If\xFE";
    z += "            @Server.End\xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        If lastXmlQuery <> \"\" Then\xFE";
    z += "            If sqlID = \"*NEW*\" Then\xFE";
    z += "                Print @(-1):\xFE";
    z += "                \xFE";
    z += "                InputMsg = \"Name this Query\"\xFE";
    z += "                NewName = \"\"\xFE";
    z += "                Loop\xFE";
    z += "                    NewName = InputBox(InputMsg, NewName)\xFE";
    z += "                While NewName <> \"\" And NewName <> Chr(27) Do\xFE";
    z += "                \xFE";
    z += "                    Prefix = NiceName(databaseName):\"_\"\xFE";
    z += "                    \xFE";
    z += "                    sqlID = Prefix:NewName\xFE";
    z += "                    \xFE";
    z += "                    Read Xx From fSQL, sqlID:\".devX\" Then\xFE";
    z += "                        InputMsg = NewName:\" is already used. Try again.\"\xFE";
    z += "                        Msgbox(InputMsg)\xFE";
    z += "                    Else\xFE";
    z += "                        Write lastXmlQuery On fSQL, sqlID:\".devX\" Else Alert(@Errors)\xFE";
    z += "                        Write myLastSql On fSQL, sqlID:'.SQL' Else Alert(@Errors)\xFE";
    z += "                        \xFE";
    z += "                        If Cmd = 'Make Report' Then Break\xFE";
    z += "                        \xFE";
    z += "                        * Reopen with correct tabID\xFE";
    z += "                        Url = sqlQueryBuilderUrl(tabID, sqlID, databaseName)\xFE";
    z += "                        Lbl = Mid(sqlID, Len(Prefix)+1)\xFE";
    z += "                        Print @(-1):@Script(`\xFE";
    z += "                            if (window.parent.reloadDbTree) {\xFE";
    z += "                                window.parent.reloadDbTree();\xFE";
    z += "                                window.parent.openInTab(\"`:tabID:`\", `:jsEscapeString(sqlID):`, `:jsEscapeString(Lbl):`, `:jsEscapeString(Url):`)\xFE";
    z += "                                window.close();\xFE";
    z += "                            }\xFE";
    z += "                        `):\xFE";
    z += "                        @Server.flush; Print @(-1):; @Server.flush\xFE";
    z += "                        @Server.End\xFE";
    z += "                    End If\xFE";
    z += "                Repeat\xFE";
    z += "            Else\xFE";
    z += "                Write lastXmlQuery On fSQL, sqlID:\".devX\"\xFE";
    z += "                Write myLastSql On fSQL, sqlID:\".SQL\"\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "\xFE";
    z += "        If Cmd = 'Make Report' Then\xFE";
    z += "            Print @(-1):\xFE";
    z += "            If sqlID = \"*NEW*\" Then\xFE";
    z += "                If !showTop1000(tabID, databaseName, myLastSql) Then Msg = @Errors\xFE";
    z += "            Else\xFE";
    z += "                If !showTop1000(tabID, databaseName, myLastSql, sqlID) Then Msg = @Errors\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "    Repeat\xFE";
    z += "    \xFE";
    z += "    Print @(-1):\xFE";
    z += "    If @hasTclParent Or @hasParentProcess Then Stop\xFE";
    z += "    @Server.End\xFE";
    z += "End Program"
    window.cached_jsb_mdl["sqlquerybuilder"] = z;
    var z = "Function standardFormView(ProjectName, objectModel, absolutePositioning, viewName)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    dim ctlHtml As String\xFE";
    z += "    \xFE";
    z += "    Columns = @DropGridColumns(objectModel.columns)\xFE";
    z += "\xFE";
    z += "    Html = []\xFE";
    z += "    For Each Column In Columns\xFE";
    z += "        If Column.display <> \"hidden\" Then\xFE";
    z += "            If Column.control = \"\" Then Column.control = \"textbox\"\xFE";
    z += "            If Column.name = \"\" Then Column.name = \"no id\"\xFE";
    z += " \xFE";
    z += "            callName = LCase(Column.control)\xFE";
    z += "            if left(callName, 4) <> \"ctl_\" then callName = \"ctl_\":callName\xFE";
    z += "            callName = \"jsb_ctls.\":callName\xFE";
    z += "            \xFE";
    z += "            CtlLabel = Column.label\xFE";
    z += "            If !CtlLabel Then CtlLabel = Column.name\xFE";
    z += "            \xFE";
    z += "            niceColumnName = @niceName(Column.name)\xFE";
    z += "            \xFE";
    z += "            additionalAttrs = [`style='width:auto;`:Column.ctlstyle:`'`]\xFE";
    z += "            Call @callName(ProjectName, niceColumnName, Column, {}, ByRef ctlHtml, False, additionalAttrs, viewName)\xFE";
    z += "\xFE";
    z += "            If Column.pickfunction Then\xFE";
    z += "                If Instr(Column.pickfunction, \".page\") Then PickURL = @DropRight(Column.pickfunction, \".page\") Else PickURL = Column.pickfunction\xFE";
    z += "                PickURL = Replace(PickURL, \"{projectname}\", @UrlEncode(ProjectName))\xFE";
    z += "                ctlHtml = @jsb_html.addPick(ctlHtml, niceColumnName, PickURL, \"80%\", \"90%\", PickURL, Column.autopostback)\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "            I = Instr(ctlHtml, \"class='\")\xFE";
    z += "            If I = 0 Then I = Instr(ctlHtml, 'class=\"')\xFE";
    z += "            If I Then ctlHtml = Left(ctlHtml, I + 6):'DragDrop ':Mid(ctlHtml, I + 7)\xFE";
    z += "\xFE";
    z += "            ctlHtml = '<mdlctl id=\"ctl_':niceColumnName:'\" class=\"DragDrop\">':ctlHtml:'</mdlctl>'\xFE";
    z += "\xFE";
    z += "            Html[-1] = @Label(Column.label, niceColumnName):ctlHtml\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "    Return Join(Html, \"\")\xFE";
    z += "End Function"
    window.cached_jsb_mdl["standardformview"] = z;
    var z = "Function standardUnload(ByVal Columns As Array, Optional ByVal Row As JSON, Optional ByVal RestrictToModel) As String\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    * Unload current form\xFE";
    z += "    \xFE";
    z += "    if IsMissing(RestrictToModel) Then RestrictToModel = True\xFE";
    z += "    \xFE";
    z += "    Dim columnNames As Array = []\xFE";
    z += "    if !Row Then Row = {}\xFE";
    z += "    \xFE";
    z += "    // Build values so I can debug after this\xFE";
    z += "    Dim Values As JSON = {}\xFE";
    z += "    DIm Column As JSON\xFE";
    z += "    Dim CN As String\xFE";
    z += "    \xFE";
    z += "    For Each Column In Columns\xFE";
    z += "        Cn = Column.name\xFE";
    z += "        If Cn Then\xFE";
    z += "            DIm V As Variant = @FormVar(@NiceName(Column.name))\xFE";
    z += "            If Column.encrypt Then V = Stx(Encode(V))\xFE";
    z += "            Values[Cn] = V\xFE";
    z += "            If LCase(Column.defaultvalue) = \"{lastvalue}\" Then @Session[\"LastValue:\":Cn] = V\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    Dim Changed As Boolean = False\xFE";
    z += "    For Each Column In Columns\xFE";
    z += "        columnNames[-1] = Column.name\xFE";
    z += "        If Column.canedit And Column.display <> \"hidden\" Then\xFE";
    z += "            Cn = Column.name\xFE";
    z += "            Dim newValue As Variant = Values[Cn]\xFE";
    z += "            Dim oldValue As Variant  = Row[Cn]\xFE";
    z += "\xFE";
    z += "            If Column.control = \"json_inline\" Or Column.control = \"json_popup\" Then Column.datatype = \"jsonarray\"\xFE";
    z += "            If Column.control = \"datebox\" Then Column.datatype = \"date\"\xFE";
    z += "            If Column.control = \"datatimebox\" Then Column.datatype = \"datetime\"\xFE";
    z += "            If Column.control = \"timebox\" Then Column.datatype = \"time\"\xFE";
    z += "            If Column.control = \"checkbox\" Then Column.datatype = \"boolean\"\xFE";
    z += "\xFE";
    z += "            If Column.control = \"dropdownbox\" Or Column.control = \"combobox\" Or Column.control = \"cascadingdropdownbox\" Then\xFE";
    z += "                If newValue = \"Select Something\" Then newValue = Null\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "            Select Case Column.datatype\xFE";
    z += "                Case \"autointeger\", \"integer\":\xFE";
    z += "                    newValue = CInt(newValue)\xFE";
    z += "                Case \"double\":\xFE";
    z += "                    newValue = Val(newValue)\xFE";
    z += "                Case \"boolean\":\xFE";
    z += "                    If LCase(newValue) = \"false\" Or newValue = \"\" Or newValue = \"0\" Then newValue = False Else newValue = True\xFE";
    z += "                Case \"jsonarray\":\xFE";
    z += "                    newValue = JSon(newValue)\xFE";
    z += "                Case \"date\":\xFE";
    z += "                    If newValue Then\xFE";
    z += "                        newValueN = Date(Date(newValue))\xFE";
    z += "                        If newValueN Then newValue = newValueN\xFE";
    z += "                    End If\xFE";
    z += "                Case \"datetime\":\xFE";
    z += "                    If newValue Then\xFE";
    z += "                        newValueN = DateTime(DateTime(newValue))\xFE";
    z += "                        If newValueN Then newValue = newValueN\xFE";
    z += "                    End If\xFE";
    z += "                Case \"time\":\xFE";
    z += "                    If newValue Then\xFE";
    z += "                        newValueN = Time(Time(newValue))\xFE";
    z += "                        If newValueN Then newValue = newValueN\xFE";
    z += "                    End If\xFE";
    z += "            End Select\xFE";
    z += "\xFE";
    z += "            If oldValue <> newValue Then\xFE";
    z += "                Changed = True\xFE";
    z += "                Row[Cn] = newValue\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    If RestrictToModel Then\xFE";
    z += "        Dim BadTags As Array = []\xFE";
    z += "        Dim TagName As String\xFE";
    z += "        \xFE";
    z += "        For Each TagName As String In Row\xFE";
    z += "            Locate TagName In ColumnNames Else BadTags[-1] = TagName\xFE";
    z += "        Next\xFE";
    z += "        \xFE";
    z += "        If BadTags Then\xFE";
    z += "            For Each TagName In BadTags\xFE";
    z += "                Remove Row, TagName\xFE";
    z += "            Next\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Return Changed\xFE";
    z += "End Function\xFE";
    z += ""
    window.cached_jsb_mdl["standardunload"] = z;
    window.cached_jsb_mdl["statusprint"] = "sub statusPrint(text) \xFE    print @Script(`\xFE        $(\"#xlsStatus\").append(convertPrint2Html(null, `:jsEscapeString(text:Crlf()):`)); \xFE        $(\"#Excel2SQL\").tabs(\"option\", \"active\", 0);\xFE    `):\xFE    @Server.Flush\xFEend sub";
    window.cached_jsb_mdl["subtreeurl"] = "function subTreeUrl(tabID, databaseName)\xFE    * %options aspxC-\xFE    \xFE    Url = @jsbRestCall('getDBSubTree'):`?tabID=`:@urlEncode(tabID):`&noCache=`:Timer()\xFE    If databaseName Then Url := `&databaseName=`:@urlEncode(databaseName)\xFE    Return Url\xFEEnd function";
    window.cached_jsb_mdl["suppresslabelcolumn"] = "Subroutine suppressLabelColumn(ProjectName, PageName, ViewName, ColumnID)\xFE    * %options aspxC-\xFE    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE    ColumnIdx = @findViewColumn(dataSet, ColumnID)\xFE    If ColumnIdx = 0 Then Return\xFE    dataSet.columns[ColumnIdx].suppresslabel = !dataSet.columns[ColumnIdx].suppresslabel\xFE    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edc-\":System(28):\": \":@Errors\xFE    Call @jsb_mdl.ReGenPageModel(ProjectName, PageName, False)\xFEEnd Subroutine";
    var z = "Subroutine toolTipColumn(ProjectName, PageName, ViewName, ColumnID)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    ReadJSon dataSet From @fHandle(\"DICT\", ProjectName), ViewName Else Return\xFE";
    z += "    ColumnIdx = @findViewColumn(dataSet, ColumnID)\xFE";
    z += "    If ColumnIdx = 0 Then Return\xFE";
    z += "    toolTip = dataSet.columns[ColumnIdx].tooltip\xFE";
    z += "    If toolTip = \"\" Then toolTip = dataSet.columns[ColumnIdx].label\xFE";
    z += "    newValue = Trim(@InputBox(\"Column Property \":ColumnID, \"Tool Tip\", toolTip, \"80%\", \"auto\"))\xFE";
    z += "    If newValue = Chr(27) Then Return\xFE";
    z += "    If newValue = dataSet.columns[ColumnIdx].label Then newValue = \"\"\xFE";
    z += "    dataSet.columns[ColumnIdx].tooltip = newValue\xFE";
    z += "    WriteJSon dataSet On @fHandle(\"DICT\", ProjectName), ViewName Else Stop @(-1):\"edc-\":System(28):\": \":@Errors\xFE";
    z += "    Call @jsb_mdl.ReGenPageModel(ProjectName, PageName, False)\xFE";
    z += "End Subroutine"
    window.cached_jsb_mdl["tooltipcolumn"] = z;
    var z = "*\xFE";
    z += "* Custom code handled by tags\xFE";
    z += "*\xFE";
    z += "*   * <insert>\xFE";
    z += "*       new code\xFE";
    z += "*   * </insert>\xFE";
    z += "*\xFE";
    z += "*   * <delete> ... old line of code\xFE";
    z += "*\xFE";
    z += "* Returns results of compile\xFE";
    z += "*\xFE";
    z += "function updateCode(ByVal genedSrc As String, ByVal ProjectName As String, ByVal ItemID As String) As String\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    Dim fProject as File = @fHandle(ProjectName)\xFE";
    z += "\xFE";
    z += "    genedSrc = Replace(genedSrc, CRLF(), AM())\xFE";
    z += "    \xFE";
    z += "    // Drop trailing spaces\xFE";
    z += "    Loop While InStr(genedSrc, \" \":AM()) Do genedSrc = Replace(genedSrc, \" \":AM(), AM()) Repeat\xFE";
    z += "    \xFE";
    z += "    // drop extra lines\xFE";
    z += "    Loop While InStr(genedSrc, AM():AM():AM()) Do genedSrc = Replace(genedSrc, AM():AM():AM(), AM():AM()) Repeat\xFE";
    z += "\xFE";
    z += "    Read usrModifiedSrc As String From @fHandle(ProjectName), ItemID Else usrModifiedSrc = \"\"\xFE";
    z += "    if usrModifiedSrc <> genedSrc Then\xFE";
    z += "        Dim lPrior As String = lcase(usrModifiedSrc)\xFE";
    z += "        If InStr(lPrior, \"* <insert>\") or InStr(lPrior, \"*<insert>\") or InStr(lPrior, \"* <delete>\") or InStr(lPrior, \"*<delete>\") Then \xFE";
    z += "            Dim PriorBlocks As Json = splitJsbCode(usrModifiedSrc, False /* Sort */)\xFE";
    z += "            Dim GenedBlocks As Json = splitJsbCode(genedSrc, False /* Sort */)\xFE";
    z += "            \xFE";
    z += "            for each BlockName in GenedBlocks\xFE";
    z += "               GenedBlock = GenedBlocks[BlockName]\xFE";
    z += "               PriorBlock = PriorBlocks[BlockName]\xFE";
    z += "               \xFE";
    z += "               GenedBlocks[BlockName] = CustomMerge(GenedBlock, PriorBlock)\xFE";
    z += "               Remove PriorBlocks, BlockName\xFE";
    z += "            next\xFE";
    z += "            \xFE";
    z += "            // Append any extra routines\xFE";
    z += "            for each BlockName As String in PriorBlocks\xFE";
    z += "                Dim PBlock As String = PriorBlocks[BlockName]\xFE";
    z += "                Dim LPBlock As String = lcase(PBlock)\xFE";
    z += "                \xFE";
    z += "                If InStr(LPBlock, \"* <insert>\") or InStr(LPBlock, \"*<insert>\") or InStr(LPBlock, \"* <delete>\") or InStr(LPBlock, \"*<delete>\") Then \xFE";
    z += "                    GenedBlocks[BlockName] = PBlock\xFE";
    z += "                end if\xFE";
    z += "            next\xFE";
    z += "            \xFE";
    z += "            Dim genedSrcAry As Array = []\xFE";
    z += "            for each BlockName As String in GenedBlocks\xFE";
    z += "                genedSrcAry[-1] = GenedBlocks[BlockName]\xFE";
    z += "            next\xFE";
    z += "            \xFE";
    z += "            genedSrc = Join(genedSrcAry, AM():AM())\xFE";
    z += "            \xFE";
    z += "            TrashIt(ProjectName, ItemID) \xFE";
    z += "        End If\xFE";
    z += "        \xFE";
    z += "        Write genedSrc On fProject, ItemID Else Stop \"Form-\":System(28):\": \":@Errors\xFE";
    z += "        \xFE";
    z += "        Execute \"Basic \":ProjectName:\" \":ItemID  Capturing Results As String\xFE";
    z += "        Results = Replace(Results, AM(), CRLF())\xFE";
    z += "        if InStr(Results, \"^\") Then \xFE";
    z += "            Results = \"Compiler error: \":\"Basic \":ProjectName:\" \":ItemID:Crlf():Results:CRLF()\xFE";
    z += "        end if\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Return Results:@anchorEdit(ProjectName, ItemID):CRLF():CRLF()\xFE";
    z += "end function"
    window.cached_jsb_mdl["updatecode"] = z;
    var z = "Subroutine updateMenu(ByVal ProjectName As String, optional byval ForceIt As Boolean)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    // When generating the whole website, try no to do this more than once\xFE";
    z += "    Read OldMenu As String From @fHandle(ProjectName), 'Project_Menus' Then\xFE";
    z += "        Dim LastMenuCompile As Long = @Session(\"LastMenuCompile_\":ProjectName)\xFE";
    z += "        If Time() - LastMenuCompile < 15 Then Return\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Dim Html As Array = []\xFE";
    z += "    Html[-1] = `Subroutine Project_Menus(ByRef MenuBar As JSON, ByVal edpName As String)`\xFE";
    z += "    Html[-1] = `*\x20EDITOR-OPTION: AUTOFORMAT\") `\xFE";
    z += "    Html[-1] = `   MenuBar = {}`\xFE";
    z += "    \xFE";
    z += "    Dim Roles As Array = ['Admin', 'Director', 'Manager', 'Clerk', 'Employee', 'User', 'Anonymous']\xFE";
    z += "    \xFE";
    z += "    Dim Pages As Json = {}\xFE";
    z += "    For Each Role As String In Roles\xFE";
    z += "        Pages[Role] = []\xFE";
    z += "    Next\xFE";
    z += "\xFE";
    z += "    * Loop on Organize Pages by Role\xFE";
    z += "    Open \"dict\", ProjectName To fProject As FileHandle Else Stop @(-1):\"Edp-\":System(28):\": \":@Errors\xFE";
    z += "    Select From fProject Where \"ItemID Like '%.page'\" To Fs Else Stop @(-1):\"Edp-\":System(28):\": \":@Errors\xFE";
    z += "    ProjectPages = GetList(Fs)\xFE";
    z += "\xFE";
    z += "    MenuTree = {}\xFE";
    z += "    For Each pageID, PNo In ProjectPages\xFE";
    z += "        Readjson Item From fProject, pageID Else Stop @(-1):\"Edp-\":System(28):\": \":@Errors\xFE";
    z += "        \xFE";
    z += "        MenuName = Item.menucategory\xFE";
    z += "        If Item.menuitem And (MenuName Or Item.iconurl Or Item.glyphicon) Then\xFE";
    z += "            Role = UCase(Left(Item.minimumRole, 1)):LCase(Mid(Item.minimumRole, 2))\xFE";
    z += "            If !Role Then Role = \"Anonymous\"\xFE";
    z += "            Item.minimumRole = Role\xFE";
    z += "            Item.pageID = pageID\xFE";
    z += "            Locate Role In Roles Then\xFE";
    z += "                Pages[Role][-1] = Item\xFE";
    z += "                If MenuName Then\xFE";
    z += "                    If !MenuTree[MenuName] Then MenuTree[MenuName] = []\xFE";
    z += "                    MenuTree[MenuName][-1] = pageID\xFE";
    z += "                End If\xFE";
    z += "            End If\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    For Each Role In Roles\xFE";
    z += "        // Build Menus for this role\xFE";
    z += "        Menus = {}\xFE";
    z += "        MenuItems = Pages[Role]\xFE";
    z += "        \xFE";
    z += "        For Each Item In MenuItems\xFE";
    z += "            MenuName = Item.menucategory\xFE";
    z += "            subMenuName = Field(Field(Item.menuitem, \"#\", 1), \"?\", 1)\xFE";
    z += "            pageID = Item.pageID\xFE";
    z += "            \xFE";
    z += "            OnlyOne = UBound(MenuTree[MenuName]) = 1\xFE";
    z += "            If !subMenuName Then subMenuName = @DropRight(pageID, \".page\")\xFE";
    z += "            \xFE";
    z += "            If MenuName Then\xFE";
    z += "                If !Menus[MenuName] Then Menus[MenuName] = {}\xFE";
    z += "                \xFE";
    z += "                If Item.iconurl Or Item.glyphicon Then\xFE";
    z += "                    Menus[MenuName][subMenuName] = { id: @DropRight(pageID, \".page\"), iconurl: Item.iconurl, glyphicon: Item.glyphicon }\xFE";
    z += "                Else\xFE";
    z += "                    If OnlyOne Then Menus[MenuName] = `window.eventHandler_SelectMenu({id:\"`:@DropRight(pageID, \".page\"):`\"}, 'id')` Else Menus[MenuName][subMenuName] = { id: @DropRight(pageID, \".page\") }\xFE";
    z += "                End If\xFE";
    z += "            Else\xFE";
    z += "                If Item.iconurl Or Item.glyphicon Then\xFE";
    z += "                    Menus[subMenuName] = { id: Item.menuitem, iconurl: Item.iconurl, glyphicon: Item.glyphicon }\xFE";
    z += "                Else\xFE";
    z += "                    Menus[subMenuName] = `window.eventHandler_SelectMenu({id:\"`:Item.menuitem:`\"}, 'id')`\xFE";
    z += "                End If\xFE";
    z += "            End If\xFE";
    z += "        Next\xFE";
    z += "        \xFE";
    z += "        If Len(Menus) Then\xFE";
    z += "            Html[-1] = ``\xFE";
    z += "            If Role <> \"Anonymous\" Then Html[-1] = `   If @Is`:Role:` Then`\xFE";
    z += "            \xFE";
    z += "            // Convert to HTML - do ICONs first\xFE";
    z += "            For Each MenuName In Menus\xFE";
    z += "                So = Menus[MenuName]\xFE";
    z += "                If isJSON(So) Then\xFE";
    z += "                    If @NiceName(MenuName) = MenuName Then To = \".\":MenuName Else To = \"['\":MenuName:\"']\"\xFE";
    z += "                    Html[-1] = `   MenuBar`:To:` = `:So\xFE";
    z += "                ElseIf !isArray(So) Then\xFE";
    z += "                    If @NiceName(MenuName) = MenuName Then To = \".\":MenuName Else To = \"['\":MenuName:\"']\"\xFE";
    z += "                    Html[-1] = `   MenuBar`:To:\" = `\":So:\"`\"\xFE";
    z += "                End If\xFE";
    z += "            Next\xFE";
    z += "            \xFE";
    z += "            // Then Menus\xFE";
    z += "            For Each MenuName In Menus\xFE";
    z += "                So = Menus[MenuName]\xFE";
    z += "                If isArray(So) Then\xFE";
    z += "                    If @NiceName(MenuName) = MenuName Then To = \".\":MenuName Else To = \"['\":MenuName:\"']\"\xFE";
    z += "                    Html[-1] = `   If !isJson(MenuBar`:To:`) Then MenuBar`:To:` = {}`\xFE";
    z += "                    For Each subMenuName In So\xFE";
    z += "                        If @NiceName(subMenuName) = subMenuName Then To2 = \".\":subMenuName Else To2 = \"['\":subMenuName:\"']\"\xFE";
    z += "                        Item = So[subMenuName]\xFE";
    z += "                        If isJSON(Item) Then\xFE";
    z += "                            Html[-1] = `   MenuBar`:To:To2:` = `:Item\xFE";
    z += "                        Else\xFE";
    z += "                            Html[-1] = `   MenuBar`:To:To2:` = { id: \"`:Item:`\" }`\xFE";
    z += "                        End If\xFE";
    z += "                    Next\xFE";
    z += "                End If\xFE";
    z += "            Next\xFE";
    z += "            \xFE";
    z += "            If Role <> \"Anonymous\" Then Html[-1] = `   End If`\xFE";
    z += "        End If\xFE";
    z += "    Next\xFE";
    z += "    \xFE";
    z += "    // Tag on web master stuff\xFE";
    z += "    Html[-1] = `   If @IsAdmin Then`\xFE";
    z += "    Html[-1] = `      Dim fromPage As String`\xFE";
    z += "    Html[-1] = `      If InStr(@Url, \"\\\\\":edpName) Then fromPage = @Url Else fromPage = edpName`\xFE";
    z += "    Html[-1] = ``\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"][\"View Page Props\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"][\"View Page Props\"].id = \"?edp&projectName=\":@UrlEncode(System(27)):\"&pageName=\":@UrlEncode(edpName):\"&fromPage=\":@UrlEncode(fromPage)`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"][\"ReGen Page\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"][\"ReGen Page\"].id = \"?ReGenPageModel&projectName=\":@UrlEncode(System(27)):\"&pageName=\":@UrlEncode(edpName):\"&fromPage=\":@UrlEncode(fromPage)`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"].seperator1 = true`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"][\"Add Page\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"][\"Add Page\"].id = \"?edp&projectName=\":@UrlEncode(System(27)):\"&fromPage=\":@UrlEncode(fromPage)`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"][\"Clone Page As\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"][\"Clone Page As\"].id = \"?clonePageModel&projectName=\":@UrlEncode(System(27)):\"&pageName=\":@UrlEncode(edpName):\"&fromPage=\":@UrlEncode(fromPage)`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"].seperator2 = true`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"][\"Rename Page\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"][\"Rename Page\"].id = \"?renamePageModel&projectName=\":@UrlEncode(System(27)):\"&pageName=\":@UrlEncode(edpName):\"&fromPage=\":@UrlEncode(fromPage)`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"].seperator3 = true`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"][\"Delete Page\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Page\"][\"Delete Page\"].id = \"?deletePageModel&projectName=\":@UrlEncode(System(27)):\"&pageName=\":@UrlEncode(edpName):\"&fromPage=Menu\"`\xFE";
    z += "    Html[-1] = ``\xFE";
    z += "    Html[-1] = `      // Can collaspe here after Any HTML `\xFE";
    z += "    Html[-1] = `      MenuBar.collaspable = True`\xFE";
    z += "    Html[-1] = ``\xFE";
    z += "    Html[-1] = `      MenuBar[\"Menus\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Menus\"][\"Main Menu\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Menus\"][\"Main Menu\"].id = \"?Menu\"`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Menus\"][\"Add Page To Menu\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Menus\"][\"Add Page To Menu\"].id = \"?addPageToMenu&projectName=\":@UrlEncode(System(27)):\"&pageName=\":@UrlEncode(edpName):\"&fromPage=\":@UrlEncode(fromPage)`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Menus\"][\"Add Page To Reference Menu\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Menus\"][\"Add Page To Reference Menu\"].id = \"?addPageToReferenceMenu&projectName=\":@UrlEncode(System(27)):\"&pageName=\":@UrlEncode(edpName):\"&fromPage=\":@UrlEncode(fromPage)`\xFE";
    z += "    Html[-1] = ``\xFE";
    z += "    Html[-1] = `      MenuBar[\"TCL\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"TCL\"].id = \"tcl\"`\xFE";
    z += "    Html[-1] = ``\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Security\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Security\"][\"Security\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Web Security\"][\"Security\"].id = \"?WebSiteSecurity&projectName=\":@UrlEncode(System(27)):\"&fromPage=\":@UrlEncode(fromPage)`\xFE";
    z += "    Html[-1] = ``\xFE";
    z += "    Html[-1] = `      MenuBar[\"Websites\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Websites\"][\"ReGen MenuBar\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Websites\"][\"ReGen MenuBar\"].id = \"?updateMenus&projectName=\":@UrlEncode(System(27)):\"&fromPage=\":@UrlEncode(fromPage)`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Websites\"].seperator1 = true`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Websites\"][\"ReGen Website\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Websites\"][\"ReGen Website\"].id = \"?RegenWebSiteModel&projectName=\":@UrlEncode(System(27)):\"&fromPage=\":@UrlEncode(fromPage)`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Websites\"].seperator2 = true`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Websites\"][\"New Website\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Websites\"][\"New Website\"].id = \"?newWebSiteModel&fromPage=\":@UrlEncode(fromPage)`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Websites\"][\"Clone Website\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Websites\"][\"Clone Website\"].id = \"?cloneWebSite&fromPage=\":@UrlEncode(fromPage)`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Websites\"].seperator3 = true`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Websites\"][\"Delete Website\"] = {}`\xFE";
    z += "    Html[-1] = `      MenuBar[\"Websites\"][\"Delete Website\"].id = \"?deleteWebSiteModel&projectName=\":@UrlEncode(System(27)):\"\"`\xFE";
    z += "\xFE";
    z += "    /*\xFE";
    z += "        Html[-1] = ``\xFE";
    z += "        Html[-1] = `      MenuBar[\"Database\"] = {}`\xFE";
    z += "        Html[-1] = `      MenuBar[\"Database\"][\"DB Check\"] = {}`\xFE";
    z += "        Html[-1] = `      MenuBar[\"Database\"][\"DB Check\"].id = \"?DBCheck&projectName=\":@UrlEncode(System(27)):\"&fromPage=\":@UrlEncode(fromPage)`\xFE";
    z += "        Html[-1] = ``\xFE";
    z += "    */\xFE";
    z += "    \xFE";
    z += "    Html[-1] = `   End If`\xFE";
    z += "\xFE";
    z += "    \xFE";
    z += "    Html[-1] = ''\xFE";
    z += "    Html[-1] = `    Dim customMenu As String = '`:ProjectName:`.':NiceName(edpName):'_customMenu'`\xFE";
    z += "    Html[-1] = `    Call @?customMenu(MenuBar)`\xFE";
    z += "    Html[-1] = 'End Sub'\xFE";
    z += "\xFE";
    z += "    Dim NewMenu As String = Join(Html, Crlf())\xFE";
    z += "    OldMenu = Replace(OldMenu, Am(), Crlf())\xFE";
    z += "\xFE";
    z += "    If OldMenu <> NewMenu Or ForceIt Then\xFE";
    z += "        Print @Jsb_mdl.UpdateCode(Html, ProjectName, 'Project_Menus')\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    @Session(\"LastMenuCompile_\":ProjectName) = Time()\xFE";
    z += "End Subroutine\xFE";
    z += ""
    window.cached_jsb_mdl["updatemenu"] = z;
    window.cached_jsb_mdl["updatemenus"] = "Program updateMenus\xFE    * %options aspxC-\xFE    If !IsManager() Then Stop \"You must be at least a manager to run this command\"\xFE\xFE    ProjectName = @ParamVar('ProjectName')\xFE    fromPage = @ParamVar('fromPage')\xFE\xFE    If ProjectName = \"\" And Instr(@Sentence, \"=\") = 0 Then\xFE        Sentence = Field(@Sentence, \"(\", 1)\xFE        ProjectName = Field(Sentence, \" \", 2)\xFE    End If\xFE    \xFE    If !ProjectName Then ProjectName = \"cs\"\xFE\xFE    Call updateMenu(ProjectName, True)\xFE    \xFE    Print @MsgBox('done')\xFE\xFEDone: \xFE    If fromPage Then @Response.Redirect(fromPage) Else Return\xFEEnd Program";
    window.cached_jsb_mdl["urloutputparams"] = "// Build a string for passing URL params\xFEfunction UrlOutputParams(outputFields)\xFE    * %options aspxC-\xFE    \xFE    If !outputFields then return \"\"\xFE    outputFields = json(outputFields)\xFE\xFE    UrlParams = \"\"\xFE    for each Row in outputFields\xFE        If row.scope = \"UrlParam\" Then\xFE            If row.name = \"\" Then row.name = row.field\xFE            if row.name <> \"\" And row.field <> \"\" Then\xFE                If UrlParams Then UrlParams = UrlParams:\"&\" Else UrlParams = \"?\"\xFE                UrlParams = UrlParams:row.name:\"={\":row.field:\"}\"\xFE            End If\xFE        End If\xFE    Next\xFE\xFE    Return UrlParams\xFEEnd Function\xFE\xFE/* Pass our URL parameters through */";
    var z = "function UrlPassThrough(viewModel)\xFE";
    z += "    * %options aspxC-\xFE";
    z += "    \xFE";
    z += "    Html = [`   UrlParams = \"\"`] ;* Returns UrlParams\xFE";
    z += "    inputs = []\xFE";
    z += "    If viewModel.inputs <> \"\" Then inputs = json(viewModel.inputs)\xFE";
    z += "\xFE";
    z += "    * Fetch each Input\xFE";
    z += "    for each Row in inputs\xFE";
    z += "        If row.name = \"\" Then row.name = row.field\xFE";
    z += "        if row.name Then\xFE";
    z += "            varName = niceName(row.name) \xFE";
    z += "            Select Case row.scope\xFE";
    z += "                case \"UrlParam\"\xFE";
    z += "                    Html[-1] = `   `:varName:` = @ParamVar(\"`:row.name:`\")`\xFE";
    z += "                    Html[-1] = `   if !IsNothing(`:varName:`) Then`\xFE";
    z += "                    Html[-1] = `      If UrlParams Then UrlParams := \"&\" Else UrlParams = \"?\"`\xFE";
    z += "                    Html[-1] = `      UrlParams := \"`:row.name:`=\":@UrlEncode(`:varName:`)`\xFE";
    z += "                    Html[-1] = `   End If`\xFE";
    z += "            End Select\xFE";
    z += "        End If\xFE";
    z += "    next\xFE";
    z += "\xFE";
    z += "    Return Join(Html, CRLF())\xFE";
    z += "End Function"
    window.cached_jsb_mdl["urlpassthrough"] = z;
    window.cached_jsb_mdl["viewdefinitions"] = "Function viewDefinitions(ModelColumns)\xFE    * %options aspxC-\xFE    \xFE    viewColumns= []\xFE    For Each XRow In ModelColumns\xFE        If Right(XRow.name, 4) = 'view' Then\xFE            viewColumns[-1] = XRow\xFE        End If\xFE    Next\xFE    Return viewColumns\xFEEnd Function";
    window.cached_jsb_mdl["viewsinpage"] = "Function ViewsInPage(ProjectName, ByVal pageName)\xFE    * %options aspxC-\xFE    \xFE    pageName = @DropIfRight(pageName, \".page\", True):\".page\"\xFE    ReadJson pageDataSet From @fHandle(\"dict\", ProjectName), pageName Else pageDataSet = []\xFE\xFE    Views = []\xFE    For Each jDef In pageDataSet\xFE        If Right(jDef, 4) = \"view\" Then\xFE            viewName = pageDataSet[jDef]\xFE            If viewName Then Views[-1] = viewName\xFE        End If\xFE    Next\xFE\xFE    Views = addNestedViews(ProjectName, Views)\xFE    Return Views\xFEEnd Function";
    window.cached_jsb_mdl["viewwizard"] = "Subroutine ViewWizard(ProjectName, pageName, ViewName, dataSet)\xFE    * %options aspxC-\xFE    \xFE    fDict = @fHandle(\"DICT\", ProjectName)\xFE    ReadJSon dataSet From fDict, ViewName Else Return\xFE\xFE    toType = @InputDropDownBox(\"ViewWizard\", \"Change columns to:\", [\"\", \"Reset Form\",\"Search Form\",\"ReadOnly Form\",\"Menu Form\"], \"\")\xFE    If toType = \"\" Or toType = Chr(27) Then Return\xFE\xFE    Call doWizard(ViewName, dataSet, toType)\xFE    \xFE    WriteJSon dataSet On fDict, ViewName Else Stop @(-1):\"edv-\":System(28):\": \":@Errors\xFE    // Call @jsb_mdl.ReGenPageModel(ProjectName, pageName, False)\xFEEnd Sub";
    window.cached_jsb_mdl["view_excelupload_canceledits"] = "function view_ExcelUpload_cancelEdits(ByVal pkID As String, ByRef rtnErrors As String) As Boolean\xFE    Return True\xFEEnd function";
    var z = "* From parent is either another .view file, or a .page file, or empty\xFE";
    z += "*\xFE";
    z += "Subroutine View_excelupload_checkCommands(ByVal viewVars As Json, ByVal pageBtn As String, ByVal ColumnID As String)\xFE";
    z += "    * What button did the user click?\xFE";
    z += "    Dim Btn As String = pageBtn:@FormVar(\"formBtn_ExcelUpload\"):@FormVar(\"ne_ExcelUpload_formBtn\"):@FormVar(\"contextMenuCmd\")\xFE";
    z += "    Dim rtnErrors As String = \"\", pkID As String = \"\", TransferHtml As String = \"\", UrlParams As String = \"\", Buff As String, Tag As String\xFE";
    z += "\xFE";
    z += "    Call @Jsb_bf.checkStandardCommands(Btn, \"mdl\", \"ExcelUpload.view\", ColumnID, \"ne_ExcelUpload\", False /* mustCompile */, viewVars.fromParentPage, viewVars.parentMultiView, viewVars.htmlBackDrop, Null)\xFE";
    z += "    Dim SuccessOp As Boolean\xFE";
    z += "\xFE";
    z += "    Select Case Btn\xFE";
    z += "        Case \"C\", \"B\", \"Q\" ;* Page Cancel\xFE";
    z += "            Dim Ans As String\xFE";
    z += "            If @view_ExcelUpload_isDirty(viewVars) Then\xFE";
    z += "                Ans = @MsgBox(\"Warning!\", @Language(\"You are about to lose any edits you have made. Continue?\"), \"Yes,No\")\xFE";
    z += "            Else\xFE";
    z += "                Ans = \"Yes\"\xFE";
    z += "            End If\xFE";
    z += "            If Ans = \"Yes\" Then\xFE";
    z += "                If @view_ExcelUpload_cancelEdits(viewVars.currentID, rtnErrors) Then\xFE";
    z += "                    Call View_excelupload_Setup(viewVars)\xFE";
    z += "                ElseIf rtnErrors Then\xFE";
    z += "                    Alert(rtnErrors, False)\xFE";
    z += "                End If\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "        Case \"C!\", \"B!\", \"Q!\"\xFE";
    z += "            Call View_excelupload_Setup(viewVars)\xFE";
    z += "\xFE";
    z += "        Case \"D\"  ;* Multi-Form Delete\xFE";
    z += "            If @view_ExcelUpload_deleteRow(viewVars.currentID, rtnErrors) Then\xFE";
    z += "                viewVars.ParentRefresh = True\xFE";
    z += "            ElseIf rtnErrors Then\xFE";
    z += "                @Alert(rtnErrors, False)\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "        Case \"S\" ;* this Is A Multi-Form Save\xFE";
    z += "            pkID = viewVars.currentID\xFE";
    z += "            If @view_ExcelUpload_writeRow(viewVars.Row, pkID, rtnErrors) Then\xFE";
    z += "                viewVars.currentID = pkID\xFE";
    z += "                viewVars.ParentRefresh = True\xFE";
    z += "\xFE";
    z += "            ElseIf rtnErrors Then\xFE";
    z += "                @Alert(rtnErrors, False)\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "        Case \"Save\" ;* A Server Side Required Button\xFE";
    z += "            pkID = viewVars.currentID\xFE";
    z += "            SuccessOp = @view_ExcelUpload_writeRow(viewVars.Row, pkID, rtnErrors)\xFE";
    z += "            If SuccessOp Then viewVars.currentID = pkID; viewVars.ParentRefresh = True\xFE";
    z += "\xFE";
    z += "            If SuccessOp Then\xFE";
    z += "                UrlParams = \"\"\xFE";
    z += "                TransferHtml = @genEventHandler(\"Transfer\", \"ExcelUpload\":UrlParams, 10 /* Current WIndow */, \"\", 0 /* add fromPage */, False /* passthruParams */)\xFE";
    z += "                If viewVars.ParentRefresh Then TransferHtml := @Script(\"if (parent.refreshData) parent.refreshData();\")\xFE";
    z += "                TransferHtml := @Script('window.eventHandler_Transfer(jsbFormVars(), \"ItemID\");')\xFE";
    z += "\xFE";
    z += "                // Push all our values into a hidden tag to be used by the transfer\xFE";
    z += "                For Each Tag In viewVars.Row\xFE";
    z += "                    TransferHtml = @Hidden(Tag, viewVars.Row[Tag]):TransferHtml\xFE";
    z += "                Next\xFE";
    z += "\xFE";
    z += "                Stop @(-1):TransferHtml\xFE";
    z += "\xFE";
    z += "            ElseIf rtnErrors Then\xFE";
    z += "                @Alert(rtnErrors, False)\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "        Case \"Update\" ;* A Server Side Required Button\xFE";
    z += "            pkID = viewVars.currentID\xFE";
    z += "            SuccessOp = @view_ExcelUpload_writeRow(viewVars.Row, pkID, rtnErrors)\xFE";
    z += "            If SuccessOp Then viewVars.currentID = pkID; viewVars.ParentRefresh = True\xFE";
    z += "\xFE";
    z += "            If SuccessOp Then\xFE";
    z += "                UrlParams = \"\"\xFE";
    z += "                TransferHtml = @genEventHandler(\"Transfer\", \"ExcelUpload\":UrlParams, 10 /* Current WIndow */, \"\", 0 /* add fromPage */, False /* passthruParams */)\xFE";
    z += "                If viewVars.ParentRefresh Then TransferHtml := @Script(\"if (parent.refreshData) parent.refreshData();\")\xFE";
    z += "                TransferHtml := @Script('window.eventHandler_Transfer(jsbFormVars(), \"ItemID\");')\xFE";
    z += "\xFE";
    z += "                // Push all our values into a hidden tag to be used by the transfer\xFE";
    z += "                For Each Tag In viewVars.Row\xFE";
    z += "                    TransferHtml = @Hidden(Tag, viewVars.Row[Tag]):TransferHtml\xFE";
    z += "                Next\xFE";
    z += "\xFE";
    z += "                Stop @(-1):TransferHtml\xFE";
    z += "\xFE";
    z += "            ElseIf rtnErrors Then\xFE";
    z += "                @Alert(rtnErrors, False)\xFE";
    z += "            End If\xFE";
    z += "\xFE";
    z += "        Case \"Cancel\", \"\"\xFE";
    z += "\xFE";
    z += "        Case Else\xFE";
    z += "            * @Alert(\"Form ExcelUpload.view got a '\":Btn:\"' on column \":ColumnID)\xFE";
    z += "    End Select\xFE";
    z += "End Sub"
    window.cached_jsb_mdl["view_excelupload_checkcommands"] = z;
    window.cached_jsb_mdl["view_excelupload_deleterow"] = "function view_ExcelUpload_deleteRow(ByVal pkID As String, ByRef rtnErrors As String) As Boolean\xFE    Dim fTable As Table\xFE\xFE    If !@Jsb_bf.OpenTable(\"tmp\", \"ExcelUpload.view\", fTable, rtnErrors) Then Return False\xFE    If pkID = \"\" Then rtnErrors = \"No primary key defined.  Delete failed\"; Return False\xFE\xFE    Delete fTable, pkID Else\xFE        rtnErrors = @Errors\xFE        LogErr(rtnErrors)\xFE        Return False\xFE    End If\xFE\xFE    Return True\xFEEnd function";
    window.cached_jsb_mdl["view_excelupload_display_cc"] = "Subroutine view_ExcelUpload_Display_cc(ByVal viewVars As Json, ByRef Html As String, ByRef ToolBar As String)\xFE    * Any extra setup needed\xFEEnd Sub";
    window.cached_jsb_mdl["view_excelupload_getpk"] = "function view_ExcelUpload_getPK(ByVal SqlFilter As String, ByRef pkID As String, ByRef rtnErrors As String) As Boolean\xFE    Dim selectHandle As SelectList\xFE    Dim fTable As Table\xFE\xFE    If !@Jsb_bf.OpenTable(\"tmp\", \"ExcelUpload.view\", fTable, rtnErrors) Then Return False\xFE\xFE    Select fTable To selectHandle Where SqlFilter Else\xFE        rtnErrors = \"Form-\":System(28):\"-Select-\":SqlFilter:\": \":@Errors\xFE        LogErr(rtnErrors)\xFE        Return False\xFE    End If\xFE\xFE    ReadNext pkID From selectHandle Else rtnErrors = \"No items found in table 'tmp' Where \":SqlFilter\xFE\xFE    Return True\xFEEnd function";
    var z = "function view_ExcelUpload_isDirty(ByVal viewVars As Json) As Boolean\xFE";
    z += "    Return False\xFE";
    z += "End function\xFE";
    z += "function view_ExcelUpload_isDirty(ByVal viewVars As Json) As Boolean\xFE";
    z += "    Dim currentRow As Json = viewVars.Row\xFE";
    z += "    Dim originalRow As Json = viewVars.OriginalRow\xFE";
    z += "    If currentRow['DataMustHaveOneNumericRow'] <> originalRow['DataMustHaveOneNumericRow'] Then Return True\xFE";
    z += "    If currentRow['SideBySideTables'] <> originalRow['SideBySideTables'] Then Return True\xFE";
    z += "    If currentRow['ignoreTablesWithNoRows'] <> originalRow['ignoreTablesWithNoRows'] Then Return True\xFE";
    z += "    If currentRow['ignoreTablesWithLessThanNColumns'] <> originalRow['ignoreTablesWithLessThanNColumns'] Then Return True\xFE";
    z += "    If currentRow['OneTablePerSheet'] <> originalRow['OneTablePerSheet'] Then Return True\xFE";
    z += "    If currentRow['AllowBlankRows'] <> originalRow['AllowBlankRows'] Then Return True\xFE";
    z += "    If currentRow['DefaultEmptyValuesFromPreviousRow'] <> originalRow['DefaultEmptyValuesFromPreviousRow'] Then Return True\xFE";
    z += "    If currentRow['deleteAndRecreateTables'] <> originalRow['deleteAndRecreateTables'] Then Return True\xFE";
    z += "    If currentRow['showTables'] <> originalRow['showTables'] Then Return True\xFE";
    z += "    If currentRow['commonDatabaseName'] <> originalRow['commonDatabaseName'] Then Return True\xFE";
    z += "    Return False\xFE";
    z += "End function"
    window.cached_jsb_mdl["view_excelupload_isdirty"] = z;
    window.cached_jsb_mdl["view_excelupload_newrow"] = "* Create a empty row with defaults\xFEfunction view_ExcelUpload_newRow(ByRef rtnErrors As String) As Json\xFE    Return view_ExcelUpload_setDefaults({})\xFEEnd function";
    var z = "function view_ExcelUpload_readRow(ByVal pkID As String, ByRef rtnRow As Json, ByRef rtnErrors As String) As Boolean\xFE";
    z += "\xFE";
    z += "    AttachDB \"sysprog\" Else rtnErrors = @Errors; Return Null\xFE";
    z += "\xFE";
    z += "    Dim fTable As Table\xFE";
    z += "    If !@Jsb_bf.OpenTable(\"tmp\", \"ExcelUpload.view\", fTable, rtnErrors) Then Return False\xFE";
    z += "    If pkID = \"\" Then Return @view_ExcelUpload_newRow(rtnErrors)\xFE";
    z += "\xFE";
    z += "    ReadJSon rtnRow From fTable, pkID Else\xFE";
    z += "        rtnErrors = @Errors\xFE";
    z += "        If rtnErrors = \"\" Then rtnErrors =  \"Item '\":pkID:\"' in 'ExcelUpload.view' not found.\"\xFE";
    z += "        LogErr(rtnErrors)\xFE";
    z += "        Return False\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    If rtnRow.ItemID And HasTag(rtnRow, \"ItemContent\") Then\xFE";
    z += "        Dim sItem As String = rtnRow.ItemContent\xFE";
    z += "        Dim Item As Array\xFE";
    z += "        If Instr(sItem, Crlf()) Then Item = Split(sItem, Crlf()) Else Item = Split(sItem, Am())\xFE";
    z += "        rtnRow = { isA_CrlF_TextFile: true }\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    Return True\xFE";
    z += "End function"
    window.cached_jsb_mdl["view_excelupload_readrow"] = z;
    window.cached_jsb_mdl["view_excelupload_setdefaults"] = "function view_ExcelUpload_setDefaults(ByVal rtnRow As Json) As Json\xFE    rtnRow['DataMustHaveOneNumericRow'] = 1\xFE    rtnRow['ignoreTablesWithNoRows'] = 1\xFE    rtnRow['ignoreTablesWithLessThanNColumns'] = 7\xFE    rtnRow['OneTablePerSheet'] = 1\xFE    rtnRow['AllowBlankRows'] = 1\xFE    rtnRow['showTables'] = 1\xFE\xFE    Return rtnRow\xFEEnd function";
    var z = "*\xFE";
    z += "Subroutine View_excelupload_Setup(viewVars As Json, optional byval BaseDirectory as string, optional byval XlsFileName as string, optional byval sqlDBName as string)\xFE";
    z += "    AttachDB \"sysprog\" Else Null\xFE";
    z += "    \xFE";
    z += "    if !viewVars Then \xFE";
    z += "        Dim Row As Json = {}\xFE";
    z += "        Row.DataMustHaveOneNumericRow = True\xFE";
    z += "        Row.SideBySideTables = False\xFE";
    z += "        Row.ignoreTablesWithNoRows = True\xFE";
    z += "        Row.ignoreTablesWithLessThanNColumns = 7\xFE";
    z += "        Row.OneTablePerSheet = True\xFE";
    z += "        Row.AllowBlankRows = True\xFE";
    z += "        Row.DefaultEmptyValuesFromPreviousRow = False\xFE";
    z += "        Row.deleteAndRecreateTables = True\xFE";
    z += "        Row.showTables = True\xFE";
    z += "        Row.commonDatabaseName = sqlDBName\xFE";
    z += "        Row.XlsFileName = XlsFileName\xFE";
    z += "        Row.BaseDirectory = BaseDirectory\xFE";
    z += "        Row.verbose = true\xFE";
    z += "        Row.columnNamesUsed = []\xFE";
    z += "        \xFE";
    z += "        viewVars = {  }\xFE";
    z += "        viewVars.Row = Row\xFE";
    z += "    End If\xFE";
    z += "    \xFE";
    z += "    Dim currentID As String = \"\" ;* this Will Be Set Here Or By Write\xFE";
    z += "    Dim rtnErrors As String = \"\"\xFE";
    z += "    Dim SqlFilter As String\xFE";
    z += "    Dim SqlColumns As String\xFE";
    z += "\xFE";
    z += "    If Instr(@Url, \"newRecord=1\") Then\xFE";
    z += "        Row = @view_ExcelUpload_newRow(rtnErrors)\xFE";
    z += "        If rtnErrors And !@IspostBack Then @Alert(rtnErrors, True)\xFE";
    z += "    Else\xFE";
    z += "        Row = {}\xFE";
    z += "        SqlFilter = ''\xFE";
    z += "        SqlColumns = `[DataMustHaveOneNumericRow],[SideBySideTables],[ignoreTablesWithNoRows],[ignoreTablesWithLessThanNColumns],[OneTablePerSheet],[AllowBlankRows],[DefaultEmptyValuesFromPreviousRow],[deleteAndRecreateTables],[showTables],[commonDatabaseName]`\xFE";
    z += "\xFE";
    z += "        If rtnErrors And !@IspostBack Then @Alert(rtnErrors, True)\xFE";
    z += "\xFE";
    z += "        * Based on current filtering (SqlFilter), Get a record ID (PrimaryKey)\xFE";
    z += "        If !@view_ExcelUpload_getPK(SqlFilter, currentID, rtnErrors) And !@IspostBack Then Alert(rtnErrors, True)\xFE";
    z += "\xFE";
    z += "        If currentID = \"\" Then\xFE";
    z += "            rtnErrors = \"\"\xFE";
    z += "            Row = @view_ExcelUpload_newRow(rtnErrors)\xFE";
    z += "            If rtnErrors And !@IspostBack Then @Alert(rtnErrors, True)\xFE";
    z += "\xFE";
    z += "        Else If @view_ExcelUpload_readRow(currentID, Row, rtnErrors) Then\xFE";
    z += "            Row = view_ExcelUpload_setDefaults(Row)\xFE";
    z += "        Else\xFE";
    z += "            * Didn't find record\xFE";
    z += "            If !Row Then Row = {}\xFE";
    z += "            If rtnErrors And !@IspostBack Then @Alert(rtnErrors, False)\xFE";
    z += "        End If\xFE";
    z += "\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    viewVars.Row = Row\xFE";
    z += "    viewVars.currentID = currentID ;* Will Always Be Blank If New Record (Updated On Write)\xFE";
    z += "    viewVars.htmlBackDrop = \"\"\xFE";
    z += "    viewVars.OriginalRow = Clone(Row)\xFE";
    z += "    \xFE";
    z += "End Subroutine\xFE";
    z += ""
    window.cached_jsb_mdl["view_excelupload_setup"] = z;
    var z = "Subroutine View_excelupload_Unload(ByVal viewVars As Json)\xFE";
    z += "    * Unload the submitted form fields (@FormVars) into the edit row (viewvars.row)\xFE";
    z += "    Dim Row As Json = viewVars.Row\xFE";
    z += "    Dim unloadedValue As String\xFE";
    z += "\xFE";
    z += "    unloadedValue = @FormVar(\"DataMustHaveOneNumericRow\")\xFE";
    z += "    If unloadedValue Then Row[\"DataMustHaveOneNumericRow\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"SideBySideTables\")\xFE";
    z += "    If unloadedValue Then Row[\"SideBySideTables\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"ignoreTablesWithNoRows\")\xFE";
    z += "    If unloadedValue Then Row[\"ignoreTablesWithNoRows\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"ignoreTablesWithLessThanNColumns\")\xFE";
    z += "    If unloadedValue Then Row[\"ignoreTablesWithLessThanNColumns\"] = unloadedValue\xFE";
    z += "\xFE";
    z += "End Subroutine\xFE";
    z += "\xFE";
    z += "Subroutine View_excelupload_Unload(ByVal viewVars As Json)\xFE";
    z += "    * Unload the submitted form fields (@FormVars) into the edit row (viewvars.row)\xFE";
    z += "    Dim Row As Json = viewVars.Row\xFE";
    z += "    Dim unloadedValue As String\xFE";
    z += "\xFE";
    z += "    unloadedValue = @FormVar(\"DataMustHaveOneNumericRow\")\xFE";
    z += "    If unloadedValue Then Row[\"DataMustHaveOneNumericRow\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"SideBySideTables\")\xFE";
    z += "    If unloadedValue Then Row[\"SideBySideTables\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"ignoreTablesWithNoRows\")\xFE";
    z += "    If unloadedValue Then Row[\"ignoreTablesWithNoRows\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"ignoreTablesWithLessThanNColumns\")\xFE";
    z += "\xFE";
    z += "    If Len(unloadedValue) Then Row[\"ignoreTablesWithLessThanNColumns\"] = CInt(Val(unloadedValue))\xFE";
    z += "    unloadedValue = @FormVar(\"OneTablePerSheet\")\xFE";
    z += "    If unloadedValue Then Row[\"OneTablePerSheet\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"AllowBlankRows\")\xFE";
    z += "    If unloadedValue Then Row[\"AllowBlankRows\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"DefaultEmptyValuesFromPreviousRow\")\xFE";
    z += "    If unloadedValue Then Row[\"DefaultEmptyValuesFromPreviousRow\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"deleteAndRecreateTables\")\xFE";
    z += "    If unloadedValue Then Row[\"deleteAndRecreateTables\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"showTables\")\xFE";
    z += "    If unloadedValue Then Row[\"showTables\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"commonDatabaseName\")\xFE";
    z += "    If unloadedValue Then Row[\"commonDatabaseName\"] = unloadedValue\xFE";
    z += "\xFE";
    z += "End Subroutine\xFE";
    z += "* view_ExcelUpload_Unload(ByVal viewVars As JSON) - can be done genericaly with:\xFE";
    z += "*     ReadJSon viewModel From @fHandle(\"DICT\", \"mdl\"), \"ExcelUpload.view\" Else viewModel = {}; Alert('Missing dict mdl, ExcelUpload.view', True)\xFE";
    z += "*     @jsb_mdl.standardUnload(viewModel.columns, viewVars.Row, false)\xFE";
    z += "*\xFE";
    z += "Subroutine View_excelupload_Unload(ByVal viewVars As Json)\xFE";
    z += "    * Unload the submitted form fields (@FormVars) into the edit row (viewvars.row)\xFE";
    z += "    Dim Row As Json = viewVars.Row\xFE";
    z += "    Dim unloadedValue As String\xFE";
    z += "\xFE";
    z += "    unloadedValue = @FormVar(\"DataMustHaveOneNumericRow\")\xFE";
    z += "    If unloadedValue Then Row[\"DataMustHaveOneNumericRow\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"SideBySideTables\")\xFE";
    z += "    If unloadedValue Then Row[\"SideBySideTables\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"ignoreTablesWithNoRows\")\xFE";
    z += "    If unloadedValue Then Row[\"ignoreTablesWithNoRows\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"ignoreTablesWithLessThanNColumns\")\xFE";
    z += "\xFE";
    z += "    If Len(unloadedValue) Then Row[\"ignoreTablesWithLessThanNColumns\"] = CInt(Val(unloadedValue))\xFE";
    z += "    unloadedValue = @FormVar(\"OneTablePerSheet\")\xFE";
    z += "    If unloadedValue Then Row[\"OneTablePerSheet\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"AllowBlankRows\")\xFE";
    z += "    If unloadedValue Then Row[\"AllowBlankRows\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"DefaultEmptyValuesFromPreviousRow\")\xFE";
    z += "    If unloadedValue Then Row[\"DefaultEmptyValuesFromPreviousRow\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"deleteAndRecreateTables\")\xFE";
    z += "    If unloadedValue Then Row[\"deleteAndRecreateTables\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"showTables\")\xFE";
    z += "    If unloadedValue Then Row[\"showTables\"] = unloadedValue\xFE";
    z += "    unloadedValue = @FormVar(\"commonDatabaseName\")\xFE";
    z += "    If unloadedValue Then Row[\"commonDatabaseName\"] = unloadedValue\xFE";
    z += "\xFE";
    z += "End Subroutine"
    window.cached_jsb_mdl["view_excelupload_unload"] = z;
    var z = "function view_ExcelUpload_writeRow(ByVal Row As Json, ByRef pkID As String, ByRef rtnErrors As String) As Boolean\xFE";
    z += "    * Verify anything in Row you want here with custom code - return False and rtnErrors\xFE";
    z += "    Dim newRecord As Boolean = !pkID\xFE";
    z += "    Dim fTable As Table\xFE";
    z += "    If !@Jsb_bf.OpenTable(\"tmp\", \"ExcelUpload.view\", fTable, rtnErrors) Then Return False\xFE";
    z += "\xFE";
    z += "    * If this is a new record get a default primary key value (or set one here in code)\xFE";
    z += "    If newRecord Then\xFE";
    z += "        If HasTag(Row, \"\") Then pkID = Row[\"\"] Else rtnErrors = \"No default set for new row's primary key \"; Return False\xFE";
    z += "        WriteJson Row On fTable, pkID Else Goto ErrWrite\xFE";
    z += "\xFE";
    z += "    Else\xFE";
    z += "        If HasTag(Row, \"isA_CrlF_TextFile\") Then\xFE";
    z += "            Dim sUpdatedRow As String = \"\"\xFE";
    z += "            Read sUpdatedRow From fTable, pkID Else sUpdatedRow = \"\"\xFE";
    z += "            Write sUpdatedRow On fTable, pkID Else Goto ErrWrite\xFE";
    z += "\xFE";
    z += "        Else\xFE";
    z += "            Dim updatedRow As Json, Tag As String\xFE";
    z += "            ReadJSon updatedRow From fTable, pkID Else updatedRow = {}\xFE";
    z += "            For Each Tag In Row\xFE";
    z += "                If LCase(Tag) <> \"ItemID\" Then updatedRow[Tag] = Row[Tag]\xFE";
    z += "            Next\xFE";
    z += "            WriteJson updatedRow On fTable, pkID Else Goto ErrWrite\xFE";
    z += "        End If\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    * Alert(\"Record Saved\", False)\xFE";
    z += "    Return True\xFE";
    z += "\xFE";
    z += "ErrWrite: \xFE";
    z += "    If newRecord Then pkID = \"\" ;* Restore To New Record\xFE";
    z += "    rtnErrors = @Errors\xFE";
    z += "    LogErr(rtnErrors)\xFE";
    z += "    Return False\xFE";
    z += "End function"
    window.cached_jsb_mdl["view_excelupload_writerow"] = z;
    window.cached_jsb_mdl["websitemodel"] = "Sub WebSiteModel\xFE* %options aspxC-\xFEEnd Sub";
    var z = "program WebSiteSecurity\xFE";
    z += "* %options aspxC-\xFE";
    z += "    if !IsAdmin() Then Stop \"You must be an administrator to run this command\"\xFE";
    z += "\xFE";
    z += "    ProjectName = @ParamVar('ProjectName')\xFE";
    z += "    fromPage = @ParamVar('fromPage')\xFE";
    z += "\xFE";
    z += "    // If ProjectName = \"\" And !Len(@ParamVars) Then  \xFE";
    z += "    If ProjectName = \"\" Then  \xFE";
    z += "        Sentence = Field(@Sentence, \"(\", 1)\xFE";
    z += "        ProjectName = Field(Sentence, \" \", 2)\xFE";
    z += "    End If\xFE";
    z += "    If ProjectName = \"\" Then ProjectName = \"cs\"\xFE";
    z += "\xFE";
    z += "    open \"dict\", ProjectName to f else stop @errors\xFE";
    z += "    select from f to sl where \"ItemID like '%.page'\" Else Stop @Errors\xFE";
    z += "    pages = getlist(sl)\xFE";
    z += "\xFE";
    z += "    Choices = [\"Admin\",\"Director\",\"Manager\",\"Clerk\",\"Employee\",\"User\",\"Anonymous\",\"<delete>\"]\xFE";
    z += "\xFE";
    z += "    Print @(-1):\"Web site Security for \":ProjectName\xFE";
    z += "    print\xFE";
    z += "    print \"Choose the mimimum level of security for each page\"\xFE";
    z += "    Print\xFE";
    z += "    Print @Html('<div class=\"container\">'):\xFE";
    z += "    for Each PageName In Pages\xFE";
    z += "        ReadJson Page From f, PageName Else Stop @Errors\xFE";
    z += "        R = Page.minimumRole\xFE";
    z += "        Locate R in Choices Else R = \"Anonymous\"\xFE";
    z += "        PN = @DropIfRight(PageName, '.page', true)\xFE";
    z += "        Print @lblCtlSet(PN, @RadioBtns(PN, Choices, R), PN, True):\xFE";
    z += "    Next\xFE";
    z += "    Print @Html('</div>') ;* Container\xFE";
    z += "    Print\xFE";
    z += "    print @SaveBtn(\"btn\", \"Save\"):@SaveBtn(\"btn\", \"Cancel\"):\xFE";
    z += "\xFE";
    z += "    @Server.Pause\xFE";
    z += "    Print @(-1):\xFE";
    z += "    b = @FormVar('btn')\xFE";
    z += "    updatethemenus = false\xFE";
    z += "\xFE";
    z += "    If B = \"Save\" Then      \xFE";
    z += "        Values = {}\xFE";
    z += "        for Each PageName In Pages\xFE";
    z += "            PN = @DropIfRight(PageName, '.page', true)\xFE";
    z += "            Values[PN] = @FormVar(PN)\xFE";
    z += "        next\xFE";
    z += "\xFE";
    z += "        for Each PageName In Pages\xFE";
    z += "            PN = @DropIfRight(PageName, '.page')\xFE";
    z += "            PageName = PN:'.page'\xFE";
    z += "            V = Values[PN]\xFE";
    z += "            If V Then\xFE";
    z += "                If V = \"<delete>\" Then\xFE";
    z += "                    If !@deletePageModel(ProjectName, pageName) Then Alert(@Errors)\xFE";
    z += "                    updatethemenus = true\xFE";
    z += "\xFE";
    z += "                Else\xFE";
    z += "                    ReadJson P From f, PageName Else Stop @Errors\xFE";
    z += "                    R = P.minimumRole\xFE";
    z += "                    Locate R in Choices Else R = \"Anonymous\"\xFE";
    z += "                    If R <> V Then\xFE";
    z += "                        P.minimumRole = V\xFE";
    z += "                        WriteJSon P On f, PageName Else Stop @(-1):\"WebSiteSecurity-\":System(28):\": \":@Errors\xFE";
    z += "                        \xFE";
    z += "                        print \"Regenerating \":pagename; @Server.Flush\xFE";
    z += "                        Call ReGenPageModel(ProjectName, pageName, False)\xFE";
    z += "                        updatethemenus = true\xFE";
    z += "                    End If\xFE";
    z += "                End If\xFE";
    z += "            End If\xFE";
    z += "        Next\xFE";
    z += "    End If\xFE";
    z += "\xFE";
    z += "    if updatethemenus then Call @jsb_mdl.UpdateMenu(ProjectName)             \xFE";
    z += "    If fromPage Then @Response.Redirect(fromPage)\xFE";
    z += "end program"
    window.cached_jsb_mdl["websitesecurity"] = z;
}
anonymousFunc()
anonymousFunc = null